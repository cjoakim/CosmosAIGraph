{
  "libtype": "pypi",
  "libname": "yoyo-migrations",
  "url": "https://ollycope.com/software/yoyo/latest/",
  "html": "<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"utf-8\" /><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /><meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />    <title>Yoyo database migrations \u2014 yoyo-migrations 8.1.0 documentation</title><link rel=\"stylesheet\" href=\"_static/pygments.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"_static/frescotheme.css\" type=\"text/css\" /><link      href=\"_static/pygments.css\"       rel=\"stylesheet\" type=\"text/css\"/><link      href=\"_static/frescotheme.css\"       rel=\"stylesheet\" type=\"text/css\"/><script src=\"_static/documentation_options.js\"  data_url_root=\"\" id=\"documentation_options\"></script><script src=\"_static/jquery.js\" ></script><script src=\"_static/underscore.js\" ></script><script src=\"_static/_sphinx_javascript_frameworks_compat.js\" ></script><script src=\"_static/doctools.js\" ></script><script src=\"_static/sphinx_highlight.js\" ></script><link rel=\"index\" title=\"Index\" href=\"genindex.html\" /><link rel=\"search\" title=\"Search\" href=\"search.html\" /><link href=\"https://fonts.googleapis.com/css2?family=Bitter:wght@400;700&display=swap\" rel=\"stylesheet\"/></head><body><header><div class=\"SearchBox\" id=\"searchbox\" style=\"display: none\" role=\"search\"><form class=\"search\" action=\"search.html\" method=\"get\"><label class=\"SearchIcon\" for=\"searchinput\" id=\"searchlabel\">\u26b2</label><div><input id=\"searchinput\" type=\"text\" name=\"q\" placeholder=\"Search yoyo-migrations documentation\"  aria-labelledby=\"searchlabel\"/></div><div><button type=\"submit\" >Go</button></div><input type=\"hidden\" name=\"check_keywords\" value=\"yes\" /><input type=\"hidden\" name=\"area\" value=\"default\" /></form></div><script>$('#searchbox').show(0);</script><div class=\"BreadcrumbsWrapper\"><div class=\"Breadcrumbs\"><span itemscope=\"\"              itemtype=\"http://data-vocabulary.org/Breadcrumb\"              id=\"breadcrumb-0\"               itemref=\"breadcrumb-1\"><a href=\"#\" itemprop=\"url\"><span itemprop=\"title\">yoyo-migrations 8.1.0 documentation</span></a></span><h1 itemscope=\"\"              itemtype=\"http://data-vocabulary.org/Breadcrumb\"              id=\"breadcrumb-1\"              ><a href=\"#\" itemprop=\"url\"><span itemprop=\"title\">Yoyo database migrations</span></a></h1></div></div></header><div class=\"DocumentWrapper\" ><div class=\"Document\" role=\"main\" ><section id=\"yoyo-database-migrations\"><h1>Yoyo database migrations<a class=\"headerlink\" href=\"#yoyo-database-migrations\" title=\"Permalink to this heading\">\u00b6</a></h1><p><a class=\"reference external\" href=\"https://sr.ht/~olly/yoyo\">Source repository and issue tracker</a></p><p>Yoyo is a database schema migration tool. Migrations are written asSQL files or Python scripts that define a list of migration steps.They can be as simple as this:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># file: migrations/0001.create-foo.py</span><span class=\"kn\">from</span> <span class=\"nn\">yoyo</span> <span class=\"kn\">import</span> <span class=\"n\">step</span><span class=\"n\">steps</span> <span class=\"o\">=</span> <span class=\"p\">[</span>   <span class=\"n\">step</span><span class=\"p\">(</span>       <span class=\"s2\">&quot;CREATE TABLE foo (id INT, bar VARCHAR(20), PRIMARY KEY (id))&quot;</span><span class=\"p\">,</span>       <span class=\"s2\">&quot;DROP TABLE foo&quot;</span>   <span class=\"p\">)</span><span class=\"p\">]</span></pre></div></div><section id=\"installation-and-project-setup\"><h2>Installation and project setup<a class=\"headerlink\" href=\"#installation-and-project-setup\" title=\"Permalink to this heading\">\u00b6</a></h2><p>Install yoyo-migrations from PyPI:</p><div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>pip install yoyo-migrations</pre></div></div><p>Initialize yoyo for your project, supplying a database connection string and migrations directory name, for example:</p><div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>yoyo init --database sqlite:///mydb.sqlite3 migrations</pre></div></div><p>This will create a new, empty directory called <code class=\"docutils literal notranslate\"><span class=\"pre\">migrations</span></code> and install a<code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo.ini</span></code> configuration file in the current directory. The configuration filewill contain any database credentials supplied on the command line. If you donot wish this to happen, then omit the <code class=\"docutils literal notranslate\"><span class=\"pre\">--database</span></code> argument from thecommand.</p><p>Create a new migration by running <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">new</span></code>. By default, a Python format file is generated, use <code class=\"docutils literal notranslate\"><span class=\"pre\">--sql</span></code> if you prefer SQL format:</p><div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>yoyo new --sql</pre></div></div><p>An editor will open with a template migration file.Add a comment explaining what the migration does followed by the SQL commands,for example:</p><div class=\"highlight-sql notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">-- Create table foo</span><span class=\"c1\">-- depends:</span><span class=\"k\">CREATE</span><span class=\"w\"> </span><span class=\"k\">TABLE</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"w\"></span><span class=\"w\">     </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"nb\">int</span><span class=\"w\"></span><span class=\"p\">);</span><span class=\"w\"></span></pre></div></div><p>Save and exit, and the new migration file will be created.Check your migration has been created with <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">list</span></code> and apply it with<code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">apply</span></code>:</p><div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>$ yoyo list$ yoyo apply</pre></div></div></section><section id=\"command-line-usage\"><h2>Command line usage<a class=\"headerlink\" href=\"#command-line-usage\" title=\"Permalink to this heading\">\u00b6</a></h2><p>You can see the list of available commands by running:</p><div class=\"highlight-text notranslate\"><div class=\"highlight\"><pre><span></span>$ yoyo --helpusage: yoyo [-h] [--config CONFIG] [-v] [-b] [--no-config-file]            {init,apply,develop,list,rollback,reapply,mark,unmark,break-lock,new}            ...positional arguments:  {init,apply,develop,list,rollback,reapply,mark,unmark,break-lock,new}                        Commands help    init                Initialize a new project    apply               Apply migrations    develop             Apply migrations without prompting. If there are no                        unapplied migrations, reapply the last migration    list                List all available and applied migrations. Each listed                        migration is prefixed with either A (applied) or U                        (unapplied)    rollback            Rollback migrations    reapply             Rollback then reapply migrations    mark                Mark migrations as applied, without running them    unmark              Unmark applied migrations, without rolling them back    break-lock          Break migration locks    new                 Create a new migrationoptions:  -h, --help            show this help message and exit  --config CONFIG, -c CONFIG                        Path to config file  -v                    Verbose output. Use multiple times to increase level                        of verbosity  -b, --batch           Run in batch mode. Turns off all user prompts  --no-config-file, --no-cache                        Don&#39;t look for a yoyo.ini config file</pre></div></div><p>You can check options for any command with <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">&lt;command&gt;</span> <span class=\"pre\">--help</span></code></p><section id=\"yoyo-new\"><h3>yoyo new<a class=\"headerlink\" href=\"#yoyo-new\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Start a new migration. <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">new</span></code> will create a new migration file and opens it your configured editor.</p><p>By default a Python formation migration will be created. To use the simpler SQL format, specify <code class=\"docutils literal notranslate\"><span class=\"pre\">--sql</span></code>.</p><div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>yoyo new -m <span class=\"s2\">&quot;Add column to foo&quot;</span>yoyo new --sql</pre></div></div></section><section id=\"yoyo-list\"><h3>yoyo list<a class=\"headerlink\" href=\"#yoyo-list\" title=\"Permalink to this heading\">\u00b6</a></h3><p>List available migrations. Each migration will be prefixed with one of <code class=\"docutils literal notranslate\"><span class=\"pre\">U</span></code>(unapplied) or <code class=\"docutils literal notranslate\"><span class=\"pre\">A</span></code> (applied).</p></section><section id=\"yoyo-apply\"><h3>yoyo apply<a class=\"headerlink\" href=\"#yoyo-apply\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Apply migrations to the target database. By default this will prompt you for each unapplied migration. To turn off prompting use <code class=\"docutils literal notranslate\"><span class=\"pre\">--batch</span></code> or specify <code class=\"docutils literal notranslate\"><span class=\"pre\">batch_mode</span> <span class=\"pre\">=</span> <span class=\"pre\">on</span></code> in <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo.ini</span></code>.</p></section><section id=\"yoyo-rollback\"><h3>yoyo rollback<a class=\"headerlink\" href=\"#yoyo-rollback\" title=\"Permalink to this heading\">\u00b6</a></h3><p>By default this will prompt you for each applied migration, starting with the most recently applied.</p><p>If you wish to rollback a single migration, specify the migration with the <code class=\"docutils literal notranslate\"><span class=\"pre\">-r</span></code>/<code class=\"docutils literal notranslate\"><span class=\"pre\">--revision</span></code> flag. Note that this will also cause any migrations that depend on the selected migration to be rolled back.</p></section><section id=\"yoyo-reapply\"><h3>yoyo reapply<a class=\"headerlink\" href=\"#yoyo-reapply\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Reapply (ie rollback then apply again) migrations. As with <a class=\"reference internal\" href=\"#yoyo-rollback\">yoyo rollback</a>, you can select a target migration with <code class=\"docutils literal notranslate\"><span class=\"pre\">-r</span></code>/<code class=\"docutils literal notranslate\"><span class=\"pre\">--revision</span></code></p></section><section id=\"yoyo-develop\"><h3>yoyo develop<a class=\"headerlink\" href=\"#yoyo-develop\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Apply any unapplied migrations without prompting.</p><p>If there are no unapplied migrations, rollback and reapply the most recentmigration. Use <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">develop</span> <span class=\"pre\">-n</span> <span class=\"pre\">&lt;n&gt;</span></code> to act on just the <em>n</em> most recentlyapplied migrations.</p></section><section id=\"yoyo-mark\"><h3>yoyo mark<a class=\"headerlink\" href=\"#yoyo-mark\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Mark one or more migrations as applied, without actually applying them.</p></section><section id=\"yoyo-unmark\"><h3>yoyo unmark<a class=\"headerlink\" href=\"#yoyo-unmark\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Unmark one or more migrations as unapplied, without actually rolling them back.</p></section></section><section id=\"connecting-to-a-database\"><h2>Connecting to a database<a class=\"headerlink\" href=\"#connecting-to-a-database\" title=\"Permalink to this heading\">\u00b6</a></h2><p>Database connections are specified using a URL, for example:</p><div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>yoyo list --database postgresql://scott:tiger@localhost/mydatabase</pre></div></div><p>The protocol part of the URL (the part before <code class=\"docutils literal notranslate\"><span class=\"pre\">://</span></code>) is used to specify the backend.Yoyo provides the following core backends:</p><ul class=\"simple\"><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">postgresql</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/psycopg2/\">psycopg2</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">postgresql+psycopg</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/psycopg/\">psycopg3</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">mysql</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/pymysql/\">pymysql</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">mysql+mysqldb</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/mysqlclient/\">mysqlclient</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">sqlite</span></code> (<a class=\"reference external\" href=\"https://docs.python.org/3/library/sqlite3.html\">sqlite3</a>)</p></li></ul><p>And these backends have been contributed and are bundled with yoyo:</p><ul class=\"simple\"><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">odbc</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/pyodbc/\">pyodbc</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">oracle</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/cx-Oracle/\">cx_Oracle</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">snowflake</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/snowflake-connector-python/\">snowflake</a>)</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">redshift</span></code> (<a class=\"reference external\" href=\"https://pypi.org/project/psycopg2/\">psycopg2</a>)</p></li></ul><p>How other parts of the URL are interpreted depends on the underlying backendand the DB-API driver used. The host part especially tends to be interpreteddifferently by drivers. A few of the more important differences are listed below.</p><section id=\"mysql-connections\"><h3>MySQL connections<a class=\"headerlink\" href=\"#mysql-connections\" title=\"Permalink to this heading\">\u00b6</a></h3><p><a class=\"reference external\" href=\"https://pypi.org/project/mysqlclient/\">mysqlclient</a> and <a class=\"reference external\" href=\"https://pypi.org/project/pymysql/\">pymysql</a> havedifferent ways to interpret the <code class=\"docutils literal notranslate\"><span class=\"pre\">host</span></code> part of the connection URL:</p><ul class=\"simple\"><li><p>With <a class=\"reference external\" href=\"https://pypi.org/project/mysqlclient/\">mysqlclient</a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">mysql+mysqldb://</span></code>),setting the host to <code class=\"docutils literal notranslate\"><span class=\"pre\">localhost</span></code> or leaving it empty causes thedriver to attempt a local unix socket connection.</p></li><li><p>In <a class=\"reference external\" href=\"https://pypi.org/project/pymysql/\">pymysql</a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">mysql://</span></code>),the driver will attempt a tcp connection in both cases.Specify a unix socket connectionwith the <code class=\"docutils literal notranslate\"><span class=\"pre\">unix_socket</span></code> option (eg <code class=\"docutils literal notranslate\"><span class=\"pre\">?unix_socket=/tmp/mysql.sock</span></code>)</p></li></ul><p>To enable SSL, specify <code class=\"docutils literal notranslate\"><span class=\"pre\">?ssl=1</span></code> and the following options as required:</p><ul class=\"simple\"><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">sslca</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">sslcapath</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">sslcert</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">sslkey</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">sslcipher</span></code></p></li></ul><p>These options correspond to the <code class=\"docutils literal notranslate\"><span class=\"pre\">ca</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">capath</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">cert</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">key</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">cipher</span></code> options used by <a class=\"reference external\" href=\"https://dev.mysql.com/doc/c-api/8.0/en/mysql-ssl-set.html\">mysql_ssl_set</a>.</p><p>Example configurations:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># MySQL: Network database connection</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mysql://scott:tiger@localhost/mydatabase</span><span class=\"w\"></span><span class=\"c1\"># MySQL: unix socket connection</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mysql://scott:tiger@/mydatabase?unix_socket=/tmp/mysql.sock</span><span class=\"w\"></span><span class=\"c1\"># MySQL with the MySQLdb driver (instead of pymysql)</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mysql+mysqldb://scott:tiger@localhost/mydatabase</span><span class=\"w\"></span><span class=\"c1\"># MySQL with SSL/TLS enabled</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mysql+mysqldb://scott:tiger@localhost/mydatabase?ssl=yes&amp;sslca=/path/to/cert</span><span class=\"w\"></span></pre></div></div></section><section id=\"postgresql-connections\"><h3>PostgreSQL connections<a class=\"headerlink\" href=\"#postgresql-connections\" title=\"Permalink to this heading\">\u00b6</a></h3><p>The psycopg family of drivers will use a unix socket if the host is left empty(or the value of <code class=\"docutils literal notranslate\"><span class=\"pre\">PGHOST</span></code> if this is set in your environment). Otherwise it will attempt a tcp connection to the specified host.</p><p>To force a unix socket connection leave the host part of the URLempty and provide a <code class=\"docutils literal notranslate\"><span class=\"pre\">host</span></code> option that points to the directory containing the socket(eg <code class=\"docutils literal notranslate\"><span class=\"pre\">postgresql:///mydb?host=/path/to/socket/</span></code>).</p><p>The postgresql backends also allow a custom schema to be selected by specifying a <code class=\"docutils literal notranslate\"><span class=\"pre\">schema</span></code> option, eg <code class=\"docutils literal notranslate\"><span class=\"pre\">postgresql://\u2026/mydatabase?schema=myschema</span></code>.</p><p>Example configurations:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">postgresql://scott:tiger@localhost/mydatabase</span><span class=\"w\"></span><span class=\"c1\"># unix socket connection</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">postgresql://scott:tiger@/mydatabase</span><span class=\"w\"></span><span class=\"c1\"># unix socket at a non-standard location and port number</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">postgresql://scott:tiger@/mydatabase?host=/var/run/postgresql&amp;port=5434</span><span class=\"w\"></span><span class=\"c1\"># PostgreSQL with psycopg 3 driver</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">postgresql+psycopg://scott:tiger@localhost/mydatabase</span><span class=\"w\"></span><span class=\"c1\"># Changing the default schema</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">postgresql://scott:tiger@/mydatabase?schema=some_schema</span><span class=\"w\"></span></pre></div></div></section><section id=\"sqlite-connections\"><h3>SQLite connections<a class=\"headerlink\" href=\"#sqlite-connections\" title=\"Permalink to this heading\">\u00b6</a></h3><p>The SQLite backend ignores everything in the connection URL except the databasename, which should be a filename, or the special value <code class=\"docutils literal notranslate\"><span class=\"pre\">:memory:</span></code> for an in-memory database.</p><p>3 slashes are required to specify a relative path:</p><div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">sqlite</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">mydb</span><span class=\"o\">.</span><span class=\"n\">sqlite</span></pre></div></div><p>and 4 for an absolute path on unix-like platforms:</p><div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">sqlite</span><span class=\"p\">:</span><span class=\"o\">////</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">user</span><span class=\"o\">/</span><span class=\"n\">mydb</span><span class=\"o\">.</span><span class=\"n\">sqlite</span></pre></div></div></section><section id=\"password-security\"><h3>Password security<a class=\"headerlink\" href=\"#password-security\" title=\"Permalink to this heading\">\u00b6</a></h3><p>You can specify your database username and password either as part of thedatabase connection string on the command line (exposing your databasepassword in the process list)or in a configuration file where other users may be able to read it.</p><p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">-p</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">--prompt-password</span></code> flag causes yoyo to promptfor a password, helping prevent your credentials from being leaked.</p></section></section><section id=\"migration-files\"><h2>Migration files<a class=\"headerlink\" href=\"#migration-files\" title=\"Permalink to this heading\">\u00b6</a></h2><p>The migrations directory contains a series of migration scripts. Eachmigration script is a Python (<code class=\"docutils literal notranslate\"><span class=\"pre\">.py</span></code>) or SQL file (<code class=\"docutils literal notranslate\"><span class=\"pre\">.sql</span></code>).</p><p>The name of each file without the extension is used as the migration\u2019s uniqueidentifier. You may include migrations from multiple sources, butidentifiers are assumed to be globally unique, so it\u2019s wise to choose a uniqueprefix for you project (eg <code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;project-name&gt;-0001-migration.sql</span></code>) or use the<code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">new</span></code> command to generate a suitable filename.</p><p>Migrations scripts are run in dependency then filename order.</p><p>Each migration file is run in a single transaction where this is supported bythe database.</p><p>Yoyo creates tables in your target database to track which migrations have beenapplied. By default these are:</p><ul class=\"simple\"><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">_yoyo_migration</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">_yoyo_log</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">_yoyo_version</span></code></p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo_lock</span></code></p></li></ul><section id=\"migrations-as-python-scripts\"><h3>Migrations as Python scripts<a class=\"headerlink\" href=\"#migrations-as-python-scripts\" title=\"Permalink to this heading\">\u00b6</a></h3><p>A migration script written in Python has the following structure:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">#</span><span class=\"c1\"># file: migrations/0001_create_foo.py</span><span class=\"c1\">#</span><span class=\"kn\">from</span> <span class=\"nn\">yoyo</span> <span class=\"kn\">import</span> <span class=\"n\">step</span><span class=\"n\">__depends__</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;0000.initial-schema&quot;</span><span class=\"p\">}</span><span class=\"n\">steps</span> <span class=\"o\">=</span> <span class=\"p\">[</span>  <span class=\"n\">step</span><span class=\"p\">(</span>      <span class=\"s2\">&quot;CREATE TABLE foo (id INT, bar VARCHAR(20), PRIMARY KEY (id))&quot;</span><span class=\"p\">,</span>      <span class=\"s2\">&quot;DROP TABLE foo&quot;</span><span class=\"p\">,</span>  <span class=\"p\">),</span>  <span class=\"n\">step</span><span class=\"p\">(</span>      <span class=\"s2\">&quot;ALTER TABLE foo ADD COLUMN baz INT NOT NULL&quot;</span>  <span class=\"p\">)</span><span class=\"p\">]</span></pre></div></div><p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">step</span></code> function may take up to 3 arguments:</p><ul class=\"simple\"><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">apply</span></code>: an SQL query (or Python function, see below) to apply the migration step.</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">rollback</span></code>: (optional) an SQL query (or Python function) to rollback the migration step.</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">ignore_errors</span></code>: (optional, one of <code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;apply&quot;</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;rollback&quot;</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;all&quot;</span></code>)causes yoyo to ignore database errors in either the apply stage, rollback stage or both.</p></li></ul><section id=\"migration-steps-as-python-functions\"><h4>Migration steps as Python functions<a class=\"headerlink\" href=\"#migration-steps-as-python-functions\" title=\"Permalink to this heading\">\u00b6</a></h4><p>If SQL is not flexible enough, you may supply a Python function aseither or both of the <code class=\"docutils literal notranslate\"><span class=\"pre\">apply</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">rollback</span></code> arguments of <code class=\"docutils literal notranslate\"><span class=\"pre\">step</span></code>.Each function should take a database connection as its only argument:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">#</span><span class=\"c1\"># file: migrations/0001_create_foo.py</span><span class=\"c1\">#</span><span class=\"kn\">from</span> <span class=\"nn\">yoyo</span> <span class=\"kn\">import</span> <span class=\"n\">step</span><span class=\"k\">def</span> <span class=\"nf\">apply_step</span><span class=\"p\">(</span><span class=\"n\">conn</span><span class=\"p\">):</span>    <span class=\"n\">cursor</span> <span class=\"o\">=</span> <span class=\"n\">conn</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">()</span>    <span class=\"n\">cursor</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span>        <span class=\"c1\"># query to perform the migration</span>    <span class=\"p\">)</span><span class=\"k\">def</span> <span class=\"nf\">rollback_step</span><span class=\"p\">(</span><span class=\"n\">conn</span><span class=\"p\">):</span>    <span class=\"n\">cursor</span> <span class=\"o\">=</span> <span class=\"n\">conn</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">()</span>    <span class=\"n\">cursor</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span>        <span class=\"c1\"># query to undo the above</span>    <span class=\"p\">)</span><span class=\"n\">steps</span> <span class=\"o\">=</span> <span class=\"p\">[</span>  <span class=\"n\">step</span><span class=\"p\">(</span><span class=\"n\">apply_step</span><span class=\"p\">,</span> <span class=\"n\">rollback_step</span><span class=\"p\">)</span><span class=\"p\">]</span></pre></div></div></section><section id=\"dependencies\"><h4>Dependencies<a class=\"headerlink\" href=\"#dependencies\" title=\"Permalink to this heading\">\u00b6</a></h4><p>Migrations may declare dependencies on other migrations via the<code class=\"docutils literal notranslate\"><span class=\"pre\">__depends__</span></code> attribute:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">#</span><span class=\"c1\"># file: migrations/0002.modify-foo.py</span><span class=\"c1\">#</span><span class=\"n\">__depends__</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;0000.initial-schema&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;0001.create-foo&#39;</span><span class=\"p\">}</span><span class=\"n\">steps</span> <span class=\"o\">=</span> <span class=\"p\">[</span>  <span class=\"c1\"># migration steps</span><span class=\"p\">]</span></pre></div></div><p>If you use the <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">new</span></code> command the <code class=\"docutils literal notranslate\"><span class=\"pre\">__depends__</span></code> attribute will be autopopulated for you.</p></section></section><section id=\"migrations-as-sql-scripts\"><h3>Migrations as SQL scripts<a class=\"headerlink\" href=\"#migrations-as-sql-scripts\" title=\"Permalink to this heading\">\u00b6</a></h3><p>An SQL migration script files should be named <code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;migration-name&gt;.sql</span></code> and contain the one or moreSQL statements required to apply the migration.</p><div class=\"highlight-sql notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">--</span><span class=\"c1\">-- file: migrations/0001.create-foo.sql</span><span class=\"c1\">--</span><span class=\"k\">CREATE</span><span class=\"w\"> </span><span class=\"k\">TABLE</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"nb\">INT</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"nb\">VARCHAR</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">PRIMARY</span><span class=\"w\"> </span><span class=\"k\">KEY</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">));</span><span class=\"w\"></span></pre></div></div><p>SQL rollback steps should be saved in a separate file named<code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;migration-name&gt;.rollback.sql</span></code>:</p><div class=\"highlight-sql notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">--</span><span class=\"c1\">-- file: migrations/0001.create-foo.rollback.sql</span><span class=\"c1\">--</span><span class=\"k\">DROP</span><span class=\"w\"> </span><span class=\"k\">TABLE</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">;</span><span class=\"w\"></span></pre></div></div><section id=\"id1\"><h4>Dependencies<a class=\"headerlink\" href=\"#id1\" title=\"Permalink to this heading\">\u00b6</a></h4><p>A structured SQL comment may be used to specifydependencies as a space separated list:</p><div class=\"highlight-sql notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">-- depends: 0000.initial-schema 0001.create-foo</span><span class=\"k\">ALTER</span><span class=\"w\"> </span><span class=\"k\">TABLE</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"k\">ADD</span><span class=\"w\"> </span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"nb\">INT</span><span class=\"p\">;</span><span class=\"w\"></span></pre></div></div></section></section><section id=\"post-apply-hook\"><h3>Post-apply hook<a class=\"headerlink\" href=\"#post-apply-hook\" title=\"Permalink to this heading\">\u00b6</a></h3><p>It can be useful to have a script that is run after every successful migration.For example you could use this to update database permissions or re-createviews.</p><p>To do this, create a special migration file called <code class=\"docutils literal notranslate\"><span class=\"pre\">post-apply.py</span></code> or<code class=\"docutils literal notranslate\"><span class=\"pre\">post-apply.sql</span></code>. This file should have the same format as any othermigration file.</p></section></section><section id=\"configuration-file\"><h2>Configuration file<a class=\"headerlink\" href=\"#configuration-file\" title=\"Permalink to this heading\">\u00b6</a></h2><p>Yoyo looks for a configuration file named <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo.ini</span></code> in the current workingdirectory or any ancestor directory.</p><p>If no configuration file is found <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span></code> will prompt you tocreate one, populated from the current command line arguments.</p><p>Using a configuration file saves repeated typing,avoids your database username and password showing in process listingsand lessens the risk of accidentally running migrationsagainst the wrong database (ie by re-running an earlier <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span></code> entry inyour command history when you have moved to a different directory).</p><p>If you do not want a config file to be loadedadd the <code class=\"docutils literal notranslate\"><span class=\"pre\">--no-config-file</span></code> parameter to the command line options.</p><p>The configuration file may contain the following options:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">[DEFAULT]</span><span class=\"w\"></span><span class=\"c1\"># List of migration source directories. &quot;%(here)s&quot; is expanded to the</span><span class=\"w\"></span><span class=\"c1\"># full path of the directory containing this ini file.</span><span class=\"w\"></span><span class=\"na\">sources</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">%(here)s/migrations %(here)s/lib/module/migrations</span><span class=\"w\"></span><span class=\"c1\"># Target database</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">postgresql://scott:tiger@localhost/mydb</span><span class=\"w\"></span><span class=\"c1\"># Verbosity level. Goes from 0 (least verbose) to 3 (most verbose)</span><span class=\"w\"></span><span class=\"na\">verbosity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">3</span><span class=\"w\"></span><span class=\"c1\"># Disable interactive features</span><span class=\"w\"></span><span class=\"na\">batch_mode</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">on</span><span class=\"w\"></span><span class=\"c1\"># Editor to use when starting new migrations</span><span class=\"w\"></span><span class=\"c1\"># &quot;{}&quot; is expanded to the filename of the new migration</span><span class=\"w\"></span><span class=\"na\">editor</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">/usr/local/bin/vim -f {}</span><span class=\"w\"></span><span class=\"c1\"># An arbitrary command to run after a migration has been created</span><span class=\"w\"></span><span class=\"c1\"># &quot;{}&quot; is expanded to the filename of the new migration</span><span class=\"w\"></span><span class=\"na\">post_create_command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">hg add {}</span><span class=\"w\"></span><span class=\"c1\"># A prefix to use for generated migration filenames</span><span class=\"w\"></span><span class=\"na\">prefix</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">myproject_</span><span class=\"w\"></span></pre></div></div><section id=\"config-file-inheritance-and-includes\"><h3>Config file inheritance and includes<a class=\"headerlink\" href=\"#config-file-inheritance-and-includes\" title=\"Permalink to this heading\">\u00b6</a></h3><p>The special <code class=\"docutils literal notranslate\"><span class=\"pre\">%inherit</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">%include</span></code> directives allow config file inheritance and inclusion:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">#</span><span class=\"w\"></span><span class=\"c1\"># file: yoyo-defaults.ini</span><span class=\"w\"></span><span class=\"c1\">#</span><span class=\"w\"></span><span class=\"k\">[DEFAULT]</span><span class=\"w\"></span><span class=\"na\">sources</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">%(here)s/migrations</span><span class=\"w\"></span><span class=\"c1\">#</span><span class=\"w\"></span><span class=\"c1\"># file: yoyo.ini</span><span class=\"w\"></span><span class=\"c1\">#</span><span class=\"w\"></span><span class=\"k\">[DEFAULT]</span><span class=\"w\"></span><span class=\"c1\">; Inherit settings from yoyo-defaults.ini</span><span class=\"w\"></span><span class=\"c1\">;</span><span class=\"w\"></span><span class=\"c1\">; Settings in inherited files are processed first and may be overridden by</span><span class=\"w\"></span><span class=\"c1\">; settings in this file</span><span class=\"w\"></span><span class=\"na\">%inherit</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">yoyo-defaults.ini</span><span class=\"w\"></span><span class=\"c1\">; Include settings from yoyo-local.ini</span><span class=\"w\"></span><span class=\"c1\">;</span><span class=\"w\"></span><span class=\"c1\">; Included files are processed after this file and may override the settings</span><span class=\"w\"></span><span class=\"c1\">; in this file</span><span class=\"w\"></span><span class=\"na\">%include</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">yoyo-local.ini</span><span class=\"w\"></span><span class=\"c1\">; Use &#39;?&#39; to avoid raising an error if the file does not exist</span><span class=\"w\"></span><span class=\"na\">%inherit</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">?yoyo-defaults.ini</span><span class=\"w\"></span><span class=\"na\">database</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">sqlite:///%(here)s/mydb.sqlite</span><span class=\"w\"></span></pre></div></div></section><section id=\"substitutions-and-environment-variables\"><h3>Substitutions and environment variables<a class=\"headerlink\" href=\"#substitutions-and-environment-variables\" title=\"Permalink to this heading\">\u00b6</a></h3><p>The special variable <code class=\"docutils literal notranslate\"><span class=\"pre\">%(here)s</span></code> will be substituted with the directory nameof the config file.</p><p>Environment variables can be substituted with the same syntax, eg <code class=\"docutils literal notranslate\"><span class=\"pre\">%(HOME)s</span></code>.</p><p>Substitutions are case-insensitive so for example <code class=\"docutils literal notranslate\"><span class=\"pre\">%(HOME)s</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">%(home)s</span></code>will both refer to the same variable.</p></section><section id=\"migration-sources\"><h3>Migration sources<a class=\"headerlink\" href=\"#migration-sources\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Yoyo reads migration scripts from the directories specified in the <code class=\"docutils literal notranslate\"><span class=\"pre\">sources</span></code>config option. Paths may include glob patterns, for example:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">[DEFAULT]</span><span class=\"w\"></span><span class=\"na\">sources</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"></span><span class=\"w\">    </span><span class=\"na\">%(here)s/migrations</span><span class=\"w\"></span><span class=\"w\">    </span><span class=\"na\">%(here)s/src/*/migrations</span><span class=\"w\"></span></pre></div></div><p>You may also read migrations from installed python packages, by supplying apath in the special form <code class=\"docutils literal notranslate\"><span class=\"pre\">package:&lt;package-name&gt;:&lt;path-to-migrations-dir&gt;</span></code>,for example:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">[DEFAULT]</span><span class=\"w\"></span><span class=\"na\">sources</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">package:myapplication:data/migrations</span><span class=\"w\"></span></pre></div></div></section></section><section id=\"transactions\"><h2>Transactions<a class=\"headerlink\" href=\"#transactions\" title=\"Permalink to this heading\">\u00b6</a></h2><p>Each migration runs in a separate transaction. Savepoints are usedto isolate steps within each migration.</p><p>If an error occurs during a step and the step has <code class=\"docutils literal notranslate\"><span class=\"pre\">ignore_errors</span></code> set,then that individual step will be rolled back andexecution will pick up from the next step.If <code class=\"docutils literal notranslate\"><span class=\"pre\">ignore_errors</span></code> is not set then the entire migration will be rolled backand execution stopped.</p><p>Note that some databases (eg MySQL) do not support rollback on DDL statements(eg <code class=\"docutils literal notranslate\"><span class=\"pre\">CREATE</span> <span class=\"pre\">...</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">ALTER</span> <span class=\"pre\">...</span></code> statements). For these databasesyou may need to manually intervene to reset the database stateshould errors occur in your migration.</p><p>Using <code class=\"docutils literal notranslate\"><span class=\"pre\">group</span></code> allows you to nest steps, giving you control of whererollbacks happen. For example:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">group</span><span class=\"p\">([</span>  <span class=\"n\">step</span><span class=\"p\">(</span><span class=\"s2\">&quot;ALTER TABLE employees ADD tax_code TEXT&quot;</span><span class=\"p\">),</span>  <span class=\"n\">step</span><span class=\"p\">(</span><span class=\"s2\">&quot;CREATE INDEX tax_code_idx ON employees (tax_code)&quot;</span><span class=\"p\">)</span><span class=\"p\">],</span> <span class=\"n\">ignore_errors</span><span class=\"o\">=</span><span class=\"s1\">&#39;all&#39;</span><span class=\"p\">)</span><span class=\"n\">step</span><span class=\"p\">(</span><span class=\"s2\">&quot;UPDATE employees SET tax_code=&#39;C&#39; WHERE pay_grade &lt; 4&quot;</span><span class=\"p\">)</span><span class=\"n\">step</span><span class=\"p\">(</span><span class=\"s2\">&quot;UPDATE employees SET tax_code=&#39;B&#39; WHERE pay_grade &gt;= 6&quot;</span><span class=\"p\">)</span><span class=\"n\">step</span><span class=\"p\">(</span><span class=\"s2\">&quot;UPDATE employees SET tax_code=&#39;A&#39; WHERE pay_grade &gt;= 8&quot;</span><span class=\"p\">)</span></pre></div></div><section id=\"disabling-transactions\"><h3>Disabling transactions<a class=\"headerlink\" href=\"#disabling-transactions\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Disable transaction handling within a migration by setting<code class=\"docutils literal notranslate\"><span class=\"pre\">__transactional__</span> <span class=\"pre\">=</span> <span class=\"pre\">False</span></code>, eg:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">__transactional__</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"n\">step</span><span class=\"p\">(</span><span class=\"s2\">&quot;CREATE DATABASE mydb&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;DROP DATABASE mydb&quot;</span><span class=\"p\">)</span></pre></div></div><p>Or for SQL migrations:</p><div class=\"highlight-sql notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\">-- transactional: false</span><span class=\"k\">CREATE</span><span class=\"w\"> </span><span class=\"k\">DATABASE</span><span class=\"w\"> </span><span class=\"n\">mydb</span><span class=\"w\"></span></pre></div></div><p>This feature is only tested against the PostgreSQL and SQLite backends.</p><section id=\"postgresql\"><h4>PostgreSQL<a class=\"headerlink\" href=\"#postgresql\" title=\"Permalink to this heading\">\u00b6</a></h4><p>In PostgreSQL it is an error to run certain statements inside a transactionblock. These include:</p><div class=\"highlight-sql notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">CREATE</span><span class=\"w\"> </span><span class=\"k\">DATABASE</span><span class=\"w\"> </span><span class=\"p\">...</span><span class=\"w\"></span><span class=\"k\">ALTER</span><span class=\"w\"> </span><span class=\"k\">TYPE</span><span class=\"w\"> </span><span class=\"p\">...</span><span class=\"w\"> </span><span class=\"k\">ADD</span><span class=\"w\"> </span><span class=\"n\">VALUE</span><span class=\"w\"></span></pre></div></div><p>Using <code class=\"docutils literal notranslate\"><span class=\"pre\">__transactional__</span> <span class=\"pre\">=</span> <span class=\"pre\">False</span></code> allows you to run these within a migration</p></section><section id=\"sqlite\"><h4>SQLite<a class=\"headerlink\" href=\"#sqlite\" title=\"Permalink to this heading\">\u00b6</a></h4><p>In SQLite, the default transactional behavior may prevent other tools fromaccessing the database for the duration of the migration. Using<code class=\"docutils literal notranslate\"><span class=\"pre\">__transactional__</span> <span class=\"pre\">=</span> <span class=\"pre\">False</span></code> allows you to work around this limitation.</p></section></section></section><section id=\"calling-yoyo-from-python-code\"><h2>Calling Yoyo from Python code<a class=\"headerlink\" href=\"#calling-yoyo-from-python-code\" title=\"Permalink to this heading\">\u00b6</a></h2><p>The following example shows how to apply migrations from inside python code:</p><div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">yoyo</span> <span class=\"kn\">import</span> <span class=\"n\">read_migrations</span><span class=\"kn\">from</span> <span class=\"nn\">yoyo</span> <span class=\"kn\">import</span> <span class=\"n\">get_backend</span><span class=\"n\">backend</span> <span class=\"o\">=</span> <span class=\"n\">get_backend</span><span class=\"p\">(</span><span class=\"s1\">&#39;postgresql://myuser@localhost/mydatabase&#39;</span><span class=\"p\">)</span><span class=\"n\">migrations</span> <span class=\"o\">=</span> <span class=\"n\">read_migrations</span><span class=\"p\">(</span><span class=\"s1\">&#39;path/to/migrations&#39;</span><span class=\"p\">)</span><span class=\"k\">with</span> <span class=\"n\">backend</span><span class=\"o\">.</span><span class=\"n\">lock</span><span class=\"p\">():</span>    <span class=\"c1\"># Apply any outstanding migrations</span>    <span class=\"n\">backend</span><span class=\"o\">.</span><span class=\"n\">apply_migrations</span><span class=\"p\">(</span><span class=\"n\">backend</span><span class=\"o\">.</span><span class=\"n\">to_apply</span><span class=\"p\">(</span><span class=\"n\">migrations</span><span class=\"p\">))</span>    <span class=\"c1\"># Rollback all migrations</span>    <span class=\"n\">backend</span><span class=\"o\">.</span><span class=\"n\">rollback_migrations</span><span class=\"p\">(</span><span class=\"n\">backend</span><span class=\"o\">.</span><span class=\"n\">to_rollback</span><span class=\"p\">(</span><span class=\"n\">migrations</span><span class=\"p\">))</span></pre></div></div><div class=\"toctree-wrapper compound\"></div></section><section id=\"adding-custom-backends\"><h2>Adding custom backends<a class=\"headerlink\" href=\"#adding-custom-backends\" title=\"Permalink to this heading\">\u00b6</a></h2><p>Backends are discovered using Python importlib.metadata entry points.</p><p>To add a custom backend, create a python package containing a subclass of<code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">yoyo.backends.base.DatabaseBackend</span></code> and configure itin the package metadata (typically in <code class=\"docutils literal notranslate\"><span class=\"pre\">setup.cfg</span></code>), for example:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">[options.entry_points]</span><span class=\"w\"></span><span class=\"na\">yoyo.backends</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"></span><span class=\"w\">    </span><span class=\"na\">mybackend</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mypackage:MyBackend</span><span class=\"w\"></span></pre></div></div><p>Use the backend by specifying <code class=\"docutils literal notranslate\"><span class=\"pre\">'mybackend'</span></code> as the driver protocol:</p><div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">..</span> <span class=\"n\">code</span><span class=\"p\">::</span> <span class=\"n\">sh</span> <span class=\"n\">yoyo</span> <span class=\"n\">apply</span> <span class=\"o\">--</span><span class=\"n\">database</span> <span class=\"n\">my_backend</span><span class=\"p\">:</span><span class=\"o\">//...</span></pre></div></div></section><section id=\"contributing\"><h2>Contributing<a class=\"headerlink\" href=\"#contributing\" title=\"Permalink to this heading\">\u00b6</a></h2><section id=\"report-an-issue\"><h3>Report an issue<a class=\"headerlink\" href=\"#report-an-issue\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Use the yoyo-migrations <a class=\"reference external\" href=\"https://todo.sr.ht/~olly/yoyo\">issue tracker</a> to report issues.</p><p>There is also a <a class=\"reference external\" href=\"https://lists.sr.ht/~olly/yoyo\">mailing list</a> where you canpost questions or suggestions.</p></section><section id=\"pull-requests\"><h3>Pull requests<a class=\"headerlink\" href=\"#pull-requests\" title=\"Permalink to this heading\">\u00b6</a></h3><p>Yoyo-migrations is developed on sourcehut and uses a mailing list to reviewcommits for inclusion into the project.</p><p>To send commits to the mailing list:</p><ol class=\"arabic simple\"><li><p>Clone the repository: <code class=\"docutils literal notranslate\"><span class=\"pre\">hg</span> <span class=\"pre\">clone</span> <span class=\"pre\">https://hg.sr.ht/~olly/yoyo</span></code></p></li><li><p>Take care to commit your work in logically separate changes. Use <code class=\"docutils literal notranslate\"><span class=\"pre\">hg</span> <span class=\"pre\">commit</span> <span class=\"pre\">-i</span></code> to commit your work in logically separate changes. Make sure each commit has a meaningful message.</p></li><li><p>When you are ready to send your commits, use <code class=\"docutils literal notranslate\"><span class=\"pre\">hg</span> <span class=\"pre\">config</span> <span class=\"pre\">--edit</span></code> to add thefollowing lines to your user Mercurial configuration file:</p></li></ol><blockquote><div><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">[extensions]</span><span class=\"w\"></span><span class=\"na\">patchbomb</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"></span><span class=\"k\">[email]</span><span class=\"w\"></span><span class=\"na\">from</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">Your Name &lt;you@example.org&gt;</span><span class=\"w\"></span><span class=\"na\">method</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">smtp</span><span class=\"w\"></span><span class=\"k\">[smtp]</span><span class=\"w\"></span><span class=\"na\">host</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mail.example.org</span><span class=\"w\"></span><span class=\"na\">port</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">587</span><span class=\"w\"></span><span class=\"na\">tls</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">smtps</span><span class=\"w\"></span><span class=\"na\">username</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">you@example.org</span><span class=\"w\"></span></pre></div></div><p>Then use <code class=\"docutils literal notranslate\"><span class=\"pre\">hg</span> <span class=\"pre\">config</span> <span class=\"pre\">--local</span></code> to add the following lines to the repository configuration file:</p><div class=\"highlight-ini notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">[email]</span><span class=\"w\"></span><span class=\"na\">to</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&lt;~olly/yoyo@lists.sr.ht&gt;</span><span class=\"w\"></span></pre></div></div></div></blockquote><ol class=\"arabic simple\" start=\"4\"><li><p>Run <code class=\"docutils literal notranslate\"><span class=\"pre\">hg</span> <span class=\"pre\">mail</span> <span class=\"pre\">-o</span></code> to send your commits by email. This command will send all your commits; if you want to send just a subset, refer to the <a class=\"reference external\" href=\"https://www.mercurial-scm.org/doc/hg.1.html#email\">hg email docs</a>.</p></li></ol><p>For more detailed instructions, see here: <a class=\"reference external\" href=\"https://man.sr.ht/hg.sr.ht/email.md\">https://man.sr.ht/hg.sr.ht/email.md</a></p></section><section id=\"id2\"><h3>Mailing list<a class=\"headerlink\" href=\"#id2\" title=\"Permalink to this heading\">\u00b6</a></h3><p>The mailing list archives can be found here: <a class=\"reference external\" href=\"https://lists.sr.ht/~olly/yoyo\">https://lists.sr.ht/~olly/yoyo</a>.</p></section></section><section id=\"changelog\"><h2>Changelog<a class=\"headerlink\" href=\"#changelog\" title=\"Permalink to this heading\">\u00b6</a></h2><section id=\"released-2022-11-03\"><h3>8.1.0 (released 2022-11-03)<a class=\"headerlink\" href=\"#released-2022-11-03\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Add a new <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">init</span></code> command</p></li></ul></section><section id=\"released-2022-10-05\"><h3>8.0.0 (released 2022-10-05)<a class=\"headerlink\" href=\"#released-2022-10-05\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Rewrite the topological sorting algorithm to provide a more stable sortorder. Note that this may change the order in which migrations are applied.</p></li><li><p>Add support for custom backends via setuptools entry points</p></li><li><p>Add support for the Psycopg 3 PostgreSQL driver via the<code class=\"docutils literal notranslate\"><span class=\"pre\">postgresql+psycopg://</span></code> URL scheme</p></li><li><p>Add support for Python 3.10</p></li><li><p>Drop support for Python 3.6</p></li></ul></section><section id=\"released-2021-05-23\"><h3>7.3.2 (released 2021-05-23)<a class=\"headerlink\" href=\"#released-2021-05-23\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fix errors arising when migration code changes connection parameters,for example the schema search path in PostgreSQL. Yoyo now uses a separatedatabase connection for running migrations than for updating its internalmetadata tables.</p></li><li><p>Bugfix: fix error when loading Python module based migrations, caused bychanges to importlib in Python 3.8.10 and Python 3.9.5.</p></li><li><p>Add support for arbitrary connection parameters to snowflake backend</p></li></ul></section><section id=\"released-2021-01-18\"><h3>7.3.1 (released 2021-01-18)<a class=\"headerlink\" href=\"#released-2021-01-18\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Add support for AWS Redshift (thanks to Daniele Pizzoni for the patch)</p></li><li><p>Add a new <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">develop</span></code> command</p></li><li><p>Bugfix: properly escape passwords containing forward slashes</p></li></ul></section><section id=\"released-2020-11-05\"><h3>7.2.1 (released 2020-11-05)<a class=\"headerlink\" href=\"#released-2020-11-05\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: allow configuration values passed in from the environment to containpercent signs (thanks to Andrew Gates for the patch)</p></li><li><p>Add support for <code class=\"docutils literal notranslate\"><span class=\"pre\">--prompt-password</span></code> argument to <code class=\"docutils literal notranslate\"><span class=\"pre\">break-lock</span></code> command</p></li><li><p>Add support for Python 3.9 (no code changes)</p></li><li><p>Drop support for Python 3.5 (no code changes)</p></li></ul></section><section id=\"released-2020-07-17\"><h3>7.2.0 (released 2020-07-17)<a class=\"headerlink\" href=\"#released-2020-07-17\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fixed environment variable interpolation in config file whenvariables are named in upper case</p></li><li><p>Bugfix: reliability fixes for the command line script (thanks to Chris vanPelt for the patch)</p></li><li><p>Bugfix: the newmigration script should now work for Windows users (thanks toJimmy Laguna Montano for the patch)</p></li><li><p>Add experimental support for the <cite>Snowflake</cite> database backend (thanks toEmmet Murphy for the patch)</p></li></ul></section><section id=\"released-2020-06-16\"><h3>7.1.2 (released 2020-06-16)<a class=\"headerlink\" href=\"#released-2020-06-16\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fix circular dependency detection bug introduced in v7.1.1</p></li></ul></section><section id=\"released-2020-06-15\"><h3>7.1.1 (released 2020-06-15)<a class=\"headerlink\" href=\"#released-2020-06-15\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: command line tool no longer shows an error message if you don\u2019tspecify a command</p></li><li><p>Bugfix: migrations are maintained in filename order wherever the dependencyordering allows it</p></li></ul></section><section id=\"released-2020-06-08\"><h3>7.1.0 (released 2020-06-08)<a class=\"headerlink\" href=\"#released-2020-06-08\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Add <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">list</span></code> command</p></li><li><p>Add support for substituting environment variables in the config file(<a class=\"reference external\" href=\"https://bitbucket.org/ollyc/yoyo/issues/55/migrations-and-rollbacks-are-both-being\">https://bitbucket.org/ollyc/yoyo/issues/55/migrations-and-rollbacks-are-both-being</a>)</p></li><li><p>Add support for a new %include directive in config files</p></li><li><p>Bugfix: migrations are now grouped by source(<a class=\"reference external\" href=\"https://bitbucket.org/ollyc/yoyo/issues/54/migrations-and-rollbacks-are-both-being\">https://bitbucket.org/ollyc/yoyo/issues/54/migrations-and-rollbacks-are-both-being</a>)</p></li><li><p>Bugfix: viewing migration source in interactive mode no longer raises anexception</p></li></ul></section><section id=\"released-2020-03-09\"><h3>7.0.2 (released 2020-03-09)<a class=\"headerlink\" href=\"#released-2020-03-09\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: removed usage of f-strings to restore python 3.5 compatibility</p></li></ul></section><section id=\"released-2020-02-18\"><h3>7.0.1 (released 2020-02-18)<a class=\"headerlink\" href=\"#released-2020-02-18\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: rolling back SQL file migrations now works correctly</p></li><li><p>Support MySQL specific encryption options when connecting</p></li><li><p>Bugfix: <code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">new</span></code> script now always creates temporary files with thecorrect file extension</p></li></ul></section><section id=\"released-2020-01-20\"><h3>7.0.0 (released 2020-01-20)<a class=\"headerlink\" href=\"#released-2020-01-20\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Add support for Python 3.8</p></li><li><p>Drop compatibility with Python 2.7 and Python 3.6</p></li><li><p>Allow migrations to be specified as <code class=\"docutils literal notranslate\"><span class=\"pre\">.sql</span></code> files</p></li><li><p>Load migrations as modules; this allows migration scripts to access the<code class=\"docutils literal notranslate\"><span class=\"pre\">__file__</span></code> attribute.</p></li><li><p>Bugfix: the <code class=\"docutils literal notranslate\"><span class=\"pre\">--all</span></code> flag now works as expected with the <code class=\"docutils literal notranslate\"><span class=\"pre\">rollback</span></code>command</p></li><li><p>Bugfix: fix an error when running under a non-default schema in PostgreSQL</p></li></ul></section><section id=\"released-2019-02-13\"><h3>6.1.0 (released 2019-02-13)<a class=\"headerlink\" href=\"#released-2019-02-13\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">sources</span></code> configuration option can now contain glob patterns andreferences to migrations installed in python packages.</p></li><li><p>Bugfix: rolling back a group of steps now works as expected (thanks to JonSorensen)</p></li></ul></section><section id=\"released-2018-08-21\"><h3>6.0.0 (released 2018-08-21)<a class=\"headerlink\" href=\"#released-2018-08-21\" title=\"Permalink to this heading\">\u00b6</a></h3><p><strong>This version introduces backwards incompatible changes</strong>. Please read thisfile carefully before upgrading.</p><ul class=\"simple\"><li><p>Bugfix: now works on MySQL+utf8mb4 databases. This requires a newinternal schema for recording applied migrations, and your database will beautomatically updated when you first run this version. After upgrading, yourdatabase will no longer be compatible with older versions of yoyo migrations.(thanks to James Socol and others for the report and discussion of theimplementation)</p></li><li><p>Bugfix: The <cite>yoyo break-lock</cite> command is no longer broken</p></li><li><p>All migration operations (<code class=\"docutils literal notranslate\"><span class=\"pre\">apply</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">rollback</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">mark</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">unmark</span></code>) arenow logged in a table <code class=\"docutils literal notranslate\"><span class=\"pre\">_yoyo_log</span></code> (thanks to Matt Williams for thesuggestion).</p></li><li><p>The CLI script now displays the list of selected migrations beforeasking for final confirmation when in interactive mode.</p></li><li><p>Added support for <code class=\"docutils literal notranslate\"><span class=\"pre\">__transactional__</span></code> flag in sqlite migrations</p></li></ul></section><section id=\"released-2018-07-30\"><h3>5.1.7 (released 2018-07-30)<a class=\"headerlink\" href=\"#released-2018-07-30\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fix uppercase letters being excluded from generated filenames(thanks to Romain Godefroy)</p></li></ul></section><section id=\"released-2018-06-28\"><h3>5.1.6 (released 2018-06-28)<a class=\"headerlink\" href=\"#released-2018-06-28\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fix problems running on Python 3 on Windows</p></li></ul></section><section id=\"released-2018-06-13\"><h3>5.1.5 (released 2018-06-13)<a class=\"headerlink\" href=\"#released-2018-06-13\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: adding a <code class=\"docutils literal notranslate\"><span class=\"pre\">schema</span></code> parameter to PostgreSQL connection stringsno longer raises an exception (thanks to Mohamed Habib for the report)</p></li></ul></section><section id=\"released-2018-07-11\"><h3>5.1.0 (released 2018-07-11)<a class=\"headerlink\" href=\"#released-2018-07-11\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">yoyo</span> <span class=\"pre\">rollback</span></code> now only rolls back a single migration in batch mode (unless a \u2013revision or \u2013all is specified) (thanks to<a class=\"reference external\" href=\"https://bitbucket.org/linuxnotes/\">A A</a> for the idea and initialimplementation)</p></li><li><p>Added support for Oracle via cx_Oracle backend (thanks to Donald Sarratt)</p></li><li><p>Added support for locking migration tables during operations to preventconflicts if multiple yoyo processes run at the same time (thanks to ArtimiNA for proposal and initial implementation)</p></li><li><p>Removed dependency on python-slugify to avoid pulling in GPL\u2019d code(thanks to Olivier Ch\u00e9dru)</p></li><li><p>Added support for a <code class=\"docutils literal notranslate\"><span class=\"pre\">schema</span></code> parameter for PostgreSQL databases (thanks toTobi\u00e1\u0161 \u0160tancel)</p></li><li><p>Added support for arbitrary keyword parameters in PostgreSQL URLs, allowingeg <code class=\"docutils literal notranslate\"><span class=\"pre\">sslmode=require</span></code> to be specified.</p></li><li><p>Bugfix: relative paths are correctly resolved in the config file.</p></li><li><p>Bugfix: fixed the ordering when applying migrations with the reapply command(thanks to Goohu)</p></li></ul></section><section id=\"released-2017-01-12\"><h3>5.0.5 (released 2017-01-12)<a class=\"headerlink\" href=\"#released-2017-01-12\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Added support for a <code class=\"docutils literal notranslate\"><span class=\"pre\">__transactional__</span> <span class=\"pre\">=</span> <span class=\"pre\">False</span></code> flag in migration files,allowing migrations to run commands in PostgreSQL that raise errorsif run inside a transaction block (eg \u201cCREATE DATABASE\u201d)</p></li><li><p>Bugfix: fix the unix_socket option for mysql connections</p></li></ul></section><section id=\"released-2016-09-04\"><h3>5.0.4 (released 2016-09-04)<a class=\"headerlink\" href=\"#released-2016-09-04\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fixed crash when mutliple migrations have the same dependency(thanks to smotko for the report)</p></li></ul></section><section id=\"released-2016-07-03\"><h3>5.0.3 (released 2016-07-03)<a class=\"headerlink\" href=\"#released-2016-07-03\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: fixed exception when creating a new migration interactivelywith <cite>yoyo new</cite></p></li></ul></section><section id=\"released-2016-06-21\"><h3>5.0.2 (released 2016-06-21)<a class=\"headerlink\" href=\"#released-2016-06-21\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Added <code class=\"docutils literal notranslate\"><span class=\"pre\">DatabaseBackend.apply_migrations_only</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">run_post_hooks</span></code>methods. This allows python code that interfaces with yoyo to run migrationsand post_hooks separately if required (thanks to Robi Wan for reporting thisand discussing possible fixes)</p></li><li><p>Bugfix: fix duplicate key error when using post-apply hooks (thanks to RobiWan for the report)</p></li><li><p>Bugfix: migration steps are no longer loaded multiple times ifread_migrations is called more than once (thanks to Kyle McChesney for thereport)</p></li><li><p>Bugfix: make sure that the migration_table option is read from the configfile (thanks to Frederik Holljen for the report and Manolo Micozzi for thefix)</p></li></ul></section><section id=\"released-2015-11-13\"><h3>5.0.1 (released 2015-11-13)<a class=\"headerlink\" href=\"#released-2015-11-13\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix: migration files are now sequentially named when using the prefixoption (thanks to Igor Tsarev)</p></li></ul></section><section id=\"id3\"><h3>5.0.0 (released 2015-11-13)<a class=\"headerlink\" href=\"#id3\" title=\"Permalink to this heading\">\u00b6</a></h3><p><strong>This version introduces backwards incompatible changes</strong>. Please read thisfile carefully before upgrading.</p><ul class=\"simple\"><li><p>The configuration file is now stored per-project, not per-migrations sourcedirectory. This makes it possible to share a migrations source directoryacross multiple projects.</p></li><li><p>The api for calling yoyo programmatically has changed. Refer to theREADME for an up to date example of calling yoyo from python code.</p></li><li><p>Improved url parsing</p></li><li><p>Allow database uris containing usernames with the symbol \u2018&#64;\u2019</p></li><li><p>The command line option <code class=\"docutils literal notranslate\"><span class=\"pre\">--no-cache</span></code> has been renamed to<code class=\"docutils literal notranslate\"><span class=\"pre\">--no-config-file</span></code>. The old name is retained as an alias for backwardscompatibility</p></li><li><p>The database must now be supplied using the <code class=\"docutils literal notranslate\"><span class=\"pre\">--database/-d</span></code> command lineflag. This makes it possible to change the database when calling yoyo withoutneeding to respecify the migration directories.</p></li><li><p>Added a \u2013revision command line option. In the case of apply, this causesthe specified migration to be applied, plus any dependencies. In the caseof rollback, this removes the specified revision and any other migrationsthat depend upon it.</p></li><li><p>Added \u2018mark\u2019 and \u2018unmark\u2019 commands to allow migrations to be marked in thedatabase without actually running them</p></li><li><p>Transaction handling has changed. Each migration now always runs in asingle transaction, with individual steps running in nested transactions(using savepoints).The <code class=\"docutils literal notranslate\"><span class=\"pre\">transaction()</span></code> function is still availablefor backwards compatibility,but now creates a savepoint rather than a full transaction.</p></li><li><p>The default MySQL driver has been changed to PyMySQL, for Python 3compatbility reasons. MySQLdb can be used by specifying the\u2018mysql+mysqldb://\u2019 scheme.</p></li><li><p>Errors encountered while creating the _yoyo_migrations table are now raisedrather than being silently ignored (thanks to James Socol).</p></li></ul></section><section id=\"version-4-2-5\"><h3>Version 4.2.5<a class=\"headerlink\" href=\"#version-4-2-5\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Fix for pyscopg2 driver versions &gt;=2.6</p></li><li><p>Faster loading of migration scripts</p></li><li><p>Dependencies between migrations can be added via the<code class=\"docutils literal notranslate\"><span class=\"pre\">__depends__</span></code> attribute</p></li><li><p>Dropped support for python 2.6</p></li></ul></section><section id=\"version-4-2-4\"><h3>Version 4.2.4<a class=\"headerlink\" href=\"#version-4-2-4\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Fix for mismanaged 4.2.3 release</p></li></ul></section><section id=\"version-4-2-3\"><h3>Version 4.2.3<a class=\"headerlink\" href=\"#version-4-2-3\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Migrations are now datestamped with a UTC date (thanks to robi wan)</p></li><li><p>Fixes for installation and use under python 3</p></li></ul></section><section id=\"version-4-2-2\"><h3>Version 4.2.2<a class=\"headerlink\" href=\"#version-4-2-2\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Migration scripts can start with <code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">yoyo</span> <span class=\"pre\">import</span> <span class=\"pre\">step,</span> <span class=\"pre\">transaction</span></code>.This prevents linters (eg flake8) throwing errors over undefined names.</p></li><li><p>Bugfix: functions declared in a migration file can access the script\u2019s globalnamespace</p></li></ul></section><section id=\"version-4-2-1\"><h3>Version 4.2.1<a class=\"headerlink\" href=\"#version-4-2-1\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix for previous release, which omitted critical files</p></li></ul></section><section id=\"version-4-2-0\"><h3>Version 4.2.0<a class=\"headerlink\" href=\"#version-4-2-0\" title=\"Permalink to this heading\">\u00b6</a></h3><ul><li><p>Removed yoyo.migrate namespace package. Any code that uses the yoyo apidirectly needs have any imports modified, eg this:</p><div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">yoyo.migrate</span> <span class=\"kn\">import</span> <span class=\"n\">read_migrations</span><span class=\"kn\">from</span> <span class=\"nn\">yoyo.migrate.connections</span> <span class=\"kn\">import</span> <span class=\"n\">connect</span></pre></div></div><p>Should be changed to this:</p><div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">yoyo</span> <span class=\"kn\">import</span> <span class=\"n\">read_migrations</span><span class=\"kn\">from</span> <span class=\"nn\">yoyo.connections</span> <span class=\"kn\">import</span> <span class=\"n\">connect</span></pre></div></div></li><li><p>Migrated from darcs to mercurial. Code is now hosted at<a class=\"reference external\" href=\"https://bitbucket.org/ollyc/yoyo\">https://bitbucket.org/ollyc/yoyo</a></p></li><li><p>Bugfix: the migration_table option was not being passed to read_migrations,causing the value to be ignored</p></li></ul></section><section id=\"version-4-1-6\"><h3>Version 4.1.6<a class=\"headerlink\" href=\"#version-4-1-6\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Added windows support (thanks to Peter Shinners)</p></li></ul></section><section id=\"version-4-1-5\"><h3>Version 4.1.5<a class=\"headerlink\" href=\"#version-4-1-5\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Configure logging handlers so that the -v switch causes output to go to theconsole (thanks to Andrew Nelis).</p></li><li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">-v</span></code> command line switch no longer takes an argument but may be specifiedmultiple times instead (ie use <code class=\"docutils literal notranslate\"><span class=\"pre\">-vvv</span></code> instead of <code class=\"docutils literal notranslate\"><span class=\"pre\">-v3</span></code>). <code class=\"docutils literal notranslate\"><span class=\"pre\">--verbosity</span></code>retains the old behaviour.</p></li></ul></section><section id=\"version-4-1-4\"><h3>Version 4.1.4<a class=\"headerlink\" href=\"#version-4-1-4\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix for post apply hooks</p></li></ul></section><section id=\"version-4-1-3\"><h3>Version 4.1.3<a class=\"headerlink\" href=\"#version-4-1-3\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Changed default migration table name back to \u2018_yoyo_migration\u2019</p></li></ul></section><section id=\"version-4-1-2\"><h3>Version 4.1.2<a class=\"headerlink\" href=\"#version-4-1-2\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Bugfix for error when running in interactive mode</p></li></ul></section><section id=\"version-4-1-1\"><h3>Version 4.1.1<a class=\"headerlink\" href=\"#version-4-1-1\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Introduced configuration option for migration table name</p></li></ul></section><section id=\"version-4-1-0\"><h3>Version 4.1.0<a class=\"headerlink\" href=\"#version-4-1-0\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Introduced ability to run steps within a transaction (thanks to Ryan Williamsfor suggesting this functionality along with assorted bug fixes.)</p></li><li><p>\u201cpost-apply\u201d migrations can be run after every successful upward migration</p></li><li><p>Other minor bugfixes and improvements</p></li><li><p>Switched to &lt;major&gt;.&lt;minor&gt; version numbering convention</p></li></ul></section><section id=\"version-4\"><h3>Version 4<a class=\"headerlink\" href=\"#version-4\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Fixed problem installing due to missing manifest entry</p></li></ul></section><section id=\"version-3\"><h3>Version 3<a class=\"headerlink\" href=\"#version-3\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Use the console_scripts entry_point in preference to scripts=[] insetup.py, this provides better interoperability with buildout</p></li></ul></section><section id=\"version-2\"><h3>Version 2<a class=\"headerlink\" href=\"#version-2\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Fixed error when reading dburi from config file</p></li></ul></section><section id=\"version-1\"><h3>Version 1<a class=\"headerlink\" href=\"#version-1\" title=\"Permalink to this heading\">\u00b6</a></h3><ul class=\"simple\"><li><p>Initial release</p></li></ul></section></section></section></div><section class=\"sphinxsidebar\" role=\"navigation\" aria-label=\"main navigation\"><div>  <h3>In this document</h3>  <ul><li><a class=\"reference internal\" href=\"#\">Yoyo database migrations</a><ul><li><a class=\"reference internal\" href=\"#installation-and-project-setup\">Installation and project setup</a></li><li><a class=\"reference internal\" href=\"#command-line-usage\">Command line usage</a><ul><li><a class=\"reference internal\" href=\"#yoyo-new\">yoyo new</a></li><li><a class=\"reference internal\" href=\"#yoyo-list\">yoyo list</a></li><li><a class=\"reference internal\" href=\"#yoyo-apply\">yoyo apply</a></li><li><a class=\"reference internal\" href=\"#yoyo-rollback\">yoyo rollback</a></li><li><a class=\"reference internal\" href=\"#yoyo-reapply\">yoyo reapply</a></li><li><a class=\"reference internal\" href=\"#yoyo-develop\">yoyo develop</a></li><li><a class=\"reference internal\" href=\"#yoyo-mark\">yoyo mark</a></li><li><a class=\"reference internal\" href=\"#yoyo-unmark\">yoyo unmark</a></li></ul></li><li><a class=\"reference internal\" href=\"#connecting-to-a-database\">Connecting to a database</a><ul><li><a class=\"reference internal\" href=\"#mysql-connections\">MySQL connections</a></li><li><a class=\"reference internal\" href=\"#postgresql-connections\">PostgreSQL connections</a></li><li><a class=\"reference internal\" href=\"#sqlite-connections\">SQLite connections</a></li><li><a class=\"reference internal\" href=\"#password-security\">Password security</a></li></ul></li><li><a class=\"reference internal\" href=\"#migration-files\">Migration files</a><ul><li><a class=\"reference internal\" href=\"#migrations-as-python-scripts\">Migrations as Python scripts</a><ul><li><a class=\"reference internal\" href=\"#migration-steps-as-python-functions\">Migration steps as Python functions</a></li><li><a class=\"reference internal\" href=\"#dependencies\">Dependencies</a></li></ul></li><li><a class=\"reference internal\" href=\"#migrations-as-sql-scripts\">Migrations as SQL scripts</a><ul><li><a class=\"reference internal\" href=\"#id1\">Dependencies</a></li></ul></li><li><a class=\"reference internal\" href=\"#post-apply-hook\">Post-apply hook</a></li></ul></li><li><a class=\"reference internal\" href=\"#configuration-file\">Configuration file</a><ul><li><a class=\"reference internal\" href=\"#config-file-inheritance-and-includes\">Config file inheritance and includes</a></li><li><a class=\"reference internal\" href=\"#substitutions-and-environment-variables\">Substitutions and environment variables</a></li><li><a class=\"reference internal\" href=\"#migration-sources\">Migration sources</a></li></ul></li><li><a class=\"reference internal\" href=\"#transactions\">Transactions</a><ul><li><a class=\"reference internal\" href=\"#disabling-transactions\">Disabling transactions</a><ul><li><a class=\"reference internal\" href=\"#postgresql\">PostgreSQL</a></li><li><a class=\"reference internal\" href=\"#sqlite\">SQLite</a></li></ul></li></ul></li><li><a class=\"reference internal\" href=\"#calling-yoyo-from-python-code\">Calling Yoyo from Python code</a></li><li><a class=\"reference internal\" href=\"#adding-custom-backends\">Adding custom backends</a></li><li><a class=\"reference internal\" href=\"#contributing\">Contributing</a><ul><li><a class=\"reference internal\" href=\"#report-an-issue\">Report an issue</a></li><li><a class=\"reference internal\" href=\"#pull-requests\">Pull requests</a></li><li><a class=\"reference internal\" href=\"#id2\">Mailing list</a></li></ul></li><li><a class=\"reference internal\" href=\"#changelog\">Changelog</a><ul><li><a class=\"reference internal\" href=\"#released-2022-11-03\">8.1.0 (released 2022-11-03)</a></li><li><a class=\"reference internal\" href=\"#released-2022-10-05\">8.0.0 (released 2022-10-05)</a></li><li><a class=\"reference internal\" href=\"#released-2021-05-23\">7.3.2 (released 2021-05-23)</a></li><li><a class=\"reference internal\" href=\"#released-2021-01-18\">7.3.1 (released 2021-01-18)</a></li><li><a class=\"reference internal\" href=\"#released-2020-11-05\">7.2.1 (released 2020-11-05)</a></li><li><a class=\"reference internal\" href=\"#released-2020-07-17\">7.2.0 (released 2020-07-17)</a></li><li><a class=\"reference internal\" href=\"#released-2020-06-16\">7.1.2 (released 2020-06-16)</a></li><li><a class=\"reference internal\" href=\"#released-2020-06-15\">7.1.1 (released 2020-06-15)</a></li><li><a class=\"reference internal\" href=\"#released-2020-06-08\">7.1.0 (released 2020-06-08)</a></li><li><a class=\"reference internal\" href=\"#released-2020-03-09\">7.0.2 (released 2020-03-09)</a></li><li><a class=\"reference internal\" href=\"#released-2020-02-18\">7.0.1 (released 2020-02-18)</a></li><li><a class=\"reference internal\" href=\"#released-2020-01-20\">7.0.0 (released 2020-01-20)</a></li><li><a class=\"reference internal\" href=\"#released-2019-02-13\">6.1.0 (released 2019-02-13)</a></li><li><a class=\"reference internal\" href=\"#released-2018-08-21\">6.0.0 (released 2018-08-21)</a></li><li><a class=\"reference internal\" href=\"#released-2018-07-30\">5.1.7 (released 2018-07-30)</a></li><li><a class=\"reference internal\" href=\"#released-2018-06-28\">5.1.6 (released 2018-06-28)</a></li><li><a class=\"reference internal\" href=\"#released-2018-06-13\">5.1.5 (released 2018-06-13)</a></li><li><a class=\"reference internal\" href=\"#released-2018-07-11\">5.1.0 (released 2018-07-11)</a></li><li><a class=\"reference internal\" href=\"#released-2017-01-12\">5.0.5 (released 2017-01-12)</a></li><li><a class=\"reference internal\" href=\"#released-2016-09-04\">5.0.4 (released 2016-09-04)</a></li><li><a class=\"reference internal\" href=\"#released-2016-07-03\">5.0.3 (released 2016-07-03)</a></li><li><a class=\"reference internal\" href=\"#released-2016-06-21\">5.0.2 (released 2016-06-21)</a></li><li><a class=\"reference internal\" href=\"#released-2015-11-13\">5.0.1 (released 2015-11-13)</a></li><li><a class=\"reference internal\" href=\"#id3\">5.0.0 (released 2015-11-13)</a></li><li><a class=\"reference internal\" href=\"#version-4-2-5\">Version 4.2.5</a></li><li><a class=\"reference internal\" href=\"#version-4-2-4\">Version 4.2.4</a></li><li><a class=\"reference internal\" href=\"#version-4-2-3\">Version 4.2.3</a></li><li><a class=\"reference internal\" href=\"#version-4-2-2\">Version 4.2.2</a></li><li><a class=\"reference internal\" href=\"#version-4-2-1\">Version 4.2.1</a></li><li><a class=\"reference internal\" href=\"#version-4-2-0\">Version 4.2.0</a></li><li><a class=\"reference internal\" href=\"#version-4-1-6\">Version 4.1.6</a></li><li><a class=\"reference internal\" href=\"#version-4-1-5\">Version 4.1.5</a></li><li><a class=\"reference internal\" href=\"#version-4-1-4\">Version 4.1.4</a></li><li><a class=\"reference internal\" href=\"#version-4-1-3\">Version 4.1.3</a></li><li><a class=\"reference internal\" href=\"#version-4-1-2\">Version 4.1.2</a></li><li><a class=\"reference internal\" href=\"#version-4-1-1\">Version 4.1.1</a></li><li><a class=\"reference internal\" href=\"#version-4-1-0\">Version 4.1.0</a></li><li><a class=\"reference internal\" href=\"#version-4\">Version 4</a></li><li><a class=\"reference internal\" href=\"#version-3\">Version 3</a></li><li><a class=\"reference internal\" href=\"#version-2\">Version 2</a></li><li><a class=\"reference internal\" href=\"#version-1\">Version 1</a></li></ul></li></ul></li></ul></div><div>    <h3>Project links</h3>    <ul>      <li>        <a href=\"https://hg.sr.ht/~olly/yoyo/\" >Source code <span class=\"LinkSite\">hg.sr.ht</span></a>      </li>      <li>        <a href=\"https://todo.sr.ht/~olly/yoyo\" >yoyo-migrations issue tracker</a>      </li>    </ul></div><div>  <h3>Browse documentation</h3>  <ul>    <li>      <a href=\"genindex.html\" title=\"General Index\"  accesskey=\"I\">General Index</a>    </li>  </ul></div><div id=\"searchbox\" style=\"display: none\" role=\"search\">    <form class=\"search\" action=\"search.html\" method=\"get\">      <div><input type=\"text\" name=\"q\" placeholder=\"Search docs\" aria-labelledby=\"search-documentation\" value=\"\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"/></div>      <div><input type=\"submit\" value=\"Go\" /></div>    </form></div><script>document.getElementById('searchbox').style.display = \"block\"</script></section></div><footer role=\"contentinfo\" >      \u00a9 Copyright 2020, Oliver Cope.                    Sphinx theme <a href=\"https://ollycope.com/\">developed by Olly Cope</a>.          </footer></body></html>",
  "embeddings": []
}