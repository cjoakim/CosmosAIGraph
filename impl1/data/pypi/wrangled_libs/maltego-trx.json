{
  "classifiers": [],
  "description": "# maltego trx python library\n\n[![runs with python3.8 - python3.10](https://github.com/paterva/maltego-trx/actions/workflows/pythonx-boot-check.yaml/badge.svg)](https://github.com/paterva/maltego-trx/actions/workflows/pythonx-boot-check.yaml)\n[![pytest with python3.8 - python3.10](https://github.com/paterva/maltego-trx/actions/workflows/pythonx-pytest.yaml/badge.svg)](https://github.com/paterva/maltego-trx/actions/workflows/pythonx-pytest.yaml)\n[![sonatype jake](https://github.com/paterva/maltego-trx/actions/workflows/sonatype-jack.yml/badge.svg)](https://github.com/paterva/maltego-trx/actions/workflows/sonatype-jack.yml)\n\n## release notes\n\n__1.6.1__: update cryptography and flask dependency and deprecate python 3.7\n\n__1.6.0__: automatically generate am `.mtz` for your local transforms\n\n__1.5.2__: add logging output for invalid / missing params in xml serialization\n\n__1.5.1__: add ignored files to starter and use readme for pypi\n\n__1.5.0__: xml serialization via `elementtree` instead of string interpolation\n\n__1.4.4__: added skeletons for csv export in template dir and made project.py application import compatible with docs\n\n__1.4.0 + 1.4.1:__ both versions are incompatible with python3.7 and lower.\n\n__1.4.2__: fixed python3.6 incompatibility\n\n## getting started\n\n_note: support for python 2 has been officially discontinued as of july 2021. please use python 3.8 or higher to use\nup-to-date versions of maltego trx._\n\nto install the trx library run the following command:\n\n``` bash\npip install maltego-trx\n```\n\nafter installing, you can create a new project by running the following command:\n\n``` bash\nmaltego-trx start new_project\n```\n\nthis will create a folder new_project with the recommended project structure.\n\nif you want to copy the starter files to your current directory, run the following command:\n\n```bash\nmaltego-trx init\n```\n\nalternatively, you can copy either the `gunicorn` or `apache` example projects from the `demo` directory. these also\ninclude dockerfile and corresponding docker-compose configuration files for production deployment.\n\n**adding a transform:**\n\nadd a new transform by creating a new python file in the \"transforms\" folder of your directory.\n\nany file in the folder where the **class name matches the filename**, and the class inherits from transform, will\nautomatically be discovered and added to your server.\n\na simple transform would look like the following:\n\n`new_project/transforms/greetperson.py`\n\n``` python\nfrom maltego_trx.entities import phrase\nfrom maltego_trx.transform import discoverabletransform\n\n\nclass greetperson(discoverabletransform):\n    \"\"\"\n    returns a phrase greeting a person on the graph.\n    \"\"\"\n\n    @classmethod\n    def create_entities(cls, request, response):\n        person_name = request.value\n\n        response.addentity(phrase, \"hi %s, nice to meet you!\" % person_name)\n```\n\n## running the transform server\n\n### for development\n\nyou can start the development server, by running the following command:\n\n``` bash\npython project.py runserver\n```\n\nthis will start up a development server that automatically reloads every time the code is changed.\n\n### for production\n\nyou can run a gunicorn transform server, after installing gunicorn on the host machine and then running the command:\n\n``` bash\ngunicorn --bind=0.0.0.0:8080 --threads=25 --workers=2 project:application\n```\n\n*for publicly accessible servers, it is recommended to run your gunicorn server behind proxy servers such as nginx.*\n\n## run a docker transform server\n\nthe `demo` folder provides an example project. the docker files given can be used to set up and run your project in\ndocker.\n\nthe dockerfile and docker-compose file can be used to easily set up and run a development transform server.\n\nif you have copied the `docker-compose.yml`, `dockerfile` and `prod.yml` files into your project, then you can use the\nfollowing commands to run the server in docker.\n\nrun the following to start the development server:\n\n``` bash\ndocker-compose up\n```\n\nrun the following command to run a production gunicorn server:\n\n``` bash\ndocker-compose -f prod.yml up --build\n```\n\n*for publicly accessible servers, it is recommended to run your gunicorn server behind proxy servers such as nginx.*\n\n## local transforms\n\n[documentation](https://docs.maltego.com/support/solutions/articles/15000017605-writing-local-transforms-in-python)\n\ntransforms written using this library can be used as either local or server transforms.\n\nto run a local transform from your project, you will need to pass the following arguments:\n\n``` bash\nproject.py local <transform_name>\n```\n\nyou can find the correct transform_name to use by running `python project.py list`.\n\n### caveats\n\nthe following values are not passed to local transforms, and will have dummy values in their place:\n\n- `type`: `local.unknown`\n- `weight`: 100\n- `slider`: 100\n- `transformsettings`: {}\n\n## using the transform registry\n\n###### added in 1.4.0 (july 2021)\n\nthe transform registry enables you to annotate transforms with metadata like display name, description, input and output\nentities as well as settings. the transform registry will automatically generate csv files that you can import into the\nptds and/or your itds.\n\n### configuring the registry\n\nyou can configure your registry with all the info you would normally add for every transform/seed on a tds. we recommend\ncreating your registry in an extra file, traditionally called `extensions.py`, to avoid circular imports.\n\n```python\n# extensions.py\nfrom maltego_trx.decorator_registry import transformregistry\n\nregistry = transformregistry(\n    owner=\"acme corporation\",\n    author=\"john doe <johndoe@acme.com>\",\n    host_url=\"https://transforms.acme.org\",\n    seed_ids=[\"demo\"]\n)\n\n# the rest of these attributes are optional\n\n# metadata\nregistry.version = \"0.1\"\n\n# transform suffix to indicate datasource\nregistry.display_name_suffix = \" [acme]\"\n\n# reference oauth settings\nregistry.oauth_settings_id = ['github-oauth']\n\n```\n\n### annotating transforms\n\n```python\n# transforms/greetperson.py\n...\nfrom extensions import registry\n\n\n@registry.register_transform(\n    display_name='greet person',\n    input_entity='maltego.phrase',\n    description='returns a phrase greeting a person on the graph.',\n    output_entities=['maltego.phrase'],\n    disclaimer='this disclaimer is optional and has to be accepted before this transform is run'\n)\nclass greetperson(discoverabletransform):\n\n    @classmethod\n    def create_entities(cls, request, response):\n        ...\n```\n\n**pro tip:** if the `display_name` is either `none` or `\"\"`, the registry will try to create a display name from the\nclass name:\n\n- `dnstoip` 'dns to ip'\n- `greetperson` 'greet person'\n\n### transform settings\n\nyou can declare transform settings in a central location and add them to the registry.\n\n#### configuring global settings\n\nthese settings will apply to all transforms which can be very helpful for api keys.\n\n```python\n# settings.py\nfrom maltego_trx.decorator_registry import transformsetting\n\napi_key_setting = transformsetting(name='api_key',\n                                   display_name='api key',\n                                   setting_type='string',\n                                   global_setting=true)\n```\n\n```python\n# extensions.py\nfrom settings import api_key_setting\n\nfrom maltego_trx.decorator_registry import transformregistry\n\nregistry = transformregistry(\n    owner=\"acme corporation\",\n    author=\"john doe <johndoe@acme.com>\",\n    host_url=\"https://transforms.acme.org\",\n    seed_ids=[\"demo\"]\n)\n\nregistry.global_settings = [api_key_setting]\n```\n\n#### configuring settings per transform\n\nsettings that aren't required for every transform have to be added to the `register_transform` decorator explicitly. to\naccess the setting on the request, use the `id` property, which will have the global prefix if it's a global setting.\nthe `name` property won't work on global settings.\n\n```python\n# settings.py\n...\n\nlanguage_setting = transformsetting(name='language',\n                                    display_name=\"language\",\n                                    setting_type='string',\n                                    default_value='en',\n                                    optional=true,\n                                    popup=true)\n```\n\n```python\n# transforms/greetperson.py\n...\nfrom settings import language_setting\n\nfrom maltego_trx.transform import discoverabletransform\n\n\n@registry.register_transform(display_name=\"greet person\",\n                             input_entity=\"maltego.phrase\",\n                             description='returns a phrase greeting a person on the graph.',\n                             settings=[language_setting])\nclass greetperson(discoverabletransform):\n\n    @classmethod\n    def create_entities(cls, request: maltegomsg, response: maltegotransform):\n        language = request.gettransformsetting(language_setting.id)\n        ...\n```\n\n### exporting the tds configuration\n\nto export the configurations, use the registry methods `write_transforms_config()` and `write_settings_config()`. these\nmethods have to executed after they have been registered with the trx server.\n\n```python\n# project.py\n\nimport sys\nimport transforms\n\nfrom maltego_trx.registry import register_transform_function, register_transform_classes\nfrom maltego_trx.server import application\nfrom maltego_trx.handler import handle_run\n\n# register_transform_function(transform_func)\nfrom extensions import registry\n\nregister_transform_classes(transforms)\n\nregistry.write_transforms_config()\nregistry.write_settings_config()\n\nhandle_run(__name__, sys.argv, application)\n```\n\n### generating an `.mtz` config with your local transforms\n\nsince `maltego-trx>=1.6.0` you can generate an `.mtz` config file with your local transforms.\n\nif you're already using the `transformregistry`, just invoke the `write_local_config()` method.\n\n```python\n# project.py\n\nregistry.write_local_mtz()\n```\n\nthis will create a file called `local.mtz` in the current directory. you can then import this file into maltego and\nstart using your local transforms faster. just remember that settings are not passed to local transforms.\n\nthe method takes in the same arguments as the interface in the maltego client.\nif you are using a `virtualenv` environment, you might want to change the `command` argument to use that.\n\n```bash\n# project.py\n\nregistry.write_local_mtz(\n    mtz_path: str = \"./local.mtz\", # path to the local .mtz file\n    working_dir: str = \".\",\n    command: str = \"python3\", # for a venv you might want to use `./venv/bin/python3`\n    params: str = \"project.py\",\n    debug: bool = true\n)\n```\n\n## legacy transforms\n\n[documentation](https://docs.maltego.com/support/solutions/articles/15000018299-porting-old-trx-transforms-to-the-latest-version)\n\nif you have old trx transforms that are written as functions, they can be registered with the server using\nthe `maltego_trx.registry.register_transform_function` method.\n\nin order to port your old transforms, make two changes:\n\n1. import the maltegotransform class from the `maltego_trx` package instead of from a local file.\n2. call the `register_transform_function` in order for the transform to be registered in your project.\n\nfor example\n\nin the legacy transform file, change:\n\n``` python\nfrom maltego import *\n\ndef old_transform(m):\n```\n\nto:\n\n```python\n\nfrom maltego_trx.maltego import maltegotransform\n\n\ndef old_transform(m):\n    ...\n```\n\nin the `project.py` file add the following:\n\n```python\nfrom maltego_trx.registry import register_transform_function\nfrom legacy_transform import trx_dns2ip\n\nregister_transform_function(trx_dns2ip)\n```\n\n## cli\n\nthe following commands can be run using the project.py file.\n\n### run server\n\n``` bash\npython project.py runserver\n```\n\nstart a development server that you can use to develop new transforms.\n\n### list\n\n``` bash\npython project.py list\n```\n\nlist the available transforms together with their transform server urls and local transform names.\n\n## reference\n\n### constants\n\nthe following constants can be imported from `maltego_trx.maltego`.\n\n**message types:**\n\n- `uim_fatal`\n- `uim_partial`\n- `uim_inform`\n- `uim_debug`\n\n**please take note:**\nyou need to enable the `debug` filter option in the desktop client output window to view `debug` transform messages.\n\n**bookmark colors:**\n\n- `bookmark_color_none`\n- `bookmark_color_blue`\n- `bookmark_color_green`\n- `bookmark_color_yellow`\n- `bookmark_color_purple`\n- `bookmark_color_red`\n\n**link styles:**\n\n- `link_style_normal`\n- `link_style_dashed`\n- `link_style_dotted`\n- `link_style_dashdot`\n\n### enums\n\n**overlays:**\n\noverlays enums are imported from `maltego_trx.overlays`\n\n*overlay overlayposition:*\n\n- `north = \"n\"`\n- `south = \"s\"`\n- `west = \"w\"`\n- `north_west = \"nw\"`\n- `south_west = \"sw\"`\n- `center = \"c\"`\n\n*overlay type*\n\n- `image = \"image\"`\n- `colour = \"colour\"`\n- `text = \"text\"`\n\n### request/maltegomsg\n\nthe request/maltego msg object given to the transform contains the information about the input entity.\n\n**attributes:**\n\n- `value: str`: the display value of the input entity on the graph\n- `weight: int`: the weight of the input entity\n- `slider: int`: results slider setting in the client\n- `type: str`: the input entity type\n- `properties: dict(str: str)`: a key-value dictionary of the input entity properties\n- `transformsettings: dict(str: str)`: a key-value dictionary of the transform settings\n- `genealogy: list(dict(str: str))`: a key-value dictionary of the entity genealogy, this is only applicable for\n  extended entities e.g. website entity\n\n**methods:**\n\n- `getproperty(name: str)`: get a property value of the input entity\n- `gettransformsetting(name: str)`: get a transform setting value\n- `clearlegacyproperties()`: delete (duplicate) legacy properties from the input entity. this will not result in\n  property information being lost, it will simply clear out some properties that the trx library duplicates on all\n  incoming transform requests. in older versions of trx, these entity properties would have a different internal id when\n  sent the server than what the maltego client would advertise in the entity manager ui. for a list of entities with\n  such properties and their corresponding legacy and actual ids, see `entity_property_map` in `maltego_trx/entities.py`.\n  for the majority of projects this distinction can be safely ignored.\n\n### response/maltegotransform\n\n**methods:**\n\n- `addentity(type: str, value: str) -> entity`: add an entity to the transform response. returns an entity object\n  created by the method.\n- `adduimessage(message: str, messagetype='inform')`: return a ui message to the user. for message type, use a message\n  type constant.\n\n### entity\n\n**methods:**\n\n- `settype(type: str)`: set the entity type (e.g. \"phrase\" for maltego.phrase entity)\n- `setvalue(value: str)`: set the entity value\n- `setweight(weight: int)`: set the entity weight\n- `adddisplayinformation(content: str, title: str)`: add display information for the entity.\n- `addproperty(fieldname: str, displayname: str, matchingrule: str, value: str)`: add a property to the entity. matching\n  rule can be `strict` or `loose`.\n- `addoverlay(propertyname: str, position: overlayposition, overlay_type: overlaytype)`: add an overlay to the entity.\n  `overlayposition` and `overlaytype` are defined in the `maltego_trx.overlays`\n\noverlay can be added as text, image or color\n\n```python \n        \n        person_name = request.value\n        entity = response.addentity(phrase, \"hi %s, nice to meet you!\" % person_name)\n\n        # normally, when we create an overlay, we would reference a property name so that maltego can then use the\n        # value of that property to create the overlay. sometimes that means creating a dynamic property, but usually\n        # it's better to either use an existing property, or, if you created the entity yourself, and only need the\n        # property for the overlay, to use a hidden property. here's an example of using a dynamic property:\n        entity.addproperty(\n            'dynamic_overlay_icon_name', \n            displayname=\"name for overlay image\", \n            value=\"champion\"  # references an icon in the maltego client\n        )\n        entity.addoverlay('dynamic_overlay_icon_name', overlayposition.west, overlaytype.image)\n\n        # discouraged:\n        # you *can* also directly supply the string value of the property, however this is not recommended. why? if\n        # the entity already has a property of the same id (in this case, \"de\"), then you would in fact be assigning the\n        # value of that property, not the string \"de\", which is not the intention. nevertheless, here's an example:\n        entity.addoverlay(\n            'de', # name of an icon, however, could also accidentally be a property name\n            overlayposition.south_west, \n            overlaytype.image\n        )\n\n        # overlays can also be used to display extra text on an entity:\n        entity.addproperty(\"exampledynamicpropertyname\", \"example dynamic property\", \"loose\", \"maltego overlay testing\")\n        entity.addoverlay('exampledynamicpropertyname', overlayposition.north, overlaytype.text)\n\n        # or a small color indicator:\n        entity.addoverlay('#45e06f', overlayposition.north_west, overlaytype.colour)\n```\n\n- `seticonurl(url: str)`: set the entity icon url\n- `setbookmark(bookmark: int)`: set bookmark color index (e.g. -1 for bookmark_color_none, 3 for bookmark_color_purple)\n- `setnote(note: str)`: set note content\n- `setgenealogy(genealogy: dict)`: set genealogy\n\n**link methods:**\n\n- `setlinkcolor(color: str)`: set the link color (e.g. hex \"#0000ff\" for blue)\n- `setlinkstyle(style: int)`: set the link style index (e.g. 0 for link_style_normal, 2 for link_style_dotted)\n- `setlinkthickness(thick: int)`: set link thickness (default is 1)\n- `setlinklabel(label: str)`: set the label of the link\n- `reverselink()`: reverse the link direction\n- `addcustomlinkproperty(fieldname=none, displayname=none, value=none)`: set a custom property for the link\n",
  "docs_url": null,
  "keywords": "",
  "license": "mit",
  "name": "maltego-trx",
  "package_url": "https://pypi.org/project/maltego-trx/",
  "project_url": "https://pypi.org/project/maltego-trx/",
  "project_urls": {
    "Homepage": "https://github.com/paterva/maltego-trx/"
  },
  "release_url": "https://pypi.org/project/maltego-trx/1.6.1/",
  "requires_dist": [
    "flask (>=2.2.0)",
    "cryptography (>=39.0.1)"
  ],
  "requires_python": ">=3.8.0",
  "summary": "python library used to develop maltego transforms",
  "version": "1.6.1",
  "releases": [],
  "developers": [
    "maltego_staff",
    "support@maltego.com"
  ],
  "kwds": "pytest pythonx python3 py yaml",
  "license_kwds": "mit",
  "libtype": "pypi",
  "id": "pypi_maltego_trx",
  "homepage": "https://github.com/paterva/maltego-trx/",
  "release_count": 22,
  "dependency_ids": [
    "pypi_cryptography",
    "pypi_flask"
  ]
}