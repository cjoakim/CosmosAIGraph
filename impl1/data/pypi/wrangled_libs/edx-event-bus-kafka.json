{
  "classifiers": [
    "development status :: 3 - alpha",
    "framework :: django",
    "framework :: django :: 3.2",
    "intended audience :: developers",
    "license :: osi approved :: gnu affero general public license v3 or later (agplv3+)",
    "natural language :: english",
    "programming language :: python :: 3",
    "programming language :: python :: 3.8"
  ],
  "description": "edx event bus - kafka\n#####################\n\nkafka implementation for open edx event bus.\n\n|pypi-badge| |ci-badge| |codecov-badge| |doc-badge| |pyversions-badge|\n|license-badge|\n\noverview\n********\nthis package implements an event bus for open edx using kafka.\n\nthe event bus acts as a broker between services publishing events and other services that consume these events.\nimplementing the event bus will allow for asynchronous messaging across services which greatly improves efficiency as we don't have to wait for scheduled batch synchronizations.\nadditionally, since the services all speak to the event bus, they are independent of one another and can still function if one service crashes.\n\nthis package contains both the publishing code, which processes events into messages to send to the broker, and the consumer code,\nwhich polls the broker using a `while true` loop in order to turn messages back into event data to be emitted.\nthe actual kafka host will be configurable.\n\nthe goal for event-bus-kafka is to eventually have a flexible event bus that can be easily brought into other apps and repositories to produce and consume arbitrary topics.\nideally, the event bus itself will also be an abstraction behind which platform maintainers can use non-kafka implementations (redis, pulsar, etc.).\nthe documentation/adrs may also be moved to more appropriate places as the process matures.\n\nthe repository works together with the openedx/openedx-events repository to make the fully functional event bus.\n\ndocumentation\n*************\n\nto use this implementation of the event bus with openedx-events, you'll need to ensure that you include the dependency ``confluent_kafka[avro,schema-registry]`` (see `adr 5 <https://github.com/openedx/event-bus-kafka/blob/main/docs/decisions/0005-optional-import-of-confluent-kafka.rst>`_ for an explanation) and set the following django settings::\n\n    event_bus_kafka_bootstrap_servers: ...\n    event_bus_kafka_schema_registry_url: ...\n    event_bus_topic_prefix: ...\n\n    # on the producing side:\n    event_bus_producer: edx_event_bus_kafka.create_producer\n\n    # on the consuming side:\n    event_bus_consumer: edx_event_bus_kafka.kafkaeventconsumer\n\n\noptional settings that are worth considering:\n\n- ``event_bus_kafka_consumer_consecutive_errors_limit``\n\nfor manual testing, see `<docs/how_tos/manual_testing.rst>`__.\n\ndjango management commands:\n\n- if you need to test event production, use the ``produce_event`` management command\n- to actually run the consumer, use openedx-events' ``consume_events`` management command\n\noep-52 documentation: https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0052-arch-event-bus-architecture.html\n(todo: `set up documentation <https://openedx.atlassian.net/wiki/spaces/doc/pages/21627535/publish+documentation+on+read+the+docs>`_)\n\ndevelopment workflow\n********************\n\none time setup\n==============\n.. code-block::\n\n  # clone the repository\n  git clone git@github.com:openedx/event-bus-kafka.git\n  cd event-bus-kafka\n\n  # set up a virtualenv using virtualenvwrapper with the same name as the repo and activate it\n  mkvirtualenv -p python3.8 event-bus-kafka\n\n\nevery time you develop something in this repo\n=============================================\n.. code-block::\n\n  # activate the virtualenv\n  workon event-bus-kafka\n\n  # grab the latest code\n  git checkout main\n  git pull\n\n  # install/update the dev requirements\n  make requirements\n\n  # run the tests and quality checks (to verify the status before you make any changes)\n  make validate\n\n  # make a new branch for your changes\n  git checkout -b <your_github_username>/<short_description>\n\n  # using your favorite editor, edit the code to make your change.\n  vim \u2026\n\n  # run your new tests\n  pytest ./path/to/new/tests\n\n  # run all the tests and quality checks\n  make validate\n\n  # commit all your changes\n  git commit \u2026\n  git push\n\n  # open a pr and ask for review.\n\ninstallation\n************\n\nthis library is not intended to be a direct dependency of any service. instead, it will likely be installed by some private mechanism. unless the platform gains new processes for installing private dependencies, upgrades will need to be manually managed via a pin.\n\nlicense\n*******\n\nthe code in this repository is licensed under the agpl 3.0 unless\notherwise noted.\n\nplease see `license.txt <license.txt>`_ for details.\n\nhow to contribute\n*****************\n\ncontributions are very welcome.\nplease read `how to contribute <https://github.com/openedx/.github/blob/master/contributing.md>`_ for details.\n\nthe pull request description template should be automatically applied if you are creating a pull request from github. otherwise you\ncan find it at `pull_request_template.md <.github/pull_request_template.md>`_.\n\nthe issue report template should be automatically applied if you are creating an issue on github as well. otherwise you\ncan find it at `issue_template.md <.github/issue_template.md>`_.\n\nreporting security issues\n*************************\n\nplease do not report security issues in public. please email security@edx.org.\n\ngetting help\n************\n\nif you're having trouble, we have discussion forums at https://discuss.openedx.org where you can connect with others in the community.\n\nour real-time conversations are on slack. you can request a `slack invitation`_, then join our `community slack workspace`_.\n\nfor more information about these options, see the `getting help`_ page.\n\n.. _slack invitation: https://openedx-slack-invite.herokuapp.com/\n.. _community slack workspace: https://openedx.slack.com/\n.. _getting help: https://openedx.org/getting-help\n\n.. |pypi-badge| image:: https://img.shields.io/pypi/v/edx-event-bus-kafka.svg\n    :target: https://pypi.python.org/pypi/edx-event-bus-kafka/\n    :alt: pypi\n\n.. |ci-badge| image:: https://github.com/openedx/event-bus-kafka/workflows/python%20ci/badge.svg?branch=main\n    :target: https://github.com/openedx/event-bus-kafka/actions\n    :alt: ci\n\n.. |codecov-badge| image:: https://codecov.io/github/openedx/event-bus-kafka/coverage.svg?branch=main\n    :target: https://codecov.io/github/openedx/event-bus-kafka?branch=main\n    :alt: codecov\n\n.. |doc-badge| image:: https://readthedocs.org/projects/edx-event-bus-kafka/badge/?version=latest\n    :target: https://edx-event-bus-kafka.readthedocs.io/en/latest/\n    :alt: documentation\n\n.. |pyversions-badge| image:: https://img.shields.io/pypi/pyversions/edx-event-bus-kafka.svg\n    :target: https://pypi.python.org/pypi/edx-event-bus-kafka/\n    :alt: supported python versions\n\n.. |license-badge| image:: https://img.shields.io/github/license/openedx/event-bus-kafka.svg\n    :target: https://github.com/openedx/event-bus-kafka/blob/main/license.txt\n    :alt: license\n\n\nchange log\n##########\n\n..\n   all enhancements and patches to edx_event_bus_kafka will be documented\n   in this file.  it adheres to the structure of https://keepachangelog.com/ ,\n   but in restructuredtext instead of markdown (for ease of incorporation into\n   sphinx documentation and the pypi description).\n\n   this project adheres to semantic versioning (https://semver.org/).\n\n.. there should always be an \"unreleased\" section for changes pending release.\n\nunreleased\n**********\n\n[5.5.0] - 2023-09-21\n********************\nchanged\n=======\n* reset edx-django-utils requestcache before handling each event\n\n[5.4.0] - 2023-08-28\n********************\nchanged\n=======\n* changed ordering of certain context assignments in producer code.\n* adds custom exceptions for producing and consuming errors.\n\n[5.3.1] - 2023-08-10\n********************\nfixed\n=====\n* constrain openedx-events version to at least 8.5.0 (for eventsmetadata serialization support)\n\n[5.3.0] - 2023-08-08\n********************\nchanged\n=======\n* added event_metadata_as_dict to producingcontext for easier replay from logs\n\n[5.2.0] - 2023-08-03\n********************\nchanged\n=======\n* added event_data_as_dict to producingcontext for easier replay from logs\n\n[5.1.0] - 2023-05-17\n********************\nchanged\n=======\n* reconfigured serializers to use topic_record_name_strategy, allowing multiple event types per topic\n\n[5.0.0] - 2023-05-17\n********************\nchanged\n=======\n* **breaking change**: removed deprecated ``signal`` argument from consumer initialization\n\n[4.0.1] - 2023-05-10\n********************\nfixed\n=====\n* added ``signal`` back as an argument when creating a consumer for compatibility with the openedx-events api\n\n[4.0.0] - 2023-05-10\n********************\nchanged\n=======\n* implement openedx-events event bus consumer api.\n* **breaking change**: remove ``consume_events`` management command as this command will be provided by openedx_events. to replay events using the\n  openedx-events version of the management command, pass ``--extra '{\"offset_time\": \"2023-01-08t06:46:22\"}'`` instead of ``-o 2023-01-08t06:46:22``.\n* **breaking change**: ``offset_timestamp`` argument has been removed from ``consume_indefinitely`` and ``reset_offsets_and_sleep_indefinitely`` methods.\n  it is now added as an optional argument named ``offset_time`` to ``kafkaeventconsumer`` constructor.\n\n[3.10.0] - 2023-05-05\n*********************\nchanged\n=======\n* switch from ``edx-sphinx-theme`` to ``sphinx-book-theme`` since the former is\n  deprecated\n* refactored consumer to manually deserialize messages instead of using deserializingconsumer\n* make signal argument optional in consumer command (take signal from message headers)\n\n[3.9.6] - 2023-02-24\n********************\nadded\n=====\n* add function tracing to the event consumption workflow for better monitoring.\n\n[3.9.5] - 2023-02-24\n********************\n\nfixed\n=====\n* ``consume_events`` command now loads all public signals so that the consumer can load signals by ``event_type`` even if their modules were not already imported\n\n[3.9.4] - 2023-02-16\n********************\n\nfixed\n=====\n* produce_event management command fixed to pass required events_metadata parameter\n\n[3.9.3] - 2023-02-10\n********************\nfixed\n=====\n* include ``message_id`` in audit log when message is produced (was ``none``)\n\n[3.9.2] - 2023-02-08\n********************\nfixed\n=====\n* added documentation to all django settings used in consumer and producer\n\n[3.9.1] - 2023-02-07\n********************\nthere was no version 3.9.0, due to a release issue. (ignore any ``v3.9.0`` tag.)\n\nadded\n=====\n* added logging of successful message production, consumption, and processing (not just errors)\n\n[3.8.1] - 2023-02-03\n********************\nchanged\n=======\n* require and use openedx-events 5.0.0, which has a breaking api change that affects event bus consumers.\n\n[3.8.0] - 2023-01-31\n********************\nadded\n=====\n* producer now passes all metadata fields as headers\n* consumer emits events with the original metadata information (from the producer)\n\n[3.7.1] - 2023-01-31\n********************\nfixed\n=====\n* consumer management command exits with useful error message if confluent-kafka library not available.\n\n[3.7.0] - 2023-01-30\n********************\nchanged\n=======\n* added ``reset_offsets_and_sleep_indefinitely`` method to consumer; relying code should switch to calling this when an offset timestamp is set.\n* deprecated the ``offset_timestamp`` parameter on the consumer's ``consume_indefinitely`` method, since ``reset_offsets_and_sleep_indefinitely`` should be used instead.\n\n[3.6.3] - 2023-01-27\n********************\nfixed\n=====\n* in the consumer loop, open new database connection if the old one has closed before processing messages\n\n[3.6.2] - 2023-01-26\n********************\nfixed\n=====\n* reset mode now commits the correct offsets to kafka.\n\n[3.6.1] - 2023-01-20\n********************\nfixed\n=======\n* added a poll call to force resets to be processed during replay/offset-reset mode.\n\n[3.6.0] - 2023-01-06\n********************\nchanged\n=======\n* consumers do not consume events after resetting offsets.\n\n[3.5.1] - 2023-01-06\n********************\nfixed\n=====\n* convert timestamps to millisecond offsets as expected by the kafka api when replaying by timestamp in the consumer\n\n[3.5.0] - 2023-01-05\n********************\nadded\n=====\n* new setting ``event_bus_kafka_consumer_consecutive_errors_limit`` will terminate the consumer if too many errors occur in a row, supporting an automated version of \"have you tried turning it off and on again\" (as long as consumer will automatically be restarted e.g. by kubernetes).\n\n[3.4.1] - 2022-12-20\n********************\nfixed\n=====\n* fixed bugs in the event replay/offset handling code for consumers.\n\n[3.4.0] - 2022-12-16\n********************\nchanged\n=======\n* kill infinite consumer loop when we see a fatal kafkaerror, as recommended in the documentation. see https://github.com/confluentinc/librdkafka/blob/e0b9e92a0b492b5b1a6f1bcf08744928d45bf396/introduction.md#fatal-consumer-errors.\n\n[3.3.0] - 2022-12-15\n********************\nchanged\n=======\n* added/removed some custom attributes used for monitoring. search for custom_attribute_name annotations for details.\n\n[3.2.0] - 2022-12-14\n********************\nchanged\n=======\n* add timestamp parameter for consumer, allowing the starting offset for consuming to be overridden from the default.\n\n[3.1.0] - 2022-12-07\n********************\n\nadded\n=====\n* a variety of custom attributes are now set for monitoring purposes. search for custom_attribute_name annotations for details.\n\nchanged\n=======\n* error recording to the log will now include message details when the message is available on the error.\n\n[3.0.0] - 2022-12-02\n********************\nchanged\n=======\n* **breaking change**: make event_metadata parameter required\n\n[2.1.0] - 2022-12-01\n********************\nchanged\n=======\n* set cloudevent headers on events using an optional event_metadata parameter\n\n[2.0.0] - 2022-11-28\n********************\nchanged\n=======\n* implement openedx-events event bus producer api\n* **breaking change**: remove caching from ``get_producer`` and rename to ``create_producer``, as we now rely on the wrapper in openedx-events to cache that call\n\nupgrading library from 1.x:\n\n- replace calls to ``edx_event_bus_kafka.get_producer`` with ``openedx_events.event_bus.get_producer``\n- add django setting ``event_bus_producer = \"edx_event_bus_kafka.create_producer\"``\n\nthese breaking changes are only relevant for the producing side. (this should only include the cms at the moment.)\n\n[1.10.0] - 2022-11-21\n*********************\nchanged\n=======\n* improve receiver error log message -- mention that stack traces are elsewhere in log\n\n[1.9.0] - 2022-11-15\n********************\nchanged\n=======\n* log and record receiver errors the same way as other errors (with offset, partition, etc.)\n\n[1.8.1] - 2022-11-10\n********************\nchanged\n=======\n* commit consumer offset asynchronously\n\n[1.8.0] - 2022-11-09\n********************\nadded\n=====\n* consumer logs a warning for receivers that fail with an exception\n\n[1.7.0] - 2022-11-04\n********************\n\nchanged\n=======\n* manually manage commits instead of using auto-commit on the consumer\n* catch exception instead of baseexception on both producer and consumer\n\n[1.6.0] - 2022-11-04\n********************\n\nchanged\n=======\n* enhanced error logging in consumer, including telemetry for exceptions\n* consumer loop will no longer exit when an error is encountered\n\n[1.5.0] - 2022-11-01\n********************\n\nchanged\n=======\n* log full event data on all producer errors\n\n[1.4.3] - 2022-10-31\n********************\n\nfixed\n=====\n* upgrade openedx-events and fastavro to bring in a fix for schema creation\n\n[1.4.2] - 2022-10-31\n********************\n\nfixed\n=====\n* removed proof-of-concept code that logged user-login events\n\n[1.4.1] - 2022-10-28\n********************\n\nfixed\n=====\n* correct and clarify management command help strings (some copy-paste errors)\n* update todo comments\n\n[1.4.0] - 2022-10-21\n********************\n\nchanged\n=======\n* remove override of auto.offset.reset on consumer (which will default to \"latest\"). new consumer groups will consume only messages that are sent after the group was initialized.\n* remove redundant lookup of signal in consumer loop (should not have any effect)\n* explicitly encode message header values as utf-8 (no change in behavior)\n\n[1.3.0] - 2022-10-20\n********************\n\nchanged\n=======\n\n* upgrade openedx-events. when avrosignalserializer gets event schemas, it will get whatever is currently defined in openedx-events, so this will update the course_catalog_event_changed schema (dropping `effort` field)\n\n[1.2.0] - 2022-10-13\n********************\n\nchanged\n=======\n\n* ``event_bus_kafka_consumers_enabled`` now defaults to true instead of false\n* removed manual monitoring since new relic tracks these now.\n\n[1.1.0] - 2022-10-06\n********************\n\nchanged\n=======\n\n* added monitoring for consumption tasks.\n\n[1.0.0] - 2022-10-03\n********************\n\nchanged\n=======\n\n* fixed bug in schema registry that was sending schemas to the wrong topic\n* bump version to 1.x to acknowledge that this is in use in production\n\n[0.7.0] - 2022-09-08\n********************\n\nchanged\n=======\n\n* **breaking changes** ``eventproducerkafka`` is now ``kafkaeventproducer``\n* kafkaeventconsumer is now part of the public api\n\n[0.6.2] - 2022-09-08\n********************\n\nadded\n=====\n\n* topic names can be autoprefixed by setting ``event_bus_topic_prefix``\n\n[0.6.1] - 2022-09-06\n********************\n\nadded\n=====\n\n* producer now polls on an interval, improving callback reliability. configurable with ``event_bus_kafka_poll_interval_sec``.\n\n[0.6.0] - 2022-09-01\n********************\n\nchanged\n=======\n\n* **breaking change**: public api is now defined in ``edx_event_bus_kafka`` package and ``edx_event_bus_kafka.management.commands`` package; all other modules should be considered unstable and not for external use.\n\n[0.5.1] - 2022-08-31\n********************\n\nfixed\n=====\n\n* various lint issues (and missing ``__init__.py`` files.)\n\n[0.5.0] - 2022-08-31\n********************\n\nchanged\n=======\n\n* **breaking changes** in the producer module, refactored to expose a better api:\n\n  * rather than ``send_to_event_bus(...)``, relying code should now call ``get_producer().send(...)``.\n  * the ``sync`` kwarg is gone; to flush and sync messages before shutdown, call ``get_producer().prepare_for_shutdown()`` instead.\n\n* clarify that config module is for internal use only.\n* implementation changes: only a single producer is created, and is used for all signals.\n\n[0.4.4] - 2022-08-26\n********************\n\nfixed\n=====\n\n* fixed bug in test module for when confluent-kafka isn't present\n\n[0.4.3] - 2022-08-24\n********************\n\nfixed\n=====\n\n* never evict producers from cache. there wasn't a real risk of this, but now we can rely on them being long-lived. addresses remainder of `<https://github.com/openedx/event-bus-kafka/issues/16>`__.\n\n[0.4.2] - 2022-08-24\n********************\n\nfixed\n=====\n\n* properly load auth settings for producer/consumer. (auth settings were ignored since 0.3.1.)\n\n[0.4.1] - 2022-08-18\n********************\n\nchanged\n=======\n\n* remove confluent-kafka as a formal dependency of the repository.\n\n  * note: this library will not work without confluent-kafka.\n\n* add an adr to explain why this work was done.\n\n[0.4.0] - 2022-08-15\n********************\n\nchanged\n=======\n\n* rename settings to have consistent prefix.\n\n  * ``kafka_consumers_enabled`` becomes ``event_bus_kafka_consumers_enabled``\n  * ``consumer_poll_timeout`` becomes ``event_bus_kafka_consumer_poll_timeout``\n  * updates to documentation and tests for various settings previously renamed\n\n[0.3.1] - 2022-08-11\n********************\n\nchanged\n=======\n\n* refactored consumer to use common configuration.\n\n[0.3.0] - 2022-08-10\n********************\n\nchanged\n=======\n\n* moved configuration onto separate file.\n* updated configuration settings to have event_bus_kafka prefix.\n\n[0.2.0] - 2022-08-09\n********************\n\nfixed\n=====\n\n* cache producers so that they don't lose data.\n\n[0.1.0] - 2022-06-16\n********************\n\nadded\n=====\n\n* first release on pypi.\n",
  "docs_url": null,
  "keywords": "python edx",
  "license": "agpl 3.0",
  "name": "edx-event-bus-kafka",
  "package_url": "https://pypi.org/project/edx-event-bus-kafka/",
  "project_url": "https://pypi.org/project/edx-event-bus-kafka/",
  "project_urls": {
    "Homepage": "https://github.com/openedx/event-bus-kafka"
  },
  "release_url": "https://pypi.org/project/edx-event-bus-kafka/5.5.0/",
  "requires_dist": [
    "Django",
    "edx-django-utils",
    "edx-toggles",
    "openedx-events >=8.5.0"
  ],
  "requires_python": ">=3.8",
  "summary": "kafka implementation for open edx event bus.",
  "version": "5.5.0",
  "releases": [],
  "developers": [
    "edx",
    "oscm@edx.org"
  ],
  "kwds": "edx_event_bus_kafka event_bus_kafka event_bus_kafka_consumers_enabled event_bus_kafka_schema_registry_url event_bus_kafka_bootstrap_servers",
  "license_kwds": "agpl 3.0",
  "libtype": "pypi",
  "id": "pypi_edx_event_bus_kafka",
  "homepage": "https://github.com/openedx/event-bus-kafka",
  "release_count": 61,
  "dependency_ids": [
    "pypi_django",
    "pypi_edx_django_utils",
    "pypi_edx_toggles",
    "pypi_openedx_events"
  ]
}