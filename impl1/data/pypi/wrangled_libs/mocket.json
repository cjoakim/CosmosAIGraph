{
  "classifiers": [
    "development status :: 6 - mature",
    "intended audience :: developers",
    "license :: osi approved :: bsd license",
    "operating system :: os independent",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.12",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9",
    "programming language :: python :: implementation :: cpython",
    "programming language :: python :: implementation :: pypy",
    "topic :: software development",
    "topic :: software development :: testing"
  ],
  "description": "===============\nmocket /m\u0254\u02c8k\u025bt/\n===============\n\n.. image:: https://github.com/mindflayer/python-mocket/workflows/mocket's%20ci/badge.svg\n    :target: https://github.com/mindflayer/python-mocket/actions?query=workflow%3a%22mocket%27s+ci%22\n\n.. image:: https://coveralls.io/repos/github/mindflayer/python-mocket/badge.svg?branch=master\n    :target: https://coveralls.io/github/mindflayer/python-mocket?branch=master\n\n.. image:: https://app.codacy.com/project/badge/grade/6327640518ce42adaf59368217028f14\n    :target: https://www.codacy.com/gh/mindflayer/python-mocket/dashboard\n\n.. image:: https://img.shields.io/pypi/dm/mocket\n    :target: https://pypistats.org/packages/mocket\n\n\na socket mock framework\n-------------------------\n    for all kinds of socket *animals*, web-clients included - with gevent/asyncio/ssl support\n\n...and then micropython's *urequests* (*mocket >= 3.9.1*)\n\noutside github\n==============\n\nmocket packages are available for `arch linux`_, `opensuse`_, `nixos`_, `alt linux`_ and `netbsd`_.\n\n.. _`arch linux`: https://archlinux.org/packages/extra/any/python-mocket/\n.. _`opensuse`: https://software.opensuse.org/search?baseproject=all&q=mocket\n.. _`nixos`: https://search.nixos.org/packages?query=mocket\n.. _`alt linux`: https://packages.altlinux.org/en/sisyphus/srpms/python3-module-mocket/\n.. _`netbsd`: https://cdn.netbsd.org/pub/pkgsrc/current/pkgsrc/devel/py-mocket/index.html\n\n\nversioning\n==========\nstarting from *3.7.0*, mocket major version will follow the same numbering pattern as python's and therefore indicate the most recent python version that is supported.\n\nfyi: the last version compatible with python 2.7 is *3.9.4*, bugfixing or backporting of features introduced after that release will only be available as commercial support.\n\nsupport it\n==========\n*star* the project on github, *buy me a coffee* clicking the button below or, even better, contribute with patches or documentation.\n\n.. image:: https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png\n     :target: https://www.buymeacoffee.com/mocket\n     :alt: buy me a coffee\n\nhow to use it\n=============\nread the following blog posts if you want to have a big picture of what *mocket* is capable of:\n\n- https://medium.com/p/mocket-is-alive-and-is-fighting-with-us-b2810d52597a\n- https://hackernoon.com/make-development-great-again-faab769d264e\n- https://hackernoon.com/httpretty-now-supports-asyncio-e310814704c6\n- https://medium.com/@mindflayer/how-to-make-your-tests-fail-when-they-try-to-access-the-network-python-eb80090a6d24\n- https://medium.com/@mindflayer/testing-in-an-asyncio-world-a9a0ad41b0c5\n\nthe starting point to understand how to use *mocket* to write a custom mock is the following example:\n\n- https://github.com/mindflayer/mocketoy\n\nas next step, you are invited to have a look at the implementation of both the mocks it provides:\n\n- http mock (similar to httpretty) - https://github.com/mindflayer/python-mocket/blob/master/mocket/mockhttp.py\n- redis mock (basic implementation) - https://github.com/mindflayer/python-mocket/blob/master/mocket/mockredis.py\n\nplease also have a look at the huge test suite:\n\n- tests module at https://github.com/mindflayer/python-mocket/tree/master/tests\n\ninstallation\n============\nusing pip::\n\n    $ pip install mocket\n\nspeedups\n========\nmocket uses **xxhash** when available instead of *hashlib.md5* for creating hashes, you can install it as follows::\n\n    $ pip install mocket[speedups]\n\nissues\n============\nwhen opening an **issue**, please add few lines of code as failing test, or -better- open its relative **pull request** adding this test to our test suite.\n\nexample of how to mock an http[s] call\n======================================\nlet's create a new virtualenv with all we need::\n\n    $ python3 -m venv example\n    $ source example/bin/activate\n    $ pip install pytest requests mocket\n\nas second step, we create an `example.py` file as the following one:\n\n.. code-block:: python\n\n    import json\n\n    from mocket import mocketize\n    from mocket.mockhttp import entry\n    import requests\n    import pytest\n\n\n    @pytest.fixture\n    def response():\n        return {\n            \"integer\": 1,\n            \"string\": \"asd\",\n            \"boolean\": false,\n        }\n\n\n    @mocketize  # use its decorator\n    def test_json(response):\n        url_to_mock = 'https://testme.org/json'\n\n        entry.single_register(\n            entry.get,\n            url_to_mock,\n            body=json.dumps(response),\n            headers={'content-type': 'application/json'}\n        )\n\n        mocked_response = requests.get(url_to_mock).json()\n\n        assert response == mocked_response\n\n    # or use its context manager\n    from mocket import mocketizer\n\n    def test_json_with_context_manager(response):\n        url_to_mock = 'https://testme.org/json'\n\n        entry.single_register(\n            entry.get,\n            url_to_mock,\n            body=json.dumps(response),\n            headers={'content-type': 'application/json'}\n        )\n\n        with mocketizer():\n            mocked_response = requests.get(url_to_mock).json()\n\n        assert response == mocked_response\n\nlet's fire our example test::\n\n    $ py.test example.py\n\nhow to make mocket fail when it tries to write to a real `socket`?\n==================================================================\nnew!!! sometimes you just want your tests to fail when they attempt to use the network.\n\n.. code-block:: python\n\n    with mocketizer(strict_mode=true):\n        with pytest.raises(strictmocketexception):\n            requests.get(\"https://duckduckgo.com/\")\n\n    # or\n\n    @mocketize(strict_mode=true)\n    def test_get():\n        with pytest.raises(strictmocketexception):\n            requests.get(\"https://duckduckgo.com/\")\n\nhow to be sure that all the entry instances have been served?\n=============================================================\nadd this instruction at the end of the test execution:\n\n.. code-block:: python\n\n    mocket.assert_fail_if_entries_not_served()\n\nexample of how to fake socket errors\n====================================\n\nit's very important that we test non-happy paths.\n\n.. code-block:: python\n\n    @mocketize\n    def test_raise_exception(self):\n        url = \"http://github.com/fluidicon.png\"\n        entry.single_register(entry.get, url, exception=socket.error())\n        with self.assertraises(requests.exceptions.connectionerror):\n            requests.get(url)\n\nexample of how to record real socket traffic\n============================================\n\nyou probably know what *vcrpy* is capable of, that's the *mocket*'s way of achieving it:\n\n.. code-block:: python\n\n    @mocketize(truesocket_recording_dir=tempfile.mkdtemp())\n    def test_truesendall_with_recording_https():\n        url = 'https://httpbin.org/ip'\n\n        requests.get(url, headers={\"accept\": \"application/json\"})\n        resp = requests.get(url, headers={\"accept\": \"application/json\"})\n        assert resp.status_code == 200\n\n        dump_filename = os.path.join(\n            mocket.get_truesocket_recording_dir(),\n            mocket.get_namespace() + '.json',\n        )\n        with io.open(dump_filename) as f:\n            response = json.load(f)\n\n        assert len(response['httpbin.org']['443'].keys()) == 1\n\nhttpretty compatibility layer\n=============================\nmocket http mock can work as *httpretty* replacement for many different use cases. two main features are missing:\n\n- url entries containing regular expressions;\n- response body from functions (used mostly to fake errors, *mocket* doesn't need to do it this way).\n\ntwo features which are against the zen of python, at least imho (*mindflayer*), but of course i am open to call it into question.\n\nexample:\n\n.. code-block:: python\n\n    import json\n\n    import aiohttp\n    import asyncio\n    from unittest import testcase\n\n    from mocket.plugins.httpretty import httpretty, httprettified\n\n\n    class aiohttpentrytestcase(testcase):\n        @httprettified\n        def test_https_session(self):\n            url = 'https://httpbin.org/ip'\n            httpretty.register_uri(\n                httpretty.get,\n                url,\n                body=json.dumps(dict(origin='127.0.0.1')),\n            )\n\n            async def main(l):\n                async with aiohttp.clientsession(\n                    loop=l, timeout=aiohttp.clienttimeout(total=3)\n                ) as session:\n                    async with session.get(url) as get_response:\n                        assert get_response.status == 200\n                        assert await get_response.text() == '{\"origin\": \"127.0.0.1\"}'\n\n            loop = asyncio.new_event_loop()\n            loop.set_debug(true)\n            loop.run_until_complete(main(loop))\n\nwhat about the other socket animals?\n====================================\nusing *mocket* with asyncio based clients::\n\n    $ pip install aiohttp\n\nexample:\n\n.. code-block:: python\n\n    class aiohttpentrytestcase(testcase):\n        @mocketize\n        def test_http_session(self):\n            url = 'http://httpbin.org/ip'\n            body = \"asd\" * 100\n            entry.single_register(entry.get, url, body=body, status=404)\n            entry.single_register(entry.post, url, body=body*2, status=201)\n\n            async def main(l):\n                async with aiohttp.clientsession(\n                    loop=l, timeout=aiohttp.clienttimeout(total=3)\n                ) as session:\n                    async with session.get(url) as get_response:\n                        assert get_response.status == 404\n                        assert await get_response.text() == body\n\n                    async with session.post(url, data=body * 6) as post_response:\n                        assert post_response.status == 201\n                        assert await post_response.text() == body * 2\n\n            loop = asyncio.new_event_loop()\n            loop.run_until_complete(main(loop))\n\n    # or again with a unittest.isolatedasynciotestcase\n    from mocket.async_mocket import async_mocketize\n\n    class aiohttpentrytestcase(isolatedasynciotestcase):\n        @async_mocketize\n        async def test_http_session(self):\n            url = 'http://httpbin.org/ip'\n            body = \"asd\" * 100\n            entry.single_register(entry.get, url, body=body, status=404)\n            entry.single_register(entry.post, url, body=body * 2, status=201)\n\n            async with aiohttp.clientsession(\n                timeout=aiohttp.clienttimeout(total=3)\n            ) as session:\n                async with session.get(url) as get_response:\n                    assert get_response.status == 404\n                    assert await get_response.text() == body\n\n                async with session.post(url, data=body * 6) as post_response:\n                    assert post_response.status == 201\n                    assert await post_response.text() == body * 2\n                    assert mocket.last_request().method == 'post'\n                    assert mocket.last_request().body == body * 6\n\n\nworks well with others\n=======================\nusing *mocket* as pook_ engine::\n\n    $ pip install mocket[pook]\n\n.. _pook: https://pypi.python.org/pypi/pook\n\nexample:\n\n.. code-block:: python\n\n    import pook\n    from mocket.plugins.pook_mock_engine import mocketengine\n\n    pook.set_mock_engine(mocketengine)\n\n    pook.on()\n\n    url = 'http://twitter.com/api/1/foobar'\n    status = 404\n    response_json = {'error': 'foo'}\n\n    mock = pook.get(\n        url,\n        headers={'content-type': 'application/json'},\n        reply=status,\n        response_json=response_json,\n    )\n    mock.persist()\n\n    requests.get(url)\n    assert mock.calls == 1\n\n    resp = requests.get(url)\n    assert resp.status_code == status\n    assert resp.json() == response_json\n    assert mock.calls == 2\n\nfirst appearance\n================\neuropython 2013, florence\n\n- video: https://www.youtube.com/watch?v=-lvxbl5d02u\n- slides: https://prezi.com/tmuiaugamsti/mocket/\n- slides as pdf: https://ep2013.europython.eu/media/conference/slides/mocket-a-socket-mock-framework.pdf\n",
  "docs_url": null,
  "keywords": "",
  "license": "copyright (c) 2017-2023 giorgio salluzzo and individual contributors. all rights reserved. copyright (c) 2013-2017 andrea de marco, giorgio salluzzo and individual contributors. all rights reserved.  redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:  1. redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.  2. redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.  3. neither the name of the mocket nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.  this software is provided by the copyright holders and contributors \"as is\" and any express or implied warranties, including, but not limited to, the implied warranties of merchantability and fitness for a particular purpose are disclaimed. in no event shall the copyright holder or contributors be liable for any direct, indirect, incidental, special, exemplary, or consequential damages (including, but not limited to, procurement of substitute goods or services; loss of use, data, or profits; or business interruption) however caused and on any theory of liability, whether in contract, strict liability, or tort (including negligence or otherwise) arising in any way out of the use of this software, even if advised of the possibility of such damage.",
  "name": "mocket",
  "package_url": "https://pypi.org/project/mocket/",
  "project_url": "https://pypi.org/project/mocket/",
  "project_urls": {
    "github": "https://github.com/mindflayer/python-mocket"
  },
  "release_url": "https://pypi.org/project/mocket/3.12.2/",
  "requires_dist": [
    "decorator>=4.0.0",
    "httptools",
    "python-magic>=0.4.5",
    "urllib3>=1.25.3",
    "pook>=0.2.1; extra == 'pook'",
    "xxhash-cffi; (platform_python_implementation == 'PyPy') and extra == 'speedups'",
    "xxhash; (platform_python_implementation == 'CPython') and extra == 'speedups'",
    "aiohttp; (python_version < '3.12') and extra == 'test'",
    "asgiref; extra == 'test'",
    "build; extra == 'test'",
    "fastapi; extra == 'test'",
    "flake8>5; extra == 'test'",
    "gevent; extra == 'test'",
    "httpx; extra == 'test'",
    "pipfile; extra == 'test'",
    "pook; extra == 'test'",
    "pre-commit; extra == 'test'",
    "pytest; extra == 'test'",
    "pytest-asyncio; extra == 'test'",
    "pytest-cov; extra == 'test'",
    "redis; extra == 'test'",
    "requests; extra == 'test'",
    "sure; extra == 'test'",
    "twine; extra == 'test'",
    "wait-for-it; extra == 'test'",
    "xxhash; extra == 'test'"
  ],
  "requires_python": ">=3.5",
  "summary": "socket mock framework - for all kinds of socket animals, web-clients included - with gevent/asyncio/ssl support",
  "version": "3.12.2",
  "releases": [],
  "developers": [
    "giorgio.salluzzo@gmail.com"
  ],
  "kwds": "mocket pook_mock_engine mock mockredis mocks",
  "license_kwds": "copyright redistributions redistribution disclaimer liable",
  "libtype": "pypi",
  "id": "pypi_mocket",
  "homepage": "",
  "release_count": 86,
  "dependency_ids": [
    "pypi_aiohttp",
    "pypi_asgiref",
    "pypi_build",
    "pypi_decorator",
    "pypi_fastapi",
    "pypi_flake8",
    "pypi_gevent",
    "pypi_httptools",
    "pypi_httpx",
    "pypi_pipfile",
    "pypi_pook",
    "pypi_pre_commit",
    "pypi_pytest",
    "pypi_pytest_asyncio",
    "pypi_pytest_cov",
    "pypi_python_magic",
    "pypi_redis",
    "pypi_requests",
    "pypi_sure",
    "pypi_twine",
    "pypi_urllib3",
    "pypi_wait_for_it",
    "pypi_xxhash",
    "pypi_xxhash_cffi"
  ]
}