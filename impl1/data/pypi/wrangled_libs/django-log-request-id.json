{
  "classifiers": [],
  "description": "django-log-request-id\n=====================\n\n**django middleware and log filter to attach a unique id to every log message generated as part of a request.**\n\n**author:** jamie matthews, [@j4mie](https://twitter.com/j4mie)\n\n[![build status](https://travis-ci.org/dabapps/django-log-request-id.png?branch=master)](https://travis-ci.org/dabapps/django-log-request-id)\n\nexample\n-------\n\n```\ndebug [33031a43fc244539895fef70c433337e] myproject.apps.myapp.views: doing something in a view\ndebug [33031a43fc244539895fef70c433337e] myproject.apps.myapp.forms: the form validated successfully!\ndebug [33031a43fc244539895fef70c433337e] myproject.apps.myapp.models: doing some model magic\ndebug [33031a43fc244539895fef70c433337e] myproject.apps.myapp.views: redirecting to form success page\n```\n\nwhy?\n----\n\nso you can grep (or otherwise search) a set of logs for a high-traffic application to isolate all messages associated with a single request.\n\nhow?\n----\n\n**the request id is stored in a thread local**. use of thread locals is not generally considered best practice for django applications, but seems to be the only viable approach in this case. pull requests with better ideas are welcome.\n\nany other neat features?\n------------------------\n\nin some cases, components further up the http stack such as load balancers or proxies may generate request ids. for example, [heroku's http-request-id feature](https://devcenter.heroku.com/articles/http-request-id) adds a header to the request called `x_request_id`. if such a header is present (and configured in your settings, see below), this id will be used (instead of generating one). you can configure your settings to use a generated id or return a default request_id when you expect the id in the request header but it is not available.\n\nthe id also gets added to the `httprequest` object that is handed to your views (as `request.id`), in case you need to use it in your application.\n\ninstallation and usage\n----------------------\n\nfirst, install the package: `pip install django-log-request-id`\n\nadd the middleware to your `middleware_classes` setting. it should be at the very top.\n\n```python\nmiddleware_classes = (\n    'log_request_id.middleware.requestidmiddleware',\n    # ... other middleware goes here\n)\n```\n\nadd the `log_request_id.filters.requestidfilter` to your `logging` setting. you'll also need to update your `formatters` to include a format with the new `request_id` variable, add a handler to output the messages (eg to the console), and finally attach the handler to your application's logger.\n\nif none of the above made sense, study [django's logging documentation](https://docs.djangoproject.com/en/dev/topics/logging/).\n\nan example `logging` setting is below:\n\n```python\nlogging = {\n    'version': 1,\n    'disable_existing_loggers': false,\n    'filters': {\n        'request_id': {\n            '()': 'log_request_id.filters.requestidfilter'\n        }\n    },\n    'formatters': {\n        'standard': {\n            'format': '%(levelname)-8s [%(asctime)s] [%(request_id)s] %(name)s: %(message)s'\n        },\n    },\n    'handlers': {\n        'console': {\n            'level': 'debug',\n            'class': 'logging.streamhandler',\n            'filters': ['request_id'],\n            'formatter': 'standard',\n        },\n    },\n    'loggers': {\n        'myapp': {\n            'handlers': ['console'],\n            'level': 'debug',\n            'propagate': false,\n        },\n    }\n}\n```\n\nyou can then output log messages as usual:\n\n```python\nimport logging\nlogger = logging.getlogger(__name__)\nlogger.debug(\"a wild log message appears!\")\n```\n\nif you wish to use an id provided in a request header, add the following setting:\n\n```python\nlog_request_id_header = \"http_x_request_id\"\n```\n\nsetting this value as above will enable requests having the header `x-request-id` to be logged with the header value supplied.\n\nnote that this value must conform to the format for [django meta keys](https://docs.djangoproject.com/en/2.1/ref/request-response/#django.http.httprequest.meta), otherwise it will be ignored.\n\nif you wish to fall back to a generated id when you have the `log_request_id_header` set but it was not provided in the request, add the following setting:\n\n```python\ngenerate_request_id_if_not_in_header = true\n```\n\nif you wish to include the request id in the response headers, add the following setting, where `response_header_name` is the name of the custom header you are going to use:\n\n```python\nrequest_id_response_header = \"response_header_name\"\n```\n\nif you wish to change the default `request_id` in the log output, the the following settings, where `none` (default) is the value you want to be the default value in case it's missing.\n\n```python\nno_request_id = \"none\"\n```\n\nlogging all requests\n--------------------\n\nthe `requestidmiddleware` also has the ability to log all requests received by the application, including some useful information such as the user id (if present). to enable this feature, add `log_requests = true` to your settings. the messages are sent to the `log_request_id.middleware` logger at `info` level.\n\nlogging other user attributes\n--------------------\n\nif you would like to log another user attribute instead of user id, this can be specified with the `log_user_attribute` setting. eg. to log the username, use: `log_user_attribute = \"username\"`. if this setting is set to `none`, no user attribute will be logged.\n\nlicense\n-------\n\ncopyright \u00a9 2012, dabapps.\n\nall rights reserved.\n\nredistribution and use in source and binary forms, with or without \nmodification, are permitted provided that the following conditions are met:\n\nredistributions of source code must retain the above copyright notice, this \nlist of conditions and the following disclaimer.\nredistributions in binary form must reproduce the above copyright notice, this \nlist of conditions and the following disclaimer in the documentation and/or \nother materials provided with the distribution.\nthis software is provided by the copyright holders and contributors \"as is\" and \nany express or implied warranties, including, but not limited to, the implied \nwarranties of merchantability and fitness for a particular purpose are \ndisclaimed. in no event shall the copyright holder or contributors be liable \nfor any direct, indirect, incidental, special, exemplary, or consequential \ndamages (including, but not limited to, procurement of substitute goods or \nservices; loss of use, data, or profits; or business interruption) however \ncaused and on any theory of liability, whether in contract, strict liability, \nor tort (including negligence or otherwise) arising in any way out of the use \nof this software, even if advised of the possibility of such damage.\n\n## code of conduct\n\nfor guidelines regarding the code of conduct when contributing to this repository please review [https://www.dabapps.com/open-source/code-of-conduct/](https://www.dabapps.com/open-source/code-of-conduct/)\n\n\n",
  "docs_url": null,
  "keywords": "",
  "license": "bsd",
  "name": "django-log-request-id",
  "package_url": "https://pypi.org/project/django-log-request-id/",
  "project_url": "https://pypi.org/project/django-log-request-id/",
  "project_urls": {
    "Homepage": "https://github.com/dabapps/django-log-request-id/"
  },
  "release_url": "https://pypi.org/project/django-log-request-id/2.1.0/",
  "requires_dist": [
    "django (>=1.8)"
  ],
  "requires_python": "",
  "summary": "django middleware and log filter to attach a unique id to every log message generated as part of a request",
  "version": "2.1.0",
  "releases": [],
  "developers": [
    "dabapps",
    "hello@dabapps.com"
  ],
  "kwds": "log_request_id log_request_id_header log_requests disable_existing_loggers request_id",
  "license_kwds": "bsd",
  "libtype": "pypi",
  "id": "pypi_django_log_request_id",
  "homepage": "https://github.com/dabapps/django-log-request-id/",
  "release_count": 16,
  "dependency_ids": [
    "pypi_django"
  ]
}