{
  "classifiers": [
    "development status :: 5 - production/stable",
    "intended audience :: developers",
    "license :: osi approved :: mit license",
    "operating system :: os independent",
    "programming language :: python",
    "programming language :: python :: 2",
    "programming language :: python :: 2.7",
    "programming language :: python :: 3",
    "programming language :: python :: 3.3",
    "programming language :: python :: 3.4",
    "programming language :: python :: 3.5",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9"
  ],
  "description": "# python-logging-rabbitmq\n\n[![build status](https://travis-ci.org/albertomr86/python-logging-rabbitmq.svg?branch=master)](https://travis-ci.org/albertomr86/python-logging-rabbitmq)\n\nlogging handler to ships logs to rabbitmq. compatible with django.\n\n## installation\ninstall using pip.\n\n```sh\npip install python_logging_rabbitmq\n```\n\n### versions\n\n| version      | dependency      |\n|--------------|-----------------|\n| &gt;= 2.x    |  pika == 0.13   |\n| <= 1.1.1     |  pika <= 0.10   |\n\n\n## handlers\nthis package has two built-in handlers that you can import as follows:\n\n```python\nfrom python_logging_rabbitmq import rabbitmqhandler\n```\n\nor (thanks to [@wallezhang](https://github.com/wallezhang))\n\n```python\nfrom python_logging_rabbitmq import rabbitmqhandleroneway\n```\n\n| handler               | description                                                                                                                                                                                                                                                                                  |\n|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| rabbitmqhandler       | basic handler for sending logs to rabbitmq. every record will be delivered directly to rabbitmq using the exchange configured.                                                                                                                                                               |\n| rabbitmqhandleroneway | high throughput handler. initializes an internal queue where logs are stored temporarily. a thread is used to deliver the logs to rabbitmq using the exchange configured. your app doesn't need to wait until the log is delivered. notice that if the main thread dies you might lose logs. |\n\n## standalone python\nto use with python first create a logger for your app, then create an instance of the handler and add it to the logger created.\n\n```python\nimport logging\nfrom python_logging_rabbitmq import rabbitmqhandler\n\nlogger = logging.getlogger('myapp')\nlogger.setlevel(logging.debug)\n\nrabbit = rabbitmqhandler(host='localhost', port=5672)\nlogger.addhandler(rabbit)\n\nlogger.debug('test debug')\n```\n\nas result, a similar message as follows will be sent to rabbitmq:\n\n```json\n{\n\t\"relativecreated\":280.61580657958984,\n\t\"process\":13105,\n\t\"args\":[],\n\t\"module\":\"test\",\n\t\"funcname\":\"<module>\",\n\t\"host\":\"albertomr86-laptop\",\n\t\"exc_text\":null,\n\t\"name\":\"myapp\",\n\t\"thread\":140032818181888,\n\t\"created\":1482290387.454017,\n\t\"threadname\":\"mainthread\",\n\t\"msecs\":454.01692390441895,\n\t\"filename\":\"test.py\",\n\t\"levelno\":10,\n\t\"processname\":\"mainprocess\",\n\t\"pathname\":\"test.py\",\n\t\"lineno\":11,\n\t\"msg\":\"test debug\",\n\t\"exc_info\":null,\n\t\"levelname\":\"debug\"\n}\n```\n\n## sending logs\nby default, logs will be sent to rabbitmq using the exchange **'log'**, this should be of **type topic**. the **routing key** used is formed by concatenating the *logger name* and the *log level*. for example:\n\n```python\nimport logging\nfrom python_logging_rabbitmq import rabbitmqhandler\n\nlogger = logging.getlogger('myapp')\nlogger.setlevel(logging.debug)\nlogger.addhandler(rabbitmqhandler(host='localhost', port=5672))\n\nlogger.info('test info')\nlogger.debug('test debug')\nlogger.warning('test warning')\n```\n\nthe messages will be sent using the following routing keys:\n- myapp.info\n- myapp.debug\n- myapp.warning\n\nfor an explanation about topics and routing keys go to https://www.rabbitmq.com/tutorials/tutorial-five-python.html\n\nwhen create the handler, you're able to specify different parameters in order to connect to rabbitmq or configure the handler behavior.\n\n## overriding routing-key creation\n\nif you wish to override routing-key format entirely, you can pass\n`routing_key_formatter` function which takes `logrecord` objects and returns\nrouting-key. for example:\n\n```python\nrabbitmqhandler(\n\thost='localhost',\n\tport=5672,\n\trouting_key_formatter=lambda r: (\n\t\t'some_exchange_prefix.{}'.format(r.levelname.lower())\n\t)\n)\n```\n\n## configuration\nthese are the configuration allowed:\n\n| parameter             | description                                                                                                                              | default                               |\n|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n| host                  | rabbitmq server hostname or ip address.                                                                                                  | localhost                             |\n| port                  | rabbitmq server port.                                                                                                                    | 5672                                  |\n| username              | username for authentication.                                                                                                             | none                                  |\n| password              | provide a password for the username.                                                                                                     | none                                  |\n| exchange              | name of the exchange to publish the logs. this exchange is considered of type topic.                                                     | log                                   |\n| declare_exchange      | whether or not to declare the exchange.                                                                                                  | false                                 |\n| remove_request        | if true (default), remove request & exc info.                                                                                            | true                                  |\n| routing_key_format    | customize how messages are routed to the queues.                                                                                         | {name}.{level}                        |\n| routing_key_formatter | customize how routing-key is constructed.                                                                                                | none                                  |\n| connection_params     | allow extra params to connect with rabbitmq.                                                                                             | none                                  |\n| formatter             | use custom formatter for the logs.                                                                                                       | python_logging_rabbitmq.jsonformatter |\n| close_after_emit      | close the active connection after send a log. a new connection is open for the next log.                                                 | false                                 |\n| fields                | dict to add as a field in each logs send to rabbitmq. this is useful when you want fields in each log but without pass them every time.  | none                                  |\n| fields_under_root     | when is true, each key in parameter 'fields' will be added as an entry in the log, otherwise they will be logged under the key 'fields'. | true                                  |\n| message_headers       | a dictionary of headers to be published with the message.                                                                                | none                                  |\n| record_fields         | a set of attributes that should be preserved from the record object.                                                                     | none                                  |\n| exclude_record_fields | a set of attributes that should be ignored from the record object.                                                                       | none                                  |\n| heartbeat             | lower bound for heartbeat timeout.                                                                                                       | 60                                    |\n| content_type          | the format of the message sent to the queue.                                                                                             | text/plain                            |\n\n\n### examples\n#### rabbitmq connection\n\n```python\nrabbit = rabbitmqhandler(\n\thost='localhost',\n\tport=5672,\n\tusername='guest',\n\tpassword='guest',\n\tconnection_params={\n\t\t'virtual_host': '/',\n\t\t'connection_attempts': 3,\n\t\t'socket_timeout': 5000\n\t}\n)\n```\n\n#### custom fields\n\n```python\nrabbit = rabbitmqhandler(\n\thost='localhost',\n\tport=5672,\n\tfields={\n\t\t'source': 'myapp',\n\t\t'env': 'production'\n\t},\n\tfields_under_root=true\n)\n```\n\n#### custom formatter\nby default, python_logging_rabbitmq implements a custom jsonformatter; but if you prefer to format your own message you could do it as follow:\n\n```python\nimport logging\nfrom python_logging_rabbitmq import rabbitmqhandler\n\nformat = '%(asctime)-15s %(message)s'\nformatter = logging.formatter(fmt=format)\nrabbit = rabbitmqhandler(formatter=formatter)\n```\n\nfor a custom json formatter take a look at https://github.com/madzak/python-json-logger\n\n## django\nto use with django add the handler in the [logging config](https://docs.djangoproject.com/en/1.9/topics/logging/#configuring-logging).\n\n```python\nlogging = {\n\t'version': 1,\n\t'disable_existing_loggers': false,\n\t'handlers': {\n\t\t'rabbit': {\n\t\t\t'level': 'debug',\n\t\t\t'class': 'python_logging_rabbitmq.rabbitmqhandler',\n\t\t\t'host': 'localhost'\n\t\t}\n\t},\n\t'loggers': {\n\t\t'myapp': {\n\t\t\t'handlers': ['rabbit'],\n\t\t\t'level': 'debug',\n\t\t\t'propagate': false\n\t\t}\n\t}\n}\n```\n\n## configuration\nsame as when use it with standalone python, you could configure the handle directly when declaring it in the config:\n\n```python\nlogging = {\n\t'version': 1,\n\t'disable_existing_loggers': false,\n\t'handlers': {\n\t\t'rabbit': {\n\t\t\t'level': 'debug',\n\t\t\t'class': 'python_logging_rabbitmq.rabbitmqhandler',\n\t\t\t'host': 'localhost',\n\t\t\t'port': 5672,\n\t\t\t'username': 'guest',\n\t\t\t'password': 'guest',\n\t\t\t'exchange': 'log',\n\t\t\t'declare_exchange': false,\n\t\t\t'connection_params': {\n\t\t\t\t'virtual_host': '/',\n\t\t\t\t'connection_attempts': 3,\n\t\t\t\t'socket_timeout': 5000\n\t\t\t},\n\t\t\t'fields': {\n\t\t\t\t'source': 'mainapi',\n\t\t\t\t'env': 'production'\n\t\t\t},\n\t\t\t'fields_under_root': true\n\t\t}\n\t},\n\t'loggers': {\n\t\t'myapp': {\n\t\t\t'handlers': ['rabbit'],\n\t\t\t'level': 'debug',\n\t\t\t'propagate': false\n\t\t}\n\t}\n}\n```\n\n#### custom formatter\n\n```python\nlogging = {\n\t'version': 1,\n\t'disable_existing_loggers': false,\n\t'formatters': {\n\t\t'standard': {\n\t\t\t'format': '%(levelname)-8s [%(asctime)s]: %(message)s'\n\t\t}\n\t},\n\t'handlers': {\n\t\t'rabbit': {\n\t\t\t'level': 'debug',\n\t\t\t'class': 'python_logging_rabbitmq.rabbitmqhandler',\n\t\t\t'host': 'localhost',\n\t\t\t'formatter': 'standard'\n\t\t}\n\t},\n\t'loggers': {\n\t\t'myapp': {\n\t\t\t'handlers': ['rabbit'],\n\t\t\t'level': 'debug',\n\t\t\t'propagate': false\n\t\t}\n\t}\n}\n```\n\n#### json formatter\n\n```sh\npip install python-json-logger\n```\n\n```python\nlogging = {\n\t'version': 1,\n\t'disable_existing_loggers': false,\n\t'formatters': {\n\t\t'json': {\n\t\t\t'()': 'pythonjsonlogger.jsonlogger.jsonformatter',\n\t\t\t'fmt': '%(name)s %(levelname) %(asctime)s %(message)s'\n\t\t}\n\t},\n\t'handlers': {\n\t\t'rabbit': {\n\t\t\t'level': 'debug',\n\t\t\t'class': 'python_logging_rabbitmq.rabbitmqhandler',\n\t\t\t'host': 'localhost',\n\t\t\t'formatter': 'json'\n\t\t}\n\t},\n\t'loggers': {\n\t\t'myapp': {\n\t\t\t'handlers': ['rabbit'],\n\t\t\t'level': 'debug',\n\t\t\t'propagate': false\n\t\t}\n\t}\n}\n```\n\n## releases\n\n[changelog](./changelog.md)\n\n## similar efforts\n- mqhandler (https://github.com/zixiong/mqhandler)\n- http://stackoverflow.com/a/25479008/2716524\n- logbook (http://pydoc.net/python/logbook/0.12.5/logbook.queues/)\n- https://pypi.python.org/pypi/py-amqp-logging/0.1\n",
  "docs_url": "https://pythonhosted.org/python-logging-rabbitmq/",
  "keywords": "logging rabbitmq logs",
  "license": "mit",
  "name": "python-logging-rabbitmq",
  "package_url": "https://pypi.org/project/python-logging-rabbitmq/",
  "project_url": "https://pypi.org/project/python-logging-rabbitmq/",
  "project_urls": {
    "Homepage": "https://github.com/albertomr86/python-logging-rabbitmq"
  },
  "release_url": "https://pypi.org/project/python-logging-rabbitmq/2.3.0/",
  "requires_dist": [
    "pika >=0.13",
    "check-manifest ; extra == 'dev'"
  ],
  "requires_python": ">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*",
  "summary": "send logs to rabbitmq from python/django",
  "version": "2.3.0",
  "releases": [],
  "developers": [
    "alberto_menendez_romero",
    "albertomr86@gmail.com"
  ],
  "kwds": "python_logging_rabbitmq rabbitmqhandler rabbitmq rabbitmqhandleroneway pythonjsonlogger",
  "license_kwds": "mit",
  "libtype": "pypi",
  "id": "pypi_python_logging_rabbitmq",
  "homepage": "https://github.com/albertomr86/python-logging-rabbitmq",
  "release_count": 16,
  "dependency_ids": [
    "pypi_check_manifest",
    "pypi_pika"
  ]
}