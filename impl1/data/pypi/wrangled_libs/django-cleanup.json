{
  "classifiers": [
    "development status :: 5 - production/stable",
    "environment :: web environment",
    "framework :: django",
    "framework :: django :: 3.2",
    "framework :: django :: 4.1",
    "framework :: django :: 4.2",
    "intended audience :: developers",
    "license :: osi approved :: mit license",
    "operating system :: os independent",
    "programming language :: python",
    "programming language :: python :: 3",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9",
    "programming language :: python :: implementation :: cpython",
    "programming language :: python :: implementation :: pypy",
    "topic :: utilities"
  ],
  "description": "django cleanup\n**************\n|version| |status| |license|\n\nfeatures\n========\nthe django-cleanup app automatically deletes files for :code:`filefield`, :code:`imagefield` and\nsubclasses. when a :code:`filefield`'s value is changed and the model is saved, the old file is\ndeleted. when a model that has a :code:`filefield` is deleted, the file is also deleted. a file that\nis set as the :code:`filefield`'s default value will not be deleted.\n\ncompatibility\n-------------\n- django 3.2, 4.1, 4.2 (`see django supported versions <https://www.djangoproject.com/download/#supported-versions>`_)\n- python 3.6+\n- compatible with `sorl-thumbnail <https://github.com/jazzband/sorl-thumbnail>`_\n- compatible with `easy-thumbnail <https://github.com/smileychris/easy-thumbnails>`_\n\nhow does it work?\n=================\nin order to track changes of a :code:`filefield` and facilitate file deletions, django-cleanup\nconnects :code:`post_init`, :code:`pre_save`, :code:`post_save` and :code:`post_delete` signals to\nsignal handlers for each :code:`installed_apps` model that has a :code:`filefield`. in order to tell\nwhether or not a :code:`filefield`'s value has changed a local cache of original values is kept on\nthe model instance. if a condition is detected that should result in a file deletion, a function to\ndelete the file is setup and inserted into the commit phase of the current transaction.\n\n**warning! please be aware of the known limitations documented below!**\n\ninstallation\n============\n::\n\n    pip install django-cleanup\n\n\nconfiguration\n=============\nadd ``django_cleanup`` to the bottom of ``installed_apps`` in ``settings.py``\n\n.. code-block:: py\n\n    installed_apps = (\n        ...,\n        'django_cleanup.apps.cleanupconfig',\n    )\n\nthat is all, no other configuration is necessary.\n\nnote: order of ``installed_apps`` is important. to ensure that exceptions inside other apps' signal\nhandlers do not affect the integrity of file deletions within transactions, ``django_cleanup``\nshould be placed last in ``installed_apps``.\n\ntroubleshooting\n===============\nif you notice that ``django-cleanup`` is not removing files when expected, check that your models\nare being properly\n`loaded <https://docs.djangoproject.com/en/stable/ref/applications/#how-applications-are-loaded>`_:\n\n    you must define or import all models in your application's models.py or models/__init__.py.\n    otherwise, the application registry may not be fully populated at this point, which could cause\n    the orm to malfunction.\n\nif your models are not loaded, ``django-cleanup`` will not be able to discover their\n``filefield``'s.\n\nyou can check if your ``model`` is loaded by using\n\n.. code-block:: py\n\n    from django.apps import apps\n    apps.get_models()\n\nknown limitations\n=================\n\ndatabase should support transactions\n------------------------------------\nif you are using a database that does not support transactions you may lose files if a\ntransaction will rollback at the right instance. this outcome is mitigated by our use of\npost_save and post_delete signals, and by following the recommended configuration in this readme.\nthis outcome will still occur if there are signals registered after app initialization and there are\nexceptions when those signals are handled. in this case, the old file will be lost and the new file\nwill not be referenced in a model, though the new file will likely still exist on disk. if you are\nconcerned about this behavior you will need another solution for old file deletion in your project.\n\nfile referenced by multiple model instances\n-------------------------------------------\nthis app is designed with the assumption that each file is referenced only once. if you are sharing\na file over two or more model instances you will not have the desired functionality. be cautious of\ncopying model instances, as this will cause a file to be shared by more than one instance. if you\nwant to reference a file from multiple models add a level of indirection. that is, use a separate\nfile model that is referenced from other models through a foreign key. there are many file\nmanagement apps already available in the django ecosystem that fulfill this behavior.\n\nadvanced\n========\nthis section contains additional functionality that can be used to interact with django-cleanup for\nspecial cases.\n\nsignals\n-------\nto facilitate interactions with other django apps django-cleanup sends the following signals which\ncan be imported from :code:`django_cleanup.signals`:\n\n- :code:`cleanup_pre_delete`: just before a file is deleted. passes a :code:`file` keyword argument.\n- :code:`cleanup_post_delete`: just after a file is deleted. passes a :code:`file` keyword argument.\n\nsignals example for sorl.thumbnail:\n\n.. code-block:: py\n\n    from django_cleanup.signals import cleanup_pre_delete\n    from sorl.thumbnail import delete\n\n    def sorl_delete(**kwargs):\n        delete(kwargs['file'])\n\n    cleanup_pre_delete.connect(sorl_delete)\n\nrefresh the cache\n-----------------\nthere have been rare cases where the cache would need to be refreshed. to do so the\n:code:`django_cleanup.cleanup.refresh` method can be used:\n\n.. code-block:: py\n\n    from django_cleanup import cleanup\n\n    cleanup.refresh(model_instance)\n\nignore cleanup for a specific model\n-----------------------------------\nto ignore a model and not have cleanup performed when the model is deleted or its files change, use\nthe :code:`ignore` decorator to mark that model:\n\n.. code-block:: py\n\n    from django_cleanup import cleanup\n\n    @cleanup.ignore\n    class mymodel(models.model):\n        image = models.filefield()\n\nonly cleanup selected models\n----------------------------\nif you have many models to ignore, or if you prefer to be explicit about what models are selected,\nyou can change the mode of django-cleanup to \"select mode\" by using the select mode app config. in\nyour ``installed_apps`` setting you will replace ':code:`django_cleanup.apps.cleanupconfig`'\nwith ':code:`django_cleanup.apps.cleanupselectedconfig`'. then use the :code:`select` decorator to\nmark a model for cleanup:\n\n.. code-block:: py\n\n    from django_cleanup import cleanup\n\n    @cleanup.select\n    class mymodel(models.model):\n        image = models.filefield()\n\nhow to run tests\n================\ninstall, setup and use pyenv_ to install all the required versions of cpython\n(see the `tox.ini <https://github.com/un1t/django-cleanup/blob/master/tox.ini>`_).\n\nsetup pyenv_ to have all versions of python activated within your local django-cleanup repository.\nensuring that the python 3.11 that was installed is first priority.\n\ninstall tox_ on python 3.11 and run the :code:`tox` command from your local django-cleanup\nrepository.\n\nhow to write tests\n==================\nthis app requires the use of django.test.transactiontestcase_ when writing tests.\n\nfor details on why this is required see `here\n<https://docs.djangoproject.com/en/stable/topics/db/transactions/#use-in-tests>`_:\n\n    django's :code:`testcase` class wraps each test in a transaction and rolls back that transaction\n    after each test, in order to provide test isolation. this means that no transaction is ever\n    actually committed, thus your :code:`on_commit()` callbacks will never be run. if you need to\n    test the results of an :code:`on_commit()` callback, use a :code:`transactiontestcase` instead.\n\nlicense\n=======\ndjango-cleanup is free software under terms of the:\n\nmit license\n\ncopyright (c) 2012 by ilya shalyapin, ishalyapin@gmail.com\n\npermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"software\"), to deal\nin the software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the software, and to permit persons to whom the software is\nfurnished to do so, subject to the following conditions:\n\nthe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the software.\n\nthe software is provided \"as is\", without warranty of any kind, express or\nimplied, including but not limited to the warranties of merchantability,\nfitness for a particular purpose and noninfringement. in no event shall the\nauthors or copyright holders be liable for any claim, damages or other\nliability, whether in an action of contract, tort or otherwise, arising from,\nout of or in connection with the software or the use or other dealings in the\nsoftware.\n\n\n.. _django.test.transactiontestcase: https://docs.djangoproject.com/en/stable/topics/testing/tools/#django.test.transactiontestcase\n.. _pyenv: https://github.com/pyenv/pyenv\n.. _tox: https://tox.readthedocs.io/en/latest/\n\n.. |version| image:: https://img.shields.io/pypi/v/django-cleanup.svg\n   :target: https://pypi.python.org/pypi/django-cleanup/\n   :alt: pypi package\n.. |status| image:: https://github.com/un1t/django-cleanup/actions/workflows/main.yml/badge.svg\n   :target: https://github.com/un1t/django-cleanup/actions/workflows/main.yml\n   :alt: build status\n.. |license| image:: https://img.shields.io/badge/license-mit-maroon\n   :target: https://github.com/un1t/django-cleanup/blob/master/license\n   :alt: mit license\n",
  "docs_url": null,
  "keywords": "django",
  "license": "mit license",
  "name": "django-cleanup",
  "package_url": "https://pypi.org/project/django-cleanup/",
  "project_url": "https://pypi.org/project/django-cleanup/",
  "project_urls": {
    "Download": "https://github.com/un1t/django-cleanup/tarball/master",
    "Homepage": "https://github.com/un1t/django-cleanup"
  },
  "release_url": "https://pypi.org/project/django-cleanup/8.0.0/",
  "requires_dist": [],
  "requires_python": "",
  "summary": "deletes old files.",
  "version": "8.0.0",
  "releases": [],
  "developers": [
    "ilya_shalyapin",
    "ishalyapin@gmail.com"
  ],
  "kwds": "django_cleanup cleanup_pre_delete filefield cleanup_post_delete _django",
  "license_kwds": "mit license",
  "libtype": "pypi",
  "id": "pypi_django_cleanup",
  "homepage": "https://github.com/un1t/django-cleanup",
  "release_count": 38,
  "dependency_ids": []
}