{
  "classifiers": [
    "development status :: 5 - production/stable",
    "intended audience :: developers",
    "license :: osi approved :: apache software license",
    "programming language :: python",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9"
  ],
  "description": "<p align=\"center\">\n    <a href=\"https://cloud.google.com/blog/topics/developers-practitioners/how-connect-cloud-sql-using-python-easy-way\">\n        <img src=\"https://raw.githubusercontent.com/googlecloudplatform/cloud-sql-python-connector/main/docs/images/cloud-sql-python-connector.png\" alt=\"cloud-sql-python-connector image\">\n    </a>\n</p>\n\n<h1 align=\"center\">cloud sql python connector</h1>\n\n[![open in colab][colab-badge]][colab-notebook]\n[![ci][ci-badge]][ci-build]\n[![pypi][pypi-badge]][pypi-docs]\n[![pypi download month][pypi-downloads]][pypi-docs]\n[![python][python-versions]][pypi-docs]\n\n[colab-badge]: https://colab.research.google.com/assets/colab-badge.svg\n[colab-notebook]: https://colab.research.google.com/github/googlecloudplatform/cloud-sql-python-connector/blob/main/samples/notebooks/postgres_python_connector.ipynb\n[ci-badge]: https://github.com/googlecloudplatform/cloud-sql-python-connector/actions/workflows/tests.yml/badge.svg?event=push\n[ci-build]: https://github.com/googlecloudplatform/cloud-sql-python-connector/actions/workflows/tests.yml?query=event%3apush+branch%3amain\n[pypi-badge]: https://img.shields.io/pypi/v/cloud-sql-python-connector\n[pypi-docs]: https://pypi.org/project/cloud-sql-python-connector\n[pypi-downloads]: https://img.shields.io/pypi/dm/cloud-sql-python-connector.svg\n[python-versions]: https://img.shields.io/pypi/pyversions/cloud-sql-python-connector\n\nthe _cloud sql python connector_ is a cloud sql connector designed for use with the\npython language. using a cloud sql connector provides a native alternative to the\n[cloud sql auth proxy](https://cloud.google.com/sql/docs/mysql/sql-proxy) while\nproviding the following benefits:\n\n* **iam authorization:** uses iam permissions to control who/what can connect to\n  your cloud sql instances\n* **improved security:** uses robust, updated tls 1.3 encryption and\n  identity verification between the client connector and the server-side proxy,\n  independent of the database protocol.\n* **convenience:** removes the requirement to use and distribute ssl\n  certificates, as well as manage firewalls or source/destination ip addresses.\n* (optionally) **iam db authentication:** provides support for\n  [cloud sql\u2019s automatic iam db authn][iam-db-authn] feature.\n\n[iam-db-authn]: https://cloud.google.com/sql/docs/postgres/authentication\n\nthe cloud sql python connector is a package to be used alongside a database driver.\ncurrently supported drivers are:\n - [`pymysql`](https://github.com/pymysql/pymysql) (mysql)\n - [`pg8000`](https://github.com/tlocke/pg8000) (postgresql)\n - [`asyncpg`](https://github.com/magicstack/asyncpg) (postgresql)\n - [`pytds`](https://github.com/denisenkom/pytds) (sql server)\n\n\n## installation\n\nyou can install this library with `pip install`, specifying the driver\nbased on your database dialect.\n\n### mysql\n```\npip install \"cloud-sql-python-connector[pymysql]\"\n```\n### postgres\nthere are two different database drivers that are supported for the postgres dialect:\n\n#### pg8000\n```\npip install \"cloud-sql-python-connector[pg8000]\"\n```\n#### asyncpg\n```\npip install \"cloud-sql-python-connector[asyncpg]\"\n```\n### sql server\n```\npip install \"cloud-sql-python-connector[pytds]\"\n```\n\n### apis and services\n\nthis package requires the following to successfully make cloud sql connections:\n\n- iam principal (user, service account, etc.) with the\n[cloud sql client][client-role] role. this iam principal will be used for\n[credentials](#credentials).\n- the [cloud sql admin api][admin-api] to be enabled within your google cloud\nproject. by default, the api will be called in the project associated with\nthe iam principal.\n\n[admin-api]: https://console.cloud.google.com/apis/api/sqladmin.googleapis.com\n[client-role]: https://cloud.google.com/sql/docs/mysql/roles-and-permissions\n\n### credentials\n\nthis library uses the [application default credentials (adc)][adc] strategy for\nresolving credentials. please see [these instructions for how to set your adc][set-adc]\n(google cloud application vs local development, iam user vs service account credentials),\nor consult the [google.auth][google-auth] package.\n\nto explicitly set a specific source for the credentials, see\n[configuring the connector](#configuring-the-connector) below.\n\n[adc]: https://cloud.google.com/docs/authentication#adc\n[set-adc]: https://cloud.google.com/docs/authentication/provide-credentials-adc\n[google-auth]: https://google-auth.readthedocs.io/en/master/reference/google.auth.html\n\n## usage\n\nthis package provides several functions for authorizing and encrypting\nconnections. these functions are used with your database driver to connect to\nyour cloud sql instance.\n\nthe instance connection name for your cloud sql instance is always in the\nformat \"project:region:instance\".\n\n### how to use this connector\n\nto connect to cloud sql using the connector, inititalize a `connector`\nobject and call it's `connect` method with the proper input parameters.\n\nthe `connector` itself creates connection objects by calling its `connect` method but does not manage database connection pooling. for this reason, it is recommended to use the connector alongside a library that can create connection pools, such as [sqlalchemy](https://www.sqlalchemy.org/). this will allow for connections to remain open and be reused, reducing connection overhead and the number of connections needed.\n\nin the connector's `connect` method below, input your connection string as the first positional argument and the name of the database driver for the second positional argument. insert the rest of your connection keyword arguments like user, password and database. you can also set the optional `timeout` or `ip_type` keyword arguments.\n\nto use this connector with sqlalchemy, use the `creator` argument for `sqlalchemy.create_engine`:\n\n```python\nfrom google.cloud.sql.connector import connector\nimport sqlalchemy\n\n# initialize connector object\nconnector = connector()\n\n# function to return the database connection\ndef getconn() -> pymysql.connections.connection:\n    conn: pymysql.connections.connection = connector.connect(\n        \"project:region:instance\",\n        \"pymysql\",\n        user=\"my-user\",\n        password=\"my-password\",\n        db=\"my-db-name\"\n    )\n    return conn\n\n# create connection pool\npool = sqlalchemy.create_engine(\n    \"mysql+pymysql://\",\n    creator=getconn,\n)\n```\n\nthe returned connection pool engine can then be used to query and modify the database.\n\n```python\n# insert statement\ninsert_stmt = sqlalchemy.text(\n    \"insert into my_table (id, title) values (:id, :title)\",\n)\n\nwith pool.connect() as db_conn:\n    # insert into database\n    db_conn.execute(insert_stmt, parameters={\"id\": \"book1\", \"title\": \"book one\"})\n\n    # query database\n    result = db_conn.execute(sqlalchemy.text(\"select * from my_table\")).fetchall()\n\n    # commit transaction (sqlalchemy v2.x.x is commit as you go)\n    db_conn.commit()\n\n    # do something with the results\n    for row in result:\n        print(row)\n```\n\nto close the `connector` object's background resources, call it's `close()` method as follows:\n\n```python\nconnector.close()\n```\n\n**note**: for more examples of using sqlalchemy to manage connection pooling with the connector, please see [cloud sql sqlalchemy samples](https://cloud.google.com/sql/docs/postgres/connect-connectors#python_1).\n\n**note for sql server users**: if your sql server instance requires ssl, you need to download the ca certificate for your instance and include `cafile={path to downloaded certificate}` and `validate_host=false`. this is a workaround for a [known issue](https://issuetracker.google.com/184867147).\n\n### configuring the connector\n\nif you need to customize something about the connector, or want to specify\ndefaults for each connection to make, you can initialize a\n`connector` object as follows:\n\n```python\nfrom google.cloud.sql.connector import connector, iptypes\n\n# note: all parameters below are optional\nconnector = connector(\n    ip_type=iptypes.public,\n    enable_iam_auth=false,\n    timeout=30,\n    credentials=custom_creds # google.auth.credentials.credentials\n)\n```\n\n### using connector as a context manager\n\nthe `connector` object can also be used as a context manager in order to\nautomatically close and cleanup resources, removing the need for explicit\ncalls to `connector.close()`.\n\nconnector as a context manager:\n\n```python\nfrom google.cloud.sql.connector import connector\nimport pymysql\nimport sqlalchemy\n\n# helper function to return sqlalchemy connection pool\ndef init_connection_pool(connector: connector) -> sqlalchemy.engine.engine:\n    # function used to generate database connection\n    def getconn() -> pymysql.connections.connection:\n        conn = connector.connect(\n            \"project:region:instance\",\n            \"pymysql\",\n            user=\"my-user\",\n            password=\"my-password\",\n            db=\"my-db-name\"\n        )\n        return conn\n\n    # create connection pool\n    pool = sqlalchemy.create_engine(\n        \"mysql+pymysql://\",\n        creator=getconn,\n    )\n    return pool\n\n# initialize cloud sql python connector as context manager\nwith connector() as connector:\n    # initialize connection pool\n    pool = init_connection_pool(connector)\n    # insert statement\n    insert_stmt = sqlalchemy.text(\n        \"insert into my_table (id, title) values (:id, :title)\",\n    )\n\n    # interact with cloud sql database using connection pool\n    with pool.connect() as db_conn:\n        # insert into database\n        db_conn.execute(insert_stmt, parameters={\"id\": \"book1\", \"title\": \"book one\"})\n\n        # commit transaction (sqlalchemy v2.x.x is commit as you go)\n        db_conn.commit()\n\n        # query database\n        result = db_conn.execute(sqlalchemy.text(\"select * from my_table\")).fetchall()\n\n        # do something with the results\n        for row in result:\n            print(row)\n```\n\n### specifying ip address type\n\nthe cloud sql python connector can be used to connect to cloud sql instances\nusing both public and private ip addresses, as well as\n[private service connect][psc] (psc). to specify which ip address type to connect\nwith, set the `ip_type` keyword argument when initializing a `connector()` or when\ncalling `connector.connect()`.\n\npossible values for `ip_type` are `iptypes.public` (default value),\n`iptypes.private`, and `iptypes.psc`.\n\nexample:\n\n```python\nfrom google.cloud.sql.connector import iptypes\n\nconn = connector.connect(\n    \"project:region:instance\",\n    \"pymysql\",\n    ip_type=iptypes.private # use private ip\n... insert other kwargs ...\n)\n```\n\nnote: if specifying private ip or private service connect, your application must be\nattached to the proper vpc network to connect to your cloud sql instance. for most\napplications this will require the use of a [vpc connector][vpc-connector].\n\n[psc]: https://cloud.google.com/vpc/docs/private-service-connect\n[vpc-connector]: https://cloud.google.com/vpc/docs/configure-serverless-vpc-access#create-connector\n\n### automatic iam database authentication\n\nconnections using [automatic iam database authentication](https://cloud.google.com/sql/docs/postgres/authentication#automatic) are supported when using postgres or mysql drivers.\nfirst, make sure to [configure your cloud sql instance to allow iam authentication](https://cloud.google.com/sql/docs/postgres/create-edit-iam-instances#configure-iam-db-instance)\nand [add an iam database user](https://cloud.google.com/sql/docs/postgres/create-manage-iam-users#creating-a-database-user).\n\nnow, you can connect using user or service account credentials instead of a password.\nin the call to connect, set the `enable_iam_auth` keyword argument to true and the `user` argument to the appropriately formatted iam principal.\n> postgres: for an iam user account, this is the user's email address. for a service account, it is the service account's email without the `.gserviceaccount.com` domain suffix.\n\n> mysql: for an iam user account, this is the user's email address, without the @ or domain name. for example, for `test-user@gmail.com`, set the `user` argument to `test-user`. for a service account, this is the service account's email address without the `@project-id.iam.gserviceaccount.com` suffix.\n\nexample:\n\n```python\nconn = connector.connect(\n     \"project:region:instance\",\n     \"pg8000\",\n     user=\"postgres-iam-user@gmail.com\",\n     db=\"my-db-name\",\n     enable_iam_auth=true,\n )\n```\n\n### sql server active directory authentication\n\nactive directory authentication for sql server instances is currently only supported on windows. first, make sure to follow [these steps](https://cloud.google.com/blog/topics/developers-practitioners/creating-sql-server-instance-integrated-active-directory-using-google-cloud-sql) to set up a managed ad domain and join your cloud sql instance to the domain. [see here for more info on cloud sql active directory integration](https://cloud.google.com/sql/docs/sqlserver/ad).\n\nonce you have followed the steps linked above, you can run the following code to return a connection object:\n\n```python\nconn = connector.connect(\n    \"project:region:instance\",\n    \"pytds\",\n    db=\"my-db-name\",\n    active_directory_auth=true,\n    server_name=\"public.[instance].[location].[project].cloudsql.[domain]\",\n)\n```\n\nor, if using private ip:\n\n```python\nconn = connector.connect(\n    \"project:region:instance\",\n    \"pytds\",\n    db=\"my-db-name\",\n    active_directory_auth=true,\n    server_name=\"private.[instance].[location].[project].cloudsql.[domain]\",\n    ip_type=iptypes.private\n)\n```\n\n### using the python connector with python web frameworks\n\nthe python connector can be used alongside popular python web frameworks such\nas flask, fastapi, etc, to integrate cloud sql databases within your\nweb applications.\n\n#### flask-sqlalchemy\n\n[flask-sqlalchemy](https://flask-sqlalchemy.palletsprojects.com/en/2.x/)\nis an extension for [flask](https://flask.palletsprojects.com/en/2.2.x/)\nthat adds support for [sqlalchemy](https://www.sqlalchemy.org/) to your\napplication. it aims to simplify using sqlalchemy with flask by providing\nuseful defaults and extra helpers that make it easier to accomplish\ncommon tasks.\n\nyou can configure flask-sqlalchemy to connect to a cloud sql database from\nyour web application through the following:\n\n```python\nfrom flask import flask\nfrom flask_sqlalchemy import sqlalchemy\nfrom google.cloud.sql.connector import connector, iptypes\n\n\n# initialize python connector object\nconnector = connector()\n\n# python connector database connection function\ndef getconn():\n    conn = connector.connect(\n        \"project:region:instance-name\", # cloud sql instance connection name\n        \"pg8000\",\n        user=\"my-user\",\n        password=\"my-password\",\n        db=\"my-database\",\n        ip_type= iptypes.public  # iptypes.private for private ip\n    )\n    return conn\n\n\napp = flask(__name__)\n\n# configure flask-sqlalchemy to use python connector\napp.config['sqlalchemy_database_uri'] = \"postgresql+pg8000://\"\napp.config['sqlalchemy_engine_options'] = {\n    \"creator\": getconn\n}\n\n# initialize the app with the extension\ndb = sqlalchemy()\ndb.init_app(app)\n```\n\nfor more details on how to use flask-sqlalchemy, check out the\n[flask-sqlalchemy quickstarts](https://flask-sqlalchemy.palletsprojects.com/en/3.0.x/quickstart/)\n\n#### fastapi\n\n[fastapi](https://fastapi.tiangolo.com/) is a modern, fast (high-performance),\nweb framework for building apis with python based on standard python type hints.\n\nyou can configure fastapi to connect to a cloud sql database from\nyour web application using [sqlalchemy orm](https://docs.sqlalchemy.org/en/14/orm/)\nthrough the following:\n\n```python\nfrom sqlalchemy import create_engine\nfrom sqlalchemy.engine import engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\nfrom google.cloud.sql.connector import connector, iptypes\n\n# helper function to return sqlalchemy connection pool\ndef init_connection_pool(connector: connector) -> engine:\n    # python connector database connection function\n    def getconn():\n        conn = connector.connect(\n            \"project:region:instance-name\", # cloud sql instance connection name\n            \"pg8000\",\n            user=\"my-user\",\n            password=\"my-password\",\n            db=\"my-database\",\n            ip_type= iptypes.public  # iptypes.private for private ip\n        )\n        return conn\n\n    sqlalchemy_database_url = \"postgresql+pg8000://\"\n\n    engine = create_engine(\n        sqlalchemy_database_url , creator=getconn\n    )\n    return engine\n\n# initialize cloud sql python connector\nconnector = connector()\n\n# create connection pool engine\nengine = init_connection_pool(connector)\n\n# create sqlalchemy orm session\nsessionlocal = sessionmaker(autocommit=false, autoflush=false, bind=engine)\n\nbase = declarative_base()\n```\n\nto learn more about integrating a database into your fastapi application,\nfollow along the [fastapi sql database guide](https://fastapi.tiangolo.com/tutorial/sql-databases/#create-the-database-models).\n\n### async driver usage\n\nthe cloud sql connector is compatible with\n[asyncio](https://docs.python.org/3/library/asyncio.html) to improve the speed\nand efficiency of database connections through concurrency. you can use all\nnon-asyncio drivers through the `connector.connect_async` function, in addition\nto the following asyncio database drivers:\n- [asyncpg](https://magicstack.github.io/asyncpg) (postgres)\n\nthe cloud sql connector has a helper `create_async_connector` function that is\nrecommended for asyncio database connections. it returns a `connector`\nobject that uses the current thread's running event loop. this is different\nthan `connector()` which by default initializes a new event loop in a\nbackground thread.\n\nthe `create_async_connector` allows all the same input arguments as the\n[connector](#configuring-the-connector) object.\n\nonce a `connector` object is returned by `create_async_connector` you can call\nits `connect_async` method, just as you would the `connect` method:\n\n```python\nimport asyncpg\n\nimport sqlalchemy\nfrom sqlalchemy.ext.asyncio import asyncengine, create_async_engine\n\nfrom google.cloud.sql.connector import connector, create_async_connector\n\nasync def init_connection_pool(connector: connector) -> asyncengine:\n    # initialize connector object for connections to cloud sql\n    async def getconn() -> asyncpg.connection:\n        conn: asyncpg.connection = await connector.connect_async(\n            \"project:region:instance\",  # cloud sql instance connection name\n            \"asyncpg\",\n            user=\"my-user\",\n            password=\"my-password\",\n            db=\"my-db-name\"\n            # ... additional database driver args\n        )\n        return conn\n\n    # the cloud sql python connector can be used along with sqlalchemy using the\n    # 'async_creator' argument to 'create_async_engine'\n    pool = create_async_engine(\n        \"postgresql+asyncpg://\",\n        async_creator=getconn,\n    )\n    return pool\n\nasync def main():\n    # initialize connector object for connections to cloud sql\n    connector = await create_async_connector()\n\n    # initialize connection pool\n    pool = await init_connection_pool(connector)\n\n    # example query\n    async with pool.connect() as conn:\n        await conn.execute(sqlalchemy.text(\"select now()\"))\n\n    # close connector\n    await connector.close_async()\n\n    # dispose of connection pool\n    await pool.dispose()\n```\n\nfor more details on additional database arguments with an `asyncpg.connection`\n, please visit the\n[official documentation](https://magicstack.github.io/asyncpg/current/api/index.html).\n\n### async context manager\n\nan alternative to using the `create_async_connector` function is initializing\na `connector` as an async context manager, removing the need for explicit\ncalls to `connector.close_async()` to cleanup resources.\n\n**note:** this alternative requires that the running event loop be\npassed in as the `loop` argument to `connector()`.\n\n```python\nimport asyncio\nimport asyncpg\n\nimport sqlalchemy\nfrom sqlalchemy.ext.asyncio import asyncengine, create_async_engine\n\nfrom google.cloud.sql.connector import connector\n\nasync def init_connection_pool(connector: connector) -> asyncengine:\n    # initialize connector object for connections to cloud sql\n    async def getconn() -> asyncpg.connection:\n            conn: asyncpg.connection = await connector.connect_async(\n                \"project:region:instance\",  # cloud sql instance connection name\n                \"asyncpg\",\n                user=\"my-user\",\n                password=\"my-password\",\n                db=\"my-db-name\"\n                # ... additional database driver args\n            )\n            return conn\n\n    # the cloud sql python connector can be used along with sqlalchemy using the\n    # 'async_creator' argument to 'create_async_engine'\n    pool = create_async_engine(\n        \"postgresql+asyncpg://\",\n        async_creator=getconn,\n    )\n    return pool\n\nasync def main():\n    # initialize connector object for connections to cloud sql\n    loop = asyncio.get_running_loop()\n    async with connector(loop=loop) as connector:\n        # initialize connection pool\n        pool = await init_connection_pool(connector)\n\n        # example query\n        async with pool.connect() as conn:\n            await conn.execute(sqlalchemy.text(\"select now()\"))\n\n        # dispose of connection pool\n        await pool.dispose()\n```\n\n## support policy\n\n### major version lifecycle\n\nthis project uses [semantic versioning](https://semver.org/), and uses the\nfollowing lifecycle regarding support for a major version:\n\n**active** - active versions get all new features and security fixes (that\nwouldn\u2019t otherwise introduce a breaking change). new major versions are\nguaranteed to be \"active\" for a minimum of 1 year.\n**deprecated** - deprecated versions continue to receive security and critical\nbug fixes, but do not receive new features. deprecated versions will be publicly\nsupported for 1 year.\n**unsupported** - any major version that has been deprecated for >=1 year is\nconsidered publicly unsupported.\n\n### supported python versions\n\nwe follow the [python version support policy][pyver] used by google cloud\nlibraries for python. changes in supported python versions will be\nconsidered a minor change, and will be listed in the release notes.\n\n[pyver]: https://cloud.google.com/python/docs/supported-python-versions\n\n### release cadence\nthis project aims for a minimum monthly release cadence. if no new\nfeatures or fixes have been added, a new patch version with the latest\ndependencies is released.\n\n### contributing\n\nwe welcome outside contributions. please see our\n[contributing guide](contributing.md) for details on how best to contribute.\n",
  "docs_url": null,
  "keywords": "",
  "license": "apache 2.0",
  "name": "cloud-sql-python-connector",
  "package_url": "https://pypi.org/project/cloud-sql-python-connector/",
  "project_url": "https://pypi.org/project/cloud-sql-python-connector/",
  "project_urls": {
    "Homepage": "https://github.com/GoogleCloudPlatform/cloud-sql-python-connector"
  },
  "release_url": "https://pypi.org/project/cloud-sql-python-connector/1.5.0/",
  "requires_dist": [
    "aiohttp",
    "cryptography (>=38.0.3)",
    "Requests",
    "google-auth",
    "asyncpg (>=0.29.0) ; extra == 'asyncpg'",
    "pg8000 (>=1.30.3) ; extra == 'pg8000'",
    "PyMySQL (>=1.1.0) ; extra == 'pymysql'",
    "python-tds (>=1.13.0) ; extra == 'pytds'"
  ],
  "requires_python": ">=3.8",
  "summary": "the cloud sql python connector is a library that can be used alongside a database driver to allow users with sufficient permissions to connect to a cloud sql database without having to manually allowlist ips or manage ssl certificates.",
  "version": "1.5.0",
  "releases": [],
  "developers": [
    "google_llc",
    "googleapis-packages@google.com"
  ],
  "kwds": "postgres_python_connector googlecloudplatform pypi _cloud cloudsql",
  "license_kwds": "apache 2.0",
  "libtype": "pypi",
  "id": "pypi_cloud_sql_python_connector",
  "homepage": "https://github.com/googlecloudplatform/cloud-sql-python-connector",
  "release_count": 34,
  "dependency_ids": [
    "pypi_aiohttp",
    "pypi_asyncpg",
    "pypi_cryptography",
    "pypi_google_auth",
    "pypi_pg8000",
    "pypi_pymysql",
    "pypi_python_tds",
    "pypi_requests"
  ]
}