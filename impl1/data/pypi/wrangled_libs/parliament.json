{
  "classifiers": [
    "development status :: 5 - production/stable",
    "license :: osi approved :: bsd license",
    "programming language :: python :: 3",
    "programming language :: python :: 3 :: only",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8"
  ],
  "description": "parliament is an aws iam linting library. it reviews policies looking for problems such as:\n- malformed json\n- missing required elements\n- incorrect prefix and action names\n- incorrect resources or conditions for the actions provided\n- type mismatches\n- bad policy patterns\n\nthis library duplicates (and adds to!) much of the functionality in the web console page when reviewing iam policies in the browser.  we wanted that functionality as a library.\n\n[demo](https://parliament.summitroute.com/)\n\n# installation\n```\npip install parliament\n```\n\n# usage\n```\ncat > test.json << eof\n{\n    \"version\": \"2012-10-17\",\n    \"statement\": {\n        \"effect\": \"allow\",\n        \"action\":[\"s3:getobject\"],\n        \"resource\": [\"arn:aws:s3:::bucket1\"]\n    }\n}\neof\n\nparliament --file test.json\n```\n\nthis will output:\n```\nmedium - no resources match for the given action -  - [{'action': 's3:getobject', 'required_format': 'arn:*:s3:::*/*'}] - {'actions': ['s3:getobject'], 'filepath': 'test.json'}\n```\n\nthis example is showing that the action s3:getobject requires a resource matching an object path (ie. it must have a \"/\" in it).\n\nthe different input types allowed include:\n- --file: filename\n- --directory: a directory path, for exmaple: `--directory . --include_policy_extension json --exclude_pattern \".*venv.*\"`\n- --aws-managed-policies: for use specifically with the repo https://github.com/z0ph/aws_managed_policies\n- --auth-details-file: for use with the file returned by \"aws iam get-account-authorization-details\"\n- --string: provide a string such as '{\"version\": \"2012-10-17\",\"statement\": {\"effect\": \"allow\",\"action\": [\"s3:getobject\", \"s3:putbucketpolicy\"],\"resource\": [\"arn:aws:s3:::bucket1\", \"arn:aws:s3:::bucket2/*\"]}}'\n\n## using parliament as a library\nparliament was meant to be used a library in other projects. a basic example follows.\n\n```\nfrom parliament import analyze_policy_string\n\nanalyzed_policy = analyze_policy_string(policy_doc)\nfor f in analyzed_policy.findings:\n  print(f)\n```\n\n## custom config file\nyou may decide you want to change the severity of a finding, the text associated with it, or that you want to ignore certain types of findings.  to support this, you can provide an override config file.  first, create a test.json file:\n\n```\n{\n    \"version\": \"2012-10-17\",\n    \"id\": \"123\",\n    \"statement\": [\n      {\n        \"effect\": \"allow\",\n        \"action\": \"s3:abc\",\n        \"resource\": \"*\"\n      },\n      {\n        \"effect\": \"allow\",\n        \"action\": [\"s3:*\", \"ec2:*\"],\n        \"resource\": \"arn:aws:s3:::test/*\"\n      }\n    ]\n }\n```\n\nthis will have two findings:\n- low - unknown action -  - unknown action s3:abc\n- medium - no resources match for the given action\n\nthe second finding will be very long, because every s3 and ec2 action are expanded and most are incorrect for the s3 object path resource that is provided.\n\nnow create a file `config_override.yaml` with the following contents:\n\n```\nunknown_action:\n  severity: medium\n  ignore_locations:\n  - filepath:\n    - testa.json\n    - .*.py\n\nresource_mismatch:\n  ignore_locations:\n  - actions: \".*s3.*\"\n```\n\nnow run: `parliament --file test.json --config config_override.yaml`\nyou will have only one output: `medium - unknown action -  - unknown action s3:abc`\n\nnotice that the severity of that finding has been changed from a `low` to a `medium`.  also, note that the other finding is gone, because the previous `resource_mismatch` finding contained an `actions` element of `[\"s3:*\", \"ec2:*\"]`.  the ignore logic converts the value you provide, and the finding value to lowercase,\nand then uses your string as a regex.  this means that we are checking if `s3` is in `str([\"s3:*\", \"ec2:*\"])`\n\nnow rename `test.json` to `testa.json` and rerun the command.  you will no longer have any output, because we are filtering based on the filepath for `unknown_action` and filtering for any filepaths that contain `testa.json` or `.py`.\n\nyou can also check the exit status with `echo $?` and see the exit status is 0 when there are no findings. the exit status will be non-zero when there are findings.\n\nyou can have multiple elements in `ignore_locations`.  for example,\n```\n- filepath: \"test.json\"\n  action: \"s3:getobject\"\n  resource: \n  - \"a\"\n  - \"b\"\n- resource: \"c.*\"\n```\n\nassuming the finding has these types of values in the `location` element, this will ignore any finding that matches the filepath to \"test.json\" and action to \"s3:getobject\" and the resource to \"a\" or \"b\".  it will also ignore a resource that matches \"c.*\".\n\n# custom auditors\n\n## private auditors\nthis section will show how to create your own private auditor to look for any policies that grant access to either of the sensitive buckets `secretbucket` and `othersecretbucket`.\n\ncreate a file `test.json` with contents:\n```\n{\n    \"version\": \"2012-10-17\",\n    \"statement\": {\n        \"effect\": \"allow\",\n        \"action\": \"s3:getobject\",\n        \"resource\": \"arn:aws:s3:::secretbucket/*\"\n    }\n}\n```\nthis is an example of the policy we want to alert on. that policy will normally not generate any findings.\n\ncreate the file `config_override.yaml` with contents:\n\n```\nsensitive_bucket_access:\n  title: sensitive bucket access\n  description: allows read access to an important s3 bucket\n  severity: medium\n  group: custom\n```\n\nin the `parliament` directory (that contains iam_definition.json), create the directory `private_auditors` and the file `parliament/private_auditors/sensitive_bucket_access.py`\n\n\n```\nfrom parliament import is_arn_match, expand_action\n\ndef audit(policy):\n    action_resources = {}\n    for action in expand_action(\"s3:*\"):\n        # iterates through a list of containing elements such as\n        # {'service': 's3', 'action': 'getobject'}\n        action_name = \"{}:{}\".format(action[\"service\"], action[\"action\"])\n        action_resources[action_name] = policy.get_allowed_resources(action[\"service\"], action[\"action\"])\n    \n    for action_name in action_resources:\n        resources = action_resources[action_name]\n        for r in resources:\n            if is_arn_match(\"object\", \"arn:aws:s3:::secretbucket*\", r) or is_arn_match(\"object\", \"arn:aws:s3:::othersecretbucket*\", r):\n                policy.add_finding(\"sensitive_bucket_access\", location={\"action\": action_name, \"resource\": r})\n```\n\nthis will look for any s3 access to the buckets of interest, including not only object access such as `s3:getobject` access, but also things like `s3:putbucketacl`.\n\nrunning against our test file, we'll get the following output:\n```\n./bin/parliament --file test.json --config config_override.yaml --json\n\n{\"issue\": \"sensitive_bucket_access\", \"title\": \"sensitive bucket access\", \"severity\": \"medium\", \"description\": \"allows read access to an important s3 bucket\", \"detail\": \"\", \"location\": {\"action\": \"s3:getobject\", \"resource\": \"arn:aws:s3:::secretbucket/*\", \"filepath\": \"test.json\"}}\n```\n\nyou can now decide if this specific situation is ok for you, and choose to ignore it by modifying the\n`config_override.yaml` to include:\n\n```\nignore_locations:\n  - filepath: \"test.json\"\n    action: \"s3:getobject\"\n    resource: \"arn:aws:s3:::secretbucket/\\\\*\"\n```\n\nnotice that i had to double-escape the escape asterisk.  if another policy is created, say in test2.json that you'd like to ignore, you can just append those values to the list:\n\n```\nignore_locations:\n  - filepath: \"test.json\"\n    action: \"s3:getobject\"\n    resource: \"arn:aws:s3:::secretbucket/\\\\*\"\n  - filepath: \"test2.json\"\n    action: \"s3:getobject\"\n    resource: \"arn:aws:s3:::secretbucket/\\\\*\"\n```\n\nor you could do:\n\n```\nignore_locations:\n  - filepath:\n    - \"test.json\"\n    - \"test2.json\"\n    action: \"s3:getobject\"\n    resource: \"arn:aws:s3:::secretbucket/\\\\*\"\n```\n\n## unit tests for private auditors\n\nto create unit tests for our new private auditor, create the directory `./parliament/private_auditors/tests/` and create the file `test_sensitive_bucket_access.py` there with the contents:\n\n```\nfrom parliament import analyze_policy_string\n\nclass testcustom():\n    \"\"\"test class for custom auditor\"\"\"\n\n    def test_my_auditor(self):\n        policy = analyze_policy_string(\n            \"\"\"{\n    \"version\": \"2012-10-17\",\n    \"statement\": {\n        \"effect\": \"allow\",\n        \"action\": \"s3:getobject\",\n        \"resource\": \"arn:aws:s3:::secretbucket/*\"}}\"\"\",\n        )\n        assert_equal(len(policy.findings), 1)\n```\n\nthat test ensures that for the given policy (which is granting read access to our secret bucket) one finding will be created.\n\nnow when you run `./tests/scripts/unit_tests.sh` there should be one additional test run.\n\n\n## community auditors\n\n* the process for community auditors is the same as private auditors, except that:\n - the community auditors are located in the `parliament/community_auditors` folder instead of the `parliament/private_auditors`\n - the community auditors are bundled with the package and users can include them in their testing by specifying `--include-community-auditors` flag.\n\n# development\nsetup a testing environment\n```\npython3 -m venv ./venv && source venv/bin/activate\npip3 install -r requirements.txt\n```\n\nrun unit tests with:\n```\nmake test\n```\n\nrun locally as:\n```\nbin/parliament\n```\n\n## updating the privilege info\nthe iam data is obtained from scraping the docs [here](https://docs.aws.amazon.com/iam/latest/userguide/reference_policies_actions-resources-contextkeys.html) and parsing this information with beautifulsoup using `./utils/update_iam_data.py`.\n\n# projects that use parliament\n- [cloudmapper](https://github.com/duo-labs/cloudmapper): has functionality to audit aws environments and will audit the iam policies as part of that.\n- [tf-parliament](https://github.com/rdkls/tf-parliament): runs parliament against terraform files\n- [iam-lint](https://github.com/xen0l/iam-lint): github action for linting aws iam policy documents \n- [paco](https://paco-cloud.io): cloud orchestration tool that integrates parliament as a library to verify a project's iam policies and warns about findings.\n- [consoleme](https://github.com/netflix/consoleme): web service that makes administering and using multiple aws accounts easier, that uses parliament for linting iam policies\n- [iamlive](https://github.com/iann0036/iamlive): generates iam policies from observing aws calls through client-side monitoring\n",
  "docs_url": null,
  "keywords": "aws parliament iam lint audit",
  "license": "bsd 3",
  "name": "parliament",
  "package_url": "https://pypi.org/project/parliament/",
  "project_url": "https://pypi.org/project/parliament/",
  "project_urls": {
    "Homepage": "https://github.com/duo-labs/parliament"
  },
  "release_url": "https://pypi.org/project/parliament/1.6.2/",
  "requires_dist": [
    "boto3",
    "jmespath",
    "pyyaml",
    "json-cfg",
    "coverage ; extra == 'dev'",
    "nose ; extra == 'dev'",
    "autoflake ; extra == 'dev'",
    "autopep8 ; extra == 'dev'",
    "pylint ; extra == 'dev'"
  ],
  "requires_python": ">=3.6",
  "summary": "parliament audits your aws iam policies",
  "version": "1.6.2",
  "releases": [],
  "developers": [
    "duo_security",
    "scott@summitroute.com"
  ],
  "kwds": "aws_managed_policies analyzed_policy test_sensitive_bucket_access reference_policies_actions analyze_policy_string",
  "license_kwds": "bsd 3",
  "libtype": "pypi",
  "id": "pypi_parliament",
  "homepage": "https://github.com/duo-labs/parliament",
  "release_count": 48,
  "dependency_ids": [
    "pypi_autoflake",
    "pypi_autopep8",
    "pypi_boto3",
    "pypi_coverage",
    "pypi_jmespath",
    "pypi_json_cfg",
    "pypi_nose",
    "pypi_pylint",
    "pypi_pyyaml"
  ]
}