{
  "classifiers": [
    "development status :: 7 - inactive",
    "framework :: aws cdk",
    "framework :: aws cdk :: 1",
    "intended audience :: developers",
    "license :: osi approved",
    "operating system :: os independent",
    "programming language :: javascript",
    "programming language :: python :: 3 :: only",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9",
    "typing :: typed"
  ],
  "description": "# amazon cloudfront construct library\n\n<!--begin stability banner-->---\n\n\n![end-of-support](https://img.shields.io/badge/end--of--support-critical.svg?style=for-the-badge)\n\n> aws cdk v1 has reached end-of-support on 2023-06-01.\n> this package is no longer being updated, and users should migrate to aws cdk v2.\n>\n> for more information on how to migrate, see the [*migrating to aws cdk v2* guide](https://docs.aws.amazon.com/cdk/v2/guide/migrating-v2.html).\n\n---\n<!--end stability banner-->\n\namazon cloudfront is a web service that speeds up distribution of your static and dynamic web content, such as .html, .css, .js, and image files, to\nyour users. cloudfront delivers your content through a worldwide network of data centers called edge locations. when a user requests content that\nyou're serving with cloudfront, the user is routed to the edge location that provides the lowest latency, so that content is delivered with the best\npossible performance.\n\n## distribution api\n\nthe `distribution` api is currently being built to replace the existing `cloudfrontwebdistribution` api. the `distribution` api is optimized for the\nmost common use cases of cloudfront distributions (e.g., single origin and behavior, few customizations) while still providing the ability for more\nadvanced use cases. the api focuses on simplicity for the common use cases, and convenience methods for creating the behaviors and origins necessary\nfor more complex use cases.\n\n### creating a distribution\n\ncloudfront distributions deliver your content from one or more origins; an origin is the location where you store the original version of your\ncontent. origins can be created from s3 buckets or a custom origin (http server). constructs to define origins are in the `@aws-cdk/aws-cloudfront-origins` module.\n\neach distribution has a default behavior which applies to all requests to that distribution, and routes requests to a primary origin.\nadditional behaviors may be specified for an origin with a given url path pattern. behaviors allow routing with multiple origins,\ncontrolling which http methods to support, whether to require users to use https, and what query strings or cookies to forward to your origin,\namong other settings.\n\n#### from an s3 bucket\n\nan s3 bucket can be added as an origin. if the bucket is configured as a website endpoint, the distribution can use s3 redirects and s3 custom error\ndocuments.\n\n```python\n# creates a distribution from an s3 bucket.\nmy_bucket = s3.bucket(self, \"mybucket\")\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.s3origin(my_bucket))\n)\n```\n\nthe above will treat the bucket differently based on if `ibucket.iswebsite` is set or not. if the bucket is configured as a website, the bucket is\ntreated as an http origin, and the built-in s3 redirects and error pages can be used. otherwise, the bucket is handled as a bucket origin and\ncloudfront's redirect and error handling will be used. in the latter case, the origin will create an origin access identity and grant it access to the\nunderlying bucket. this can be used in conjunction with a bucket that is not public to require that your users access your content using cloudfront\nurls and not s3 urls directly.\n\n#### elbv2 load balancer\n\nan elastic load balancing (elb) v2 load balancer may be used as an origin. in order for a load balancer to serve as an origin, it must be publicly\naccessible (`internetfacing` is true). both application and network load balancers are supported.\n\n```python\n# creates a distribution from an elbv2 load balancer\n# vpc: ec2.vpc\n\n# create an application load balancer in a vpc. 'internetfacing' must be 'true'\n# for cloudfront to access the load balancer and use it as an origin.\nlb = elbv2.applicationloadbalancer(self, \"lb\",\n    vpc=vpc,\n    internet_facing=true\n)\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.loadbalancerv2origin(lb))\n)\n```\n\n#### from an http endpoint\n\norigins can also be created from any other http endpoint, given the domain name, and optionally, other origin properties.\n\n```python\n# creates a distribution from an http endpoint\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.httporigin(\"www.example.com\"))\n)\n```\n\n### domain names and certificates\n\nwhen you create a distribution, cloudfront assigns a domain name for the distribution, for example: `d111111abcdef8.cloudfront.net`; this value can\nbe retrieved from `distribution.distributiondomainname`. cloudfront distributions use a default certificate (`*.cloudfront.net`) to support https by\ndefault. if you want to use your own domain name, such as `www.example.com`, you must associate a certificate with your distribution that contains\nyour domain name, and provide one (or more) domain names from the certificate for the distribution.\n\nthe certificate must be present in the aws certificate manager (acm) service in the us east (n. virginia) region; the certificate\nmay either be created by acm, or created elsewhere and imported into acm. when a certificate is used, the distribution will support https connections\nfrom sni only and a minimum protocol version of tlsv1.2_2021 if the `@aws-cdk/aws-cloudfront:defaultsecuritypolicytlsv1.2_2021` feature flag is set, and tlsv1.2_2019 otherwise.\n\n```python\n# to use your own domain name in a distribution, you must associate a certificate\nimport aws_cdk.aws_certificatemanager as acm\nimport aws_cdk.aws_route53 as route53\n\n# hosted_zone: route53.hostedzone\n\n# my_bucket: s3.bucket\n\nmy_certificate = acm.dnsvalidatedcertificate(self, \"mysitecert\",\n    domain_name=\"www.example.com\",\n    hosted_zone=hosted_zone\n)\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.s3origin(my_bucket)),\n    domain_names=[\"www.example.com\"],\n    certificate=my_certificate\n)\n```\n\nhowever, you can customize the minimum protocol version for the certificate while creating the distribution using `minimumprotocolversion` property.\n\n```python\n# create a distribution with a custom domain name and a minimum protocol version.\n# my_bucket: s3.bucket\n\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.s3origin(my_bucket)),\n    domain_names=[\"www.example.com\"],\n    minimum_protocol_version=cloudfront.securitypolicyprotocol.tls_v1_2016,\n    ssl_support_method=cloudfront.sslmethod.sni\n)\n```\n\n### multiple behaviors & origins\n\neach distribution has a default behavior which applies to all requests to that distribution; additional behaviors may be specified for a\ngiven url path pattern. behaviors allow routing with multiple origins, controlling which http methods to support, whether to require users to\nuse https, and what query strings or cookies to forward to your origin, among others.\n\nthe properties of the default behavior can be adjusted as part of the distribution creation. the following example shows configuring the http\nmethods and viewer protocol policy of the cache.\n\n```python\n# create a distribution with configured http methods and viewer protocol policy of the cache.\n# my_bucket: s3.bucket\n\nmy_web_distribution = cloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(my_bucket),\n        allowed_methods=cloudfront.allowedmethods.allow_all,\n        viewer_protocol_policy=cloudfront.viewerprotocolpolicy.redirect_to_https\n    )\n)\n```\n\nadditional behaviors can be specified at creation, or added after the initial creation. each additional behavior is associated with an origin,\nand enable customization for a specific set of resources based on a url path pattern. for example, we can add a behavior to `mywebdistribution` to\noverride the default viewer protocol policy for all of the images.\n\n```python\n# add a behavior to a distribution after initial creation.\n# my_bucket: s3.bucket\n# my_web_distribution: cloudfront.distribution\n\nmy_web_distribution.add_behavior(\"/images/*.jpg\", origins.s3origin(my_bucket),\n    viewer_protocol_policy=cloudfront.viewerprotocolpolicy.redirect_to_https\n)\n```\n\nthese behaviors can also be specified at distribution creation time.\n\n```python\n# create a distribution with additional behaviors at creation time.\n# my_bucket: s3.bucket\n\nbucket_origin = origins.s3origin(my_bucket)\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        allowed_methods=cloudfront.allowedmethods.allow_all,\n        viewer_protocol_policy=cloudfront.viewerprotocolpolicy.redirect_to_https\n    ),\n    additional_behaviors={\n        \"/images/*.jpg\": cloudfront.behavioroptions(\n            origin=bucket_origin,\n            viewer_protocol_policy=cloudfront.viewerprotocolpolicy.redirect_to_https\n        )\n    }\n)\n```\n\n### customizing cache keys and ttls with cache policies\n\nyou can use a cache policy to improve your cache hit ratio by controlling the values (url query strings, http headers, and cookies)\nthat are included in the cache key, and/or adjusting how long items remain in the cache via the time-to-live (ttl) settings.\ncloudfront provides some predefined cache policies, known as managed policies, for common use cases. you can use these managed policies,\nor you can create your own cache policy that\u2019s specific to your needs.\nsee https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/controlling-the-cache-key.html for more details.\n\n```python\n# using an existing cache policy for a distribution\n# bucket_origin: origins.s3origin\n\ncloudfront.distribution(self, \"mydistmanagedpolicy\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        cache_policy=cloudfront.cachepolicy.caching_optimized\n    )\n)\n```\n\n```python\n# creating a custom cache policy for a distribution -- all parameters optional\n# bucket_origin: origins.s3origin\n\nmy_cache_policy = cloudfront.cachepolicy(self, \"mycachepolicy\",\n    cache_policy_name=\"mypolicy\",\n    comment=\"a default policy\",\n    default_ttl=duration.days(2),\n    min_ttl=duration.minutes(1),\n    max_ttl=duration.days(10),\n    cookie_behavior=cloudfront.cachecookiebehavior.all(),\n    header_behavior=cloudfront.cacheheaderbehavior.allow_list(\"x-customheader\"),\n    query_string_behavior=cloudfront.cachequerystringbehavior.deny_list(\"username\"),\n    enable_accept_encoding_gzip=true,\n    enable_accept_encoding_brotli=true\n)\ncloudfront.distribution(self, \"mydistcustompolicy\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        cache_policy=my_cache_policy\n    )\n)\n```\n\n### customizing origin requests with origin request policies\n\nwhen cloudfront makes a request to an origin, the url path, request body (if present), and a few standard headers are included.\nother information from the viewer request, such as url query strings, http headers, and cookies, is not included in the origin request by default.\nyou can use an origin request policy to control the information that\u2019s included in an origin request.\ncloudfront provides some predefined origin request policies, known as managed policies, for common use cases. you can use these managed policies,\nor you can create your own origin request policy that\u2019s specific to your needs.\nsee https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/controlling-origin-requests.html for more details.\n\n```python\n# using an existing origin request policy for a distribution\n# bucket_origin: origins.s3origin\n\ncloudfront.distribution(self, \"mydistmanagedpolicy\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        origin_request_policy=cloudfront.originrequestpolicy.cors_s3_origin\n    )\n)\n```\n\n```python\n# creating a custom origin request policy for a distribution -- all parameters optional\n# bucket_origin: origins.s3origin\n\nmy_origin_request_policy = cloudfront.originrequestpolicy(self, \"originrequestpolicy\",\n    origin_request_policy_name=\"mypolicy\",\n    comment=\"a default policy\",\n    cookie_behavior=cloudfront.originrequestcookiebehavior.none(),\n    header_behavior=cloudfront.originrequestheaderbehavior.all(\"cloudfront-is-android-viewer\"),\n    query_string_behavior=cloudfront.originrequestquerystringbehavior.allow_list(\"username\")\n)\n\ncloudfront.distribution(self, \"mydistcustompolicy\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        origin_request_policy=my_origin_request_policy\n    )\n)\n```\n\n### customizing response headers with response headers policies\n\nyou can configure cloudfront to add one or more http headers to the responses that it sends to viewers (web browsers or other clients), without making any changes to the origin or writing any code.\nto specify the headers that cloudfront adds to http responses, you use a response headers policy. cloudfront adds the headers regardless of whether it serves the object from the cache or has to retrieve the object from the origin. if the origin response includes one or more of the headers that\u2019s in a response headers policy, the policy can specify whether cloudfront uses the header it received from the origin or overwrites it with the one in the policy.\nsee https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/adding-response-headers.html\n\n```python\n# using an existing managed response headers policy\n# bucket_origin: origins.s3origin\n\ncloudfront.distribution(self, \"mydistmanagedpolicy\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        response_headers_policy=cloudfront.responseheaderspolicy.cors_allow_all_origins\n    )\n)\n\n# creating a custom response headers policy -- all parameters optional\nmy_response_headers_policy = cloudfront.responseheaderspolicy(self, \"responseheaderspolicy\",\n    response_headers_policy_name=\"mypolicy\",\n    comment=\"a default policy\",\n    cors_behavior=cloudfront.responseheaderscorsbehavior(\n        access_control_allow_credentials=false,\n        access_control_allow_headers=[\"x-custom-header-1\", \"x-custom-header-2\"],\n        access_control_allow_methods=[\"get\", \"post\"],\n        access_control_allow_origins=[\"*\"],\n        access_control_expose_headers=[\"x-custom-header-1\", \"x-custom-header-2\"],\n        access_control_max_age=duration.seconds(600),\n        origin_override=true\n    ),\n    custom_headers_behavior=cloudfront.responsecustomheadersbehavior(\n        custom_headers=[cloudfront.responsecustomheader(header=\"x-amz-date\", value=\"some-value\", override=true), cloudfront.responsecustomheader(header=\"x-amz-security-token\", value=\"some-value\", override=false)\n        ]\n    ),\n    security_headers_behavior=cloudfront.responsesecurityheadersbehavior(\n        content_security_policy=cloudfront.responseheaderscontentsecuritypolicy(content_security_policy=\"default-src https:;\", override=true),\n        content_type_options=cloudfront.responseheaderscontenttypeoptions(override=true),\n        frame_options=cloudfront.responseheadersframeoptions(frame_option=cloudfront.headersframeoption.deny, override=true),\n        referrer_policy=cloudfront.responseheadersreferrerpolicy(referrer_policy=cloudfront.headersreferrerpolicy.no_referrer, override=true),\n        strict_transport_security=cloudfront.responseheadersstricttransportsecurity(access_control_max_age=duration.seconds(600), include_subdomains=true, override=true),\n        xss_protection=cloudfront.responseheadersxssprotection(protection=true, mode_block=true, report_uri=\"https://example.com/csp-report\", override=true)\n    )\n)\ncloudfront.distribution(self, \"mydistcustompolicy\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=bucket_origin,\n        response_headers_policy=my_response_headers_policy\n    )\n)\n```\n\n### validating signed urls or signed cookies with trusted key groups\n\ncloudfront distribution supports validating signed urls or signed cookies using key groups.\nwhen a cache behavior contains trusted key groups, cloudfront requires signed urls or signed\ncookies for all requests that match the cache behavior.\n\n```python\n# validating signed urls or signed cookies with trusted key groups\n\n# public key in pem format\n# public_key: str\n\npub_key = cloudfront.publickey(self, \"mypubkey\",\n    encoded_key=public_key\n)\n\nkey_group = cloudfront.keygroup(self, \"mykeygroup\",\n    items=[pub_key\n    ]\n)\n\ncloudfront.distribution(self, \"dist\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.httporigin(\"www.example.com\"),\n        trusted_key_groups=[key_group\n        ]\n    )\n)\n```\n\n### lambda@edge\n\nlambda@edge is an extension of aws lambda, a compute service that lets you execute\nfunctions that customize the content that cloudfront delivers. you can author node.js\nor python functions in the us east (n. virginia) region, and then execute them in aws\nlocations globally that are closer to the viewer, without provisioning or managing servers.\nlambda@edge functions are associated with a specific behavior and event type. lambda@edge\ncan be used to rewrite urls, alter responses based on headers or cookies, or authorize\nrequests based on headers or authorization tokens.\n\nthe following shows a lambda@edge function added to the default behavior and triggered\non every request:\n\n```python\n# my_bucket: s3.bucket\n# a lambda@edge function added to default behavior of a distribution\n# and triggered on every request\nmy_func = cloudfront.experimental.edgefunction(self, \"myfunction\",\n    runtime=lambda_.runtime.nodejs_14_x,\n    handler=\"index.handler\",\n    code=lambda_.code.from_asset(path.join(__dirname, \"lambda-handler\"))\n)\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(my_bucket),\n        edge_lambdas=[cloudfront.edgelambda(\n            function_version=my_func.current_version,\n            event_type=cloudfront.lambdaedgeeventtype.viewer_request\n        )\n        ]\n    )\n)\n```\n\n> **note:** lambda@edge functions must be created in the `us-east-1` region, regardless of the region of the cloudfront distribution and stack.\n> to make it easier to request functions for lambda@edge, the `edgefunction` construct can be used.\n> the `edgefunction` construct will automatically request a function in `us-east-1`, regardless of the region of the current stack.\n> `edgefunction` has the same interface as `function` and can be created and used interchangeably.\n> please note that using `edgefunction` requires that the `us-east-1` region has been bootstrapped.\n> see https://docs.aws.amazon.com/cdk/latest/guide/bootstrapping.html for more about bootstrapping regions.\n\nif the stack is in `us-east-1`, a \"normal\" `lambda.function` can be used instead of an `edgefunction`.\n\n```python\n# using a lambda function instead of an edgefunction for stacks in `us-east-`.\nmy_func = lambda_.function(self, \"myfunction\",\n    runtime=lambda_.runtime.nodejs_14_x,\n    handler=\"index.handler\",\n    code=lambda_.code.from_asset(path.join(__dirname, \"lambda-handler\"))\n)\n```\n\nif the stack is not in `us-east-1`, and you need references from different applications on the same account,\nyou can also set a specific stack id for each lambda@edge.\n\n```python\n# setting stackids for edgefunctions that can be referenced from different applications\n# on the same account.\nmy_func1 = cloudfront.experimental.edgefunction(self, \"myfunction1\",\n    runtime=lambda_.runtime.nodejs_14_x,\n    handler=\"index.handler\",\n    code=lambda_.code.from_asset(path.join(__dirname, \"lambda-handler1\")),\n    stack_id=\"edge-lambda-stack-id-1\"\n)\n\nmy_func2 = cloudfront.experimental.edgefunction(self, \"myfunction2\",\n    runtime=lambda_.runtime.nodejs_14_x,\n    handler=\"index.handler\",\n    code=lambda_.code.from_asset(path.join(__dirname, \"lambda-handler2\")),\n    stack_id=\"edge-lambda-stack-id-2\"\n)\n```\n\nlambda@edge functions can also be associated with additional behaviors,\neither at or after distribution creation time.\n\n```python\n# associating a lambda@edge function with additional behaviors.\n\n# my_func: cloudfront.experimental.edgefunction\n# assigning at distribution creation\n# my_bucket: s3.bucket\n\nmy_origin = origins.s3origin(my_bucket)\nmy_distribution = cloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=my_origin),\n    additional_behaviors={\n        \"images/*\": cloudfront.behavioroptions(\n            origin=my_origin,\n            edge_lambdas=[cloudfront.edgelambda(\n                function_version=my_func.current_version,\n                event_type=cloudfront.lambdaedgeeventtype.origin_request,\n                include_body=true\n            )\n            ]\n        )\n    }\n)\n\n# assigning after creation\nmy_distribution.add_behavior(\"images/*\", my_origin,\n    edge_lambdas=[cloudfront.edgelambda(\n        function_version=my_func.current_version,\n        event_type=cloudfront.lambdaedgeeventtype.viewer_response\n    )\n    ]\n)\n```\n\nadding an existing lambda@edge function created in a different stack to a cloudfront distribution.\n\n```python\n# adding an existing lambda@edge function created in a different stack\n# to a cloudfront distribution.\n# s3_bucket: s3.bucket\n\nfunction_version = lambda_.version.from_version_arn(self, \"version\", \"arn:aws:lambda:us-east-1:123456789012:function:functionname:1\")\n\ncloudfront.distribution(self, \"distro\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(s3_bucket),\n        edge_lambdas=[cloudfront.edgelambda(\n            function_version=function_version,\n            event_type=cloudfront.lambdaedgeeventtype.viewer_request\n        )\n        ]\n    )\n)\n```\n\n### cloudfront function\n\nyou can also deploy cloudfront functions and add them to a cloudfront distribution.\n\n```python\n# s3_bucket: s3.bucket\n# add a cloudfront function to a distribution\ncf_function = cloudfront.function(self, \"function\",\n    code=cloudfront.functioncode.from_inline(\"function handler(event) { return event.request }\")\n)\ncloudfront.distribution(self, \"distro\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(s3_bucket),\n        function_associations=[cloudfront.functionassociation(\n            function=cf_function,\n            event_type=cloudfront.functioneventtype.viewer_request\n        )]\n    )\n)\n```\n\nit will auto-generate the name of the function and deploy it to the `live` stage.\n\nadditionally, you can load the function's code from a file using the `functioncode.fromfile()` method.\n\n### logging\n\nyou can configure cloudfront to create log files that contain detailed information about every user request that cloudfront receives.\nthe logs can go to either an existing bucket, or a bucket will be created for you.\n\n```python\n# configure logging for distributions\n\n# simplest form - creates a new bucket and logs to it.\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.httporigin(\"www.example.com\")),\n    enable_logging=true\n)\n\n# you can optionally log to a specific bucket, configure whether cookies are logged, and give the log files a prefix.\ncloudfront.distribution(self, \"mydist\",\n    default_behavior=cloudfront.behavioroptions(origin=origins.httporigin(\"www.example.com\")),\n    enable_logging=true,  # optional, this is implied if logbucket is specified\n    log_bucket=s3.bucket(self, \"logbucket\"),\n    log_file_prefix=\"distribution-access-logs/\",\n    log_includes_cookies=true\n)\n```\n\n### importing distributions\n\nexisting distributions can be imported as well; note that like most imported constructs, an imported distribution cannot be modified.\nhowever, it can be used as a reference for other higher-level constructs.\n\n```python\n# using a reference to an imported distribution\ndistribution = cloudfront.distribution.from_distribution_attributes(self, \"importeddist\",\n    domain_name=\"d111111abcdef8.cloudfront.net\",\n    distribution_id=\"012345abcdef\"\n)\n```\n\n## migrating from the original cloudfrontwebdistribution to the newer distribution construct\n\nit's possible to migrate a distribution from the original to the modern api.\nthe changes necessary are the following:\n\n### the distribution\n\nreplace `new cloudfrontwebdistribution` with `new distribution`. some\nconfiguration properties have been changed:\n\n| old api                        | new api                                                                                        |\n|--------------------------------|------------------------------------------------------------------------------------------------|\n| `originconfigs`                | `defaultbehavior`; use `additionalbehaviors` if necessary                                      |\n| `viewercertificate`            | `certificate`; use `domainnames` for aliases                                                   |\n| `errorconfigurations`          | `errorresponses`                                                                               |\n| `loggingconfig`                | `enablelogging`; configure with `logbucket` `logfileprefix` and `logincludescookies`           |\n| `viewerprotocolpolicy`         | removed; set on each behavior instead. default changed from `redirect_to_https` to `allow_all` |\n\nafter switching constructs, you need to maintain the same logical id for the underlying [cfndistribution](https://docs.aws.amazon.com/cdk/api/v1/docs/@aws-cdk_aws-cloudfront.cfndistribution.html) if you wish to avoid the deletion and recreation of your distribution.\nto do this, use [escape hatches](https://docs.aws.amazon.com/cdk/v2/guide/cfn_layer.html) to override the logical id created by the new distribution construct with the logical id created by the old construct.\n\nexample:\n\n```python\n# source_bucket: s3.bucket\n\n\nmy_distribution = cloudfront.distribution(self, \"mycfwebdistribution\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(source_bucket)\n    )\n)\ncfn_distribution = my_distribution.node.default_child\ncfn_distribution.override_logical_id(\"mydistributioncfdistribution3h55ti9q\")\n```\n\n### behaviors\n\nthe modern api makes use of the [cloudfront origins](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudfront_origins-readme.html) module to easily configure your origin. replace your origin configuration with the relevant cloudfront origins class. for example, here's a behavior with an s3 origin:\n\n```python\n# source_bucket: s3.bucket\n# oai: cloudfront.originaccessidentity\n\n\ncloudfront.cloudfrontwebdistribution(self, \"mycfwebdistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket,\n            origin_access_identity=oai\n        ),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )\n    ]\n)\n```\n\nbecomes:\n\n```python\n# source_bucket: s3.bucket\n\n\ndistribution = cloudfront.distribution(self, \"mycfwebdistribution\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(source_bucket)\n    )\n)\n```\n\nin the original api all behaviors are defined in the `originconfigs` property. the new api is optimized for a single origin and behavior, so the default behavior and additional behaviors will be defined separately.\n\n```python\n# source_bucket: s3.bucket\n# oai: cloudfront.originaccessidentity\n\n\ncloudfront.cloudfrontwebdistribution(self, \"mycfwebdistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket,\n            origin_access_identity=oai\n        ),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    ), cloudfront.sourceconfiguration(\n        custom_origin_source=cloudfront.customoriginconfig(\n            domain_name=\"myalias\"\n        ),\n        behaviors=[cloudfront.behavior(path_pattern=\"/somewhere\")]\n    )\n    ]\n)\n```\n\nbecomes:\n\n```python\n# source_bucket: s3.bucket\n\n\ndistribution = cloudfront.distribution(self, \"mycfwebdistribution\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(source_bucket)\n    ),\n    additional_behaviors={\n        \"/somewhere\": cloudfront.behavioroptions(\n            origin=origins.httporigin(\"myalias\")\n        )\n    }\n)\n```\n\n### certificates\n\nif you are using an acm certificate, you can pass the certificate directly to the `certificate` prop.\nany aliases used before in the `viewercertificate` class should be passed in to the `domainnames` prop in the modern api.\n\n```python\nimport aws_cdk.aws_certificatemanager as acm\n# certificate: acm.certificate\n# source_bucket: s3.bucket\n\n\nviewer_certificate = cloudfront.viewercertificate.from_acm_certificate(certificate,\n    aliases=[\"myalias\"]\n)\n\ncloudfront.cloudfrontwebdistribution(self, \"mycfwebdistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket\n        ),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )\n    ],\n    viewer_certificate=viewer_certificate\n)\n```\n\nbecomes:\n\n```python\nimport aws_cdk.aws_certificatemanager as acm\n# certificate: acm.certificate\n# source_bucket: s3.bucket\n\n\ndistribution = cloudfront.distribution(self, \"mycfwebdistribution\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(source_bucket)\n    ),\n    domain_names=[\"myalias\"],\n    certificate=certificate\n)\n```\n\niam certificates aren't directly supported by the new api, but can be easily configured through [escape hatches](https://docs.aws.amazon.com/cdk/v2/guide/cfn_layer.html)\n\n```python\n# source_bucket: s3.bucket\n\nviewer_certificate = cloudfront.viewercertificate.from_iam_certificate(\"myiamroleidentifier\",\n    aliases=[\"myalias\"]\n)\n\ncloudfront.cloudfrontwebdistribution(self, \"mycfwebdistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket\n        ),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )\n    ],\n    viewer_certificate=viewer_certificate\n)\n```\n\nbecomes:\n\n```python\n# source_bucket: s3.bucket\n\ndistribution = cloudfront.distribution(self, \"mycfwebdistribution\",\n    default_behavior=cloudfront.behavioroptions(\n        origin=origins.s3origin(source_bucket)\n    ),\n    domain_names=[\"myalias\"]\n)\n\ncfn_distribution = distribution.node.default_child\n\ncfn_distribution.add_property_override(\"viewercertificate.iamcertificateid\", \"myiamroleidentifier\")\ncfn_distribution.add_property_override(\"viewercertificate.sslsupportmethod\", \"sni-only\")\n```\n\n### other changes\n\na number of default settings have changed on the new api when creating a new distribution, behavior, and origin.\nafter making the major changes needed for the migration, run `cdk diff` to see what settings have changed.\nif no changes are desired during migration, you will at the least be able to use [escape hatches](https://docs.aws.amazon.com/cdk/v2/guide/cfn_layer.html) to override what the cdk synthesizes, if you can't change the properties directly.\n\n## cloudfrontwebdistribution api\n\n> the `cloudfrontwebdistribution` construct is the original construct written for working with cloudfront distributions.\n> users are encouraged to use the newer `distribution` instead, as it has a simpler interface and receives new features faster.\n\nexample usage:\n\n```python\n# using a cloudfrontwebdistribution construct.\n\n# source_bucket: s3.bucket\n\ndistribution = cloudfront.cloudfrontwebdistribution(self, \"mydistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket\n        ),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )\n    ]\n)\n```\n\n### viewer certificate\n\nby default, cloudfront web distributions will answer https requests with cloudfront's default certificate,\nonly containing the distribution `domainname` (e.g. d111111abcdef8.cloudfront.net).\nyou can customize the viewer certificate property to provide a custom certificate and/or list of domain name aliases to fit your needs.\n\nsee [using alternate domain names and https](https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/using-https-alternate-domain-names.html) in the cloudfront user guide.\n\n#### default certificate\n\nyou can customize the default certificate aliases. this is intended to be used in combination with cname records in your dns zone.\n\nexample:\n\n```python\ns3_bucket_source = s3.bucket(self, \"bucket\")\n\ndistribution = cloudfront.cloudfrontwebdistribution(self, \"anamazingwebsiteprobably\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(s3_bucket_source=s3_bucket_source),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )],\n    viewer_certificate=cloudfront.viewercertificate.from_cloud_front_default_certificate(\"www.example.com\")\n)\n```\n\n#### acm certificate\n\nyou can change the default certificate by one stored aws certificate manager, or acm.\nthose certificate can either be generated by aws, or purchased by another ca imported into acm.\n\nfor more information, see\n[the aws-certificatemanager module documentation](https://docs.aws.amazon.com/cdk/api/latest/docs/aws-certificatemanager-readme.html)\nor [importing certificates into aws certificate manager](https://docs.aws.amazon.com/acm/latest/userguide/import-certificate.html)\nin the aws certificate manager user guide.\n\nexample:\n\n```python\ns3_bucket_source = s3.bucket(self, \"bucket\")\n\ncertificate = certificatemanager.certificate(self, \"certificate\",\n    domain_name=\"example.com\",\n    subject_alternative_names=[\"*.example.com\"]\n)\n\ndistribution = cloudfront.cloudfrontwebdistribution(self, \"anamazingwebsiteprobably\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(s3_bucket_source=s3_bucket_source),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )],\n    viewer_certificate=cloudfront.viewercertificate.from_acm_certificate(certificate,\n        aliases=[\"example.com\", \"www.example.com\"],\n        security_policy=cloudfront.securitypolicyprotocol.tls_v1,  # default\n        ssl_method=cloudfront.sslmethod.sni\n    )\n)\n```\n\n#### iam certificate\n\nyou can also import a certificate into the iam certificate store.\n\nsee [importing an ssl/tls certificate](https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/cnames-and-https-procedures.html#cnames-and-https-uploading-certificates) in the cloudfront user guide.\n\nexample:\n\n```python\ns3_bucket_source = s3.bucket(self, \"bucket\")\n\ndistribution = cloudfront.cloudfrontwebdistribution(self, \"anamazingwebsiteprobably\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(s3_bucket_source=s3_bucket_source),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )],\n    viewer_certificate=cloudfront.viewercertificate.from_iam_certificate(\"certificateid\",\n        aliases=[\"example.com\"],\n        security_policy=cloudfront.securitypolicyprotocol.ssl_v3,  # default\n        ssl_method=cloudfront.sslmethod.sni\n    )\n)\n```\n\n### trusted key groups\n\ncloudfront web distributions supports validating signed urls or signed cookies using key groups.\nwhen a cache behavior contains trusted key groups, cloudfront requires signed urls or signed cookies for all requests that match the cache behavior.\n\nexample:\n\n```python\n# using trusted key groups for cloudfront web distributions.\n# source_bucket: s3.bucket\n# public_key: str\n\npub_key = cloudfront.publickey(self, \"mypubkey\",\n    encoded_key=public_key\n)\n\nkey_group = cloudfront.keygroup(self, \"mykeygroup\",\n    items=[pub_key\n    ]\n)\n\ncloudfront.cloudfrontwebdistribution(self, \"anamazingwebsiteprobably\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket\n        ),\n        behaviors=[cloudfront.behavior(\n            is_default_behavior=true,\n            trusted_key_groups=[key_group\n            ]\n        )\n        ]\n    )\n    ]\n)\n```\n\n### restrictions\n\ncloudfront supports adding restrictions to your distribution.\n\nsee [restricting the geographic distribution of your content](https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/georestrictions.html) in the cloudfront user guide.\n\nexample:\n\n```python\n# adding restrictions to a cloudfront web distribution.\n# source_bucket: s3.bucket\n\ncloudfront.cloudfrontwebdistribution(self, \"mydistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=source_bucket\n        ),\n        behaviors=[cloudfront.behavior(is_default_behavior=true)]\n    )\n    ],\n    geo_restriction=cloudfront.georestriction.allowlist(\"us\", \"gb\")\n)\n```\n\n### connection behaviors between cloudfront and your origin\n\ncloudfront provides you even more control over the connection behaviors between cloudfront and your origin.\nyou can now configure the number of connection attempts cloudfront will make to your origin and the origin connection timeout for each attempt.\n\nsee [origin connection attempts](https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/distribution-web-values-specify.html#origin-connection-attempts)\n\nsee [origin connection timeout](https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/distribution-web-values-specify.html#origin-connection-timeout)\n\nexample usage:\n\n```python\n# configuring connection behaviors between cloudfront and your origin\ndistribution = cloudfront.cloudfrontwebdistribution(self, \"mydistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        connection_attempts=3,\n        connection_timeout=duration.seconds(10),\n        behaviors=[cloudfront.behavior(\n            is_default_behavior=true\n        )\n        ]\n    )\n    ]\n)\n```\n\n#### origin fallback\n\nin case the origin source is not available and answers with one of the\nspecified status codes the failover origin source will be used.\n\n```python\n# configuring origin fallback options for the cloudfrontwebdistribution\ncloudfront.cloudfrontwebdistribution(self, \"adistribution\",\n    origin_configs=[cloudfront.sourceconfiguration(\n        s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=s3.bucket.from_bucket_name(self, \"abucket\", \"myoriginbucket\"),\n            origin_path=\"/\",\n            origin_headers={\n                \"myheader\": \"42\"\n            },\n            origin_shield_region=\"us-west-2\"\n        ),\n        failover_s3_origin_source=cloudfront.s3originconfig(\n            s3_bucket_source=s3.bucket.from_bucket_name(self, \"abucketfallback\", \"myoriginbucketfallback\"),\n            origin_path=\"/somewhere\",\n            origin_headers={\n                \"myheader2\": \"21\"\n            },\n            origin_shield_region=\"us-east-1\"\n        ),\n        failover_criteria_status_codes=[cloudfront.failoverstatuscode.internal_server_error],\n        behaviors=[cloudfront.behavior(\n            is_default_behavior=true\n        )\n        ]\n    )\n    ]\n)\n```\n\n## keygroup & publickey api\n\nyou can create a key group to use with cloudfront signed urls and signed cookies\nyou can add public keys to use with cloudfront features such as signed urls, signed cookies, and field-level encryption.\n\nthe following example command uses openssl to generate an rsa key pair with a length of 2048 bits and save to the file named `private_key.pem`.\n\n```bash\nopenssl genrsa -out private_key.pem 2048\n```\n\nthe resulting file contains both the public and the private key. the following example command extracts the public key from the file named `private_key.pem` and stores it in `public_key.pem`.\n\n```bash\nopenssl rsa -pubout -in private_key.pem -out public_key.pem\n```\n\nnote: don't forget to copy/paste the contents of `public_key.pem` file including `-----begin public key-----` and `-----end public key-----` lines into `encodedkey` parameter when creating a `publickey`.\n\nexample:\n\n```python\n# create a key group to use with cloudfront signed urls and signed cookies.\ncloudfront.keygroup(self, \"mykeygroup\",\n    items=[\n        cloudfront.publickey(self, \"mypublickey\",\n            encoded_key=\"...\"\n        )\n    ]\n)\n```\n\nsee:\n\n* https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/privatecontent.html\n* https://docs.aws.amazon.com/amazoncloudfront/latest/developerguide/private-content-trusted-signers.html\n",
  "docs_url": null,
  "keywords": "",
  "license": "apache-2.0",
  "name": "aws-cdk.aws-cloudfront",
  "package_url": "https://pypi.org/project/aws-cdk.aws-cloudfront/",
  "project_url": "https://pypi.org/project/aws-cdk.aws-cloudfront/",
  "project_urls": {
    "Homepage": "https://github.com/aws/aws-cdk",
    "Source": "https://github.com/aws/aws-cdk.git"
  },
  "release_url": "https://pypi.org/project/aws-cdk.aws-cloudfront/1.204.0/",
  "requires_dist": [
    "aws-cdk.aws-certificatemanager (==1.204.0)",
    "aws-cdk.aws-cloudwatch (==1.204.0)",
    "aws-cdk.aws-ec2 (==1.204.0)",
    "aws-cdk.aws-iam (==1.204.0)",
    "aws-cdk.aws-kms (==1.204.0)",
    "aws-cdk.aws-lambda (==1.204.0)",
    "aws-cdk.aws-s3 (==1.204.0)",
    "aws-cdk.aws-ssm (==1.204.0)",
    "aws-cdk.core (==1.204.0)",
    "aws-cdk.cx-api (==1.204.0)",
    "constructs (<4.0.0,>=3.3.69)",
    "jsii (<2.0.0,>=1.84.0)",
    "publication (>=0.0.3)",
    "typeguard (~=2.13.3)"
  ],
  "requires_python": "~=3.7",
  "summary": "the cdk construct library for aws::cloudfront",
  "version": "1.204.0",
  "releases": [],
  "developers": [
    "amazon_web_services"
  ],
  "kwds": "aws_cloudfront_origins cloudfront cloudfrontwebdistribution amazoncloudfront aws_cdk",
  "license_kwds": "apache-2.0",
  "libtype": "pypi",
  "id": "pypi_aws_cdk.aws_cloudfront",
  "homepage": "https://github.com/aws/aws-cdk",
  "release_count": 258,
  "dependency_ids": [
    "pypi_aws_cdk.aws_certificatemanager",
    "pypi_aws_cdk.aws_cloudwatch",
    "pypi_aws_cdk.aws_ec2",
    "pypi_aws_cdk.aws_iam",
    "pypi_aws_cdk.aws_kms",
    "pypi_aws_cdk.aws_lambda",
    "pypi_aws_cdk.aws_s3",
    "pypi_aws_cdk.aws_ssm",
    "pypi_aws_cdk.core",
    "pypi_aws_cdk.cx_api",
    "pypi_constructs",
    "pypi_jsii",
    "pypi_publication",
    "pypi_typeguard"
  ]
}