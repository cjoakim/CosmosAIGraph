{
  "classifiers": [
    "license :: osi approved :: mit license",
    "natural language :: english",
    "operating system :: os independent",
    "programming language :: python",
    "programming language :: python :: 3",
    "programming language :: python :: 3 :: only",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9",
    "topic :: software development :: libraries :: python modules"
  ],
  "description": "# pycobertura\n\n![pycobertura logo](https://raw.githubusercontent.com/aconrad/pycobertura/master/aysha-logo.svg)\n\na code coverage diff tool for cobertura reports.\n\n![pycobertura](https://github.com/aconrad/pycobertura/actions/workflows/build-and-test-pycobertura.yml/badge.svg)\n[![pypi](http://img.shields.io/pypi/v/pycobertura.svg?style=flat)](https://pypi.python.org/pypi/pycobertura)\n\n- [about](#about)\n- [install](#install)\n- [cli usage](#cli-usage)\n- [library usage](#library-usage)\n- [how to contribute?](#how-to-contribute)\n- [faq](#faq)\n\n## about\n\npycobertura is a generic [cobertura](http://cobertura.github.io/cobertura/)\nreport parser. it was also designed to help prevent code coverage from\ndecreasing with the `pycobertura diff` command: any line changed should be\ntested and uncovered changes should be clearly visible without letting legacy\nuncovered code get in the way so developers can focus solely on their changes.\n\nfeatures:\n\n* show coverage summary of a cobertura file\n* output in plain text or html\n* compare two cobertura files and show changes in coverage\n* colorized diff output\n* diff exit status of non-zero if coverage worsened or if any changes were left uncovered\n* fail based on uncovered lines rather than on decrease of coverage rate\n  ([see why](#why-is-the-number-of-uncovered-lines-used-as-the-metric-to-check-if-code-coverage-worsened-rather-than-the-line-rate))\n\nnote: the api is unstable any may be subject to changes until it reaches 1.0.\n\n## install\n\n```shell\npip install pycobertura\n```\n\n## cli usage\n\npycobertura provides a command line interface to report on coverage files.\n\n### help commands\n\ndifferent help screens are available depending on what you need help about.\n\n```shell\n$ pycobertura --help\nusage: pycobertura [options] command [args]...\n\noptions:\n  --help  show this message and exit.\n\ncommands:\n  diff  the diff command compares and shows the changes between two...\n  show  show coverage summary of a cobertura report\n```\n\n```shell\npycobertura show --help\n```\n\n```shell\npycobertura diff --help\n```\n\n### command `show`\n\nthe `show` command displays the report summary of a coverage file.\n\n```shell\n$ pycobertura show coverage.xml\nfilename                     stmts    miss  cover    missing\n-------------------------  -------  ------  -------  ---------\npycobertura/__init__.py          1       0  100.00%\npycobertura/cli.py              18       0  100.00%\npycobertura/cobertura.py        93       0  100.00%\npycobertura/reporters.py       129       0  100.00%\npycobertura/utils.py            12       0  100.00%\ntotal                          253       0  100.00%\n```\n\n*note*: for the csv format we chose as default delimiter the semicolon, because the common is used internally in the \"missing\" column,\ntherefore the \",\" delimiter might lead to problems when rendering the csv in an editor.\n```shell\n$ pycobertura show --format csv coverage.xml --delimiter \";\"\nfilename;stmts;miss;cover;missing\npycobertura/__init__.py;2;0;100.00%;\npycobertura/cli.py;132;88;33.33%;274-3758\npycobertura/cobertura.py;216;35;83.80%;423, 648-696\npycobertura/filesystem.py;91;6;93.41%;343-625\npycobertura/reporters.py;214;110;48.60%;291, 295-3284\npycobertura/utils.py;122;15;87.70%;38, 262-486\npycobertura/templates/__init__.py;0;0;100.00%;\npycobertura/templates/filters.py;17;10;41.18%;261-544\ntotal;794;264;66.75%;\n```\n\n```shell\n$ pycobertura show --format markdown coverage.xml \n| filename                          |   stmts |   miss | cover   | missing            |\n|-----------------------------------|---------|--------|---------|--------------------|\n| pycobertura/__init__.py           |       2 |      0 | 100.00% |                    |\n| pycobertura/cli.py                |     132 |     88 | 33.33%  | 274-3758           |\n| pycobertura/cobertura.py          |     216 |     35 | 83.80%  | 423, 648-696       |\n| pycobertura/filesystem.py         |      91 |      6 | 93.41%  | 343-625            |\n| pycobertura/reporters.py          |     222 |    114 | 48.65%  | 286, 290, 331-4065 |\n| pycobertura/utils.py              |     122 |     15 | 87.70%  | 38, 262-486        |\n| pycobertura/templates/__init__.py |       0 |      0 | 100.00% |                    |\n| pycobertura/templates/filters.py  |      17 |     10 | 41.18%  | 261-544            |\n| total                             |     802 |    268 | 66.58%  |                    |\n```\n\nthe following is a screenshot of the html version of another coverage file\nwhich also include the source code with highlighted source code to indicate\nwhether lines were covered (green) or not (red).\n\n```shell\npycobertura show --format html --output coverage.html coverage.xml\n```\n\n![example output of html formatted pycobertura show command](http://i.imgur.com/bynxmap.png)\n\nthe following shows how to generate a json version of another coverage file.\n\n```shell\n$ pycobertura show --format json --output coverage.json tests/cobertura.xml\n{\n    \"files\": [\n        {\n            \"filename\": \"main.java\",\n            \"stmts\": 15,\n            \"miss\": 0,\n            \"cover\": \"100.00%\",\n            \"missing\": \"\"\n        },\n        {\n            \"filename\": \"search/binarysearch.java\",\n            \"stmts\": 12,\n            \"miss\": 1,\n            \"cover\": \"91.67%\",\n            \"missing\": \"24\"\n        },\n        {\n            \"filename\": \"search/isortedarraysearch.java\",\n            \"stmts\": 0,\n            \"miss\": 0,\n            \"cover\": \"100.00%\",\n            \"missing\": \"\"\n        },\n        {\n            \"filename\": \"search/linearsearch.java\",\n            \"stmts\": 7,\n            \"miss\": 2,\n            \"cover\": \"71.43%\",\n            \"missing\": \"19-24\"\n        }\n    ],\n    \"total\": {\n        \"filename\": \"total\",\n        \"stmts\": 34,\n        \"miss\": 3,\n        \"cover\": \"90.00%\"\n    }\n}\n```\n\n```shell\n$ pycobertura show --format yaml --output coverage.yaml tests/cobertura.xml\nfiles:\n- filename: main.java\n  stmts: 15\n  miss: 0\n  cover: 100.00%\n  missing: ''\n- filename: search/binarysearch.java\n  stmts: 12\n  miss: 1\n  cover: 91.67%\n  missing: '24'\n- filename: search/isortedarraysearch.java\n  stmts: 0\n  miss: 0\n  cover: 100.00%\n  missing: ''\n- filename: search/linearsearch.java\n  stmts: 7\n  miss: 2\n  cover: 71.43%\n  missing: 19-24\ntotal:\n  filename: total\n  stmts: 34\n  miss: 3\n  cover: 90.00%\n\n```\n\nthe following shows how to generate github annotations given a coverage file.\n\n```shell\n$ pycobertura show --format github-annotation tests/cobertura.xml\n::notice file=dummy/dummy.py,line=5,endline=6,title=pycobertura::not covered\n::notice file=dummy/dummy4.py,line=1,endline=6,title=pycobertura::not covered\n```\n\nif you run it in github actions/apps, the above log generates check annotations.\n\n![example output of github-annotation formatted pycobertura show command](images/example_github_annotation_show.png)\n\n### command `diff`\n\nyou can also use the `diff` command to show the difference between two coverage\nfiles. to properly compute the `missing` column, it is necessary to provide the\nsource code that was used to generate each of the passed cobertura reports\n([see why](#why-do-i-need-to-provide-the-path-to-the-source-code-directory)).\n\n```shell\n$ pycobertura diff coverage.old.xml coverage.new.xml --source1 old_source/ --source2 new_source/\nfilename          stmts    miss    cover     missing\n----------------  -------  ------  --------  ---------\ndummy/dummy.py    -        -2      +50.00%   -2, -5\ndummy/dummy2.py   +2       -       +100.00%\ntotal             +2       -2      +50.00%\n```\n\nthe column `missing` will show line numbers prefixed with either a plus sign\n`+` or a minus sign `-`. when prefixed with a plus sign, the line was\nintroduced as uncovered and is shown in red, when prefixed as a minus sign, the\nline is no longer uncovered and is rendered in green.\n\nanalogously you can also show the diff in csv format with the option to define a delimiter (\\t should also work here) via:\n\n```shell\npycobertura diff tests/dummy.source1/coverage.xml tests/dummy.source2/coverage.xml --format csv --delimiter \";\"\n```\n\n![example output of csv formatted pycobertura diff command](images/example_csv_diff_output.png)\n\n*note*: the default delimiter is semicolon (;). the delimiters comma (,) and newline (/n) are *very risky* to use and are not supported by this library. the comma delimiter is used in the \"missing\" column in the list datastructure to separate the different items. therefore the \",\" delimiter might lead to problems when rendering the csv in an editor. as a missing value in csv corresponds to an empty value, the newline delimiter can as well lead to problems when rendering the csv in an editor.\n\nanalogously you can also show the diff in markdown format via:\n\n```shell\npycobertura diff --format markdown tests/dummy.source1/coverage.xml tests/dummy.source2/coverage.xml\n```\n\nthis will lead to the following output\n![example output of markdown formatted pycobertura diff command](images/example_markdown_diff_output.png)\n\nthis screenshot shows how the html output only applies coverage highlighting to\nthe parts of the code where the coverage has changed (from covered to\nuncovered, or vice versa).\n\n```shell\npycobertura diff --format html --output coverage.html ./master/coverage.xml ./myfeature/coverage.xml\n```\n\n![example output of html formatted pycobertura diff command](http://i.imgur.com/l5zuari.png)\n\nthis screenshot shows how the json output only applies coverage highlighting to\nthe parts of the code where the coverage has changed (from covered to\nuncovered, or vice versa).\n\n```shell\npycobertura diff --format json tests/dummy.source1/coverage.xml tests/dummy.source2/coverage.xml\n```\n\n![example output of json formatted pycobertura diff command](images/example_json_output.png)\n\nthis screenshot shows how the yaml output only applies coverage highlighting to\nthe parts of the code where the coverage has changed (from covered to\nuncovered, or vice versa).\n\n```shell\npycobertura diff --format yaml tests/dummy.source1/coverage.xml tests/dummy.source2/coverage.xml\n```\n\n![example output of yaml formatted pycobertura diff command](images/example_yaml_output.png)\n\nthe following shows how to generate github annotations given a coverage file.\n\n```shell\n$ pycobertura diff --format github-annotation tests/dummy.source1/coverage.xml tests/dummy.source2/coverage.xml\n::notice file=dummy/dummy2.py,line=5,endline=5,title=pycobertura::not covered\n::notice file=dummy/dummy3.py,line=1,endline=2,title=pycobertura::not covered\n```\n\nif you run it in github actions/apps, the above log generates check annotations.\n\n![example output of github-annotation formatted pycobertura diff command](images/example_github_annotation_diff.png)\n\n\n### option to exclude files via --ignore-regex-option\nyou can specify the `--ignore-regex` option to exclude files that have a certain pattern either by specifying the path to a `.gitignore` file or by entering a python regex.\nexamples:\n```\npycobertura show tests/cobertura.xml\nfilename                          stmts    miss  cover    missing\n------------------------------  -------  ------  -------  ---------\nmain.java                            15       0  100.00%\nsearch/binarysearch.java             12       1  91.67%   24\nsearch/isortedarraysearch.java        0       0  100.00%\nsearch/linearsearch.java              7       2  71.43%   19-24\ntotal                                34       3  90.00%\n```\n```\npycobertura show tests/cobertura.xml --ignore-regex \".*search\"\nfilename      stmts    miss  cover    missing\n----------  -------  ------  -------  ---------\nmain.java        15       0  100.00%\ntotal            34       3  90.00%\n```\n> note: putting just a `*`, e.g. \"*search\" above will lead to an error, you need to really follow python regex conventions to use this option.\nyou can also specify a `.testgitignore` with the following content:\n```\n# test file for ignore regexes\n\n**/__pycache__\n**/dummy*\n\n*.xml\n\n**/*search*\n```\nand then use\n```\npycobertura show tests/cobertura.xml --ignore-regex \"tests/.testgitignore\"\nfilename      stmts    miss  cover    missing\n----------  -------  ------  -------  ---------\nmain.java        15       0  100.00%\ntotal            34       3  90.00%\n```\nthe same will also work for `diff` commands.\n\n#### `diff` exit codes\n\nupon exit, the `diff` command may return various exit codes:\n\n* 0: all changes are covered, no new uncovered statements have been introduced\n* 1: some exception occurred (likely due to inappropriate usage or a bug in pycobertura)\n* 2: the changes worsened the overall coverage\n* 3: the changes introduced uncovered statements but the overall coverage is still better than before\n\nyou can capture the exit code by using the `$?` syntax from your shell:\n\n```bash\npycobertura ...\npycobertura_exit_code=$?\necho $pycobertura_exit_code\n```\n\n## library usage\n\nusing it as a library in your python application is easy:\n\n```python\nfrom pycobertura import cobertura\ncobertura = cobertura('coverage.xml')\n\ncobertura.version == '4.0.2'\ncobertura.line_rate() == 1.0  # 100%\ncobertura.files() == [\n    'pycobertura/__init__.py',\n    'pycobertura/cli.py',\n    'pycobertura/cobertura.py',\n    'pycobertura/reporters.py',\n    'pycobertura/utils.py',\n]\ncobertura.line_rate('pycobertura/cli.py') == 1.0\n\nfrom pycobertura import textreporter\ntr = textreporter(cobertura)\ntr.generate() == \"\"\"\\\nfilename                     stmts    miss  cover    missing\n-------------------------  -------  ------  -------  ---------\npycobertura/__init__.py          1       0  100.00%\npycobertura/cli.py              18       0  100.00%\npycobertura/cobertura.py        93       0  100.00%\npycobertura/reporters.py       129       0  100.00%\npycobertura/utils.py            12       0  100.00%\ntotal                          253       0  100.00%\"\"\"\n\nfrom pycobertura import textreporterdelta\n\ncoverage1 = cobertura('coverage1.xml')\ncoverage2 = cobertura('coverage2.xml')\ndelta = textreporterdelta(coverage1, coverage2)\ndelta.generate() == \"\"\"\\\nfilename          stmts    miss    cover     missing\n----------------  -------  ------  --------  ---------\ndummy/dummy.py    -        -2      +50.00%   -2, -5\ndummy/dummy2.py   +2       -       +100.00%\ntotal             +2       -2      +50.00%\"\"\"\n```\n\n## how to contribute?\n\nfound a bug/typo? got a patch? have an idea? please use github issues or fork\npycobertura and submit a pull request (pr). all contributions are welcome!\n\nif you submit a pr:\n\n* ensure the description of your pr illustrates your changes clearly by showing\n  what the problem was and how you fixed it (before/after)\n* make sure your changes are covered with one or more tests\n* add a descriptive note in the changes file under the `unreleased` section\n* update the readme accordingly if your changes outdate the documentation\n* make sure all tests are passing using `tox`\n\n```shell\npip install tox\ntox\n```\n\n## faq\n\n### how does pycobertura work?\n\npycobertura takes two different cobertura reports and compares them line by\nline. if the coverage status of a line changed from covered to uncovered or\nvice versa, then pycobertura will report it. sometimes you have no code changes\nat all, the only changes were to add more tests and pycobertura will show you\nthe progress.\n\npycobertura was initially designed as a general purpose cobertura parser and\ncan generate a summary table for a single cobertura file (the `show` command).\n\n### i only have one cobertura report, can i just see my uncovered changes?\n\nyes. all you have to do is pass your same coverage report twice and provide the\npath to the two different code bases:\n\n```shell\npycobertura diff coverage.xml coverage.xml --source1 master/ --source2 myfeature/\n```\n\nbut keep in mind that this will not show you if your changes have introduced a\ndrop in coverage elsewhere in the code base.\n\n### why doesn't pycobertura use git to diff the source given revision shas rather than passing paths to the source code?\n\nbecause we would have to support n version control systems (vcs). it is easy\nenough to generate a directory that contains the source code at a given commit\nor branch name that it's not a top priority for pycobertura to be vcs-aware:\n\n```shell\ngit archive --prefix=source1/ ${branch_or_commit1} | tar -xf -\ngit archive --prefix=source2/ ${branch_or_commit2} | tar -xf -\npycobertura diff --source1 source1/ --source2 source2/ coverage1.xml coverage2.xml -o output.html\nrm -rf source1/ source2/\n```\n\nmercurial has `hg archive` and subversion has `svn export`. these are simple\npre-steps to running `pycobertura diff`.\n\nalso, the code repository may not always be available at the time pycobertura\nis run. typically, in continuous delivery pipelines, only\n[artifacts](http://en.wikipedia.org/wiki/artifact_%28software_development%29)\nare available.\n\n### why do i need to provide the path to the source code directory?\n\nwith the command `pycobertura show`, you don't need to provide the source code\ndirectory, unless you want the html output which will conveniently render the\nhighlighted source code for you.\n\nbut with `pycobertura diff`, if you care about *which* lines are covered or\nuncovered (and not just a global count), then you will need to provide the\nsource for *each* of the reports.\n\nto better understand why, let's assume we have 2 cobertura reports with the\nfollowing info:\n\nreport a:\n\n```shell\nline 1, hit\nline 2, miss\nline 3, hit\n```\n\nand report b:\n\n```shell\nline 1, hit\nline 2, miss\nline 3, hit\nline 4, miss\nline 5, hit\n```\n\nhow can you tell which lines need to be highlighted? naively, you'd assume that\nlines 4-5 were added and these should be the highlighted lines, the ones part\nof your coverage diff. well, that doesn't quite work.\n\nthe code for report a is:\n\n```python\nif foo is true:  # line 1\n    total += 1   # line 2\nreturn total     # line 3\n```\n\nthe code for report b is:\n\n```python\nif foo is false:   # line 1  # new line\n    total -= 1     # line 2  # new line\nelif foo is true:  # line 3  # modified line\n    total += 1     # line 4, unchanged\nreturn total       # line 5, unchanged\n```\n\nthe code change are lines 1-3 and these are the ones you want to highlight.\nlines 4-5 don't need to be highlighted (unless coverage status changed\nin-between).\n\nso, to accurately highlight the lines that have changed, the coverage reports\nalone are not sufficient and this is why you need to provide the path to the\nsource that was used to generate each of the cobertura reports and diff them to\nsee which lines actually changed to report accurate coverage.\n\n### when should i use pycobertura?\n\npycobertura was built as a tool to educate developers about the testing culture\nin such way that any code change should have one or more tests along with it.\n\nyou can use pycobertura in your continuous integration (ci) or continuous\ndelivery (cd) pipeline which would fail a build if the code changes worsened\nthe coverage. for example, when a pull request is submitted, the new code\nshould have equal or better coverage than the branch it's going to be merged\ninto. or if code navigates through a release pipeline and the new code has\nworse coverage than what's already in production, then the release is aborted.\n\nwhen a build is triggered by your ci/cd pipeline, each testing stage would\ntypically store an\n[artifact](http://en.wikipedia.org/wiki/artifact_%28software_development%29) of\nthe source code and another one of the cobertura report. an extra stage in the\npipeline could ensure that the coverage did not worsen. this can be done by\nretrieving the artifacts of the current build as well as the \"target\" artifacts\n(code and cobertura report of production or target branch of a pull request).\nthen `pycobertura diff` will take care of failing the build if the coverage\nworsened (return a non-zero exit code) and then the pycobertura report can be\npublished as an artifact to make it available to developers to look at.\n\nthe step could look like this:\n\n```shell\n# download artifacts of current build\ncurl -o coverage.${build_id}.xml https://ciserver/artifacts/${build_id}/coverage.xml\ncurl -o source.${build_id}.zip https://ciserver/artifacts/${build_id}/source.zip\n\n# download artifacts of already-in-prod build\ncurl -o coverage.${prod_build}.xml https://ciserver/artifacts/${prod_build}/coverage.xml\ncurl -o source.${prod_build}.zip https://ciserver/artifacts/${prod_build}/source.zip\n\nunzip source.${build_id}.zip -d source.${build_id}\nunzip source.${prod_build}.zip -d source.${prod_build}\n\n# compare\npycobertura diff --format html \\\n                 --output pycobertura-diff.${build_id}.html \\\n                 --source1 source.${prod_build} \\\n                 --source2 source.${build_id} \\\n                 coverage.${prod_build}.xml \\\n                 coverage.${build_id}.xml\n\n# upload the pycobertura report artifact\ncurl -f filedata=@pycobertura-diff.${build_id}.html http://ciserver/artifacts/${build_id}/\n```\n\n### why is the number of uncovered lines used as the metric to check if code coverage worsened rather than the line rate?\n\nthe line rate (percentage of covered lines) can legitimately go down for a\nnumber of reasons. to illustrate, suppose we have this code coverage report for\nversion a of our code:\n\n```shell\nline 1: hit\nline 2: hit\nline 3: miss\nline 4: hit\nline 5: hit\n```\n\nhere, the line rate is 80% and uncovered lines is 1 (miss). later in version b\nof our code, we legitimately delete a covered line and the following coverage\nreport is generated:\n\n```shell\nline 1: hit\n### line deleted ###\nline 2: miss\nline 3: hit\nline 4: hit\n```\n\nthe line rate decreased from 80% to 75% but uncovered lines is still at 1. in\nthis case, failing the build based on line rate is inappropriate, thus making\nthe line rate the wrong metric to look at when validating coverage.\n\nthe basic idea is that a code base may have technical debt of n uncovered lines\nand you want to prevent n from ever going up.\n\n### pycobertura sounds cool, but how to i generate a cobertura file?\n\ndepending on your programing language, you need to find a tool that measures\ncode coverage and generates a cobertura report which is an xml representation\nof your code coverage results.\n\nin python, [coverage.py](http://nedbatchelder.com/code/coverage/) is a great\ntool for measuring code coverage and plugins such as\n[pytest-cov](https://pypi.python.org/pypi/pytest-cov) for\n[pytest](http://pytest.org/latest/) and\n[nosexcover](https://pypi.python.org/pypi/nosexcover) for\n[nose](https://nose.readthedocs.org/en/latest/) are available to generate\ncobertura reports while running tests.\n\n[istanbul](https://github.com/gotwarlost/istanbul) can generate\ncobertura reports for javascript and also has plugins for\n[coffeescript](https://github.com/benbria/coffee-coverage) if that is your\ncup of tea.\n\ncobertura is a very common file format available in many testing tools for\npretty much all programing languages. pycobertura is language agnostic and\nshould work with reports generated by tools in any language. but it was mostly\ndeveloped and tested against reports generated with the `pytest-cov` plugin in\npython. if you see issues, please [create a\nticket](https://github.com/surveymonkey/pycobertura/issues).\n\n## logo credit\n\nthe pycobertura logo, aysha, was graciously\n[donated](https://github.com/arasatasaygin/openlogos/issues/19) by\n[open logos](http://openlogos.org/). \ud83d\ude47\u200d check them out!\n",
  "docs_url": null,
  "keywords": "\"cobertura coverage diff report parser parse xml\"",
  "license": "",
  "name": "pycobertura",
  "package_url": "https://pypi.org/project/pycobertura/",
  "project_url": "https://pypi.org/project/pycobertura/",
  "project_urls": {
    "Homepage": "https://github.com/aconrad/pycobertura"
  },
  "release_url": "https://pypi.org/project/pycobertura/3.2.4/",
  "requires_dist": [
    "click >=4.0",
    "jinja2",
    "lxml",
    "tabulate",
    "ruamel.yaml"
  ],
  "requires_python": ">=3.7",
  "summary": "\"a cobertura coverage parser that can diff reports and show coverage progress.\"",
  "version": "3.2.4",
  "releases": [],
  "developers": [],
  "kwds": "pycobertura pycobertura_exit_code pytest cobertura coverage2",
  "license_kwds": "",
  "libtype": "pypi",
  "id": "pypi_pycobertura",
  "homepage": "https://github.com/aconrad/pycobertura",
  "release_count": 37,
  "dependency_ids": [
    "pypi_click",
    "pypi_jinja2",
    "pypi_lxml",
    "pypi_ruamel.yaml",
    "pypi_tabulate"
  ]
}