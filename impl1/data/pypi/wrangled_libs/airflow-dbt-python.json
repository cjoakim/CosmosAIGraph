{
  "classifiers": [
    "development status :: 5 - production/stable",
    "intended audience :: developers",
    "license :: osi approved :: mit license",
    "programming language :: python :: 3",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9"
  ],
  "description": "# airflow-dbt-python\n\n[![pypi version](https://img.shields.io/pypi/v/airflow-dbt-python?style=plastic)](https://pypi.org/project/airflow-dbt-python/)\n[![ci testing](https://github.com/tomasfarias/airflow-dbt-python/actions/workflows/ci.yaml/badge.svg)](https://github.com/tomasfarias/airflow-dbt-python/actions)\n[![code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)\n[![test coverage](https://img.shields.io/endpoint?url=https://gist.githubusercontent.com/tomasfarias/81ef37701aa088d18db8a58ce07c79c7/raw/covbadge.json)](https://github.com/tomasfarias/airflow-dbt-python/actions)\n[![documentation](https://readthedocs.org/projects/airflow-dbt-python/badge/?version=latest)](https://airflow-dbt-python.readthedocs.io/en/latest/?badge=latest)\n\na collection of [airflow](https://airflow.apache.org/) operators, hooks, and utilities to execute [`dbt`](https://pypi.org/project/dbt-core/) commands.\n\nread the [documentation](https://airflow-dbt-python.readthedocs.io) for examples, installation instructions, and more details.\n\n# installation\n\n## requirements\n\nbefore using *airflow-dbt-python*, ensure you meet the following requirements:\n* a *dbt* project using [dbt-core](https://pypi.org/project/dbt-core/) version 1.4.0 or later.\n* an airflow environment using version 2.2 or later.\n\n  * if using any managed service, like aws mwaa, ensure your environment is created with a supported version of airflow.\n  * if self-hosting, airflow installation instructions can be found in their [official documentation](https://airflow.apache.org/docs/apache-airflow/stable/installation/index.html).\n\n* running python 3.8 or later in your airflow environment.\n\n> **warning**\n>\n> even though we don't impose any upper limits on versions of airflow and *dbt*, it's possible that new versions are not supported immediately after release, particularly for *dbt*. we recommend testing the latest versions before upgrading and [reporting any issues](https://github.com/tomasfarias/airflow-dbt-python/issues/new/choose).\n\n> **note**\n>\n> older versions of airflow and *dbt* may work with *airflow-dbt-python*, although we cannot guarantee this. our testing pipeline runs the latest *dbt-core* with the latest airflow release, and the latest version supported by [aws mwaa](https://aws.amazon.com/managed-workflows-for-apache-airflow/).\n\n## from pypi\n\n*airflow-dbt-python* is available in [pypi](https://pypi.org/project/airflow-dbt-python/) and can be installed with *pip*:\n\n``` shell\npip install airflow-dbt-python\n```\n\nas a convenience, some *dbt* adapters can be installed by specifying extras. for example, if requiring the *dbt-redshift* adapter:\n\n``` shell\npip install airflow-dbt-python[redshift]\n```\n\n## from this repo\n\n*airflow-dbt-python* can also be built from source by cloning this github repository:\n\n``` shell\ngit clone https://github.com/tomasfarias/airflow-dbt-python.git\ncd airflow-dbt-python\n```\n\nand installing with *poetry*:\n\n``` shell\npoetry install\n```\n\n## in aws mwaa\n\nadd *airflow-dbt-python* to your `requirements.txt` file and edit your airflow environment to use this new `requirements.txt` file, or upload it as a plugin.\n\nread the [documentation](https://airflow-dbt-python.readthedocs.io/en/latest/getting_started.html#installing-in-mwaa) for more a more detailed aws mwaa installation breakdown.\n\n## in other managed services\n\n*airflow-dbt-python* should be compatible with most or all airflow managed services. consult the documentation specific to your provider.\n\nif you notice an issue when installing *airflow-dbt-python* in a specific managed service, please open an [issue](https://github.com/tomasfarias/airflow-dbt-python/issues/new/choose).\n\n# features\n\n*airflow-dbt-python* aims to make dbt a **first-class citizen** of airflow by supporting additional features that integrate both tools. as you would expect, *airflow-dbt-python* can run all your dbt workflows in airflow with the same interface you are used to from the cli, but without being a mere wrapper: *airflow-dbt-python* directly communicates with internal *dbt-core* classes, bridging the gap between them and airflow's operator interface. essentially, we are attempting to use *dbt* **as a library**.\n\nas this integration was completed, several features were developed to **extend the capabilities of dbt** to leverage airflow as much as possible. can you think of a way *dbt* could leverage airflow that is not currently supported? let us know in a [github issue](https://github.com/tomasfarias/airflow-dbt-python/issues/new/choose)!\n\n## independent task execution\n\nairflow executes [tasks](https://airflow.apache.org/docs/apache-airflow/stable/concepts/tasks.html) independent of one another: even though downstream and upstream dependencies between tasks exist, the execution of an individual task happens entirely independently of any other task execution (see: [tasks relationships](https://airflow.apache.org/docs/apache-airflow/stable/concepts/tasks.html#relationships)).\n\nin order to work with this constraint, *airflow-dbt-python* runs each dbt command in a **temporary and isolated directory**. before execution, all the relevant dbt files are copied from supported backends, and after executing the command any artifacts are exported. this ensures dbt can work with any airflow deployment, including most production deployments as they are usually running [remote executors](https://airflow.apache.org/docs/apache-airflow/stable/executor/index.html#executor-types) and do not guarantee any files will be shared by default between tasks, since each task may run in a completely different environment.\n\n\n## download dbt files from a remote storage\n\nthe dbt parameters `profiles_dir` and `project_dir` would normally point to a directory containing a `profiles.yml` file and a dbt project in the local environment respectively (defined by the presence of a *dbt_project.yml* file). *airflow-dbt-python* extends these parameters to also accept an url pointing to a remote storage.\n\ncurrently, we support the following remote storages:\n\n* [aws s3](https://aws.amazon.com/s3/) (identified by a *s3* scheme).\n* remote git repositories, like those stored in github (both *https* and *ssh* schemes are supported).\n\n* if a remote url is used for `project_dir`, then this url must point to a location in your remote storage containing a *dbt* project to run. a *dbt* project is identified by the prescence of a *dbt_project.yml*, and contains all your [resources](https://docs.getdbt.com/docs/build/projects). all of the contents of this remote location will be downloaded and made available for the operator. the url may also point to an archived file containing all the files of a dbt project, which will be downloaded, uncompressed, and made available for the operator.\n* if a remote url is used for `profiles_dir`, then this url must point to a location in your remote storage that contains a *profiles.yml* file. the *profiles.yml* file will be downloaded and made available for the operator to use when running. the *profiles.yml* may be part of your *dbt* project, in which case this argument may be ommitted.\n\nthis feature is intended to work in line with airflow's [description of the task concept](https://airflow.apache.org/docs/apache-airflow/stable/concepts/tasks.html#relationships):\n\n> tasks don\u2019t pass information to each other by default, and run entirely independently.\n\nwe interpret this as meaning a task should be responsible of fetching all the *dbt* related files it needs in order to run independently, as already described in [independent task execution](#independent-task-execution).\n\n## push dbt artifacts to xcom\n\neach dbt execution produces one or more [json artifacts](https://docs.getdbt.com/reference/artifacts/dbt-artifacts/) that are valuable to produce meta-metrics, build conditional workflows, for reporting purposes, and other uses. *airflow-dbt-python* can push these artifacts to [xcom](https://airflow.apache.org/docs/apache-airflow/stable/concepts/xcoms.html) as requested via the `do_xcom_push_artifacts` parameter, which takes a list of artifacts to push.\n\n## use airflow connections as dbt targets (without a profiles.yml)\n\n[airflow connections](https://airflow.apache.org/docs/apache-airflow/stable/howto/connection.html) allow users to manage and store connection information, such as hostname, port, username, and password, for operators to use when accessing certain applications, like databases. similarly, a *dbt* `profiles.yml` file stores connection information under each target key. *airflow-dbt-python* bridges the gap between the two and allows you to use connection information stored as an airflow connection by specifying the connection id as the `target` parameter of any of the *dbt* operators it provides. what's more, if using an airflow connection, the `profiles.yml` file may be entirely omitted (although keep in mind a `profiles.yml` file contains a configuration block besides target connection information).\n\nsee an example dag [here](examples/airflow_connection_target_dag.py).\n\n# motivation\n\n## airflow running in a managed environment\n\nalthough [`dbt`](https://docs.getdbt.com/) is meant to be installed and used as a cli, we may not have control of the environment where airflow is running, disallowing us the option of using *dbt* as a cli.\n\nthis is exactly what happens when using [amazon's managed workflows for apache airflow](https://aws.amazon.com/managed-workflows-for-apache-airflow/) or mwaa: although a list of python requirements can be passed, the cli cannot be found in the worker's path.\n\nthere is a workaround which involves using airflow's `bashoperator` and running python from the command line:\n\n``` python\nfrom airflow.operators.bash import bashoperator\n\nbash_command = \"python -c 'from dbt.main import main; main()' run\"\noperator = bashoperator(\n    task_id=\"dbt_run\",\n    bash_command=bash_command,\n)\n```\n\nbut it can get cumbersome when appending all potential arguments a `dbt run` command (or other subcommand) can take.\n\nthat's where *airflow-dbt-python* comes in: it abstracts the complexity of interfacing with *dbt-core* and exposes one operator for each *dbt* subcommand that can be instantiated with all the corresponding arguments that the *dbt* cli would take.\n\n## an alternative to *airflow-dbt* that works without the *dbt* cli\n\nthe alternative [`airflow-dbt`](https://pypi.org/project/airflow-dbt/) package, by default, would not work if the *dbt* cli is not in path, which means it would not be usable in mwaa. there is a workaround via the `dbt_bin` argument, which can be set to `\"python -c 'from dbt.main import main; main()' run\"`, in similar fashion as the `bashoperator` example. yet this approach is not without its limitations:\n* *airflow-dbt* works by wrapping the *dbt* cli, which makes our code dependent on the environment in which it runs.\n* *airflow-dbt* does not support the full range of arguments a command can take. for example, `dbtrunoperator` does not have an attribute for `fail_fast`.\n* *airflow-dbt* does not offer access to *dbt* artifacts created during execution. *airflow-dbt-python* does so by pushing any artifacts to [xcom](https://airflow.apache.org/docs/apache-airflow/stable/concepts/xcoms.html).\n\n# usage\n\ncurrently, the following *dbt* commands are supported:\n\n* `clean`\n* `compile`\n* `debug`\n* `deps`\n* `docs generate`\n* `ls`\n* `parse`\n* `run`\n* `run-operation`\n* `seed`\n* `snapshot`\n* `source`\n* `test`\n\n## examples\n\nall example dags are tested against the latest airflow version. some changes, like modifying `import` statements or changing types, may be required for them to work in other versions.\n\n``` python\nimport datetime as dt\n\nimport pendulum\nfrom airflow import dag\n\nfrom airflow_dbt_python.operators.dbt import (\n    dbtrunoperator,\n    dbtseedoperator,\n    dbttestoperator,\n)\n\nargs = {\n    \"owner\": \"airflow\",\n}\n\nwith dag(\n    dag_id=\"example_dbt_operator\",\n    default_args=args,\n    schedule=\"0 0 * * *\",\n    start_date=pendulum.today(\"utc\").add(days=-1),\n    dagrun_timeout=dt.timedelta(minutes=60),\n    tags=[\"example\", \"example2\"],\n) as dag:\n    dbt_test = dbttestoperator(\n        task_id=\"dbt_test\",\n        selector_name=\"pre-run-tests\",\n    )\n\n    dbt_seed = dbtseedoperator(\n        task_id=\"dbt_seed\",\n        select=[\"/path/to/first.csv\", \"/path/to/second.csv\"],\n        full_refresh=true,\n    )\n\n    dbt_run = dbtrunoperator(\n        task_id=\"dbt_run\",\n        select=[\"/path/to/models\"],\n        full_refresh=true,\n        fail_fast=true,\n    )\n\n    dbt_test >> dbt_seed >> dbt_run\n```\n\nmore examples can be found in the [`examples/`](examples/) directory and the [documentation](https://airflow-dbt-python.readthedocs.io).\n\n# development\n\nsee the [development documentation](https://airflow-dbt-python.readthedocs.io/en/latest/development.html) for a more in-depth dive into setting up a development environment, running the test-suite, and general commentary on working on *airflow-dbt-python*.\n\n## testing\n\ntests are run with *pytest*, can be located in `tests/`. to run them locally, you may use *poetry*:\n\n``` shell\npoetry run pytest tests/ -vv\n```\n\n# license\n\nthis project is licensed under the mit license. see [license](license).\n",
  "docs_url": null,
  "keywords": "",
  "license": "mit",
  "name": "airflow-dbt-python",
  "package_url": "https://pypi.org/project/airflow-dbt-python/",
  "project_url": "https://pypi.org/project/airflow-dbt-python/",
  "project_urls": {
    "Homepage": "https://github.com/tomasfarias/airflow-dbt-python",
    "Repository": "https://github.com/tomasfarias/airflow-dbt-python"
  },
  "release_url": "https://pypi.org/project/airflow-dbt-python/2.0.0/",
  "requires_dist": [
    "apache-airflow (>=2.2)",
    "apache-airflow-providers-amazon (>=3.0.0) ; extra == \"airflow-providers\" or extra == \"s3\"",
    "apache-airflow-providers-ssh (>=3.0.0) ; extra == \"airflow-providers\" or extra == \"git\"",
    "connexion (<3.0)",
    "dulwich (>=0.21) ; extra == \"git\"",
    "contextlib-chdir (==1.0.2) ; python_version < \"3.11\"",
    "dbt-core (>=1.4.0,<1.6.0) ; python_version < \"3.8\"",
    "dbt-core (>=1.4.0,<1.8.0) ; python_version >= \"3.11\"",
    "dbt-bigquery (>=1.4.0,<1.6.0) ; (python_version < \"3.8\") and (extra == \"adapters\" or extra == \"bigquery\")",
    "dbt-bigquery (>=1.4.0,<1.8.0) ; (python_version >= \"3.11\") and (extra == \"adapters\" or extra == \"bigquery\")",
    "dbt-postgres (>=1.4.0,<1.6.0) ; (python_version < \"3.8\") and (extra == \"adapters\" or extra == \"postgres\")",
    "dbt-postgres (>=1.4.0,<1.8.0) ; (python_version >= \"3.11\") and (extra == \"adapters\" or extra == \"postgres\")",
    "dbt-redshift (>=1.4.0,<1.6.0) ; (python_version < \"3.8\") and (extra == \"adapters\" or extra == \"redshift\")",
    "dbt-redshift (>=1.4.0,<1.8.0) ; (python_version >= \"3.11\") and (extra == \"adapters\" or extra == \"redshift\")",
    "dbt-snowflake (>=1.4.0,<1.6.0) ; (python_version < \"3.8\") and (extra == \"adapters\" or extra == \"snowflake\")",
    "dbt-snowflake (>=1.4.0,<1.8.0) ; (python_version >= \"3.11\") and (extra == \"adapters\" or extra == \"snowflake\")",
    "dbt-spark (>=1.4.0,<1.6.0) ; (python_version < \"3.8\") and (extra == \"adapters\" or extra == \"spark\")",
    "dbt-spark (>=1.4.0,<1.8.0) ; (python_version >= \"3.11\") and (extra == \"adapters\" or extra == \"spark\")"
  ],
  "requires_python": ">=3.8,<3.12",
  "summary": "a collection of airflow operators, hooks, and utilities to execute dbt commands",
  "version": "2.0.0",
  "releases": [],
  "developers": [
    "tomas@tomasfarias.dev"
  ],
  "kwds": "airflow_dbt_python airflow airflow_connection_target_dag badge shields",
  "license_kwds": "mit",
  "libtype": "pypi",
  "id": "pypi_airflow_dbt_python",
  "homepage": "https://github.com/tomasfarias/airflow-dbt-python",
  "release_count": 63,
  "dependency_ids": [
    "pypi_apache_airflow",
    "pypi_apache_airflow_providers_amazon",
    "pypi_apache_airflow_providers_ssh",
    "pypi_connexion",
    "pypi_contextlib_chdir",
    "pypi_dbt_bigquery",
    "pypi_dbt_core",
    "pypi_dbt_postgres",
    "pypi_dbt_redshift",
    "pypi_dbt_snowflake",
    "pypi_dbt_spark",
    "pypi_dulwich"
  ]
}