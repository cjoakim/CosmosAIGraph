{
  "classifiers": [
    "intended audience :: developers",
    "license :: osi approved :: bsd license",
    "license :: other/proprietary license",
    "operating system :: os independent",
    "programming language :: python",
    "programming language :: python :: 3",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9",
    "topic :: database",
    "topic :: database :: database engines/servers"
  ],
  "description": "\n<img src=\"artwork/logo.png\" alt=\"drawing\" width=\"600\"/>\n\n[![python package](https://github.com/davidlatwe/montydb/actions/workflows/python-package.yml/badge.svg)](https://github.com/davidlatwe/montydb/actions/workflows/python-package.yml)\n[![version](http://img.shields.io/pypi/v/montydb.svg?style=flat)](https://pypi.python.org/pypi/montydb)\n[![pypi downloads](https://img.shields.io/pypi/dm/montydb)](https://pypistats.org/packages/montydb)\n\n> monty, mongo tinified. mongodb implemented in python!\n\n_inspired by [tinydb](https://github.com/msiemens/tinydb) and it's extension [tinymongo](https://github.com/schapman1974/tinymongo)_\n\n\n## what is it?\n\na pure python-implemented database that looks and works like [mongodb](https://www.mongodb.com/).\n\n```python\n>>> from montydb import montyclient\n\n>>> col = montyclient(\":memory:\").db.test\n>>> col.insert_many( [{\"stock\": \"a\", \"qty\": 6}, {\"stock\": \"a\", \"qty\": 2}] )\n>>> cur = col.find( {\"stock\": \"a\", \"qty\": {\"$gt\": 4}} )\n>>> next(cur)\n{'_id': objectid('5ad34e537e8dd45d9c61a456'), 'stock': 'a', 'qty': 6}\n```\n\nmost of the crud operators have been implemented. you can visit [issue #14](https://github.com/davidlatwe/montydb/issues/14) to see the full list.\n\nthis project is tested against:\n\n- mongodb: 3.6, 4.0, 4.2 (4.4 on the way\ud83d\udca6)\n- python: 3.7, 3.8, 3.9, 3.10, 3.11\n\n\n## install\n\n```sh\npip install montydb\n```\n\n- optional, to use *real* `bson` in operation (`pymongo` will be installed)\n    _for minimum requirements, `montydb` ships with it's own fork of `objectid` in `montydb.types`, so you may ignore this option if `objectid` is all you need from `bson`_\n\n    ```sh\n    pip install montydb[bson]\n    ```\n- optional, to use lightning memory-mapped db as storage engine\n    ```sh\n    pip install montydb[lmdb]\n    ```\n\n\n## storage\n\n\ud83e\udd84 available storage engines:\n\n* in-memory\n* flat-file\n* sqlite\n* lmdb (lightning memory-mapped db)\n\ndepending on which one you use, you may have to configure the storage engine before you start.\n\n> \u26a0\ufe0f\n>\n> the configuration process only required on repository creation or modification. and, one repository (the parent level of databases) can only assign one storage engine.\n\nto configure a storage, see flat-file storage for example:\n\n```python\nfrom montydb import set_storage, montyclient\n\n\nset_storage(\n    # general settings\n    \n    repository=\"/db/repo\",  # dir path for database to live on disk, default is {cwd}\n    storage=\"flatfile\",     # storage name, default \"flatfile\"\n    mongo_version=\"4.0\",    # try matching behavior with this mongodb version\n    use_bson=false,         # default none, and will import pymongo's bson if none or true\n\n    # any other kwargs are storage engine settings.\n    \n    cache_modified=10,       # the only setting that flat-file have\n)\n\n# ready to go\n```\n\nonce that done, there should be a file named `monty.storage.cfg` saved in your db repository path. it would be `/db/repo` for the above examples.\n\n\n## configuration\n\nnow let's moving on to each storage engine's config settings.\n\n### \ud83c\udf1f in-memory\n  \n`memory` storage does not need nor have any configuration, nothing saved to disk.\n\n```python\nfrom montydb import montyclient\n\n\nclient = montyclient(\":memory:\")\n\n# ready to go\n```\n\n### \ud83d\udd30 flat-file\n  \n`flatfile` is the default on-disk storage engine.\n\n```python\nfrom montydb import set_storage, montyclient\n\n\nset_storage(\"/db/repo\", cache_modified=5)  # optional step\nclient = montyclient(\"/db/repo\")  # use current working dir if no path given\n\n# ready to go\n```\n\nflatfile config:\n\n```ini\n[flatfile]\ncache_modified: 0  # how many document crud cached before flush to disk.\n```\n\n### \ud83d\udc8e sqlite\n  \n`sqlite` is not the default on-disk storage, need configuration first before getting client.\n\n> pre-existing sqlite storage file which saved by `montydb<=1.3.0` is not read/writeable after `montydb==2.0.0`.\n\n```python\nfrom montydb import set_storage, montyclient\n\n\nset_storage(\"/db/repo\", storage=\"sqlite\")  # required, to set sqlite as engine\nclient = montyclient(\"/db/repo\")\n\n# ready to go\n```\n\nsqlite config:\n\n```ini\n[sqlite]\njournal_mode = wal\ncheck_same_thread =   # leave it empty as false, or any value will be true\n```\nor,\n\n```python\nrepo = \"path_to/repo\"\nset_storage(\n    repository=repo,\n    storage=\"sqlite\",\n    use_bson=true,\n    # sqlite pragma\n    journal_mode=\"wal\",\n    # sqlite connection option\n    check_same_thread=false,\n)\nclient = montyclient(repo)\n...\n```\n\nsqlite write concern:\n\n```python\nclient = montyclient(\"/db/repo\",\n                     synchronous=1,\n                     automatic_index=false,\n                     busy_timeout=5000)\n```\n\n### \ud83d\ude80 lmdb (lightning memory-mapped database)\n\n`lightning` is not the default on-disk storage, need configuration first before get client.\n\n> newly implemented.\n\n```python\nfrom montydb import set_storage, montyclient\n\n\nset_storage(\"/db/repo\", storage=\"lightning\")  # required, to set lightning as engine\nclient = montyclient(\"/db/repo\")\n\n# ready to go\n```\n\nlmdb config:\n\n```ini\n[lightning]\nmap_size: 10485760  # maximum size database may grow to.\n```\n\n## uri\n\noptionally, you could prefix the repository path with montydb uri scheme.\n\n```python\nclient = montyclient(\"montydb:///db/repo\")\n```\n\n## utilities\n\n> pymongo `bson` may required.\n\n* #### `montyimport`\n\n  imports content from an extended json file into a montycollection instance.\n  the json file could be generated from `montyexport` or `mongoexport`.\n\n  ```python\n  from montydb import open_repo, utils\n  \n\n  with open_repo(\"foo/bar\"):\n      utils.montyimport(\"db\", \"col\", \"/path/dump.json\")\n  \n  ```\n\n* #### `montyexport`\n\n  produces a json export of data stored in a montycollection instance.\n  the json file could be loaded by `montyimport` or `mongoimport`.\n\n  ```python\n  from montydb import open_repo, utils\n  \n\n  with open_repo(\"foo/bar\"):\n      utils.montyexport(\"db\", \"col\", \"/data/dump.json\")\n  \n  ```\n\n* #### `montyrestore`\n\n  loads a binary database dump into a montycollection instance.\n  the bson file could be generated from `montydump` or `mongodump`.\n\n  ```python\n  from montydb import open_repo, utils\n  \n\n  with open_repo(\"foo/bar\"):\n      utils.montyrestore(\"db\", \"col\", \"/path/dump.bson\")\n  \n  ```\n\n* ####  `montydump`\n\n  creates a binary export from a montycollection instance.\n  the bson file could be loaded by `montyrestore` or `mongorestore`.\n\n  ```python\n  from montydb import open_repo, utils\n  \n\n  with open_repo(\"foo/bar\"):\n      utils.montydump(\"db\", \"col\", \"/data/dump.bson\")\n  \n  ```\n\n* #### `mongoqueryrecorder`\n\n  record mongodb query results in a period of time.\n  *requires to access database profiler.*\n\n  this works via filtering the database profile data and reproduce the queries of `find` and `distinct` commands.\n\n  ```python\n  from pymongo import mongoclient\n  from montydb.utils import mongoqueryrecorder\n  \n  client = mongoclient()\n  recorder = mongoqueryrecorder(client[\"mydb\"])\n  recorder.start()\n  \n  # make some queries or run the app...\n  recorder.stop()\n  recorder.extract()\n  {<collection_1>: [<doc_1>, <doc_2>, ...], ...}\n  \n  ```\n\n* ####  `montylist`\n\n  experimental, a subclass of `list`, combined the common crud methods from mongo's collection and cursor.\n\n  ```python\n  from montydb.utils import montylist\n  \n  mtl = montylist([1, 2, {\"a\": 1}, {\"a\": 5}, {\"a\": 8}])\n  mtl.find({\"a\": {\"$gt\": 3}})\n  montylist([{'a': 5}, {'a': 8}])\n  \n  ```\n\n## development\n\nmontydb uses [poetry](https://python-poetry.org/) to make it easy manage dependencies and set up the development environment. \n\n### initial setup\n\nafter cloning the repository, you need to run the following commands to set up the development environment:\n\n```bash\nmake install\n```\n\nthis will create a virtual environment and download the required dependencies.\n\n### updating dependencies\n\nto keep dependencies updated after git operations such as local updates or merging changes into local dev branch\n\n```bash\nmake update\n```\n### makefile\n\na makefile is used to simplify common operations such as updating, testing, and deploying etc.\n\n```bash\nmake or make help\n\ninstall                        install all dependencies locally\nupdate                         update project dependencies locally (run after git update)\nci                             run all checks (codespell, lint, bandit, test)\ntest                           run tests\nlint                           run linting with flake8\ncodespell                      find typos with codespell\nbandit                         run static security analysis with bandit\nbuild                          build project using poetry\nclean                          clean project\n```\n\n### run mongo docker image\nmost of our tests compare montydb crud results against real mongodb instance, therefore we must have a running\nmongodb before testing.\n\nfor example, if we want to test against mongo 4.4:\n```shell\ndocker run --name monty-4.4 -p 30044:27017 -d mongo:4.4\n```\n\n### tests\n```shell\npoetry run pytest --storage {storage engin name} --mongodb {mongo instance url} [--use-bson]\n```\nexample:\n```shell\npoetry run pytest --storage memory --mongodb localhost:30044 --use-bson\n```\n\n## why did i make this?\n\nmainly for personal skill practicing and fun.\n\ni work in the vfx industry and some of my production needs (mostly edge-case) requires to run in a limited environment (e.g. outsourced render farms), which may have problem to run or connect a mongodb instance. and i found this project really helps.\n\n---\n\n<p align=center>\n    <a href=\"https://jb.gg/opensource\"><i>this project is supported by jetbrains</i></a>\n</p>\n\n<p align=\"center\">\n    <img src=\"artwork/icon.png\" alt=\"drawing\" width=\"100\"/>\n  &nbsp;&nbsp;\n    <img src=\"artwork/jetbrains.png\" alt=\"drawing\" width=\"100\"/>\n</p>\n",
  "docs_url": null,
  "keywords": "monty,montydb,pymongo,mongodb,database,embedded",
  "license": "bsd-3-clause license",
  "name": "montydb",
  "package_url": "https://pypi.org/project/montydb/",
  "project_url": "https://pypi.org/project/montydb/",
  "project_urls": {
    "Homepage": "https://github.com/davidlatwe/montydb",
    "Repository": "https://github.com/davidlatwe/montydb"
  },
  "release_url": "https://pypi.org/project/montydb/2.5.2/",
  "requires_dist": [],
  "requires_python": ">=3.7,<3.12",
  "summary": "monty, mongo tinified. mongodb implemented in python !",
  "version": "2.5.2",
  "releases": [],
  "developers": [
    "davidlatwe",
    "davidlatwe@gmail.com"
  ],
  "kwds": "mongodump mongo montycollection mongoimport montydb",
  "license_kwds": "bsd-3-clause license",
  "libtype": "pypi",
  "id": "pypi_montydb",
  "homepage": "https://github.com/davidlatwe/montydb",
  "release_count": 27,
  "dependency_ids": []
}