{
  "classifiers": [
    "development status :: 5 - production/stable",
    "intended audience :: developers",
    "intended audience :: system administrators",
    "license :: osi approved :: apache software license",
    "operating system :: os independent",
    "programming language :: python :: 3",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9",
    "topic :: software development :: libraries",
    "topic :: utilities"
  ],
  "description": "# aws-assume-role-lib\n**assumed role session chaining (with credential refreshing) for boto3**\n\nthe typical way to use boto3 when programmatically assuming a role is to explicitly call [`sts.assumerole`](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sts.html#sts.client.assume_role) and use the returned credentials to create a new [`boto3.session`](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html) or client.\nit looks like this mess of code:\n\n```python\nrole_arn = \"arn:aws:iam::123456789012:role/myrole\"\nsession = boto3.session()\n\nsts = session.client(\"sts\")\nresponse = sts.assume_role(\n    rolearn=role_arn,\n    rolesessionname=\"something_you_have_to_think_about\"\n)\n\ncredentials = response[\"credentials\"]\n\nassumed_role_session = boto3.session(\n    aws_access_key_id=credentials[\"accesskeyid\"],\n    aws_secret_access_key=credentials[\"secretaccesskey\"],\n    aws_session_token=credentials[\"sessiontoken\"]\n)\n\n# use the session\nprint(assumed_role_session.client(\"sts\").get_caller_identity())\n```\n\nthis code is verbose, requires specifying a role session name even if you don't care what it is, and must explicitly handle credential expiration and refreshing if needed (in a lambda function, this is typically handled by calling `assumerole` in every invocation).\n\nwith `aws-assume-role-lib`, all that collapses down to a single line. the assumed role session automatically refreshes expired credentials and generates a role session name if one is not provided.\n\n```python\nrole_arn = \"arn:aws:iam::123456789012:role/myrole\"\nsession = boto3.session()\n\nassumed_role_session = aws_assume_role_lib.assume_role(session, role_arn)\n\n# use the session\nprint(assumed_role_session.client(\"sts\").get_caller_identity())\n```\n\nin a lambda function that needs to assume a role, you can create the assumed role session during initialization and use it for the lifetime of the execution environment, with `assumerole` calls only being made when necessary, not on every invocation.\n\nnote that in `~/.aws/config`, [you have the option to have profiles that assume a role based on another profile](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html), and this automatically handles refreshing expired credentials as well.\n\nif you've only used `boto3.client()` and are not familiar with boto3 sessions, [here's an explainer](https://ben11kehoe.medium.com/boto3-sessions-and-why-you-should-use-them-9b094eb5ca8e).\n\n# installation\n\n```bash\npip install --user aws-assume-role-lib\n```\n\nor just add [`aws_assume_role_lib.py`](https://raw.githubusercontent.com/benkehoe/aws-assume-role-lib/stable/aws_assume_role_lib/aws_assume_role_lib.py) to your project.\n\nview the release history [here](changelog.md).\n\n# usage\n\n```python\nimport boto3\nfrom aws_assume_role_lib import assume_role\n\n# get a session\nsession = boto3.session()\n# or with a profile:\n# session = boto3.session(profile_name=\"my-profile\")\n\n# assume the session\nassumed_role_session = assume_role(session, \"arn:aws:iam::123456789012:role/myrole\")\n\n# do stuff with the original credentials\nprint(session.client(\"sts\").get_caller_identity()[\"arn\"])\n\n# do stuff with the assumed role\nprint(assumed_role_session.client(\"sts\").get_caller_identity()[\"arn\"])\n```\n\nin lambda, initialize the sessions outside the handler, and `assumerole` will only get called when necessary, rather than on every invocation:\n```python\nimport os\nimport boto3\nfrom aws_assume_role_lib import assume_role, generate_lambda_session_name\n\n# get the lambda session\nsession = boto3.session()\n\n# get the config\nrole_arn = os.environ[\"role_arn\"]\nrole_session_name = generate_lambda_session_name() # see below for details\n\n# assume the session\nassumed_role_session = assume_role(session, role_arn, rolesessionname=role_session_name)\n\ndef handler(event, context):\n    # do stuff with the lambda role using session\n    print(session.client(\"sts\").get_caller_identity()[\"arn\"])\n\n    # do stuff with the assumed role using assumed_role_session\n    print(assumed_role_session.client(\"sts\").get_caller_identity()[\"arn\"])\n```\nlearn more about the benefits of `aws-assume-role-lib` in lambda functions in the [demo](lambda-demo/readme.md).\n\n# interface\n\n```\nassume_role(\n    # required arguments\n    session:           boto3.session,\n    rolearn:           str,\n\n    *,\n    # keyword-only arguments for assumerole\n    rolesessionname:   str                                    = none,\n    policyarns:        union[list[dict[str, str]], list[str]] = none,\n    policy:            union[str, dict]                       = none,\n    durationseconds:   union[int, datetime.timedelta]         = none,\n    tags:              list[dict[str, str]]                   = none,\n    transitivetagkeys: list[str]                              = none,\n    externalid:        str                                    = none,\n    serialnumber:      str                                    = none,\n    tokencode:         str                                    = none,\n    sourceidentity:    str                                    = none,\n    additional_kwargs: dict                                   = none,\n\n    # keyword-only arguments for returned session\n    region_name:       union[str, bool]                       = none,\n\n    # keyword-only arguments for assume_role() itself\n    validate:          bool                                   = true,\n    cache:             dict                                   = none,\n)\n```\n\n`assume_role()` takes a session and a role arn, and optionally [other keyword arguments for `sts.assumerole`](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sts.html#sts.client.assume_role).\n\nunlike the `assumerole` api call itself, `rolearn` is required, but `rolesessionname` is not.\nthe `rolesessionname` is set for you if it is not provided; it will use the [`sourceidentity`](https://docs.aws.amazon.com/iam/latest/userguide/id_credentials_temp_control-access_monitor.html) if that is provided, otherwise it will generated.\nif you want this generated value for `rolesessionname` when `sourceidentity` is provided (the behavior in v2.8 and before), set `rolesessionname` to the special value `aws_assume_role_lib.automatic_role_session_name`.\n\nnote that unlike the boto3 sts client method, you can provide the `policy` parameter (the [inline session policy](https://docs.aws.amazon.com/iam/latest/userguide/access_policies.html#policies_session)) as a `dict` instead of as a serialized json string, `policyarns` as a list of arns, and `durationseconds` as a `datetime.timedelta` instead of as an integer.\n\nby default, the session returned by `assume_role()` links its region configuration to the input session.\nif you would like to set the region explicitly, pass it in the `region_name` parameter.\n\nnote that if the parent session was created without a region passed in to the `session` constructor, it has an implicit region, based on searching potential configuration locations.\nthis means that the region used by the session can change (for example, if you set or change `os.environ[\"aws_default_region\"]`).\nby default, the child session region is linked to the parent session, so if the parent session has an implicit region, or if the parent session's region is changed directly, they would both change.\nif you would like to fix the child session region to be explicitly the current value, pass `region_name=true`.\nif, for some reason, you have an explicit region set on the parent, and want the child to have implicit region config, pass `region_name=false`.\n\nby default, `assume_role()` checks if the parameters are invalid.\nwithout this validation, errors for these issues are more confusingly raised when the child session is first used to make an api call (boto3 doesn't make the call to retrieve credentials until they are needed).\nhowever, this incurs a small time penalty, so parameter validation can be disabled by passing `validate=false`.\n\nif any new arguments are added to `assumerole` in the future and this library is not updated to allow them directly, they can be passed in as a dict via the `additional_kwargs` argument.\n\nthe parent session is available on the child session in the `assume_role_parent_session` property.\nnote this property is added by this library; ordinary boto3 sessions do not have it.\n\n# patching boto3\n\nyou can make the `assume_role()` function available directly in boto3 by calling `patch_boto3()`.\nthis creates a `boto3.assume_role(rolearn, ...)` function (note that it does not take a session, it uses the same default session as `boto3.client()`), and adds a `boto3.session.assume_role()` method.\nso usage for that looks like:\n\n```python\nimport boto3\nimport aws_assume_role_lib\naws_assume_role_lib.patch_boto3()\n\nassumed_role_session = boto3.assume_role(\"arn:aws:iam::123456789012:role/myrole\")\n# the above is basically equivalent to:\n# aws_assume_role_lib.assume_role(boto3.session(), \"arn:aws:iam::123456789012:role/myrole\")\n\nsession = boto3.session(profile_name=\"my-profile\")\nassumed_role_session = session.assume_role(\"arn:aws:iam::123456789012:role/myrole\")\n```\n\n# role session names for lambda functions\nlearn more about the benefits of `aws-assume-role-lib` in lambda functions in the [demo](lambda-demo/readme.md).\n\nif you don't provide a role session name, but you provide a [`sourceidentity`](https://docs.aws.amazon.com/iam/latest/userguide/id_credentials_temp_control-access_monitor.html), this value is used for the role session name as well.\nif `sourceidentity` is not provided either, the underlying `botocore` library [generates one using a timestamp](https://github.com/boto/botocore/blob/c53072ec257ef47e2fc749c384a9488fd3f3e626/botocore/credentials.py#l730).\nthat's the best it can do, because it doesn't have any other context.\n\nbut in a lambda function, we do have additional context, the lambda function itself.\nif you call `generate_lambda_session_name()` inside an instance of a lambda function, it returns a session name that corresponds to the function instance, which you can use when assuming a role in the lambda function (either with this library's `assume_role()` or any other method).\nthe purpose of this is to simplify tracing usage of the session back to the function instance.\n\nthe returned value is in one of the following forms, depending on the length of the values, to keep the session name within the maximum of 64 characters:\n* `{function_name}`\n* `{function_name}.{identifier}`\n* `{function_name}.{function_version}.{identifier}`\n\nthe function version is never included if it is `$latest`.\n\nthe maximum role session name length is 64 characters. to ensure this, and\nto provide at least 4 characters of the identifier when it is used, the\nfollowing rules apply, in order:\n1. if the function name is longer than 59 characters, the session name is the truncated function name.\n2. if the function name plus the function version is longer than 59 characters, the session name is the function name plus the identifier, truncated.\n3. otherwise, the session name is the function name plus the version (if one is found and not $latest) plus the identifier, truncated.\n\nthe identifier is the function instance's unique id taken from the cloudwatch log stream name; if this cannot be found, it's a timestamp if the identifier can be at least 14 characters long (to provide for second-level precision), otherwise it is a random string.\nthe identifier will not be included unless at least 4 characters\n\nthe values are automatically extracted from [the relevant environment variables](https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars.html#configuration-envvars-runtime); you can override any of them by providing them as arguments to the function.\n\n# arn formatting\n`assume_role()` requires a role arn, and if you know the role name and account id but have trouble remembering the [exact format of role arns](https://docs.aws.amazon.com/service-authorization/latest/reference/list_identityandaccessmanagement.html#identityandaccessmanagement-resources-for-iam-policies), there's `get_role_arn()` for you.\nthere's additionally a `get_assumed_role_session_arn()` for formatting assumed role session arns.\n\n```\nget_role_arn(\n    account_id: union[str, int],\n    role_name:  str,\n    path:       str             = \"\",\n    partition:  str             = \"aws\",\n)\n\nget_assumed_role_session_arn(\n    account_id:        union[str, int],\n    role_name:         str,\n    role_session_name: str,\n    partition:         str             = \"aws\",\n)\n```\n\nfor `get_role_arn()`, if the role name has a path, it can be provided as part of the name or as the separate `path` argument (but not both).\nassumed role session arns do not include the role path; if it is used in the role name it is removed.\n\n# caching\n\nif you would like to cache the credentials on the file system, you can use the `jsonfilecache` class, which will create files under the directory you provide in the constructor (which it will create if it doesn't exist).\nuse it like:\n```python\nassumed_role_session = assume_role(session, \"arn:aws:iam::123456789012:role/myrole\", cache=jsonfilecache(\"path/to/dir\"))\n```\nyou can also use any `dict`-like object for the cache (supporting `__getitem__`/`__setitem__`/`__contains__`).\n\n# command line use\n`aws-assume-role-lib` has basic support for retrieving assumed role credentials from the command line.\nin general, it's better to make profiles in `~/.aws/config` for role assumption, like this:\n\n```ini\n# this is a pre-existing profile you already have\n[profile profile-to-call-assume-role-with]\n# maybe it's iam user credentials\n# or aws sso config\n# or whatever else you may have\n\n[profile my-assumed-role]\nrole_arn = arn:aws:iam::123456789012:role/myrole\n# optional: role_session_name = myrolesessionname\n\nsource_profile = profile-to-call-assume-role-with\n# or instead of source_profile, you can tell it to\n# use external credentials. one of:\n# credential_source = environment\n# credential_source = ec2instancemetadata\n# credential_source = ecscontainer\n```\n\nyou can use `my-assumed-role` like any other profile.\nit uses the aws sdks' built-in support for role assumption, rather than relying on this third party library.\nit also gets you credential refreshing from the sdks, where getting the credentials in the manner below cannot refresh them when they expire.\n\nbut if you absolutely must have ad hoc role assumption on the command line, use the module invocation syntax `python -m aws_assume_role_lib role_arn [options]`.\n\nthe options are:\n* `--profile`: use a specific configuration profile.\n* `--env`: print the credentials as environment variables (the default), suitable for `export $(python -m aws_assume_role_lib ...)`.\n* `--json`: print the credentials in [`credential_process`-formatted json format](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sourcing-external.html). note that you don't normally need to use this as a `credential_process` in a profile, because you can just directly make the profile do role assumption as shown above.\n* the remaining options are the arguments to `assume_role()`:\n  * `--rolesessionname`\n  * `--policyarns`: must be a comma-separated list of arns, a json list of arns, or a json object per the api\n  * `--policy`: must be a json object\n  * `--durationseconds`\n  * `--tags`: must be formatted as `key1=value1,key2=value2`, or a json object.\n  * `--transitivetagkeys`: must be a comma-separated list or a json list.\n  * `--externalid`\n  * `--serialnumber`\n  * `--tokencode`\n  * `--sourceidentity`\n  * `--additional-kwargs`: must be a json object.\n\n",
  "docs_url": null,
  "keywords": "",
  "license": "apache-2.0",
  "name": "aws-assume-role-lib",
  "package_url": "https://pypi.org/project/aws-assume-role-lib/",
  "project_url": "https://pypi.org/project/aws-assume-role-lib/",
  "project_urls": {
    "Homepage": "https://github.com/benkehoe/aws-assume-role-lib",
    "Repository": "https://github.com/benkehoe/aws-assume-role-lib"
  },
  "release_url": "https://pypi.org/project/aws-assume-role-lib/2.10.0/",
  "requires_dist": [
    "boto3 (>=1.17.51,<2.0.0)"
  ],
  "requires_python": ">=3.6,<4.0",
  "summary": "assumed role session chaining (with credential refreshing) for boto3",
  "version": "2.10.0",
  "releases": [],
  "developers": [
    "ben@kehoe.io",
    "ben_kehoe"
  ],
  "kwds": "aws_session_token assumed_role_session boto3 aws_assume_role_lib get_assumed_role_session_arn",
  "license_kwds": "apache-2.0",
  "libtype": "pypi",
  "id": "pypi_aws_assume_role_lib",
  "homepage": "https://github.com/benkehoe/aws-assume-role-lib",
  "release_count": 11,
  "dependency_ids": [
    "pypi_boto3"
  ]
}