{
  "classifiers": [
    "license :: osi approved :: mit license",
    "operating system :: os independent",
    "programming language :: python :: 3.8"
  ],
  "description": "# prometheus-api-client\n\n[![pypi version](https://badge.fury.io/py/prometheus-api-client.svg)](https://badge.fury.io/py/prometheus-api-client) [![pypi download month](https://img.shields.io/pypi/dm/prometheus-api-client.svg)](https://pypi.python.org/pypi/prometheus-api-client/)\n\na python wrapper for the prometheus http api and some tools for metrics processing.\n\n## installation\n\nto install the latest release:\n\n`pip install prometheus-api-client`\n\nto install directly from this branch:\n\n`pip install https://github.com/4n4nd/prometheus-api-client-python/zipball/master`\n\n## links\n\n- [slack](https://join.slack.com/share/zt-kw3v8t1e-hbcvh7x7bxoriquqtsnz4a)\n- [google chat](https://chat.google.com/room/aaaazfpwq5s)\n- [documentation](https://prometheus-api-client-python.readthedocs.io/en/master/source/prometheus_api_client.html)\n\n## getting started\n\n### usage\n[prometheus](https://prometheus.io/), a cloud native computing foundation project, is a systems and service monitoring system. it collects metrics (time series data) from configured targets at given intervals, evaluates rule expressions, displays the results, and can trigger alerts if some condition is observed to be true. the raw time series data obtained from a prometheus host can sometimes be hard to interpret. to help better understand these metrics we have created a python wrapper for the prometheus http api for easier metrics processing and analysis.\n\nthe `prometheus-api-client` library consists of multiple modules which assist in connecting to a prometheus host, fetching the required metrics and performing various aggregation operations on the time series data.\n\n#### connecting and collecting metrics from a prometheus host\nthe `prometheusconnect` module of the library can be used to connect to a prometheus host. this module is essentially a class created for the collection of metrics from a prometheus host. it stores the following connection parameters:\n\n-   **url** - (str) url for the prometheus host\n-   **headers** \u2013 (dict) a dictionary of http headers to be used to communicate with the host. example: {\u201cauthorization\u201d: \u201cbearer my_oauth_token_to_the_host\u201d}\n-   **disable_ssl** \u2013 (bool) if set to true, will disable ssl certificate verification for the http requests made to the prometheus host\n\n```python\nfrom prometheus_api_client import prometheusconnect\nprom = prometheusconnect(url =\"<prometheus-host>\", disable_ssl=true)\n\n# get the list of all the metrics that the prometheus host scrapes\nprom.all_metrics()\n```\n\nyou can also fetch the time series data for a specific metric using custom queries as follows:\n\n```python\nprom = prometheusconnect()\nmy_label_config = {'cluster': 'my_cluster_id', 'label_2': 'label_2_value'}\nprom.get_current_metric_value(metric_name='up', label_config=my_label_config)\n\n# here, we are fetching the values of a particular metric name\nprom.custom_query(query=\"prometheus_http_requests_total\")\n\n# now, lets try to fetch the `sum` of the metrics\nprom.custom_query(query=\"sum(prometheus_http_requests_total)\")\n```\n\nwe can also use custom queries for fetching the metric data in a specific time interval. for example, let's try to fetch the past 2 days of data for a particular metric in chunks of 1 day:\n\n```python\n# import the required datetime functions\nfrom prometheus_api_client.utils import parse_datetime\nfrom datetime import timedelta\n\nstart_time = parse_datetime(\"2d\")\nend_time = parse_datetime(\"now\")\nchunk_size = timedelta(days=1)\n\nmetric_data = prom.get_metric_range_data(\n    \"up{cluster='my_cluster_id'}\",  # this is the metric name and label config\n    start_time=start_time,\n    end_time=end_time,\n    chunk_size=chunk_size,\n)\n```\n\nfor more functions included in the `prometheusconnect` module, refer to this [documentation.](https://prometheus-api-client-python.readthedocs.io/en/master/source/prometheus_api_client.html#module-prometheus_api_client.prometheus_connect)\n\n#### understanding the metrics data fetched\nthe `metricslist` module initializes a list of metric objects for the metrics fetched from a prometheus host as a result of a promql query.\n\n```python\n# import the metricslist and metric modules\nfrom prometheus_api_client import prometheusconnect, metricslist, metric\n\nprom = prometheusconnect()\nmy_label_config = {'cluster': 'my_cluster_id', 'label_2': 'label_2_value'}\nmetric_data = prom.get_metric_range_data(metric_name='up', label_config=my_label_config)\n\nmetric_object_list = metricslist(metric_data) # metric_object_list will be initialized as\n                                              # a list of metric objects for all the\n                                              # metrics downloaded using get_metric query\n\n# we can see what each of the metric objects look like\nfor item in metric_object_list:\n    print(item.metric_name, item.label_config, \"\\n\")\n```\n\neach of the items in the `metric_object_list` are initialized as a `metric` class object. let's look at one of the metrics from the `metric_object_list` to learn more about the `metric` class:\n\n```python\nmy_metric_object = metric_object_list[1] # one of the metrics from the list\nprint(my_metric_object)\n```\n\nfor more functions included in the `metricslist` and `metrics` module, refer to this [documentation.](https://prometheus-api-client-python.readthedocs.io/en/master/source/prometheus_api_client.html#module-prometheus_api_client.metric)\n\n#### additional metric functions\nthe `metric` class also supports multiple functions such as adding, equating and plotting various metric objects.\n\n##### adding metrics\nyou can add add two metric objects for the same time-series as follows:\n\n```python\nmetric_1 = metric(metric_data_1)\nmetric_2 = metric(metric_data_2)\nmetric_12 = metric_1 + metric_2 # will add the data in ``metric_2`` to ``metric_1``\n                                # so if any other parameters are set in ``metric_1``\n                                # will also be set in ``metric_12``\n                                # (like ``oldest_data_datetime``)\n```\n\n##### equating metrics\noverloading operator =, to check whether two metrics are the same (are the same time-series regardless of their data)\n```python\nmetric_1 = metric(metric_data_1)\nmetric_2 = metric(metric_data_2)\nprint(metric_1 == metric_2) # will print true if they belong to the same time-series\n```\n\n##### plotting metric objects\nplot a very simple line graph for the metric time series:\n\n```python\nfrom prometheus_api_client import prometheusconnect, metricslist, metric\n\nprom = prometheusconnect()\nmy_label_config = {'cluster': 'my_cluster_id', 'label_2': 'label_2_value'}\nmetric_data = prom.get_metric_range_data(metric_name='up', label_config=my_label_config)\n\nmetric_object_list = metricslist(metric_data)\nmy_metric_object = metric_object_list[1] # one of the metrics from the list\nmy_metric_object.plot()\n```\n\n#### getting metrics data as pandas dataframes\nto perform data analysis and manipulation, it is often helpful to have the data represented using a [pandas dataframe](https://pandas.pydata.org/docs/user_guide/dsintro.html#dataframe). there are two modules in this library that can be used to process the raw metrics fetched into a dataframe.\n\nthe `metricsnapshotdataframe` module converts \"current metric value\" data to a dataframe representation, and the `metricrangedataframe` converts \"metric range values\" data to a dataframe representation. example usage of these classes can be seen below:\n\n```python\nimport datetime as dt\nfrom prometheus_api_client import prometheusconnect,  metricsnapshotdataframe, metricrangedataframe\n\nprom = prometheusconnect()\nmy_label_config = {'cluster': 'my_cluster_id', 'label_2': 'label_2_value'}\n\n# metric current values\nmetric_data = prom.get_current_metric_value(\n    metric_name='up',\n    label_config=my_label_config,\n)\nmetric_df = metricsnapshotdataframe(metric_data)\nmetric_df.head()\n\"\"\" output:\n+-------------------------+-----------------+------------+-------+\n| __name__ | cluster      | label_2         | timestamp  | value |\n+==========+==============+=================+============+=======+\n| up       | cluster_id_0 | label_2_value_2 | 1577836800 | 0     |\n+-------------------------+-----------------+------------+-------+\n| up       | cluster_id_1 | label_2_value_3 | 1577836800 | 1     |\n+-------------------------+-----------------+------------+-------+\n\"\"\"\n\n# metric values for a range of timestamps\nmetric_data = prom.get_metric_range_data(\n    metric_name='up',\n    label_config=my_label_config,\n    start_time=(dt.datetime.now() - dt.timedelta(minutes=30)),\n    end_time=dt.datetime.now(),\n)\nmetric_df = metricrangedataframe(metric_data)\nmetric_df.head()\n\"\"\" output:\n+------------+------------+-----------------+--------------------+-------+\n|            |  __name__  | cluster         | label_2            | value |\n+-------------------------+-----------------+--------------------+-------+\n| timestamp  |            |                 |                    |       |\n+============+============+=================+====================+=======+\n| 1577836800 | up         | cluster_id_0    | label_2_value_2    | 0     |\n+-------------------------+-----------------+--------------------+-------+\n| 1577836801 | up         | cluster_id_1    | label_2_value_3    | 1     |\n+-------------------------+-----------------+------------=-------+-------+\n\"\"\"\n```\n\n\nfor more functions included in the `prometheus-api-client` library, please refer to this [documentation.](https://prometheus-api-client-python.readthedocs.io/en/master/source/prometheus_api_client.html)\n\n## running tests\n\n`prom_url=\"http://demo.robustperception.io:9090/\" pytest`\n\n## code styling and linting\n\nprometheus api client uses [pre-commit](https://pre-commit.com) framework to maintain the code linting and python code styling.<br>\nthe aicoe-ci would run the pre-commit check on each pull request.<br>\nwe encourage our contributors to follow the same pattern, while contributing to the code.<br>\nwe would like to keep the same standard and maintain the code for better quality and readability.\n\nthe pre-commit configuration file is present in the repository `.pre-commit-config.yaml`<br>\nit contains the different code styling and linting guide which we use for the application.\n\nwe just need to run [pre-commit](https://pre-commit.com/#install) before raising a pull request.<br>\nfollowing command can be used to run the pre-commit:<br>\n`pre-commit run --all-files`\n\nif pre-commit is not installed in your system, it can be install with : `pip install pre-commit`\n",
  "docs_url": null,
  "keywords": "",
  "license": "",
  "name": "prometheus-api-client",
  "package_url": "https://pypi.org/project/prometheus-api-client/",
  "project_url": "https://pypi.org/project/prometheus-api-client/",
  "project_urls": {
    "Homepage": "https://github.com/4n4nd/prometheus-api-client-python"
  },
  "release_url": "https://pypi.org/project/prometheus-api-client/0.5.4/",
  "requires_dist": [
    "requests",
    "dateparser",
    "pandas >=1.4.0",
    "numpy",
    "matplotlib",
    "httmock"
  ],
  "requires_python": "",
  "summary": "a small python api to collect data from prometheus",
  "version": "0.5.4",
  "releases": [],
  "developers": [
    "anand_sanmukhani",
    "asanmukhani@microsoft.com"
  ],
  "kwds": "prometheus_api_client prometheusconnect prometheus_connect prometheus_http_requests_total prometheus",
  "license_kwds": "",
  "libtype": "pypi",
  "id": "pypi_prometheus_api_client",
  "homepage": "https://github.com/4n4nd/prometheus-api-client-python",
  "release_count": 15,
  "dependency_ids": [
    "pypi_dateparser",
    "pypi_httmock",
    "pypi_matplotlib",
    "pypi_numpy",
    "pypi_pandas",
    "pypi_requests"
  ]
}