{
  "classifiers": [
    "license :: other/proprietary license",
    "operating system :: macos",
    "operating system :: posix",
    "operating system :: unix",
    "programming language :: python :: 3",
    "programming language :: python :: 3.10",
    "programming language :: python :: 3.11",
    "programming language :: python :: 3.4",
    "programming language :: python :: 3.5",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7",
    "programming language :: python :: 3.8",
    "programming language :: python :: 3.9"
  ],
  "description": "## about\nthe datarobot model runner (drum) is a tool that allows you to work locally with python, r, and java custom models.\nit can be used to verify that a custom model can run and make predictions before it is uploaded to datarobot.\nhowever, this testing is only for development purposes. datarobot recommends that any model you wish to deploy should also be tested in the custom model workshop.\n\ndrum can also:\n- run performance and memory usage testing for models.\n- perform model validation tests, e.g., checking model functionality on corner cases, like null values imputation.\n- run models in a docker container.\n\n***datarobot drum is only tested to support linux/macos operating systems. to run drum in windows 10 please use wsl (windows subsystem for linux).***\n\n## communication\n- open an issue in the [drum github repository](https://github.com/datarobot/datarobot-user-models/issues).\n\n## custom inference models quickstart guide\nview examples [here](https://github.com/datarobot/datarobot-user-models#quickstart).\n\n## custom tasks\nview examples [here](https://github.com/datarobot/datarobot-user-models#training_model_folder).\n\n## installation\n\n### prerequisites:\nall models:\n- install the dependencies needed to run your code.\n- if you are using a drop-in environment found in this repo, you must pip install these dependencies.\n\npython models:\n- check https://pypi.org/project/datarobot-drum/ for supported python versions.\n\njava models:\n- jre >= 11.\n\nr models:\n- python >= 3.6.\n- the r framework must be installed.\n- drum uses the `rpy2` package (by default the latest version is installed) to run r.\nyou may need to adjust the **rpy2** and **pandas** versions for compatibility.\n\nto install drum with python/java models support:  \n```pip install datarobot-drum```\n\nto install drum with r support:  \n```pip install datarobot-drum[r]```\n\n### autocompletion\ndrum supports autocompletion based on the `argcomplete` package. additional configuration is required to use it:\n- run `activate-global-python-argcomplete --user`; this should create a file: `~/.bash_completion.d/python-argcomplete`,\n- source created file `source ~/.bash_completion.d/python-argcomplete` in your `~/.bashrc` or another profile-related file according to your system.\n\nif global completion is not completing your script, bash may have registered a default completion function:\n- run `complete | grep drum`; if there is an output `complete -f _minimal <some_line_containing_drum>` do\n- `complete -r <some_line_containing_drum>`\n\nfor more information and troubleshooting visit the [argcomplete](https://pypi.org/project/argcomplete/) information page.\n\n\n## usage\nhelp:  \n```**drum** -help```\n\n### operations\n- [score](#score)\n- [fit](#fit)\n- [perf-test](#perf)\n- [validation](#validation)\n- [server](#server)\n- [new](#new)\n\n\n### code directory *--code-dir*\nthe *--code-dir* (code directory) argument is required in all commands and should point to a folder which contains your model artifacts and any other code needed for drum to run your model. for example, if you're running drum from **testdir** with a test input file at the root and your model in a subdirectory called **model**, you would enter:\n\n`drum score --code-dir ./model/ --input ./testfile.csv`\n\n#### additional model code dependencies\ncode dir may contain a `requirements.txt` file, listing dependency packages which are required by code. only python and r models are supported.\n\n**format of requirements.txt file**\n* for python: pip requrements file format\n* for r: a package per line\n\ndrum will attempt to install dependencies only when running with [`--docker`](#docker) option.\n\n### model template generation\n<a name=\"new\"></a>\ndrum can help you to generate a code folder template with the `custom` file described above.  \n`drum new model --code-dir ~/user_code_dir/ --language r`  \nthis command creates a folder with a `custom.py/r` file and a short description: `readme.md`.\n\n### batch scoring mode\n<a name=\"score\"></a>\n#### run a binary classification custom model\nmake batch predictions with a binary classification model. optionally, specify an output file. otherwise, predictions are returned to the command line:  \n```drum score --code-dir ~/user_code_dir/ --input 10k.csv --target-type binary --positive-class-label yes --negative-class-label no --output 10k-results.csv --verbose```\n\n#### run a regression custom model\nmake batch predictions with a regression model:  \n```drum score --code-dir ~/user_code_dir/ --input fast-iron.csv --target-type regression --verbose```\n\n### testing model performance\n<a name=\"perf\"></a>\nyou can test how the model performs and get its latency times and memory usage.  \nin this mode, the model is started with a prediction server. different request combinations are submitted to it.\nafter it completes, it returns a report.  \n```drum perf-test --code-dir ~/user_code_dir/ --input 10k.csv --target-type binary --positive-class-label yes --negative-class-label no```  \nreport example:\n```\nsamples   iters    min     avg     max    used (mb)   total (mb)\n============================================================================\ntest case         1     100   0.028   0.030   0.054     306.934    31442.840\ntest case        10     100   0.030   0.034   0.069     307.375    31442.840\ntest case       100      10   0.036   0.038   0.045     307.512    31442.840\ntest case      1000      10   0.042   0.047   0.058     308.258    31442.840\ntest case    100000       1   0.674   0.674   0.674     330.902    31442.840\n50mb file    838861       1   5.206   5.206   5.206     453.121    31442.840\n```\nfor more feature options, see:\n```drum perf-test --help```\n\n### model validation checks\n<a name=\"validation\"></a>\nyou can validate the model on a set of various checks.\nit is highly recommended running these checks, as they are performed in datarobot before the model can be deployed.\n\nlist of checks:\n- null values imputation: each feature of the provided dataset is set to missing and fed to the model.\n\nto run:\n```drum validation --code-dir ~/user_code_dir/ --input 10k.csv --target-type binary --positive-class-label yes --negative-class-label no```\nsample report:\n```\nvalidation check results\ntest case         status\n==============================\nnull value imputation   passed\n```\nin case of check failure more information will be provided.\n\n### runtime parameters\nruntime parameters are created by the user via the custom model's version create routes (.e.g\ndatarobot web ui, datarobot client, etc.). these runtime parameters can then be loaded into the\ncustom model using the `runtimeparameters` class, as follows:\n\n```\nfrom datarobot_drum import runtimeparameters\n\ndef load_model(code_dir):\n    url = runtimeparameters.get(\"url_param_1\")\n    aws_credential = runtimeparameters.get(\"aws_credential_param_1\")\n    ...\n```\n\nduring testing and debugging in a local development environment, the user can write the runtime\nparameter values into a yaml file and provide it as an input to the `drum` utility. the yaml file\ncan have any name ending with .yaml and should follow the example layout below:\n\n```\nurl_param_1: http://any-desired-location/\naws_cred_param_1:\n    # see the rest api documentation for details on all supported credential types:\n    #     https://docs.datarobot.com/en/docs/api/reference/public-api/credentials.html#properties_3\n    credentialtype: s3\n    awsaccesskeyid: abdefghijk...\n    awssecretaccesskey: asdjdfsdjafslkjsddlkgdsdlkjlkj...\n    awssessiontoken: null\n```\n\nfor credential type parameters, the value matches the credentials rest api payload.\nfor a complete example, see the following [model template with runtime parameters](https://github.com/datarobot/datarobot-user-models/blob/master/model_templates/python3_sklearn_runtime_params/readme.md).\n\nand here is how you use it when running the drum utility:\n\n```\ndrum score --runtime-params-file <filepath> --code-dir ~/user_code_dir/ --target-type <target type> --input dataset.csv\n```\n\n### prediction server mode\n<a name=\"server\"></a>\n\ndrum can also run as a prediction server. to do so, provide a server address argument:  \n```drum server --code-dir ~/user_code_dir --target-type regression --address localhost:6789```\n\nthe drum prediction server provides the following routes. you may provide the environment variable url_prefix. note that urls must end with /.  \nfor complete api specification in openapi 3.0 format check here [drum_server_api.yaml](https://raw.githubusercontent.com/datarobot/datarobot-user-models/master/custom_model_runner/drum_server_api.yaml), you can also open it rendered in the [swagger editor](https://editor.swagger.io/?url=https://raw.githubusercontent.com/datarobot/datarobot-user-models/master/custom_model_runner/drum_server_api.yaml).\n\n* status routes:   \na get **url_prefix/** and **url_prefix/ping/** routes, shows server status - if the server is alive.  \nexample: get http://localhost:6789/  \nresponse:\n```json\n   {\"message\": \"ok\"}\n```\n\n* health route:  \na get **url_prefix/health/** route, shows functional health. e.g. model is loaded and functioning properly.  \nexample: get http://localhost:6789/health/  \nresponse:\n  * success:\n    ```json\n    {\"message\": \"ok\"}\n    ```\n  * error:\n    ```json\n    {\n      \"message\": \"error: \\n\\nrunning environment language: python.\\n failed loading hooks from [/tmp/model/python3_sklearn/custom.py] : no module named 'andas'\"\n    }\n    ```\n  \n* info route:  \na get **url_prefix/info/** route, shows information about running model (metadata, paths, predictor type, etc.).  \nexample: get http://localhost:6789/info/  \nresponse:\n  ```json\n  {\n     \"codedir\": \"/tmp/model/python3_sklearn\",\n     \"drumserver\": \"flask\",\n     \"drumversion\": \"1.5.3\",\n     \"language\": \"python\",\n     \"modelmetadata\": {\n       \"environmentid\": \"5e8c889607389fe0f466c72d\",\n       \"inferencemodel\": {\n         \"targetname\": \"grade 2014\"\n       },\n       \"modelid\": \"5f1f15a4d6111f01cb7f91fd\",\n       \"name\": \"regression model\",\n       \"targettype\": \"regression\",\n       \"type\": \"inference\",\n       \"validation\": {\n         \"input\": \"../../../tests/testdata/juniors_3_year_stats_regression.csv\"\n       }\n     },\n     \"predictor\": \"scikit-learn\",\n     \"targettype\": \"regression\"\n  }\n        ```  \n\n* statistics route:  \na get **url_prefix/stats/** route, shows running model statistics (memory).  \nexample: get http://localhost:6789/stats/  \n`mem_info::drum_rss` represent a sum of `drum_info::mem` values.  \nresponse:\n    ```json\n  {\n      \"drum_info\": [{\n          \"cmdline\": [\n              \"/tmp/drum_tests_virtual_environment/bin/python3\",\n              \"/tmp/drum_tests_virtual_environment/bin/drum\",\n              \"server\",\n              \"--code-dir\",\n              \"/tmp/model/python3_sklearn\",\n              \"--target-type\",\n              \"regression\",\n              \"--address\",\n              \"localhost:6789\",\n              \"--with-error-server\",\n              \"--show-perf\"\n          ],\n          \"mem\": 256.71484375,\n          \"pid\": 342391\n      }],\n      \"mem_info\": {\n          \"avail\": 17670.828125,\n          \"container_limit\": null,\n          \"container_max_used\": null,\n          \"container_used\": null,\n          \"drum_rss\": 256.71484375,\n          \"free\": 312.33203125,\n          \"nginx_rss\": 0,\n          \"total\": 31442.73046875\n      },\n      \"time_info\": {\n        \"run_predictor_total\": {\n          \"avg\": 0.0165,\n          \"max\": 0.023,\n          \"min\": 0.013\n        }\n      }\n  }\n    ```  \n\n* capabilities route:  \na get **url_prefix/capabilities/** route, shows payload formats supported by the running model.  \nexample: get http://localhost:6789/capabilities/\n\n* structured predictions routes:   \na post **url_prefix/predict/** and **url_prefix/predictions/** routes, which returns predictions on data.  \nexample: post http://localhost:6789/predict/; post http://localhost:6789/predictions/  \nfor these routes data can be posted in two ways:\n  * as form data parameter with a <key:value> pair, where:  \nkey = x  \nvalue = filename of the `csv/arrow/mtx` format, that contains the inference data.\n  * as binary data; in case of `arrow` or `mtx` formats, mimetype `application/x-apache-arrow-stream` or `text/mtx` must be set.\n   \n* structured transform route (for python predictor only):   \na post **url_prefix/transform/** route, which returns transformed data.  \nexample: post http://localhost:6789/transform/;  \nfor this route data can be posted in two ways:\n  * as form data parameter with a <key:value> pair, where:  \nkey = `x`.  \nvalue = filename of the `csv/arrow/mtx` format, that contains the inference data.\n \n    optionally a second key, `y`, can be passed with value = a second filename containing target data. \n    \n    if `y` is passed, the route will return both `x.transformed` and `y.transformed` keys, along with `out.format`\n     indicating the format of the transformed x output. this will take a value of `csv`, \n    `sparse` or `arrow`. `y.transformed` is never sparse.\n    \n    an `arrow_version` key may also be passed if you desire to use `arrow` format for `x.transformed` or `y.transformed`.\n    this is used to ensure that the endpoint returns data that can be opened by the caller's version of arrow. without this\n    key, all dense data returned will default to csv format.\n\n  * as binary data; in case of `arrow` or `mtx` formats, mimetype `application/x-apache-arrow-stream` or `text/mtx` must be set.\n  \n  \n* unstructured predictions routes:  \na post **url_prefix/predictunstructured/** and **url_prefix/predictionsunstructured/** routes, which returns predictions on data.  \nexample: post http://localhost:6789/predictunstructured/; post http://localhost:6789/predictionsunstructured/  \nfor these routes data is posted as binary data. provide mimetype and charset to properly handle the data.\nfor more detailed information please go [here](https://github.com/datarobot/datarobot-user-models#unstructured_inference_models).  \n\n#### starting drum as prediction server in production mode.\ndrum prediction server can be started in *production* mode which has nginx and uwsgi as the backend.\nthis provides better stability and scalability - depending on how many cpus are available several workers will be started to serve predictions.  \n*--max-workers* parameter  can be used to limit number of workers.  \ne.g. ```drum server --code-dir ~/user_code_dir --address localhost:6789 --production --max-workers 2```\n\n> note: `uwsgi` is an extra dependency for drum. install it using: `pip install datarobot-drum[uwsgi]` or `pip install uwsgi`  \n> note: *production* mode may not be available on windows-based systems out ot the box, as uwsgi installation requires special handling.\n> docker container based linux environment can be used for such cases.\n\n### fit mode\n<a name=\"fit\"></a>\n> note: running fit inside of datarobot is currently in alpha. check back soon for the opportunity\nto test out this functionality yourself.\n\ndrum can run your training model to make sure it can produce a trained model artifact before\nadding the training model into datarobot.\n\nyou can try this out on our sklearn classifier model template this this command:\n\n```\ndrum fit --code-dir task_templates/3_pipelines/python3_sklearn_binary --target-type binary --target species --input \\\ntests/testdata/iris_binary_training.csv --output . --positive-class-label iris-setosa \\\n--negative-class-label iris-versicolor\n```\n> note: if you don't provide class label, datarobot tries to autodetect the labels for you.\n\nyou can also use drum on regression datasets, and soon you will also be able to provide row weights. checkout the ```drum fit --help``` output for further details.\n\n\n\n### running inside a docker container\n<a name=\"docker\"></a>\nin every mode, drum can be run inside a docker container by providing the option ```--docker <image_name/directory_path>```.\nthe container should implement an environment required to perform desired action.\ndrum must be installed as a part of this environment.  \nthe following is an example on how to run drum inside of container:  \n```drum score --code-dir ~/user_code_dir/ --target-type <target type> --input dataset.csv --docker <container_name>```  \n```drum perf-test --code-dir ~/user_code_dir/ --target-type <target type> --input dataset.csv --docker <container_name>```\n\nalternatively, the argument passed through the `--docker` flag may be a directory containing the unbuilt contents\nof an image. the drum tool will then attempt to build an image using this directory and run your model inside\nthe newly built image.\n\nif the argument passed to `--docker` is a docker context directory, and code dir contains dependencies file `requirements.txt`, drum will try to install the packages during the image build.  \nto skip dependencies installation you can use `--skip-deps-install` flag. \n\n## drum push\nstarting in version 1.1.4, drum includes a new verb called `push`. when the user writes\n`drum push -cd /dirtopush/` the contents of that directory will be submitted as a custom model\nto datarobot. however, for this to work, you must create two types of configuration.\n1. **datarobot client configuration**\n`push` relies on correct global configuration of the client to access a datarobot server.\nthere are two options for supplying this configuration, through environment variables or through\na config file which is read by the datarobot client. both of these options will include an endpoint\nand an api token to authenticate the requests.\n\n* option 1: environment variables.\n    example:\n    ```\n    export datarobot_endpoint=https://app.datarobot.com/api/v2\n    export datarobot_api_token=<yourtoken>\n    ```\n* option 2: create this file, which we check for: `~/.config/datarobot/drconfig.yaml`  \n    example:\n    ```\n    endpoint: https://app.datarobot.com/api/v2\n    token: <yourtoken>\n    ```\n2. **model metadata** `push` also relies on a metadata file, which is parsed on drum to create\nthe correct sort of model in datarobot. this metadata file includes quite a few options. you can\n[read about those options](https://github.com/datarobot/datarobot-user-models/blob/master/model-metadata.md) or [see an example](https://github.com/datarobot/datarobot-user-models/blob/master/model_templates/python3_sklearn/model-metadata.yaml).\n",
  "docs_url": null,
  "keywords": "",
  "license": "apache license, version 2.0",
  "name": "datarobot-drum",
  "package_url": "https://pypi.org/project/datarobot-drum/",
  "project_url": "https://pypi.org/project/datarobot-drum/",
  "project_urls": {
    "Changelog": "https://github.com/datarobot/datarobot-user-models/blob/master/custom_model_runner/CHANGELOG.md",
    "Homepage": "http://datarobot.com",
    "Source": "https://github.com/datarobot/datarobot-user-models"
  },
  "release_url": "https://pypi.org/project/datarobot-drum/1.10.16/",
  "requires_dist": [
    "argcomplete ==1.11.1",
    "datarobot <4,>=3.1.0",
    "trafaret <2.2.0,>=2.0.0",
    "docker <5.0.0,>=4.2.2",
    "flask <=2.2.5",
    "werkzeug ==3.0.1",
    "jinja2 >=3.0.0",
    "memory-profiler <1.0.0",
    "mlpiper ~=2.6.0",
    "numpy",
    "pandas <=2.0.3,>=1.5.0",
    "progress",
    "requests",
    "scipy <2,>=1.1",
    "strictyaml ==1.4.2",
    "PyYAML",
    "texttable",
    "py4j ~=0.10.9.0",
    "pyarrow <=14.0.1,>=0.14.1",
    "Pillow <=10.1.0",
    "julia <=0.5.7",
    "termcolor",
    "packaging",
    "markupsafe <=2.1.3",
    "rpy2 ==3.5.8 ; (python_version >= \"3.6\") and extra == 'r'",
    "scipy ; extra == 'keras'",
    "numpy ; extra == 'keras'",
    "h5py ; extra == 'keras'",
    "tensorflow >=2.2.1 ; extra == 'keras'",
    "onnxruntime ; extra == 'onnx'",
    "pypmml ; extra == 'pypmml'",
    "scikit-learn ; extra == 'scikit-learn'",
    "scipy ; extra == 'scikit-learn'",
    "numpy ; extra == 'scikit-learn'",
    "torch ; extra == 'torch'",
    "numpy ; extra == 'torch'",
    "scikit-learn ; extra == 'torch'",
    "scipy ; extra == 'torch'",
    "uwsgi ; extra == 'uwsgi'",
    "scipy ; extra == 'xgboost'",
    "numpy ; extra == 'xgboost'",
    "xgboost ; extra == 'xgboost'"
  ],
  "requires_python": ">=3.4,<3.12",
  "summary": "drum - develop, test and deploy custom models",
  "version": "1.10.16",
  "releases": [],
  "developers": [
    "datarobot",
    "support@datarobot.com"
  ],
  "kwds": "drum_tests_virtual_environment datarobot_drum custom_model_runner datarobot docker",
  "license_kwds": "apache license, version 2.0",
  "libtype": "pypi",
  "id": "pypi_datarobot_drum",
  "homepage": "http://datarobot.com",
  "release_count": 123,
  "dependency_ids": [
    "pypi_argcomplete",
    "pypi_datarobot",
    "pypi_docker",
    "pypi_flask",
    "pypi_h5py",
    "pypi_jinja2",
    "pypi_julia",
    "pypi_markupsafe",
    "pypi_memory_profiler",
    "pypi_mlpiper",
    "pypi_numpy",
    "pypi_onnxruntime",
    "pypi_packaging",
    "pypi_pandas",
    "pypi_pillow",
    "pypi_progress",
    "pypi_py4j",
    "pypi_pyarrow",
    "pypi_pypmml",
    "pypi_pyyaml",
    "pypi_requests",
    "pypi_rpy2",
    "pypi_scikit_learn",
    "pypi_scipy",
    "pypi_strictyaml",
    "pypi_tensorflow",
    "pypi_termcolor",
    "pypi_texttable",
    "pypi_torch",
    "pypi_trafaret",
    "pypi_uwsgi",
    "pypi_werkzeug",
    "pypi_xgboost"
  ]
}