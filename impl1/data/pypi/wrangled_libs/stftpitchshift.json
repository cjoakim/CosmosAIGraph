{
  "classifiers": [
    "intended audience :: developers",
    "intended audience :: education",
    "intended audience :: other audience",
    "intended audience :: science/research",
    "license :: osi approved :: mit license",
    "programming language :: c++",
    "programming language :: python :: 3",
    "topic :: artistic software",
    "topic :: education",
    "topic :: multimedia :: sound/audio",
    "topic :: multimedia :: sound/audio :: analysis",
    "topic :: multimedia :: sound/audio :: sound synthesis",
    "topic :: scientific/engineering",
    "topic :: software development :: libraries"
  ],
  "description": "# stftpitchshift\n\n![language](https://img.shields.io/badge/language-c%2b%2b-blue)\n![language](https://img.shields.io/badge/language-python-blue)\n![license](https://img.shields.io/github/license/jurihock/stftpitchshift?color=blue)\n![build cpp](https://img.shields.io/github/actions/workflow/status/jurihock/stftpitchshift/cpp.yml?branch=main&label=build%20cpp)\n![build python](https://img.shields.io/github/actions/workflow/status/jurihock/stftpitchshift/python.yml?branch=main&label=build%20python)\n![tag](https://img.shields.io/github/v/tag/jurihock/stftpitchshift?color=gold)\n![pypi](https://img.shields.io/pypi/v/stftpitchshift?color=gold)\n\n*stftpitchshift* is a short-time fourier transform ([stft](https://www.audiolabs-erlangen.de/resources/mir/fmp/c2/c2_stft-basic.html)) based pitch and timbre shifting algorithm implementation, originally inspired by the stephan m. bernsee's [smbpitchshift.cpp](https://blogs.zynaptiq.com/bernsee/download). \n\nthis repository features two analogical algorithm implementations, [c++](cpp/stftpitchshift) and [python](python/stftpitchshift). both contain several [function blocks](#modules) of the same name (but different file extension, of course).\n\nin addition to the basic pitch shifting algorithm, it also features spectral [poly pitch shifting](#pitch-shifting) and cepstral [formant preservation](#formant-preservation) extensions.\n\nboth sources contain a ready-to-use [command line tool](#usage) as well as a library for custom needs. see more details in the [build](#build) section.\n\nfeel free to check out some demos at [stftpitchshiftdemo](http://jurihock.github.io/stftpitchshiftdemo) and the [stftpitchshiftplugin](https://github.com/jurihock/stftpitchshiftplugin) as well.\n\n## modules\n\n<details>\n<summary><strong>stftpitchshift</strong></summary>\n\nthe *stftpitchshift* module provides a full-featured audio processing chain to perform the pitch shifting of a single audio track, based on the built in *stft* implementation.\n\nexclusively in the c++ environment the additional *stftpitchshiftcore* module can be used to embed this pitch shifting implementation in an existing real-time *stft* pipeline.\n</details>\n\n<details>\n<summary><strong>vocoder</strong></summary>\n\nthe *vocoder* module transforms the dft spectral data according to the original algorithm, which is actually the *instantaneous frequency estimation* technique. see also [further reading](#further-reading) for more details.\n\nthe particular `encode` function replaces the input dft values by the `magnitude + j * frequency` complex numbers, representing the phase error based frequency estimation in the imaginary part.\n\nthe `decode` function does an inverse transformation back to the original dft complex numbers, by replacing eventually modified frequency value by the reconstructed phase value.\n</details>\n\n<details>\n<summary><strong>pitcher</strong></summary>\n\nthe *pitcher* module performs mono or poly pitch shifting of the encoded dft frame depending on the specified fractional factors.\n</details>\n\n<details>\n<summary><strong>resampler</strong></summary>\n\nthe *resampler* module provides the `linear` interpolation routine, to actually perform pitch shifting, based on the *vocoder* dft transform.\n</details>\n\n<details>\n<summary><strong>cepster</strong></summary>\n\nthe *cepster* module estimates a spectral envelope of the dft magnitude vector, representing the vocal tract resonances. this computation takes place in the cepstral domain by applying a low-pass filter. the cutoff value of the low-pass filter or *lifter* is the *quefrency* value to be specified in seconds or milliseconds.\n</details>\n\n<details>\n<summary><strong>normalizer</strong></summary>\n\nthe *normalizer* module optionally performs a [rms normalization](https://en.wikipedia.org/wiki/audio_normalization) right after pitch shifting relative to the original signal to get about the same loudness level. this correction takes place in the frequency domain each dft frame separately.\n</details>\n\n<details>\n<summary><strong>stft</strong></summary>\n\nas the name of this module already implies, it performs the comprehensive *stft* analysis and synthesis steps.\n</details>\n\n## pitch shifting\n\n### mono pitch shifting\n\nsince the *vocoder* module transforms the original dft complex values `real + j * imag` into `magnitude + j * frequency` representation, the mono pitch shifting is a comparatively easy task. both `magnitude` and `frequency` vectors are to be resampled according to the desired pitch shifting factor:\n\n* the factor `1` means no change.\n* the factor `<1` means downsampling.\n* the factor `>1` means upsampling.\n\nany fractional resampling factor such as `0.5` requires interpolation. in the simplest case, linear interpolation will be sufficient. otherwise, bilinear interpolation can also be applied to smooth values between two consecutive stft hops.\n\ndue to frequency vector alteration, the resampled frequency values needs also be multiplied by the resampling factor.\n\n### poly pitch shifting\n\nin terms of poly pitch shifting, multiple differently resampled `magnitude` and `frequency` vectors are to be combined together. for example, the magnitude vectors can easily be averaged. but what about the frequency vectors?\n\nthe basic concept of this algorithm extension is to only keep the frequency value of the strongest magnitude value. so the *strongest* magnitude will mask the *weakest* one. thus, all remaining *masked* components become *inaudible*.\n\nin this way, the poly pitch shifting can be performed *simultaneously* in the same dft frame. there is no need to build a separate stft pipeline for different pitch variations to superimpose the synthesized signals in the time domain.\n\n## formant preservation\n\nthe pitch shifting also causes distortion of the original [vocal formants](https://en.wikipedia.org/wiki/formant), leading to a so called *mickey mouse* effect if scaled up. one possibility to reduce this artifact, is to exclude the formant feature from the pitch shifting procedure.\n\nthe vocal formants are represented by the *spectral envelope*, which is given by the smoothed dft mangitude vector. in this implementation, the smoothing of the dft mangitude vector takes place in the cepstral domain by low-pass *liftering*. the extracted envelope is then removed from the original dft magnitude. the remaining *residual* or *excitation* signal goes through the pitch shifting algorithm. after that, the previously extracted envelope is combined with the processed residual.\n\n## build\n\n### c++\n\nuse [cmake](http://cmake.org) to manually build the c++ library, main and example programs like this:\n\n```cmd\ncmake -s . -b build\ncmake --build build\n```\n\nor alternatively just get the packaged library from:\n\n* vcpkg repository [stftpitchshift](https://github.com/microsoft/vcpkg/tree/master/ports/stftpitchshift) or\n* ubuntu repository [ppa:jurihock/stftpitchshift](https://launchpad.net/~jurihock/+archive/ubuntu/stftpitchshift).\n\nto include this library in your c++ audio project, study the minimal c++ example in the examples folder:\n\n```cpp\n#include <stftpitchshift/stftpitchshift.h>\n\nusing namespace stftpitchshift;\n\nstftpitchshift pitchshifter(1024, 256, 44100);\n\nstd::vector<float> x(44100);\nstd::vector<float> y(x.size());\n\npitchshifter.shiftpitch(x, y, 1);\n```\n\noptionally specify following cmake options for custom builds:\n\n* `-dbuild_shared_libs=on` to enable a [shared](https://cmake.org/cmake/help/latest/variable/build_shared_libs.html) library build,\n* `-dvcpkg=on` to enable the [vcpkg](https://vcpkg.io) compatible library only build without executables,\n* `-ddeb=on` to enable the [deb](https://en.wikipedia.org/wiki/deb_(file_format)) package build for library and main executable,\n* `-dwasm=on` to enable the [wasm](https://emscripten.org) library build used in [demo](https://github.com/jurihock/stftpitchshiftdemo) project.\n\n### python\n\nthe python program `stftpitchshift` can be installed via `pip install stftpitchshift`.\n\nalso feel free to explore the python class `stftpitchshift` in your personal audio project:\n\n```python\nfrom stftpitchshift import stftpitchshift\n\npitchshifter = stftpitchshift(1024, 256, 44100)\n\nx = [0] * 44100\ny = pitchshifter.shiftpitch(x, 1)\n```\n\n## usage\n\nboth programs c++ and python provides a similar set of command line options:\n\n```\n-h  --help       print this help\n    --version    print version number\n\n-i  --input      input .wav file name\n-o  --output     output .wav file name\n\n-p  --pitch      fractional pitch shifting factors separated by comma\n                 (default 1.0)\n\n-q  --quefrency  optional formant lifter quefrency in milliseconds\n                 (default 0.0)\n\n-t  --timbre     fractional timbre shifting factor related to -q\n                 (default 1.0)\n\n-r  --rms        enable spectral rms normalization\n\n-w  --window     stft window size\n                 (default 1024)\n\n-v  --overlap    stft window overlap\n                 (default 32)\n\n-c  --chrono     enable runtime measurements\n                 (only available in the c++ version)\n\n-d  --debug      plot spectrograms before and after processing\n                 (only available in the python version)\n```\n\ncurrently only `.wav` files are supported. please use e.g. [audacity](http://www.audacityteam.org) or [sox](http://sox.sourceforge.net) to prepare your audio files for pitch shifting.\n\nto apply multiple pitch shifts at once, separate each factor by a comma, e.g. `-p 0.5,1,2`. alternatively specify pitch shifting factors as semitones denoted by the + or - prefix, e.g. `-p -12,0,+12`. for precise pitch corrections append the number of cents after semitones, e.g. `-p -11-100,0,+11+100`.\n\nto enable the formant preservation feature specify a suitable *quefrency* value in milliseconds. depending on the source signal, begin with a small value like `-q 1`. generally, the *quefrency* value has to be smaller than the fundamental period, as reciprocal of the fundamental frequency, of the source signal.\n\nat the moment the formant preservation doesn't seem to work well along with the poly pitch shifting and smaller pitch shifting factors. further investigation is therefore necessary...\n\n## further reading\n\n### instantaneous frequency estimation\n\n* [fundamentals of music processing](http://www.music-processing.de) by meinard m\u00fcller (section 8.2.1 in the second edition or [online](https://www.audiolabs-erlangen.de/resources/mir/fmp/c8/c8s2_instantfreqestimation.html))\n* [digital audio effects](http://www.dafx.de) by udo z\u00f6lzer (sections 7.3.1 and 7.3.5 in the second edition)\n* [spectral music design](https://global.oup.com/academic/product/spectral-music-design-9780197524015) by victor lazzarini (section 6.3 in the first edition)\n\n### cepstrum analysis and formant changing\n\n* [digital audio effects](http://www.dafx.de) by udo z\u00f6lzer (sections 8.2.3 and 8.3.2 in the second edition)\n* [discrete-time signal processing](https://www.pearson.com/us/higher-education/program/oppenheim-discrete-time-signal-processing-3rd-edition/pgm212808.html) by oppenheim & schafer (chapter 13 in the third edition)\n* [spectral music design](https://global.oup.com/academic/product/spectral-music-design-9780197524015) by victor lazzarini (section 6.5.7 in the first edition)\n\n### asymmetric windows\n\n* [a low delay, variable resolution, perfect reconstruction spectral analysis-synthesis system for speech enhancement](https://ieeexplore.ieee.org/document/7098797) by dirk mauler and rainer martin\n* [asymmetric windows in digital signal processing](https://doi.org/10.1016/bs.adcom.2019.07.004) by robert rozman\n\n## credits\n\n* [cxxopts](https://github.com/jarro2783/cxxopts) by jarryd beck\n* [dr_libs](https://github.com/mackron/dr_libs) by david reid\n\n## license\n\n*stftpitchshift* is licensed under the terms of the mit license.\nfor details please refer to the accompanying [license](license) file distributed with *stftpitchshift*.\n",
  "docs_url": null,
  "keywords": "digital,audio,signal,processing,dasp,fft,stft,pitch,shifting,formants,spectrum,cepstrum,algorithms,analysis,synthesis,cpp,python",
  "license": "mit",
  "name": "stftpitchshift",
  "package_url": "https://pypi.org/project/stftpitchshift/",
  "project_url": "https://pypi.org/project/stftpitchshift/",
  "project_urls": {
    "Homepage": "https://github.com/jurihock/stftPitchShift"
  },
  "release_url": "https://pypi.org/project/stftpitchshift/2.0/",
  "requires_dist": [
    "click",
    "matplotlib",
    "numpy >=1.20.0"
  ],
  "requires_python": ">=3",
  "summary": "stft based pitch and timbre shifting",
  "version": "2.0",
  "releases": [],
  "developers": [
    "juergen.hock@jurihock.de",
    "juergen_hock"
  ],
  "kwds": "stftpitchshiftcore stftpitchshiftdemo stftpitchshift stft stftpitchshiftplugin",
  "license_kwds": "mit",
  "libtype": "pypi",
  "id": "pypi_stftpitchshift",
  "homepage": "https://github.com/jurihock/stftpitchshift",
  "release_count": 9,
  "dependency_ids": [
    "pypi_click",
    "pypi_matplotlib",
    "pypi_numpy"
  ]
}