{
  "classifiers": [
    "development status :: 5 - production/stable",
    "environment :: console",
    "intended audience :: science/research",
    "license :: osi approved :: bsd license",
    "operating system :: os independent",
    "programming language :: python",
    "programming language :: python :: 3",
    "programming language :: python :: 3 :: only",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7",
    "topic :: scientific/engineering :: artificial intelligence"
  ],
  "description": "# ![pytorch-biggraph](docs/source/_static/logo_color.svg)\n\n[![circleci status](https://circleci.com/gh/facebookresearch/pytorch-biggraph.svg?style=svg)](https://circleci.com/gh/facebookresearch/pytorch-biggraph) [![documentation status](https://readthedocs.org/projects/torchbiggraph/badge/?version=latest)](https://torchbiggraph.readthedocs.io/en/latest/?badge=latest)\n\npytorch-biggraph (pbg) is a distributed system for learning graph embeddings for large graphs, particularly big web interaction graphs with up to billions of entities and trillions of edges.\n\npbg was introduced in the [pytorch-biggraph: a large-scale graph embedding framework](https://www.sysml.cc/doc/2019/71.pdf) paper, presented at the [sysml conference](https://www.sysml.cc/) in 2019.\n\npbg trains on an input graph by ingesting its list of edges, each identified by its source and target entities and, possibly, a relation type. it outputs a feature vector (embedding) for each entity, trying to place adjacent entities close to each other in the vector space, while pushing unconnected entities apart. therefore, entities that have a similar distribution of neighbors will end up being nearby.\n\nit is possible to configure each relation type to calculate this \"proximity score\" in a different way, with the parameters (if any) learned during training. this allows the same underlying entity embeddings to be shared among multiple relation types.\n\nthe generality and extensibility of its model allows pbg to train a number of models from the knowledge graph embedding literature, including [transe](https://www.utc.fr/~bordesan/dokuwiki/_media/en/transe_nips13.pdf), [rescal](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.383.2015&rep=rep1&type=pdf), [distmult](https://arxiv.org/abs/1412.6575) and [complex](http://proceedings.mlr.press/v48/trouillon16.pdf).\n\npbg is designed with scale in mind, and achieves it through:\n- *graph partitioning*, so that the model does not have to be fully loaded into memory\n- *multi-threaded computation* on each machine\n- *distributed execution* across multiple machines (optional), all simultaneously operating on disjoint parts of the graph\n- *batched negative sampling*, allowing for processing >1 million edges/sec/machine with 100 negatives per edge\n\npbg is *not* for model exploration with exotic models on small graphs, e.g. graph convnets, deep networks, etc.\n\n## requirements\n\npbg is written in python (version 3.6 or later) and relies on [pytorch](https://pytorch.org/) (at least version 1.0) and a few other libraries.\n\nall computations are performed on the cpu, therefore a large number of cores is advisable. no gpu is necessary.\n\nwhen running on multiple machines, they need to be able to communicate to each other at high bandwidth (10 gbps or higher recommended) and have access to a shared filesystem (for checkpointing). pbg uses [torch.distributed](https://pytorch.org/docs/stable/distributed.html), which uses the gloo package which runs on top of tcp or mpi.\n\n## installation\n\nto install the latest version of pbg run:\n```bash\npip install torchbiggraph\n```\n\nas an alternative, one can instead install the *development* version from the repository. this may have newer features but could be more unstable. to do so, clone the repository (or download it as an archive) and, inside the top-level directory, run:\n```bash\npip install .\n```\n\n## getting started\n\nthe results of [the paper](https://www.sysml.cc/doc/2019/71.pdf) can easily be reproduced by running the following command (which executes [this script](torchbiggraph/examples/fb15k.py)):\n```bash\ntorchbiggraph_example_fb15k\n```\nthis will download the freebase 15k knowledge base dataset, put it into the right format, train on it using the complex model and finally perform an evaluation of the learned embeddings that calculates the mrr and other metrics that should match the paper. another command, `torchbiggraph_example_livejournal`, does the same for the livejournal interaction graph dataset.\n\nto learn how to use pbg, let us walk through what the fb15k script does.\n\n### downloading the data\n\nfirst, it [retrieves the dataset](https://dl.fbaipublicfiles.com/starspace/fb15k.tgz) and unpacks it, obtaining a directory with three edge sets as tsv files, for training, validation and testing.\n```bash\nwget https://dl.fbaipublicfiles.com/starspace/fb15k.tgz -p data\ntar xf data/fb15k.tgz -c data\n```\n\neach line of these files contains information about one edge. using tabs as separators, the lines are divided into columns which contain the identifiers of the source entities, the relation types and the target entities. for example:\n```\n/m/027rn\t/location/country/form_of_government\t/m/06cx9\n/m/017dcd\t/tv/tv_program/regular_cast./tv/regular_tv_appearance/actor\t/m/06v8s0\n/m/07s9rl0\t/media_common/netflix_genre/titles\t/m/0170z3\n/m/01sl1q\t/award/award_winner/awards_won./award/award_honor/award_winner\t/m/044mz_\n/m/0cnk2q\t/soccer/football_team/current_roster./sports/sports_team_roster/position\t/m/02nzb8\n```\n\n### preparing the data\n\nthen, the script converts the edge lists to pbg's input format. this amounts to assigning a numerical identifier to all entities and relation types, shuffling and partitioning the entities and edges and writing all down in the right format.\n\nluckily, there is a command that does all of this:\n```bash\ntorchbiggraph_import_from_tsv \\\n  --lhs-col=0 --rel-col=1 --rhs-col=2 \\\n  torchbiggraph/examples/configs/fb15k_config.py \\\n  data/fb15k/freebase_mtr100_mte100-train.txt \\\n  data/fb15k/freebase_mtr100_mte100-valid.txt \\\n  data/fb15k/freebase_mtr100_mte100-test.txt\n```\nthe outputs will be stored next to the inputs in the `data/fb15k` directory.\n\nthis simple utility is only suitable for small graphs that fit entirely in memory. to handle larger data one will have to implement their own custom preprocessor.\n\n### training\n\nthe `torchbiggraph_train` command is used to launch training. the training parameters are tucked away in a configuration file, whose path is given to the command. they can however be overridden from the command line with the `--param` flag. the sample config is used for both training and evaluation, so we will have to use the override to specify the edge set to use.\n```bash\ntorchbiggraph_train \\\n  torchbiggraph/examples/configs/fb15k_config.py \\\n  -p edge_paths=data/fb15k/freebase_mtr100_mte100-train_partitioned\n```\n\nthis will read data from the `entity_path` directory specified in the configuration and the `edge_paths` directory given on the command line. it will write checkpoints (which also double as the output data) to the `checkpoint_path` directory also defined in the configuration, which in this case is `model/fb15k`.\n\ntraining will proceed for 50 epochs in total, with the progress and some statistics logged to the console, for example:\n```\nstarting epoch 1 / 50, edge path 1 / 1, edge chunk 1 / 1\nedge path: data/fb15k/freebase_mtr100_mte100-train_partitioned\nstill in queue: 0\nswapping partitioned embeddings none ( 0 , 0 )\n( 0 , 0 ): loading entities\n( 0 , 0 ): bucket 1 / 1 : processed 483142 edges in 17.36 s ( 0.028 m/sec ); io: 0.02 s ( 542.52 mb/sec )\n( 0 , 0 ): loss:  309.695 , violators_lhs:  171.846 , violators_rhs:  165.525 , count:  483142\nswapping partitioned embeddings ( 0 , 0 ) none\nwriting partitioned embeddings\nfinished epoch 1 / 50, edge path 1 / 1, edge chunk 1 / 1\nwriting the metadata\nwriting the checkpoint\nswitching to the new checkpoint version\n```\n\n### evaluation\n\nonce training is complete, the entity embeddings it produced can be evaluated against a held-out edge set. the `torchbiggraph_example_fb15k` command performs a *filtered* evaluation, which calculates the ranks of the edges in the evaluation set by comparing them against all other edges *except* the ones that are true positives in any of the training, validation or test set. filtered evaluation is used in the literature for fb15k, but does not scale beyond small graphs.\n\nthe final results should match the values of `mrr` (mean reciprocal rank, mrr) and `r10` (hits@10) reported in [the paper](https://www.sysml.cc/doc/2019/71.pdf):\n```\nstats: pos_rank:  65.4821 , mrr:  0.789921 , r1:  0.738501 , r10:  0.876894 , r50:  0.92647 , auc:  0.989868 , count:  59071\n```\n\nevaluation can also be run directly from the command line as follows:\n```bash\ntorchbiggraph_eval \\\n  torchbiggraph/examples/configs/fb15k_config.py \\\n  -p edge_paths=data/fb15k/freebase_mtr100_mte100-test_partitioned \\\n  -p relations.0.all_negs=true \\\n  -p num_uniform_negs=0\n```\n\nhowever, *filtered* evaluation *cannot* be performed on the command line, so the reported results will not match the paper. they will be something like:\n```\nstats: pos_rank:  234.136 , mrr:  0.239957 , r1:  0.131757 , r10:  0.485382 , r50:  0.712693 , auc:  0.989648 , count:  59071\n```\n\n### converting the output\n\nduring preprocessing, the entities and relation types had their identifiers converted from strings to ordinals. in order to map the output embeddings back onto the original names, one can do:\n```bash\ntorchbiggraph_export_to_tsv \\\n  torchbiggraph/examples/configs/fb15k_config.py \\\n  --entities-output entity_embeddings.tsv \\\n  --relation-types-output relation_types_parameters.tsv\n```\nthis will create the `entity_embeddings.tsv` file, which is a text file where each line contains the identifier of an entity followed respectively by the components of its embedding, each in a different column, all separated by tabs. for example, with each line shortened for brevity:\n```\n/m/0fphf3v\t-0.524391472\t-0.016430536\t-0.461346656\t-0.394277513\t0.125605106\t...\n/m/01bns_\t-0.122734159\t-0.091636233\t0.506501377\t-0.503864646\t0.215775326\t...\n/m/02ryvsw\t-0.107151665\t0.002058491\t-0.094485454\t-0.129078045\t-0.123694092\t...\n/m/04y6_qr\t-0.577532947\t-0.215747222\t-0.022358289\t-0.352154016\t-0.051905245\t...\n/m/02wrhj\t-0.593656778\t-0.557167351\t0.042525314\t-0.104738958\t-0.265990764\t...\n```\nit will also create a `relation_types_parameters.tsv` file which contains the parameters of the operators for the relation types. the format is similar to the above, but each line starts with more key columns containing, respectively, the name of a relation type, a side (`lhs` or `rhs`), the name of the operator which is used by that relation type on that side, the name of a parameter of that operator and the shape of the parameter (integers separated by `x`). these columns are followed by the values of the flattened parameter. for example, for two relation types, `foo` and `bar`, respectively using operators `linear` and `complex_diagonal`, with an embedding dimension of 200 and dynamic relations enabled, this file could look like:\n```\nfoo\tlhs\tlinear\tlinear_transformation\t200x200\t-0.683401227\t0.209822774\t-0.047136042\t...\nfoo\trhs\tlinear\tlinear_transformation\t200x200\t-0.695254087\t0.502532542\t-0.131654695\t...\nbar\tlhs\tcomplex_diagonal\treal\t200\t0.263731539\t1.350529909\t1.217602968\t...\nbar\tlhs\tcomplex_diagonal\timag\t200\t-0.089371338\t-0.092713356\t0.025076168\t...\nbar\trhs\tcomplex_diagonal\treal\t200\t-2.350617170\t0.529571176\t0.521403074\t...\nbar\trhs\tcomplex_diagonal\timag\t200\t0.692483306\t0.446569800\t0.235914066\t...\n```\n\n## documentation\n\nmore information can be found in [the full documentation](https://torchbiggraph.readthedocs.io/).\n\n## pre-trained embeddings\n\nwe trained a pbg model on the full [wikidata](https://www.wikidata.org/) graph, using a [translation operator](https://torchbiggraph.readthedocs.io/en/latest/scoring.html#operators) to represent relations. it can be downloaded [here](https://dl.fbaipublicfiles.com/torchbiggraph/wikidata_translation_v1.tsv.gz) (36gib, gzip-compressed). we used the truthy version of data from [here](https://dumps.wikimedia.org/wikidatawiki/entities/) to train our model. the model file is in tsv format as described in the above section. note that the first line of the file contains the number of entities, the number of relations and the dimension of the embeddings, separated by tabs. the model contains 78 million entities, 4,131 relations and the dimension of the embeddings is 200.\n\n## citation\n\nto cite this work please use:\n```tex\n@inproceedings{pbg,\n  title={{pytorch-biggraph: a large-scale graph embedding system}},\n  author={lerer, adam and wu, ledell and shen, jiajun and lacroix, timothee and wehrstedt, luca and bose, abhijit and peysakhovich, alex},\n  booktitle={proceedings of the 2nd sysml conference},\n  year={2019},\n  address={palo alto, ca, usa}\n}\n```\n\n## license\n\npytorch-biggraph is bsd licensed, as found in the [license.txt](license.txt) file.\n\n\n",
  "docs_url": null,
  "keywords": "machine-learning,knowledge-base,graph-embedding,link-prediction",
  "license": "",
  "name": "torchbiggraph",
  "package_url": "https://pypi.org/project/torchbiggraph/",
  "project_url": "https://pypi.org/project/torchbiggraph/",
  "project_urls": {
    "Bug Reports": "https://github.com/facebookresearch/PyTorch-BigGraph/issues",
    "Documentation": "https://torchbiggraph.readthedocs.io/",
    "Homepage": "https://github.com/facebookresearch/PyTorch-BigGraph",
    "Source": "https://github.com/facebookresearch/PyTorch-BigGraph"
  },
  "release_url": "https://pypi.org/project/torchbiggraph/1.0.0/",
  "requires_dist": [
    "attrs (>=18.2)",
    "h5py (>=2.8)",
    "numpy",
    "setuptools",
    "torch (>=1)",
    "tqdm",
    "Sphinx ; extra == 'docs'"
  ],
  "requires_python": ">=3.6, <4",
  "summary": "a distributed system to learn embeddings of large graphs",
  "version": "1.0.0",
  "releases": [],
  "developers": [
    "facebook_ai_research"
  ],
  "kwds": "torchbiggraph biggraph torchbiggraph_example_fb15k torchbiggraph_eval pytorch",
  "license_kwds": "",
  "libtype": "pypi",
  "id": "pypi_torchbiggraph",
  "homepage": "https://github.com/facebookresearch/pytorch-biggraph",
  "release_count": 3,
  "dependency_ids": [
    "pypi_attrs",
    "pypi_h5py",
    "pypi_numpy",
    "pypi_setuptools",
    "pypi_sphinx",
    "pypi_torch",
    "pypi_tqdm"
  ]
}