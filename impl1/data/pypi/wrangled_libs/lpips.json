{
  "classifiers": [
    "license :: osi approved :: bsd license",
    "operating system :: os independent",
    "programming language :: python :: 3"
  ],
  "description": "\n## perceptual similarity metric and dataset [[project page]](http://richzhang.github.io/perceptualsimilarity/)\n\n**the unreasonable effectiveness of deep features as a perceptual metric**  \n[richard zhang](https://richzhang.github.io/), [phillip isola](http://web.mit.edu/phillipi/), [alexei a. efros](http://www.eecs.berkeley.edu/~efros/), [eli shechtman](https://research.adobe.com/person/eli-shechtman/), [oliver wang](http://www.oliverwang.info/). in [cvpr](https://arxiv.org/abs/1801.03924), 2018.\n\n<img src='https://richzhang.github.io/perceptualsimilarity/index_files/fig1_v2.jpg' width=1200>\n\n### quick start\n\nrun `pip install lpips`. the following python code is all you need.\n\n```python\nimport lpips\nloss_fn_alex = lpips.lpips(net='alex') # best forward scores\nloss_fn_vgg = lpips.lpips(net='vgg') # closer to \"traditional\" perceptual loss, when used for optimization\n\nimport torch\nimg0 = torch.zeros(1,3,64,64) # image should be rgb, important: normalized to [-1,1]\nimg1 = torch.zeros(1,3,64,64)\nd = loss_fn_alex(img0, img1)\n```\n\nmore thorough information about variants is below. this repository contains our **perceptual metric (lpips)** and **dataset (bapps)**. it can also be used as a \"perceptual loss\". this uses pytorch; a tensorflow alternative is [here](https://github.com/alexlee-gk/lpips-tensorflow).\n\n\n**table of contents**<br>\n1. [learned perceptual image patch similarity (lpips) metric](#1-learned-perceptual-image-patch-similarity-lpips-metric)<br>\n   a. [basic usage](#a-basic-usage) if you just want to run the metric through command line, this is all you need.<br>\n   b. [\"perceptual loss\" usage](#b-backpropping-through-the-metric)<br>\n   c. [about the metric](#c-about-the-metric)<br>\n2. [berkeley-adobe perceptual patch similarity (bapps) dataset](#2-berkeley-adobe-perceptual-patch-similarity-bapps-dataset)<br>\n   a. [download](#a-downloading-the-dataset)<br>\n   b. [evaluation](#b-evaluating-a-perceptual-similarity-metric-on-a-dataset)<br>\n   c. [about the dataset](#c-about-the-dataset)<br>\n   d. [train the metric using the dataset](#d-using-the-dataset-to-train-the-metric)<br>\n\n## (0) dependencies/setup\n\n### installation\n- install pytorch 1.0+ and torchvision fom http://pytorch.org\n\n```bash\npip install -r requirements.txt\n```\n- clone this repo:\n```bash\ngit clone https://github.com/richzhang/perceptualsimilarity\ncd perceptualsimilarity\n```\n\n## (1) learned perceptual image patch similarity (lpips) metric\n\nevaluate the distance between image patches. **higher means further/more different. lower means more similar.**\n\n### (a) basic usage\n\n#### (a.i) line commands\n\nexample scripts to take the distance between 2 specific images, all corresponding pairs of images in 2 directories, or all pairs of images within a directory:\n\n```\npython lpips_2imgs.py -p0 imgs/ex_ref.png -p1 imgs/ex_p0.png --use_gpu\npython lpips_2dirs.py -d0 imgs/ex_dir0 -d1 imgs/ex_dir1 -o imgs/example_dists.txt --use_gpu\npython lpips_1dir_allpairs.py -d imgs/ex_dir_pair -o imgs/example_dists_pair.txt --use_gpu\n```\n\n#### (a.ii) python code\n\nfile [test_network.py](test_network.py) shows example usage. this snippet is all you really need.\n\n```python\nimport lpips\nloss_fn = lpips.lpips(net='alex')\nd = loss_fn.forward(im0,im1)\n```\n\nvariables ```im0, im1``` is a pytorch tensor/variable with shape ```nx3xhxw``` (```n``` patches of size ```hxw```, rgb images scaled in `[-1,+1]`). this returns `d`, a length `n` tensor/variable.\n\nrun `python test_network.py` to take the distance between example reference image [`ex_ref.png`](imgs/ex_ref.png) to distorted images [`ex_p0.png`](./imgs/ex_p0.png) and [`ex_p1.png`](imgs/ex_p1.png). before running it - which do you think *should* be closer?\n\n**some options** by default in `model.initialize`:\n- by default, `net='alex'`. network `alex` is fastest, performs the best (as a forward metric), and is the default. for backpropping, `net='vgg'` loss is closer to the traditional \"perceptual loss\".\n- by default, `lpips=true`. this adds a linear calibration on top of intermediate features in the net. set this to `lpips=false` to equally weight all the features.\n\n### (b) backpropping through the metric\n\nfile [`lpips_loss.py`](lpips_loss.py) shows how to iteratively optimize using the metric. run `python lpips_loss.py` for a demo. the code can also be used to implement vanilla vgg loss, without our learned weights.\n\n### (c) about the metric\n\n**higher means further/more different. lower means more similar.**\n\nwe found that deep network activations work surprisingly well as a perceptual similarity metric. this was true across network architectures (squeezenet [2.8 mb], alexnet [9.1 mb], and vgg [58.9 mb] provided similar scores) and supervisory signals (unsupervised, self-supervised, and supervised all perform strongly). we slightly improved scores by linearly \"calibrating\" networks - adding a linear layer on top of off-the-shelf classification networks. we provide 3 variants, using linear layers on top of the squeezenet, alexnet (default), and vgg networks.\n\nif you use lpips in your publication, please specify which version you are using. the current version is 0.1. you can set `version='0.0'` for the initial release.\n\n## (2) berkeley adobe perceptual patch similarity (bapps) dataset\n\n### (a) downloading the dataset\n\nrun `bash ./scripts/download_dataset.sh` to download and unzip the dataset into directory `./dataset`. it takes [6.6 gb] total. alternatively, run `bash ./scripts/download_dataset_valonly.sh` to only download the validation set [1.3 gb].\n- 2afc train [5.3 gb]\n- 2afc val [1.1 gb]\n- jnd val [0.2 gb]  \n\n### (b) evaluating a perceptual similarity metric on a dataset\n\nscript `test_dataset_model.py` evaluates a perceptual model on a subset of the dataset.\n\n**dataset flags**\n- `--dataset_mode`: `2afc` or `jnd`, which type of perceptual judgment to evaluate\n- `--datasets`: list the datasets to evaluate\n    - if `--dataset_mode 2afc`: choices are [`train/traditional`, `train/cnn`, `val/traditional`, `val/cnn`, `val/superres`, `val/deblur`, `val/color`, `val/frameinterp`]\n    - if `--dataset_mode jnd`: choices are [`val/traditional`, `val/cnn`]\n\n**perceptual similarity model flags**\n- `--model`: perceptual similarity model to use\n    - `lpips` for our lpips learned similarity model (linear network on top of internal activations of pretrained network)\n    - `baseline` for a classification network (uncalibrated with all layers averaged)\n    - `l2` for euclidean distance\n    - `ssim` for structured similarity image metric\n- `--net`: [`squeeze`,`alex`,`vgg`] for the `net-lin` and `net` models; ignored for `l2` and `ssim` models\n- `--colorspace`: choices are [`lab`,`rgb`], used for the `l2` and `ssim` models; ignored for `net-lin` and `net` models\n\n**misc flags**\n- `--batch_size`: evaluation batch size (will default to 1)\n- `--use_gpu`: turn on this flag for gpu usage\n\nan example usage is as follows: `python ./test_dataset_model.py --dataset_mode 2afc --datasets val/traditional val/cnn --model lpips --net alex --use_gpu --batch_size 50`. this would evaluate our model on the \"traditional\" and \"cnn\" validation datasets.\n\n### (c) about the dataset\n\nthe dataset contains two types of perceptual judgements: **two alternative forced choice (2afc)** and **just noticeable differences (jnd)**.\n\n**(1) 2afc** evaluators were given a patch triplet (1 reference + 2 distorted). they were asked to select which of the distorted was \"closer\" to the reference.\n\ntraining sets contain 2 judgments/triplet.\n- `train/traditional` [56.6k triplets]\n- `train/cnn` [38.1k triplets]\n- `train/mix` [56.6k triplets]\n\nvalidation sets contain 5 judgments/triplet.\n- `val/traditional` [4.7k triplets]\n- `val/cnn` [4.7k triplets]\n- `val/superres` [10.9k triplets]\n- `val/deblur` [9.4k triplets]\n- `val/color` [4.7k triplets]\n- `val/frameinterp` [1.9k triplets]\n\neach 2afc subdirectory contains the following folders:\n- `ref`: original reference patches\n- `p0,p1`: two distorted patches\n- `judge`: human judgments - 0 if all preferred p0, 1 if all humans preferred p1\n\n**(2) jnd** evaluators were presented with two patches - a reference and a distorted - for a limited time. they were asked if the patches were the same (identically) or different. \n\neach set contains 3 human evaluations/example.\n- `val/traditional` [4.8k pairs]\n- `val/cnn` [4.8k pairs]\n\neach jnd subdirectory contains the following folders:\n- `p0,p1`: two patches\n- `same`: human judgments: 0 if all humans thought patches were different, 1 if all humans thought patches were same\n\n### (d) using the dataset to train the metric\n\nsee script `train_test_metric.sh` for an example of training and testing the metric. the script will train a model on the full training set for 10 epochs, and then test the learned metric on all of the validation sets. the numbers should roughly match the **alex - lin** row in table 5 in the [paper](https://arxiv.org/abs/1801.03924). the code supports training a linear layer on top of an existing representation. training will add a subdirectory in the `checkpoints` directory.\n\nyou can also train \"scratch\" and \"tune\" versions by running `train_test_metric_scratch.sh` and `train_test_metric_tune.sh`, respectively. \n\n## citation\n\nif you find this repository useful for your research, please use the following.\n\n```\n@inproceedings{zhang2018perceptual,\n  title={the unreasonable effectiveness of deep features as a perceptual metric},\n  author={zhang, richard and isola, phillip and efros, alexei a and shechtman, eli and wang, oliver},\n  booktitle={cvpr},\n  year={2018}\n}\n```\n\n## acknowledgements\n\nthis repository borrows partially from the [pytorch-cyclegan-and-pix2pix](https://github.com/junyanz/pytorch-cyclegan-and-pix2pix) repository. the average precision (ap) code is borrowed from the [py-faster-rcnn](https://github.com/rbgirshick/py-faster-rcnn/blob/master/lib/datasets/voc_eval.py) repository. [angjoo kanazawa](https://github.com/akanazawa), [connelly barnes](http://www.connellybarnes.com/work/), [gaurav mittal](https://github.com/g1910), [wilhelmhb](https://github.com/wilhelmhb), [filippo mameli](https://github.com/mameli), [supershinyeyes](https://github.com/supershinyeyes), [minyoung huh](http://people.csail.mit.edu/minhuh/) helped to improve the codebase.\n\n\n",
  "docs_url": null,
  "keywords": "",
  "license": "",
  "name": "lpips",
  "package_url": "https://pypi.org/project/lpips/",
  "project_url": "https://pypi.org/project/lpips/",
  "project_urls": {
    "Homepage": "https://github.com/richzhang/PerceptualSimilarity"
  },
  "release_url": "https://pypi.org/project/lpips/0.1.4/",
  "requires_dist": [
    "torch (>=0.4.0)",
    "torchvision (>=0.2.1)",
    "numpy (>=1.14.3)",
    "scipy (>=1.0.1)",
    "tqdm (>=4.28.1)"
  ],
  "requires_python": "",
  "summary": "lpips similarity metric",
  "version": "0.1.4",
  "releases": [],
  "developers": [
    "richard_zhang",
    "rizhang@adobe.com"
  ],
  "kwds": "similarity perceptualsimilarity features perceptual zhang2018perceptual",
  "license_kwds": "",
  "libtype": "pypi",
  "id": "pypi_lpips",
  "homepage": "https://github.com/richzhang/perceptualsimilarity",
  "release_count": 5,
  "dependency_ids": [
    "pypi_numpy",
    "pypi_scipy",
    "pypi_torch",
    "pypi_torchvision",
    "pypi_tqdm"
  ]
}