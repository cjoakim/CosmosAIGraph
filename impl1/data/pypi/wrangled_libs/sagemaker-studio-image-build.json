{
  "classifiers": [
    "intended audience :: developers",
    "intended audience :: science/research",
    "programming language :: python",
    "programming language :: python :: 3",
    "programming language :: python :: 3.6",
    "programming language :: python :: 3.7"
  ],
  "description": "## sagemaker docker build\n\n[![version](https://img.shields.io/pypi/v/sagemaker-studio-image-build.svg)](https://pypi.org/project/sagemaker-studio-image-build/)\n[![code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)\n\nthis is a cli for building docker images in sagemaker studio using aws codebuild.  \n\n### usage\n\nnavigate to the directory containing the dockerfile and simply do:\n\n```bash\nsm-docker build .\n```\n \n\nany additional arguments supported with `docker build` are supported\n\n```bash\nsm-docker build . --file /path/to/dockerfile --build-arg foo=bar\n```\n\nby default, the codebuild project will not run within a vpc, the image will be pushed to a repository `sagemakerstudio` with the tag `latest`, and use the studio app's execution role and the default sagemaker python sdk s3 bucket\n\nthese can be overridden with the relevant cli options.\n\n```bash\nsm-docker build . --repository mynewrepo:1.0 --role sampledockerbuildrole --bucket sagemaker-us-east-1-326543455535 --vpc-id vpc-0c70e76ef1c603b94 --subnet-ids subnet-0d984f080338960bb,subnet-0ac3e96808c8092f2 --security-group-ids sg-0d31b4042f2902cd0\n``` \n\nthe cli will take care of packaging the current directory and uploading to s3, creating a codebuild project, starting a build with the s3 artifacts, tailing the build logs, and uploading the built image to ecr.\n\n\n### installing\n\ninstall the cli using pip.\n```bash\npip install sagemaker-studio-image-build\n```\n\nensure the execution role has a trust policy with codebuild.\n\n```json\n{\n  \"version\": \"2012-10-17\",\n  \"statement\": [\n    {\n      \"effect\": \"allow\",\n      \"principal\": {\n        \"service\": [\n          \"codebuild.amazonaws.com\"\n        ]\n      },\n      \"action\": \"sts:assumerole\"\n    }\n  ]\n}\n```\n\nthe following permissions are required in the execution role to execute a build in codebuild and push the image to ecr\n\n```json\n{\n    \"version\": \"2012-10-17\",\n    \"statement\": [\n        {\n            \"effect\": \"allow\",\n            \"action\": [\n                \"codebuild:deleteproject\",\n                \"codebuild:createproject\",\n                \"codebuild:batchgetbuilds\",\n                \"codebuild:startbuild\"\n            ],\n            \"resource\": \"arn:aws:codebuild:*:*:project/sagemaker-studio*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": \"logs:createlogstream\",\n            \"resource\": \"arn:aws:logs:*:*:log-group:/aws/codebuild/sagemaker-studio*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": [\n                \"logs:getlogevents\",\n                \"logs:putlogevents\"\n            ],\n            \"resource\": \"arn:aws:logs:*:*:log-group:/aws/codebuild/sagemaker-studio*:log-stream:*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": \"logs:createloggroup\",\n            \"resource\": \"*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": [\n                \"ecr:createrepository\",\n                \"ecr:batchgetimage\",\n                \"ecr:completelayerupload\",\n                \"ecr:describeimages\",\n                \"ecr:describerepositories\",\n                \"ecr:uploadlayerpart\",\n                \"ecr:listimages\",\n                \"ecr:initiatelayerupload\", \n                \"ecr:batchchecklayeravailability\",\n                \"ecr:putimage\"\n            ],\n            \"resource\": \"arn:aws:ecr:*:*:repository/sagemaker-studio*\"\n        },\n        {\n            \"sid\": \"readaccesstoprebuiltawsimages\",\n            \"effect\": \"allow\",\n            \"action\": [\n                \"ecr:batchgetimage\",\n                \"ecr:getdownloadurlforlayer\"\n            ],\n            \"resource\": [\n                \"arn:aws:ecr:*:763104351884:repository/*\",\n                \"arn:aws:ecr:*:217643126080:repository/*\",\n                \"arn:aws:ecr:*:727897471807:repository/*\",\n                \"arn:aws:ecr:*:626614931356:repository/*\",\n                \"arn:aws:ecr:*:683313688378:repository/*\",\n                \"arn:aws:ecr:*:520713654638:repository/*\",\n                \"arn:aws:ecr:*:462105765813:repository/*\"\n            ]\n        },\n        {\n            \"sid\": \"ecrauthorizationtokenretrieval\",\n            \"effect\": \"allow\",\n            \"action\": [\n                \"ecr:getauthorizationtoken\"\n            ],\n            \"resource\": [\n                \"*\"\n            ]\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": [\n              \"s3:getobject\",\n              \"s3:deleteobject\",\n              \"s3:putobject\"\n              ],\n            \"resource\": \"arn:aws:s3:::sagemaker-*/*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": [\n                \"s3:createbucket\"\n            ],\n            \"resource\": \"arn:aws:s3:::sagemaker*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": [\n                \"iam:getrole\",\n                \"iam:listroles\"\n            ],\n            \"resource\": \"*\"\n        },\n        {\n            \"effect\": \"allow\",\n            \"action\": \"iam:passrole\",\n            \"resource\": \"arn:aws:iam::*:role/*\",\n            \"condition\": {\n                \"stringlikeifexists\": {\n                    \"iam:passedtoservice\": \"codebuild.amazonaws.com\"\n                }\n            }\n        }\n    ]\n}\n\n```\n\nif you need to run your codebuild project within a vpc, please add the following actions to your execution role that the codebuild project will assume:\n\n```json\n        {\n            \"sid\": \"vpcaccessactions\",\n            \"effect\": \"allow\",\n            \"action\": [\n                \"ec2:createnetworkinterface\",\n                \"ec2:createnetworkinterfacepermission\",\n                \"ec2:describedhcpoptions\",\n                \"ec2:describenetworkinterfaces\",\n                \"ec2:deletenetworkinterface\",\n                \"ec2:describesubnets\",\n                \"ec2:describesecuritygroups\",\n                \"ec2:describevpcs\"\n            ],\n            \"resource\": \"*\"\n        }\n```\n\n### development\n\ncheckout the repository.\n\n```bash\nmake install\n```\n\n#### testing locally\nto build locally, use one of the example dockerfiles in the *examples* directory\n\n```bash\nrole_name=<<a role in your account to use in the codebuild build job>>\n(cd examples/basic_build && sm-docker build . --role ${role_name} )\n```\n\n```bash\n(cd examples/build_with_args && sm-docker build . --role ${role_name} --file dockerfile.args --build-arg base_image=python:3.8 )\n```\n\n\n#### testing on sagemaker studio\n\nto build a binary to use on sagemaker studio, specify an s3 path and use the *s3bundle* target.\n\n```bash\nexport dev_s3_path_prefix=s3://path/to/location\nblack .\nmake -k s3bundle\n```\n\nfrom a \"system terminal\" in sagemaker studio\n\n```bash\nexport dev_s3_path_prefix=s3://path/to/location\naws s3 sync ${dev_s3_path_prefix}/sagemaker-docker-build/dist . \npip install sagemaker_studio_image_build-x.y.z.tar.gz\n```\n\n## security\n\nsee [contributing](contributing.md#security-issue-notifications) for more information.\n\n## license\n\nthis library is licensed under the mit-0 license. see the license file.",
  "docs_url": null,
  "keywords": "",
  "license": "mit-0",
  "name": "sagemaker-studio-image-build",
  "package_url": "https://pypi.org/project/sagemaker-studio-image-build/",
  "project_url": "https://pypi.org/project/sagemaker-studio-image-build/",
  "project_urls": {
    "Homepage": "https://github.com/aws-samples/sagemaker-studio-image-build-cli"
  },
  "release_url": "https://pypi.org/project/sagemaker-studio-image-build/0.6.0/",
  "requires_dist": [],
  "requires_python": ">=3.6",
  "summary": "build docker images in amazon sagemaker studio using aws codebuild",
  "version": "0.6.0",
  "releases": [],
  "developers": [
    "amazon_web_services"
  ],
  "kwds": "sagemaker_studio_image_build dockerfile dockerfiles sagemaker docker",
  "license_kwds": "mit-0",
  "libtype": "pypi",
  "id": "pypi_sagemaker_studio_image_build",
  "homepage": "https://github.com/aws-samples/sagemaker-studio-image-build-cli",
  "release_count": 4,
  "dependency_ids": []
}