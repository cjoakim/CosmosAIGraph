{
  "libtype": "npm",
  "libname": "ses",
  "url": "https://github.com/agoric/ses-shim/tree/master/packages/ses#readme",
  "html": "{\"payload\":{\"allShortcutsEnabled\":false,\"path\":\"packages/ses\",\"repo\":{\"id\":220080707,\"defaultBranch\":\"master\",\"name\":\"endo\",\"ownerLogin\":\"endojs\",\"currentUserCanPush\":false,\"isFork\":false,\"isEmpty\":false,\"createdAt\":\"2019-11-06T20:09:57.000Z\",\"ownerAvatar\":\"https://avatars.githubusercontent.com/u/9937112?v=4\",\"public\":true,\"private\":false,\"isOrgOwned\":true},\"currentUser\":null,\"refInfo\":{\"name\":\"master\",\"listCacheKey\":\"v0:1709504927.0\",\"canEdit\":false,\"refType\":\"branch\",\"currentOid\":\"111c2ffca7455f478281f3ecadb38f959306d345\"},\"tree\":{\"items\":[{\"name\":\"demos\",\"path\":\"packages/ses/demos\",\"contentType\":\"directory\"},{\"name\":\"docs\",\"path\":\"packages/ses/docs\",\"contentType\":\"directory\"},{\"name\":\"error-codes\",\"path\":\"packages/ses/error-codes\",\"contentType\":\"directory\"},{\"name\":\"scripts\",\"path\":\"packages/ses/scripts\",\"contentType\":\"directory\"},{\"name\":\"src\",\"path\":\"packages/ses/src\",\"contentType\":\"directory\"},{\"name\":\"test\",\"path\":\"packages/ses/test\",\"contentType\":\"directory\"},{\"name\":\"test262\",\"path\":\"packages/ses/test262\",\"contentType\":\"directory\"},{\"name\":\"CHANGELOG.md\",\"path\":\"packages/ses/CHANGELOG.md\",\"contentType\":\"file\"},{\"name\":\"LICENSE\",\"path\":\"packages/ses/LICENSE\",\"contentType\":\"file\"},{\"name\":\"LICENSE-aura\",\"path\":\"packages/ses/LICENSE-aura\",\"contentType\":\"file\"},{\"name\":\"LICENSE-caja\",\"path\":\"packages/ses/LICENSE-caja\",\"contentType\":\"file\"},{\"name\":\"LICENSE-corejs\",\"path\":\"packages/ses/LICENSE-corejs\",\"contentType\":\"file\"},{\"name\":\"LICENSE-v8\",\"path\":\"packages/ses/LICENSE-v8\",\"contentType\":\"file\"},{\"name\":\"NEWS.md\",\"path\":\"packages/ses/NEWS.md\",\"contentType\":\"file\"},{\"name\":\"README.md\",\"path\":\"packages/ses/README.md\",\"contentType\":\"file\"},{\"name\":\"SECURITY.md\",\"path\":\"packages/ses/SECURITY.md\",\"contentType\":\"file\"},{\"name\":\"_redirects\",\"path\":\"packages/ses/_redirects\",\"contentType\":\"file\"},{\"name\":\"assert-shim.js\",\"path\":\"packages/ses/assert-shim.js\",\"contentType\":\"file\"},{\"name\":\"compartment-shim.js\",\"path\":\"packages/ses/compartment-shim.js\",\"contentType\":\"file\"},{\"name\":\"index.js\",\"path\":\"packages/ses/index.js\",\"contentType\":\"file\"},{\"name\":\"lockdown-shim.js\",\"path\":\"packages/ses/lockdown-shim.js\",\"contentType\":\"file\"},{\"name\":\"lockdown.js\",\"path\":\"packages/ses/lockdown.js\",\"contentType\":\"file\"},{\"name\":\"package.json\",\"path\":\"packages/ses/package.json\",\"contentType\":\"file\"},{\"name\":\"package.json.md\",\"path\":\"packages/ses/package.json.md\",\"contentType\":\"file\"},{\"name\":\"tools.js\",\"path\":\"packages/ses/tools.js\",\"contentType\":\"file\"},{\"name\":\"tsconfig.json\",\"path\":\"packages/ses/tsconfig.json\",\"contentType\":\"file\"},{\"name\":\"typedoc.json\",\"path\":\"packages/ses/typedoc.json\",\"contentType\":\"file\"},{\"name\":\"types.d.ts\",\"path\":\"packages/ses/types.d.ts\",\"contentType\":\"file\"},{\"name\":\"types.test-d.ts\",\"path\":\"packages/ses/types.test-d.ts\",\"contentType\":\"file\"}],\"templateDirectorySuggestionUrl\":null,\"readme\":{\"displayName\":\"README.md\",\"richText\":\"<article class=\\\"markdown-body entry-content container-lg\\\" itemprop=\\\"text\\\"><div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h1 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">SES</h1><a id=\\\"user-content-ses\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: SES\\\" href=\\\"#ses\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">SES is <em>hardened JavaScript</em>. SES stands for <em>fearless cooperation</em>.\\nThis package is a SES <a href=\\\"https://en.wikipedia.org/wiki/Shim_(computing)\\\" rel=\\\"nofollow\\\">shim</a> for JavaScript features\\n<a href=\\\"https://github.com/tc39/proposal-ses\\\">proposed</a> to ECMA\u00a0TC39.\\nHardened JavaScript is highly compatible with ordinary JavaScript.\\nMost existing JavaScript libraries can run on hardened JavaScript.</p>\\n<ul dir=\\\"auto\\\">\\n<li><strong>Compartments</strong> Compartments are separate execution contexts: each one has\\nits own global object and global lexical scope.</li>\\n<li><strong>Frozen realm</strong> Compartments share their intrinsics to avoid identity\\ndiscontinuity. By freezing the intrinsics, SES protects programs from each\\nother. By sharing the intrinsics, programs from separate compartments\\ncan recognize each other's arrays, data objects, and so on.</li>\\n<li><strong>Strict mode</strong> SES enforces JavaScript strict mode that enhances security,\\nfor example by changing some silent failures into thrown errors.</li>\\n<li><strong>POLA</strong> (Principle of Least Authority) By default, Compartments receive no\\nambient authority. They are created without host-provided APIs, (for example\\nno <code>fetch</code>). Compartments can be selectively endowed with powerful arguments,\\nglobals, or modules.</li>\\n</ul>\\n<p dir=\\\"auto\\\">SES safely executes third-party JavaScript 'strict' mode programs in\\ncompartments that have no excess authority in their global scope.\\nSES runs atop an ES6-compliant platform, enabling safe interaction of\\nmutually-suspicious code, using object-capability -style programming.</p>\\n<p dir=\\\"auto\\\">See <a href=\\\"https://github.com/Agoric/Jessie\\\">https://github.com/Agoric/Jessie</a> to see how SES fits into the various\\nflavors of confined JavaScript execution. And visit\\n<a href=\\\"https://ses-demo.agoric.app/demos/\\\" rel=\\\"nofollow\\\">https://ses-demo.agoric.app/demos/</a> for a demo.</p>\\n<p dir=\\\"auto\\\">SES starts where the Caja project left off\\n<a href=\\\"https://github.com/google/caja/wiki/SES\\\">https://github.com/google/caja/wiki/SES</a>, and goes on to introduce compartments\\nand modernize the permitted JavaScript features.</p>\\n<p dir=\\\"auto\\\">Please join the conversation on our <a href=\\\"https://groups.google.com/g/ses-strategy\\\" rel=\\\"nofollow\\\">Mailing List</a> and\\n<a href=\\\"https://matrix.to/#/#endojs:matrix.org\\\" rel=\\\"nofollow\\\">Matrix</a>.\\nWe record a <a href=\\\"https://www.youtube.com/playlist?list=PLzDw4TTug5O1jzKodRDp3qec8zl88oxGd\\\" rel=\\\"nofollow\\\">weekly conference call</a> with the Hardened\\nJavaScript engineering community.</p>\\n<p dir=\\\"auto\\\"><em>Hardened JavaScript</em>, Kris Kowal:</p>\\n<p dir=\\\"auto\\\"><a href=\\\"https://www.youtube.com/watch?v=RZ7bBIU8DRc\\\" rel=\\\"nofollow\\\"><img src=\\\"https://camo.githubusercontent.com/997b8e449573bd20e4266e48793b033411c48d2053cacc612b27269cd3983802/68747470733a2f2f696d672e796f75747562652e636f6d2f76692f525a3762424955384452632f302e6a7067\\\" alt=\\\"Primer on Hardened JavaScript\\\" data-canonical-src=\\\"https://img.youtube.com/vi/RZ7bBIU8DRc/0.jpg\\\" style=\\\"max-width: 100%;\\\"></a></p>\\n<p dir=\\\"auto\\\"><em>Don't add Security, Remove Insecurity</em>, Mark Miller:</p>\\n<p dir=\\\"auto\\\"><a href=\\\"https://www.youtube.com/watch?v=u-XETUbxNUU\\\" rel=\\\"nofollow\\\"><img src=\\\"https://camo.githubusercontent.com/c33548927d61cc2dd1414ccd380e65fe38c7b12d52b4eb65b7f3654595c0b7d9/68747470733a2f2f696d672e796f75747562652e636f6d2f76692f752d5845545562784e55552f302e6a7067\\\" alt=\\\"Don't add Security, Remove Insecurity\\\" data-canonical-src=\\\"https://img.youtube.com/vi/u-XETUbxNUU/0.jpg\\\" style=\\\"max-width: 100%;\\\"></a></p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h2 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Install</h2><a id=\\\"user-content-install\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Install\\\" href=\\\"#install\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<div class=\\\"highlight highlight-source-shell notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"npm install ses\\\"><pre>npm install ses</pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h2 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Usage</h2><a id=\\\"user-content-usage\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Usage\\\" href=\\\"#usage\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">The SES shim runs in most engines, either as an ESM module <code>ses</code> or as a\\n<code>&lt;script&gt;</code> tag.\\nFor a script tag, the content encoding charset must be UTF-8, either by virtue\\nof <code>&lt;head&gt;&lt;meta charset=\\\"utf-8\\\"&gt;&lt;/head&gt;</code> (a general best practice for all HTML\\nfiles) or specifically <code>&lt;script src=\\\"node_modules/ses/dist/ses.umd.min.js\\\" charset=\\\"utf-8\\\"&gt;</code>.</p>\\n<p dir=\\\"auto\\\">SES can be bundled by Webpack, Browseriy, Rollup, and Parcel, but any of these\\ntools could be coopted with a supply-chain attack to invalidate the security\\nproperties of SES.  We generally recommend installing SES as a separate script\\ntag.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Lockdown</h3><a id=\\\"user-content-lockdown\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Lockdown\\\" href=\\\"#lockdown\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">SES introduces the <code>lockdown()</code> function.\\nCalling <code>lockdown()</code> alters the surrounding execution environment, or\\n<strong>realm</strong>, such that no two programs running in the same realm can observe or\\naffect each other until they have been introduced, and even then can only\\ninteract through their own exposed interfaces.</p>\\n<p dir=\\\"auto\\\">To do this, <code>lockdown()</code> tamper-proofs all of the JavaScript intrinsics, to\\nprevent <strong>prototype pollution</strong>.\\nAfter that, no program can subvert the methods of these objects (preventing\\nsome <strong>man in the middle attacks</strong>).\\nAlso, no program can use these mutable objects to pass notes to parties that\\nhaven't been expressly introduced (preventing some <strong>covert communication\\nchannels</strong>).</p>\\n<p dir=\\\"auto\\\">Lockdown freezes all objects that are effectively undeniable to programs in the\\nrealm. The set of such objects includes but is not limited to: <code>globalThis</code>,\\nprototype objects of Array, Function, GeneratorFunction, and Object, and objects\\naccessible from those objects (such as <code>Object.prototype.toString</code>).</p>\\n<p dir=\\\"auto\\\">The <code>lockdown()</code> function also <strong>tames</strong> some objects including regular\\nexpressions, locale methods, and errors.\\nA tamed <code>RegExp</code> does not have the deprecated <code>compile</code> method.\\nA tamed error does not have a V8 <code>stack</code>, but the <code>console</code> can still see the\\nstack.\\nLockdown replaces locale methods like <code>String.prototype.localeCompare</code> with\\ngeneric versions that do not reveal the host locale.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"import 'ses';\\n\\nlockdown();\\n\\nconsole.log(Object.isFrozen([].__proto__));\\n// true\\\"><pre><span class=\\\"pl-k\\\">import</span> <span class=\\\"pl-s\\\">'ses'</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-en\\\">lockdown</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-smi\\\">console</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">log</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-v\\\">Object</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">isFrozen</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">[</span><span class=\\\"pl-kos\\\">]</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">__proto__</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-c\\\">// true</span></pre></div>\\n<p dir=\\\"auto\\\">Lockdown does not erase any powerful objects from the initial global scope.\\nInstead, <strong>Compartments</strong> give complete control over what powerful objects\\nexist for client code.</p>\\n<p dir=\\\"auto\\\">See <a href=\\\"/endojs/endo/blob/master/packages/ses/docs/lockdown.md\\\"><code>lockdown</code> options</a> for configuration options to\\n<code>lockdown</code>. However, all of these have sensible defaults that should\\nwork for most projects out of the box.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Harden</h3><a id=\\\"user-content-harden\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Harden\\\" href=\\\"#harden\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">SES introduces the <code>harden</code> function.\\n<em>After</em> calling <code>lockdown</code>, the <code>harden</code> function ensures that every object in\\nthe transitive closure over property and prototype access starting with that\\nobject has been <strong>frozen</strong> by <code>Object.freeze</code>.\\nThis means that the object can be passed among programs and none of those\\nprograms will be able to tamper with the <strong>surface</strong> of that object graph.\\nThey can only read the surface data and call the surface functions.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"import 'ses';\\n\\nlockdown();\\n\\nlet counter = 0;\\nconst capability = harden({\\n  inc() {\\n    counter++;\\n  },\\n});\\n\\nconsole.log(Object.isFrozen(capability));\\n// true\\nconsole.log(Object.isFrozen(capability.inc));\\n// true\\\"><pre><span class=\\\"pl-k\\\">import</span> <span class=\\\"pl-s\\\">'ses'</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-en\\\">lockdown</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">let</span> <span class=\\\"pl-s1\\\">counter</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-c1\\\">0</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">capability</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-en\\\">harden</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-en\\\">inc</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-s1\\\">counter</span><span class=\\\"pl-c1\\\">++</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-smi\\\">console</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">log</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-v\\\">Object</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">isFrozen</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">capability</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-c\\\">// true</span>\\n<span class=\\\"pl-smi\\\">console</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">log</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-v\\\">Object</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">isFrozen</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">capability</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">inc</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-c\\\">// true</span></pre></div>\\n<p dir=\\\"auto\\\">Note that although the <strong>surface</strong> of the capability is frozen, the capability\\nstill closes over the mutable counter.\\nHardening an object graph makes the surface immutable, but does not guarantee\\nthat methods are free of side effects.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Compartment</h3><a id=\\\"user-content-compartment\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Compartment\\\" href=\\\"#compartment\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">SES introduces the <code>Compartment</code> constructor.\\nA compartment is an evaluation and execution environment with its own\\n<code>globalThis</code> and wholly independent system of modules, but otherwise shares\\nthe same batch of intrinsics like <code>Array</code> with the surrounding compartment.\\nThe concept of a compartment implies an <strong>initial compartment</strong>, the initial\\nexecution environment of a <strong>realm</strong>.</p>\\n<p dir=\\\"auto\\\">In the following example, we create a compartment endowed with a <code>print()</code>\\nfunction on <code>globalThis</code>.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"import 'ses';\\n\\nconst c = new Compartment({\\n  print: harden(console.log),\\n});\\n\\nc.evaluate(`\\n  print('Hello! Hello?');\\n`);\\\"><pre><span class=\\\"pl-k\\\">import</span> <span class=\\\"pl-s\\\">'ses'</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-c1\\\">print</span>: <span class=\\\"pl-en\\\">harden</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-smi\\\">console</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">log</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">`</span>\\n<span class=\\\"pl-s\\\">  print('Hello! Hello?');</span>\\n<span class=\\\"pl-s\\\">`</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<p dir=\\\"auto\\\">The new compartment has a different global object than the start compartment.\\nThe global object is initially mutable.\\nLocking down the realm hardened the objects in global scope.\\nAfter <code>lockdown</code>, no compartment can tamper with these <strong>intrinsics</strong> and\\n<strong>undeniable</strong> objects.\\nMany of these are identical in the new compartment.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const c = new Compartment();\\nc.globalThis === globalThis; // false\\nc.globalThis.JSON === JSON; // true\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s1\\\">globalThis</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// false</span>\\n<span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">JSON</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-c1\\\">JSON</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// true</span></pre></div>\\n<p dir=\\\"auto\\\">Other pairs of compartments also share many identical intrinsics and undeniable\\nobjects of the realm.\\nEach has a unique, initially mutable, global object.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const c1 = new Compartment();\\nconst c2 = new Compartment();\\nc1.globalThis === c2.globalThis; // false\\nc1.globalThis.JSON === c2.globalThis.JSON; // true\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c1</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c2</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">c1</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s1\\\">c2</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// false</span>\\n<span class=\\\"pl-s1\\\">c1</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">JSON</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s1\\\">c2</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">JSON</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// true</span></pre></div>\\n<p dir=\\\"auto\\\">The global scope of every compartment includes a shallow, specialized copy of\\nthe JavaScript intrinsics, disabling <code>Math.random</code>, <code>Date.now</code> and the\\nbehaviors of the <code>Date</code> constructor which would reveal the current time.\\nCompartments leave these out since they can be used as covert communication\\nchannels between programs.\\nHowever, a compartment may be expressly given access to these objects\\nthrough:</p>\\n<ul dir=\\\"auto\\\">\\n<li>the first argument to the compartment constructor or</li>\\n<li>by assigning them to the compartment's <code>globalThis</code> after construction.</li>\\n</ul>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const powerfulCompartment = new Compartment({ Math });\\npowerfulCompartment.globalThis.Date = Date;\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">powerfulCompartment</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span> Math <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">powerfulCompartment</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">Date</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-v\\\">Date</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Compartment + Lockdown</h3><a id=\\\"user-content-compartment--lockdown\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Compartment + Lockdown\\\" href=\\\"#compartment--lockdown\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Together, Compartment and lockdown isolate client code in an environment with\\nlimited powers and communication channels.\\nA compartment has only the capabilities it is expressly given and cannot modify\\nany of the shared intrinsics.\\nEvery compartment gets its own globals, including such objects as the\\n<code>Function</code> constructor.\\nYet, compartment and lockdown do not break <code>instanceof</code> for any of these\\nintrinsics types!</p>\\n<p dir=\\\"auto\\\">All of the evaluators in one compartment are captured by that compartment's\\nglobal scope, including <code>Function</code>, indirect <code>eval</code>, dynamic <code>import</code>, and its\\nown <code>Compartment</code> constructor for child compartments.\\nFor example, the <code>Function</code> constructor in one compartment creates functions\\nthat evaluate in the global scope of that compartment.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const c1 = new Compartment();\\nconst f1 = new c.globalThis.Function('return globalThis');\\nf1() === c1.globalThis; // true\\n\\nconst c2 = new Compartment();\\nconst f2 = new c.globalThis.Function('return globalThis');\\nf2() === c2.globalThis; // true\\n\\nf1() === f2(); // false\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c1</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">f1</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">Function</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'return globalThis'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">f1</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s1\\\">c1</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// true</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c2</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">f2</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">Function</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'return globalThis'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">f2</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s1\\\">c2</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globalThis</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// true</span>\\n\\n<span class=\\\"pl-s1\\\">f1</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s1\\\">f2</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span> <span class=\\\"pl-c\\\">// false</span></pre></div>\\n<p dir=\\\"auto\\\">Lockdown prepares for compartments with separate globals by freezing\\ntheir shared prototypes and replacing their prototype constructors\\nwith powerless dummies.\\nSo, <code>Function</code> is different in two compartments, <code>Function.prototype</code> is the\\nsame, and <code>Function</code> is not the same as <code>Function.prototype.constructor</code>.\\nThe <code>Function.prototype.constructor</code> can only throw exceptions.\\nSo, a function passed between compartments does not carry access to\\nits compartment's globals along with it.\\nYet, <code>f instanceof Function</code> works, even when <code>f</code> and <code>Function</code> are\\nfrom different compartments.</p>\\n<p dir=\\\"auto\\\">The <code>globalThis</code> in each compartment is mutable.\\nThis can and should be frozen before running any dynamic code in that\\ncompartment, yet is not strictly necessary if the compartment only\\nruns code from a single party.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Modules</h3><a id=\\\"user-content-modules\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Modules\\\" href=\\\"#modules\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Any code executed within a compartment shares a set of module instances.\\nFor modules to work within a compartment, the creator must provide\\na <code>resolveHook</code> and an <code>importHook</code>.\\nThe <code>resolveHook</code> determines how the compartment will infer the full module\\nspecifier for another module from a referrer module and the import specifier.\\nThe <code>importHook</code> accepts a full specifier and asynchronously returns a\\n<code>StaticModuleRecord</code> for that module.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"import 'ses';\\nimport { StaticModuleRecord } from '@endo/static-module-record';\\n\\nconst c1 = new Compartment({}, {}, {\\n  name: &quot;first compartment&quot;,\\n  resolveHook: (moduleSpecifier, moduleReferrer) =&gt; {\\n    return resolve(moduleSpecifier, moduleReferrer);\\n  },\\n  importHook: async moduleSpecifier =&gt; {\\n    const moduleLocation = locate(moduleSpecifier);\\n    const moduleText = await retrieve(moduleLocation);\\n    return new StaticModuleRecord(moduleText, moduleLocation);\\n  },\\n});\\\"><pre><span class=\\\"pl-k\\\">import</span> <span class=\\\"pl-s\\\">'ses'</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">import</span> <span class=\\\"pl-kos\\\">{</span> <span class=\\\"pl-v\\\">StaticModuleRecord</span> <span class=\\\"pl-kos\\\">}</span> <span class=\\\"pl-k\\\">from</span> <span class=\\\"pl-s\\\">'@endo/static-module-record'</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c1</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-c1\\\">name</span>: <span class=\\\"pl-s\\\">\\\"first compartment\\\"</span><span class=\\\"pl-kos\\\">,</span>\\n  <span class=\\\"pl-en\\\">resolveHook</span>: <span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleSpecifier</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-s1\\\">moduleReferrer</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-k\\\">return</span> <span class=\\\"pl-en\\\">resolve</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleSpecifier</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-s1\\\">moduleReferrer</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span>\\n  <span class=\\\"pl-en\\\">importHook</span>: <span class=\\\"pl-k\\\">async</span> <span class=\\\"pl-s1\\\">moduleSpecifier</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">moduleLocation</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-en\\\">locate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleSpecifier</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n    <span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">moduleText</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">await</span> <span class=\\\"pl-en\\\">retrieve</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleLocation</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n    <span class=\\\"pl-k\\\">return</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">StaticModuleRecord</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleText</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-s1\\\">moduleLocation</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<blockquote>\\n<p dir=\\\"auto\\\">The SES language specifies a global <code>StaticModuleRecord</code>, but this is not\\nprovided by the shim because it entrains a full JavaScript parser that is an\\nunnecessary performance penalty for the SES runtime.\\nInstead, the SES shim accepts a compiled static module record duck-type that\\nis tightly coupled to the shim implementation.\\nThird party modules can provide suitable implementations and even move the\\ncompile step to build time instead of runtime.</p>\\n</blockquote>\\n<p dir=\\\"auto\\\">A compartment can also link a module in another compartment.\\nEach compartment has a <code>module</code> function that accepts a module specifier\\nand returns the module exports namespace for that module.\\nThe module exports namespace is not useful for inspecting the exports of the\\nmodule until that module has been imported, but it can be passed into the\\nmodule map of another Compartment, creating a link.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const c2 = new Compartment({}, {\\n  'c1': c1.module('./main.js'),\\n}, {\\n  name: &quot;second compartment&quot;,\\n  resolveHook,\\n  importHook,\\n});\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c2</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-s\\\">'c1'</span>: <span class=\\\"pl-s1\\\">c1</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">module</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'./main.js'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-c1\\\">name</span>: <span class=\\\"pl-s\\\">\\\"second compartment\\\"</span><span class=\\\"pl-kos\\\">,</span>\\n  resolveHook<span class=\\\"pl-kos\\\">,</span>\\n  importHook<span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">importHook aliases</h3><a id=\\\"user-content-importhook-aliases\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: importHook aliases\\\" href=\\\"#importhook-aliases\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">If a compartment imports a module specified as <code>\\\"./utility\\\"</code> but actually\\nimplemented by an alias like <code>\\\"./utility/index.js\\\"</code>, the <code>importHook</code> may\\nfollow redirects, symbolic links, or search for candidates using its own logic\\nand return a module that has a different \\\"response specifier\\\" than the original\\n\\\"request specifier\\\".\\nThe <code>importHook</code> may return an \\\"alias\\\" object with <code>record</code>, <code>compartment</code>,\\nand <code>module</code> properties.</p>\\n<ul dir=\\\"auto\\\">\\n<li><code>record</code> must be a static module record, either a third-party module record\\nor a compiled static module record.</li>\\n<li><code>compartment</code> is optional, to be specified if the alias transits to a\\ndifferent compartment, and</li>\\n<li><code>specifier</code> is the full module specifier of the module in its compartment.\\nThis defaults to the request specifier, which is only useful if the\\ncompartment is different.</li>\\n</ul>\\n<p dir=\\\"auto\\\">In the following example, the importHook searches for a file and returns an\\nalias.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const importHook = async specifier =&gt; {\\n  const candidates = [specifier, `${specifier}.js`, `${specifier}/index.js`];\\n  for (const candidate of candidates) {\\n    const record = await wrappedImportHook(candidate).catch(_ =&gt; undefined);\\n    if (record !== undefined) {\\n      return { record, specifier };\\n    }\\n  }\\n  throw new Error(`Cannot find module ${specifier}`);\\n};\\n\\nconst compartment = new Compartment({}, {}, {\\n  resolveHook,\\n  importHook,\\n});\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-en\\\">importHook</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">async</span> <span class=\\\"pl-s1\\\">specifier</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">candidates</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-kos\\\">[</span><span class=\\\"pl-s1\\\">specifier</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-s\\\">`<span class=\\\"pl-s1\\\"><span class=\\\"pl-kos\\\">${</span><span class=\\\"pl-s1\\\">specifier</span><span class=\\\"pl-kos\\\">}</span></span>.js`</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-s\\\">`<span class=\\\"pl-s1\\\"><span class=\\\"pl-kos\\\">${</span><span class=\\\"pl-s1\\\">specifier</span><span class=\\\"pl-kos\\\">}</span></span>/index.js`</span><span class=\\\"pl-kos\\\">]</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-k\\\">for</span> <span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">candidate</span> <span class=\\\"pl-k\\\">of</span> <span class=\\\"pl-s1\\\">candidates</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">record</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">await</span> <span class=\\\"pl-en\\\">wrappedImportHook</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">candidate</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">catch</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">_</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-c1\\\">undefined</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n    <span class=\\\"pl-k\\\">if</span> <span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">record</span> <span class=\\\"pl-c1\\\">!==</span> <span class=\\\"pl-c1\\\">undefined</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-kos\\\">{</span>\\n      <span class=\\\"pl-k\\\">return</span> <span class=\\\"pl-kos\\\">{</span> record<span class=\\\"pl-kos\\\">,</span> specifier <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">;</span>\\n    <span class=\\\"pl-kos\\\">}</span>\\n  <span class=\\\"pl-kos\\\">}</span>\\n  <span class=\\\"pl-k\\\">throw</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Error</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">`Cannot find module <span class=\\\"pl-s1\\\"><span class=\\\"pl-kos\\\">${</span><span class=\\\"pl-s1\\\">specifier</span><span class=\\\"pl-kos\\\">}</span></span>`</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">compartment</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  resolveHook<span class=\\\"pl-kos\\\">,</span>\\n  importHook<span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">moduleMapHook</h3><a id=\\\"user-content-modulemaphook\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: moduleMapHook\\\" href=\\\"#modulemaphook\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">The module map above allows modules to be introduced to a compartment up-front.\\nSome modules cannot be known that early.\\nFor example, in Node.js, a package might have a dependency that brings in an\\nentire subtree of modules.\\nAlso, a pair of compartments with cyclic dependencies between modules they each\\ncontain cannot use <code>compartment.module</code> to link the second compartment\\nconstructed to the first.\\nFor these cases, the <code>Compartment</code> constructor accepts a <code>moduleMapHook</code> option\\nthat is like the dynamic version of the static <code>moduleMap</code> argument.\\nThis is a function that accepts a module specifier and returns the module\\nnamespace for that module specifier, or <code>undefined</code>.\\nIf the <code>moduleMapHook</code> returns <code>undefined</code>, the compartment proceeds to the\\n<code>importHook</code> to attempt to asynchronously obtain the module's source.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const moduleMapHook = moduleSpecifier =&gt; {\\n  if (moduleSpecifier === 'even') {\\n    return even.module('./index.js');\\n  } else if (moduleSpecifier === 'odd') {\\n    return odd.module('./index.js');\\n  }\\n};\\n\\nconst even = new Compartment({}, {}, {\\n  resolveHook: nodeResolveHook,\\n  importHook: makeImportHook('https://example.com/even'),\\n  moduleMapHook,\\n});\\n\\nconst odd = new Compartment({}, {}, {\\n  resolveHook: nodeResolveHook,\\n  importHook: makeImportHook('https://example.com/odd'),\\n  moduleMapHook,\\n});\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-en\\\">moduleMapHook</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-s1\\\">moduleSpecifier</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-k\\\">if</span> <span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleSpecifier</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s\\\">'even'</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-k\\\">return</span> <span class=\\\"pl-s1\\\">even</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">module</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'./index.js'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-kos\\\">}</span> <span class=\\\"pl-k\\\">else</span> <span class=\\\"pl-k\\\">if</span> <span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">moduleSpecifier</span> <span class=\\\"pl-c1\\\">===</span> <span class=\\\"pl-s\\\">'odd'</span><span class=\\\"pl-kos\\\">)</span> <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-k\\\">return</span> <span class=\\\"pl-s1\\\">odd</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">module</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'./index.js'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-kos\\\">}</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">even</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-c1\\\">resolveHook</span>: <span class=\\\"pl-s1\\\">nodeResolveHook</span><span class=\\\"pl-kos\\\">,</span>\\n  <span class=\\\"pl-c1\\\">importHook</span>: <span class=\\\"pl-en\\\">makeImportHook</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'https://example.com/even'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">,</span>\\n  moduleMapHook<span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">odd</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span><span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-c1\\\">resolveHook</span>: <span class=\\\"pl-s1\\\">nodeResolveHook</span><span class=\\\"pl-kos\\\">,</span>\\n  <span class=\\\"pl-c1\\\">importHook</span>: <span class=\\\"pl-en\\\">makeImportHook</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'https://example.com/odd'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">,</span>\\n  moduleMapHook<span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Third-party modules</h3><a id=\\\"user-content-third-party-modules\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Third-party modules\\\" href=\\\"#third-party-modules\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">To incorporate modules not implemented as JavaScript modules, third-parties may\\nimplement a <code>StaticModuleRecord</code> interface.\\nThe record must have an <code>imports</code> array and an <code>execute</code> method.\\nThe compartment will call <code>execute</code> with:</p>\\n<ol dir=\\\"auto\\\">\\n<li>the proxied <code>exports</code> namespace object,</li>\\n<li>a <code>resolvedImports</code> object that maps import names (from <code>imports</code>) to their\\ncorresponding resolved specifiers (through the compartment's <code>resolveHook</code>),\\nand</li>\\n<li>the <code>compartment</code>, such that <code>importNow</code> can obtain any of the module's\\nspecified <code>imports</code>.</li>\\n</ol>\\n<p dir=\\\"auto\\\"><g-emoji class=\\\"g-emoji\\\" alias=\\\"warning\\\">\u26a0\ufe0f</g-emoji> A future breaking version may allow the <code>importNow</code> and the <code>execute</code>\\nmethod of third-party static module records to return promises, to support\\ntop-level await.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Compiled modules</h3><a id=\\\"user-content-compiled-modules\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Compiled modules\\\" href=\\\"#compiled-modules\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Instead of the <code>StaticModuleRecord</code> constructor specified for the SES language,\\nthe SES shim uses compiled static module records as a stand-in.\\nThese can be created with a <code>StaticModuleRecord</code> constructor from a package\\nlike <code>@endo/static-module-record</code>.\\nWe omitted <code>StaticModuleRecord</code> from the SES shim because it entrains a heavy\\ndependency on a JavaScript parser.\\nThe shim depends upon a <code>StaticModuleRecord</code> constructor to analyze and\\ntransform the source of a JavaScript module (known as an ESM or a <code>.mjs</code> file)\\ninto a JavaScript program suitable for evaluation with <code>compartment.evaluate</code>\\nusing a particular calling convention to initialize a module instance.</p>\\n<p dir=\\\"auto\\\">A compiled static module record has the following shape:</p>\\n<ul dir=\\\"auto\\\">\\n<li><code>imports</code> is a record that maps partial module specifiers to a list of\\nnames imported from the corresponding module.</li>\\n<li><code>exports</code> is an array of all the names that the module will export.</li>\\n<li><code>reexports</code> is an array of partial module specifier for which this\\nmodule exports all imported names.\\nThis field is optional.</li>\\n<li><code>__syncModuleProgram__</code> is a string that evaluates to a function that accepts\\nan initialization record and initializes the module.\\nThis property distinguishes this type of module record.\\nThe name implies a future record type that supports top-level await.\\n<ul dir=\\\"auto\\\">\\n<li>An initialization record has the properties <code>imports</code>, <code>liveVar</code>, <code>importMeta</code> and\\n<code>onceVar</code>.\\n<ul dir=\\\"auto\\\">\\n<li><code>imports</code> is a function that accepts a map from partial import\\nmodule specifiers to maps from names that the corresponding module\\nexports to notifier functions.\\nA notifier function accepts an update function and registers\\nto receive updates for the value exported by the other module.</li>\\n<li><code>importMeta</code> is a null-prototype object with keys transferred from <code>importMeta</code>\\nproperty in the envelope returned by importHook and/or mutated by\\ncalling <code>importMetaHook(moduleSpecifier, importMeta)</code></li>\\n<li><code>liveVar</code> is a record that maps names exported by this module\\nto a function that may be called to initialize or update\\nthe corresponding value in another module.</li>\\n<li><code>onceVar</code> is a record that maps constants exported by this\\nmodule to a function that may be called to initialize the\\ncorresponding value in another module.</li>\\n</ul>\\n</li>\\n</ul>\\n</li>\\n<li><code>__syncModuleFunctor__</code> is an optional function that if present is used\\ninstead of the evaluation of the <code>__syncModuleProgram__</code> string. It will be\\ncalled with the initialization record described above. It is intended to be\\nused in environments where eval is not available. Sandboxing of the functor is\\nthe responsibility of the author of the StaticModuleRecord.</li>\\n<li><code>__liveExportsMap__</code> is a record that maps import names or names in the lexical\\nscope of the module to export names, for variables that may change after\\ninitialization. Any reexported name is assumed to possibly change.\\nThe exported name is wrapped in a duple array like <code>[\\\"exportedName\\\", true]</code>.\\nThe second value, a boolean, indicates that the variable has a temporal\\ndead-zone (a time between creation and initialization) when access to that\\nname should throw a <code>ReferenceError</code>.</li>\\n<li><code>__fixedExportsMap__</code> is a record that maps import names to export names\\nfor constants exported by this module.\\nThe fixed exports map is an aesthetic subtype of the live exports map,\\nso the value is wrapped in a simple array like <code>[\\\"exportedName\\\"]</code></li>\\n</ul>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Transforms</h3><a id=\\\"user-content-transforms\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Transforms\\\" href=\\\"#transforms\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">The <code>Compartment</code> constructor accepts a <code>transforms</code> option.\\nThis is an array of JavaScript source to source translation functions,\\nin the order they should be applied.\\nPassing the source to the first function's input, then from each function's\\noutput to the next's input, the final function's output must be a valid\\nJavaScript \\\"Program\\\" grammar construction, code that is valid in a <code>&lt;script&gt;</code>,\\nnot a module.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const transforms = [addCodeCoverageInstrumentation];\\nconst c = new Compartment({ console, coverage }, null, { transforms });\\nc.evaluate('console.log(&quot;Hello&quot;);');\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">transforms</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-kos\\\">[</span><span class=\\\"pl-s1\\\">addCodeCoverageInstrumentation</span><span class=\\\"pl-kos\\\">]</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span> console<span class=\\\"pl-kos\\\">,</span> coverage <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-c1\\\">null</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span> transforms <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'console.log(\\\"Hello\\\");'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<p dir=\\\"auto\\\">The <code>evaluate</code> method of a compartment also accepts a <code>transforms</code> option.\\nThese apply before and in addition to the compartment-scoped transforms.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const transform = source =&gt; source.replace(/Farewell/g, 'Hello');\\nconst transforms = [transform];\\nc.evaluate('console.log(&quot;Farewell, World!&quot;)', { transforms });\\n// Hello, World!\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-en\\\">transform</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-s1\\\">source</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-s1\\\">source</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">replace</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-pds\\\"><span class=\\\"pl-c1\\\">/</span>Farewell<span class=\\\"pl-c1\\\">/</span>g</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-s\\\">'Hello'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">transforms</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-kos\\\">[</span><span class=\\\"pl-en\\\">transform</span><span class=\\\"pl-kos\\\">]</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'console.log(\\\"Farewell, World!\\\")'</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span> transforms <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-c\\\">// Hello, World!</span></pre></div>\\n<p dir=\\\"auto\\\">These transforms do not apply to modules.\\nTo transform the source of a JavaScript module, the <code>importHook</code> must\\nintercept the source and transform it before passing it to the\\n<code>StaticModuleRecord</code> constructor.\\nThese are distinct because programs and modules have distinct grammar\\nproductions.</p>\\n<p dir=\\\"auto\\\">An <strong>internal implementation detail</strong> of the SES-shim is that it\\nconverts modules to programs and evaluates them as programs.\\nSo, only for this implementation of <code>Compartment</code>, it is possible for a program\\ntransform to be equally applicable for modules, but that transform will\\nhave a window into the internal translation, will be sensitive to changes to\\nthat translation between any pair of releases, even those that do not disclose\\nany breaking changes, and will only work on SES-shim, not any other\\nimplementation of <code>Compartment</code> like the one provided by XS.</p>\\n<p dir=\\\"auto\\\">The SES-shim <code>Compartment</code> constructor accepts a <code>__shimTransforms__</code>\\noption for this purpose.\\nFor the <code>Compartment</code> to use the same transforms for both evaluated strings\\nand modules converted to programs, pass them as <code>__shimTransforms__</code>\\ninstead of <code>transforms</code>.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"const __shimTransforms__ = [addCoverage];\\nconst c = new Compartment({ console, coverage }, null, {\\n  __shimTransforms__,\\n});\\nc.evaluate('console.log(&quot;Hello&quot;);');\\\"><pre><span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">__shimTransforms__</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-kos\\\">[</span><span class=\\\"pl-s1\\\">addCoverage</span><span class=\\\"pl-kos\\\">]</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">c</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span> console<span class=\\\"pl-kos\\\">,</span> coverage <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-c1\\\">null</span><span class=\\\"pl-kos\\\">,</span> <span class=\\\"pl-kos\\\">{</span>\\n  __shimTransforms__<span class=\\\"pl-kos\\\">,</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">c</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s\\\">'console.log(\\\"Hello\\\");'</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<p dir=\\\"auto\\\">The <code>__shimTransforms__</code> feature is designed to uphold the security properties\\nof compartments, since an attacker may use all available features, whether they\\nare standard or not.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Logging Errors</h3><a id=\\\"user-content-logging-errors\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Logging Errors\\\" href=\\\"#logging-errors\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\"><code>lockdown()</code> adds new global <code>assert</code> and tames the global <code>console</code>. The error\\ntaming hides error stacks, accumulating them in side tables. The <code>assert</code>\\nsystem generates other diagnostic information hidden in side tables. The tamed\\nconsole uses these side tables to output more informative diagnostics.\\n<a href=\\\"/endojs/endo/blob/master/packages/ses/src/error/README.md\\\">Logging Errors</a> explains the design.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h2 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Security claims and caveats</h2><a id=\\\"user-content-security-claims-and-caveats\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Security claims and caveats\\\" href=\\\"#security-claims-and-caveats\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">The <code>ses</code> shim concerns boundaries between programs in the same process and\\nJavaScript realm.\\nIn terms of the <a href=\\\"https://papers.agoric.com/taxonomy-of-security-issues/\\\" rel=\\\"nofollow\\\">Taxonomy of Security Issues</a>,\\nthe <code>ses</code> shim creates a boundary that is finer than an operating system\\nprocess or thread and facilitates boundaries as fine as individual objects.\\nWhile <code>ses</code> can interpose at granularities where process isolation is not a\\nviable boundary, as between an application and its dependencies or between a\\nplatform and a plugin, <code>ses</code> combines well with coarser boundaries for defense\\nin depth.</p>\\n<p dir=\\\"auto\\\">For the purposes of these claims and caveats, a \\\"host program\\\" is a program\\nthat arranges <code>ses</code>, calls <code>lockdown</code>, and orchestrates one or more \\\"guest\\nprograms\\\", providing limited access to its resources.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Single-guest Compartment Isolation</h3><a id=\\\"user-content-single-guest-compartment-isolation\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Single-guest Compartment Isolation\\\" href=\\\"#single-guest-compartment-isolation\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Provided that the <code>ses</code> implementation and its\\n<a href=\\\"#trusted-compute-base\\\">trusted compute base</a> are correct, we claim that a host\\nprogram can evaluate a guest program (<code>program</code>) in a compartment after\\n<code>lockdown</code> and that the guest program:</p>\\n<ul dir=\\\"auto\\\">\\n<li>will initially only have access to one mutable object, the compartment's\\n<code>globalThis</code>,</li>\\n<li>specifically cannot modify any shared primordial objects, which are part of\\nthe default execution environment,</li>\\n<li>cannot initially perform any I/O (except I/O necessarily performed by the\\ntrusted compute base like paging virtual memory),</li>\\n<li>and specifically cannot measure the passage of time at any resolution.</li>\\n</ul>\\n<p dir=\\\"auto\\\">However, such a program can:</p>\\n<ul dir=\\\"auto\\\">\\n<li>execute for an indefinite amount of time,</li>\\n<li>allocate arbitrary amounts of memory,</li>\\n<li>detect the platform endianness,</li>\\n<li>in some JavaScript engines, observe the contents of the stack.\\nThis may include sensitive information about the layout of files on the host\\ndisk.\\nIn cases where the stack is data-dependent, a guest can infer the data.\\n<code>ses</code> occludes the stack on V8 and SpiderMonkey, but cannot on\\nJavaScriptCore.</li>\\n</ul>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"lockdown();\\nconst compartment = new Compartment();\\ncompartment.evaluate(program);\\\"><pre><span class=\\\"pl-en\\\">lockdown</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">compartment</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">compartment</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">program</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Multi-guest Compartment Isolation</h3><a id=\\\"user-content-multi-guest-compartment-isolation\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Multi-guest Compartment Isolation\\\" href=\\\"#multi-guest-compartment-isolation\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">If the host program arranges for the compartment's <code>globalThis</code> to\\nbe frozen, we additionally claim that the host can evaluate any two guest\\nprograms (<code>program1</code> and <code>program2</code>) in that compartment such that neither\\nguest program will:</p>\\n<ul dir=\\\"auto\\\">\\n<li>initially share <em>any</em> mutable objects.</li>\\n<li>be able to observe the relative passage of time of the other program,\\nas they would had they been given a reference to a working <code>Date.now()</code>.</li>\\n<li>be able to communicate, as they would if they had shared access to mutable\\nstate like an unfrozen object, a hardened collection like a <code>Map</code>, or even\\n<code>Math.random()</code>.</li>\\n</ul>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"lockdown();\\nconst compartment = new Compartment();\\nharden(compartment.globaThis);\\ncompartment.evaluate(program1);\\ncompartment.evaluate(program2);\\\"><pre><span class=\\\"pl-en\\\">lockdown</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">compartment</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-en\\\">harden</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">compartment</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-c1\\\">globaThis</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">compartment</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">program1</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">compartment</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">program2</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Endowment Protection</h3><a id=\\\"user-content-endowment-protection\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Endowment Protection\\\" href=\\\"#endowment-protection\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">The above <code>program</code>, <code>program1</code>, and <code>program2</code> guest programs are only useful\\nas glorified calculators.\\nWhen going beyond that by \\\"endowing\\\" a compartment with extra objects, a host\\nprogram is responsible for maintaining any of the invariants above that it\\nconsiders necessary.</p>\\n<p dir=\\\"auto\\\">For example, a host program may run two guest programs in separate\\ncompartments, giving one the ability to resolve a promise and the other\\nthe ability to observe the settlement (fulfillment or rejection) of\\nthat promise.\\nThe host program is responsible for hardening the objects implementing such\\nabilities.</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"lockdown();\\n\\nconst promise = new Promise(resolve =&gt; {\\n  const compartmentA = new Compartment(harden({ resolve }));\\n  compartmentA.evaluate(programA);\\n});\\n\\nconst compartmentB = new Compartment(harden({ promise }));\\ncompartmentB.evaluate(programB);\\\"><pre><span class=\\\"pl-en\\\">lockdown</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">promise</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Promise</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">resolve</span> <span class=\\\"pl-c1\\\">=&gt;</span> <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">compartmentA</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-en\\\">harden</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span> resolve <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n  <span class=\\\"pl-s1\\\">compartmentA</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">programA</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n\\n<span class=\\\"pl-k\\\">const</span> <span class=\\\"pl-s1\\\">compartmentB</span> <span class=\\\"pl-c1\\\">=</span> <span class=\\\"pl-k\\\">new</span> <span class=\\\"pl-v\\\">Compartment</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-en\\\">harden</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-kos\\\">{</span> promise <span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span>\\n<span class=\\\"pl-s1\\\">compartmentB</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">evaluate</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-s1\\\">programB</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<p dir=\\\"auto\\\">With <code>ses</code>, guest programs are initially powerless.\\nA host can explicitly share limited powers with guest programs\\nand provide intentional communication channels between them.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Caveats</h3><a id=\\\"user-content-caveats\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Caveats\\\" href=\\\"#caveats\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Host programs must maintain the <code>ses</code> boundary with care in what they present\\nas endowments.\\nA host program should take care not to share mutable state with guests,\\nor distribute mutable state to multiple guests, such as an object that has not\\nbeen frozen with <code>harden</code> or a collection like a <code>Map</code> or <code>Set</code> or typed array\\n(collections retain some mutability even if hardened).</p>\\n<p dir=\\\"auto\\\">For the purposes of sharing state, pseudo-random number generators (PRNG) like\\n<code>Math.random()</code> are equivalent to read and write access to shared state, and\\nany guest can use one to eavesdrop on other guests or the host that share one.</p>\\n<p dir=\\\"auto\\\">If a guest program needs a high resolution timer to function, the host should\\nonly invite one guest to a single operating system process and limit the\\nactivity of the host program in the same process.</p>\\n<p dir=\\\"auto\\\">Hosts must avoid exposing <code>SharedArrayBuffer</code> to guests.\\nAny two JavaScript programs sharing a <code>SharedArrayBuffer</code> can use the shared\\nbuffer to construct a high resolution timer.</p>\\n<p dir=\\\"auto\\\">The <code>ses</code> shim does not in itself isolate the stack of guest programs, even\\nwhen evaluated in separate compartments.\\nThis is relevant when objects are shared between guest programs.</p>\\n<p dir=\\\"auto\\\">When a program interacts with an object introduced by another program (as\\nthrough the per-compartment <code>globalThis</code>, function arguments or returned\\nvalues), there are potential risks due to the synchronous nature of object\\naccess.\\nEven interactions that are not explicit function calls may cause code from\\nanother program, like property accessors or proxy traps, to execute on the same\\nstack, which may be able to detect the stack height, throw an exception, or call\\nback into the program in pursuit of a reentrancy attack.</p>\\n<p dir=\\\"auto\\\">A host object can defend itself from reentrancy attacks by ensuring that it\\ninteracts with guest objects on a clean stack through the use of promises.</p>\\n<p dir=\\\"auto\\\">Within these constraints, a host program can provide objects that grant limited\\nI/O capabilities to guest programs, and even revoke or suspend those\\ncapabilities at runtime.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h3 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Trusted Compute Base</h3><a id=\\\"user-content-trusted-compute-base\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Trusted Compute Base\\\" href=\\\"#trusted-compute-base\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">The trusted compute base (TCB) for <code>ses</code> includes:</p>\\n<ul dir=\\\"auto\\\">\\n<li>the host hardware,</li>\\n<li>the host operating system,</li>\\n<li>any intermediate virtual operating systems or hypervisors,</li>\\n<li>the process memory manager,</li>\\n<li>an implementation of JavaScript conforming to ECMAScript 262 as of\\n2021, providing no unspecified embedding host behavior like the introduction of syntax\\nthat when evaluated reveals a mutable object.\\n<code>ses</code> accounts for one such host behavior provided by Node.js, namely the <code>domain</code>\\nproperty on promises, by preventing the use of <code>ses</code> in concert with the\\n<code>domain</code> module.</li>\\n<li>Also, any attached debugger, and</li>\\n<li>any JavaScript that has executed in the same realm before the host program calls\\n<code>lockdown</code>, including JavaScript that executes after <code>ses</code> initializes.</li>\\n</ul>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h2 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Audits</h2><a id=\\\"user-content-audits\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Audits\\\" href=\\\"#audits\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">In June 2021, <code>ses</code> underwent formal third party vulnerability assessment over a\\nperiod of 4 weeks with 3 engineers and a dedicated project manager that\\nsurfaced no unknown security issues or vulnerabilities within the code. As a\\nresult of this assessment, <a href=\\\"https://github.com/endojs/endo/issues/126\\\" data-hovercard-type=\\\"issue\\\" data-hovercard-url=\\\"/endojs/endo/issues/126/hovercard\\\">a single code change was\\nmade</a> to set a flag to disable the\\ndomain module in Node.js to mitigate a known issue identified in the code.  The\\ncode will be the subject of another round of intense application security\\nreview mid-2022 by a reputable application security firm renowned for their\\nresults in security reviews.</p>\\n<p dir=\\\"auto\\\">In July 2021, <code>ses</code> was the target of an intensive collaborative bug hunt lead by\\nthe MetaMask team.\\nNo critical flaws in the code surfaced during the review.\\nAs a result of the search for flaws, deficiencies, and weaknesses in the code,\\na series of small code changes and documentation improvements were made. There\\nis a report available on the\\n<a href=\\\"https://agoric.com/blog/technology/purple-teaming-how-metamask-and-agoric-hunted-bugs-to-harden-javascript\\\" rel=\\\"nofollow\\\">Agoric blog</a>\\nthat includes links to recordings of code walk-throughs and technical\\ndiscussion, and issues are tagged\\n<a href=\\\"https://github.com/endojs/endo/issues?q=label%3Aaudit-sestival\\\">audit-SEStival</a>.\\nThe <a href=\\\"https://www.youtube.com/playlist?list=PLzDw4TTug5O2d1XOdB7VNCZbIxRZu3gov\\\" rel=\\\"nofollow\\\">video recordings of the MetaMask and Agoric collaborative\\nreview</a>.\\nprovide useful background for future audits, reviews, and for learning more\\nabout how the <code>ses</code> shim constructs a Hardened JavaScript environment.</p>\\n<p dir=\\\"auto\\\">In addition to vulnerability assessments, active efforts to <a href=\\\"https://agoric.com/blog/technology/the-path-to-verified-blds-how-informal-systems-and-agoric-are-using-formal\\\" rel=\\\"nofollow\\\">formally verify\\nthe Agoric kernel</a>\\nhave found the object capability model that <code>ses</code> provides to be sound.</p>\\n<p dir=\\\"auto\\\">Hardened JavaScript is also within the scope of the <a href=\\\"https://hackerone.com/agoric\\\" rel=\\\"nofollow\\\">Agoric bug bounty\\nprogram</a>, which rewards researchers for surfacing valid\\nbugs in our code. We welcome the opportunity to cooperate with researchers,\\nwhose efforts will undoubtedly yield stronger, more resilient code.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h2 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Bug Disclosure</h2><a id=\\\"user-content-bug-disclosure\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Bug Disclosure\\\" href=\\\"#bug-disclosure\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Please help us practice coordinated security bug disclosure, by using the\\ninstructions in <a href=\\\"https://github.com/endojs/endo/blob/master/packages/ses/SECURITY.md\\\">SECURITY.md</a> to report security-sensitive bugs privately.</p>\\n<p dir=\\\"auto\\\">For non-security bugs, please use the <a href=\\\"https://github.com/endojs/endo/issues\\\">regular Issues page</a>.</p>\\n<div class=\\\"markdown-heading\\\" dir=\\\"auto\\\"><h2 tabindex=\\\"-1\\\" class=\\\"heading-element\\\" dir=\\\"auto\\\">Ecosystem Compatibility</h2><a id=\\\"user-content-ecosystem-compatibility\\\" class=\\\"anchor-element\\\" aria-label=\\\"Permalink: Ecosystem Compatibility\\\" href=\\\"#ecosystem-compatibility\\\"><svg class=\\\"octicon octicon-link\\\" viewBox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" width=\\\"16\\\" height=\\\"16\\\" aria-hidden=\\\"true\\\"><path d=\\\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\\\"></path></svg></a></div>\\n<p dir=\\\"auto\\\">Most ordinary JavaScript can run without issues in a realm locked down by SES.\\nExceptions are tracked at <a href=\\\"https://github.com/endojs/endo/issues/576\\\" data-hovercard-type=\\\"issue\\\" data-hovercard-url=\\\"/endojs/endo/issues/576/hovercard\\\">issue #576</a>, and almost\\nalways take the form of assignments that fail because the\\n\\\"<a href=\\\"https://web.archive.org/web/20141230041441/http://wiki.ecmascript.org/doku.php?id=strawman:fixing_override_mistake\\\" rel=\\\"nofollow\\\">override mistake</a>\\\" prevents overriding properties inherited\\nfrom a frozen intrinsic object in the prototype chain. When that is the case,\\nthe code is often incompatible with <em>all</em> environments in which intrinsic\\nobjects are frozen (such as in Node.js with the\\n<a href=\\\"https://nodejs.org/docs/latest/api/cli.html#--frozen-intrinsics\\\" rel=\\\"nofollow\\\"><code>--frozen-intrinsics</code></a> option) and can be fixed by\\nreplacing <code>&lt;lhs&gt;.&lt;propertyKey&gt; = &lt;rhs&gt;;</code> or <code>&lt;lhs&gt;[&lt;propertyKey&gt;] = &lt;rhs&gt;;</code> with</p>\\n<div class=\\\"highlight highlight-source-js notranslate position-relative overflow-auto\\\" dir=\\\"auto\\\" data-snippet-clipboard-copy-content=\\\"Object.defineProperties(&lt;lhs&gt;, {\\n  [&lt;propertyKey&gt;]: {\\n    value: &lt;rhs&gt;,\\n    writable: true,\\n    enumerable: true,\\n    configurable: true,\\n  },\\n});\\\"><pre><span class=\\\"pl-v\\\">Object</span><span class=\\\"pl-kos\\\">.</span><span class=\\\"pl-en\\\">defineProperties</span><span class=\\\"pl-kos\\\">(</span><span class=\\\"pl-c1\\\">&lt;</span><span class=\\\"pl-ent\\\">lhs</span><span class=\\\"pl-c1\\\">&gt;</span>, <span class=\\\"pl-kos\\\">{</span>\\n  <span class=\\\"pl-kos\\\">[</span><span class=\\\"pl-c1\\\">&lt;</span><span class=\\\"pl-ent\\\">propertyKey</span><span class=\\\"pl-c1\\\">&gt;</span>]: <span class=\\\"pl-kos\\\">{</span>\\n    <span class=\\\"pl-s1\\\">value</span>: <span class=\\\"pl-c1\\\">&lt;</span><span class=\\\"pl-s1\\\">rhs</span><span class=\\\"pl-c1\\\">&gt;</span><span class=\\\"pl-kos\\\">,</span>\\n    <span class=\\\"pl-s1\\\">writable</span>: <span class=\\\"pl-c1\\\">true</span><span class=\\\"pl-kos\\\">,</span>\\n    <span class=\\\"pl-s1\\\">enumerable</span>: <span class=\\\"pl-c1\\\">true</span><span class=\\\"pl-kos\\\">,</span>\\n    <span class=\\\"pl-s1\\\">configurable</span>: <span class=\\\"pl-c1\\\">true</span><span class=\\\"pl-kos\\\">,</span>\\n  <span class=\\\"pl-kos\\\">}</span>,\\n<span class=\\\"pl-kos\\\">}</span><span class=\\\"pl-kos\\\">)</span><span class=\\\"pl-kos\\\">;</span></pre></div>\\n<p dir=\\\"auto\\\">Upon encountering an incompatibility, we recommend that you add a comment to\\n<a href=\\\"https://github.com/endojs/endo/issues/576\\\" data-hovercard-type=\\\"issue\\\" data-hovercard-url=\\\"/endojs/endo/issues/576/hovercard\\\">issue #576</a> and file an issue with the external\\nproject referencing this section.\\nProjects often have their own unique issue reporting templates, but generally\\nprovide some place to include text like</p>\\n<blockquote>\\n<div class=\\\"snippet-clipboard-content notranslate position-relative overflow-auto\\\" data-snippet-clipboard-copy-content=\\\"This project has some assignments that break in an environment with frozen\\nintrinsic objects, such as\\n[Hardened JS (a.k.a. SES)](https://github.com/endojs/endo/blob/master/packages/ses#ecosystem-compatibility)\\nor Node.js with the\\n[`--frozen-intrinsics`](https://nodejs.org/docs/latest/api/cli.html#--frozen-intrinsics)\\noption.\\nSpecifically, [link to source in the project] does not work correctly in such\\nan environment.\\n\\nPlease consider increasing support by replacing assignments to object\\nproperties inherited from intrinsics with use of `Object.defineProperties`\\n(thereby working around the JavaScript &quot;override mistake&quot;), and if applicable\\nalso by avoiding mutation of intrinsic objects.\\nIf you don't have the capacity but would accept a PR, please comment to that\\neffect so that a volunteer knows their efforts would be welcomed.\\\"><pre class=\\\"notranslate\\\"><code>This project has some assignments that break in an environment with frozen\\nintrinsic objects, such as\\n[Hardened JS (a.k.a. SES)](https://github.com/endojs/endo/blob/master/packages/ses#ecosystem-compatibility)\\nor Node.js with the\\n[`--frozen-intrinsics`](https://nodejs.org/docs/latest/api/cli.html#--frozen-intrinsics)\\noption.\\nSpecifically, [link to source in the project] does not work correctly in such\\nan environment.\\n\\nPlease consider increasing support by replacing assignments to object\\nproperties inherited from intrinsics with use of `Object.defineProperties`\\n(thereby working around the JavaScript \\\"override mistake\\\"), and if applicable\\nalso by avoiding mutation of intrinsic objects.\\nIf you don't have the capacity but would accept a PR, please comment to that\\neffect so that a volunteer knows their efforts would be welcomed.\\n</code></pre></div>\\n</blockquote>\\n<p dir=\\\"auto\\\">We find that library authors are generally amenable to making these small changes to increase\\ncompatibility with any environment that protects itself from prototype pollution attacks by freezing\\nintrinsics, including <code>ses</code>.</p>\\n</article>\",\"errorMessage\":null,\"headerInfo\":{\"toc\":[{\"level\":1,\"text\":\"SES\",\"anchor\":\"ses\",\"htmlText\":\"SES\"},{\"level\":2,\"text\":\"Install\",\"anchor\":\"install\",\"htmlText\":\"Install\"},{\"level\":2,\"text\":\"Usage\",\"anchor\":\"usage\",\"htmlText\":\"Usage\"},{\"level\":3,\"text\":\"Lockdown\",\"anchor\":\"lockdown\",\"htmlText\":\"Lockdown\"},{\"level\":3,\"text\":\"Harden\",\"anchor\":\"harden\",\"htmlText\":\"Harden\"},{\"level\":3,\"text\":\"Compartment\",\"anchor\":\"compartment\",\"htmlText\":\"Compartment\"},{\"level\":3,\"text\":\"Compartment + Lockdown\",\"anchor\":\"compartment--lockdown\",\"htmlText\":\"Compartment + Lockdown\"},{\"level\":3,\"text\":\"Modules\",\"anchor\":\"modules\",\"htmlText\":\"Modules\"},{\"level\":3,\"text\":\"importHook aliases\",\"anchor\":\"importhook-aliases\",\"htmlText\":\"importHook aliases\"},{\"level\":3,\"text\":\"moduleMapHook\",\"anchor\":\"modulemaphook\",\"htmlText\":\"moduleMapHook\"},{\"level\":3,\"text\":\"Third-party modules\",\"anchor\":\"third-party-modules\",\"htmlText\":\"Third-party modules\"},{\"level\":3,\"text\":\"Compiled modules\",\"anchor\":\"compiled-modules\",\"htmlText\":\"Compiled modules\"},{\"level\":3,\"text\":\"Transforms\",\"anchor\":\"transforms\",\"htmlText\":\"Transforms\"},{\"level\":3,\"text\":\"Logging Errors\",\"anchor\":\"logging-errors\",\"htmlText\":\"Logging Errors\"},{\"level\":2,\"text\":\"Security claims and caveats\",\"anchor\":\"security-claims-and-caveats\",\"htmlText\":\"Security claims and caveats\"},{\"level\":3,\"text\":\"Single-guest Compartment Isolation\",\"anchor\":\"single-guest-compartment-isolation\",\"htmlText\":\"Single-guest Compartment Isolation\"},{\"level\":3,\"text\":\"Multi-guest Compartment Isolation\",\"anchor\":\"multi-guest-compartment-isolation\",\"htmlText\":\"Multi-guest Compartment Isolation\"},{\"level\":3,\"text\":\"Endowment Protection\",\"anchor\":\"endowment-protection\",\"htmlText\":\"Endowment Protection\"},{\"level\":3,\"text\":\"Caveats\",\"anchor\":\"caveats\",\"htmlText\":\"Caveats\"},{\"level\":3,\"text\":\"Trusted Compute Base\",\"anchor\":\"trusted-compute-base\",\"htmlText\":\"Trusted Compute Base\"},{\"level\":2,\"text\":\"Audits\",\"anchor\":\"audits\",\"htmlText\":\"Audits\"},{\"level\":2,\"text\":\"Bug Disclosure\",\"anchor\":\"bug-disclosure\",\"htmlText\":\"Bug Disclosure\"},{\"level\":2,\"text\":\"Ecosystem Compatibility\",\"anchor\":\"ecosystem-compatibility\",\"htmlText\":\"Ecosystem Compatibility\"}],\"siteNavLoginPath\":\"/login?return_to=https%3A%2F%2Fgithub.com%2Fendojs%2Fendo%2Ftree%2Fmaster%2Fpackages%2Fses\"}},\"totalCount\":29,\"showBranchInfobar\":false},\"fileTree\":{\"packages\":{\"items\":[{\"name\":\"base64\",\"path\":\"packages/base64\",\"contentType\":\"directory\"},{\"name\":\"bundle-source\",\"path\":\"packages/bundle-source\",\"contentType\":\"directory\"},{\"name\":\"captp\",\"path\":\"packages/captp\",\"contentType\":\"directory\"},{\"name\":\"check-bundle\",\"path\":\"packages/check-bundle\",\"contentType\":\"directory\"},{\"name\":\"cjs-module-analyzer\",\"path\":\"packages/cjs-module-analyzer\",\"contentType\":\"directory\"},{\"name\":\"cli\",\"path\":\"packages/cli\",\"contentType\":\"directory\"},{\"name\":\"common\",\"path\":\"packages/common\",\"contentType\":\"directory\"},{\"name\":\"compartment-mapper\",\"path\":\"packages/compartment-mapper\",\"contentType\":\"directory\"},{\"name\":\"daemon\",\"path\":\"packages/daemon\",\"contentType\":\"directory\"},{\"name\":\"env-options\",\"path\":\"packages/env-options\",\"contentType\":\"directory\"},{\"name\":\"errors\",\"path\":\"packages/errors\",\"contentType\":\"directory\"},{\"name\":\"eslint-plugin\",\"path\":\"packages/eslint-plugin\",\"contentType\":\"directory\"},{\"name\":\"evasive-transform\",\"path\":\"packages/evasive-transform\",\"contentType\":\"directory\"},{\"name\":\"eventual-send\",\"path\":\"packages/eventual-send\",\"contentType\":\"directory\"},{\"name\":\"exo\",\"path\":\"packages/exo\",\"contentType\":\"directory\"},{\"name\":\"far\",\"path\":\"packages/far\",\"contentType\":\"directory\"},{\"name\":\"import-bundle\",\"path\":\"packages/import-bundle\",\"contentType\":\"directory\"},{\"name\":\"init\",\"path\":\"packages/init\",\"contentType\":\"directory\"},{\"name\":\"lockdown\",\"path\":\"packages/lockdown\",\"contentType\":\"directory\"},{\"name\":\"lp32\",\"path\":\"packages/lp32\",\"contentType\":\"directory\"},{\"name\":\"marshal\",\"path\":\"packages/marshal\",\"contentType\":\"directory\"},{\"name\":\"memoize\",\"path\":\"packages/memoize\",\"contentType\":\"directory\"},{\"name\":\"nat\",\"path\":\"packages/nat\",\"contentType\":\"directory\"},{\"name\":\"netstring\",\"path\":\"packages/netstring\",\"contentType\":\"directory\"},{\"name\":\"pass-style\",\"path\":\"packages/pass-style\",\"contentType\":\"directory\"},{\"name\":\"patterns\",\"path\":\"packages/patterns\",\"contentType\":\"directory\"},{\"name\":\"promise-kit\",\"path\":\"packages/promise-kit\",\"contentType\":\"directory\"},{\"name\":\"ses-ava\",\"path\":\"packages/ses-ava\",\"contentType\":\"directory\"},{\"name\":\"ses\",\"path\":\"packages/ses\",\"contentType\":\"directory\"},{\"name\":\"skel\",\"path\":\"packages/skel\",\"contentType\":\"directory\"},{\"name\":\"static-module-record\",\"path\":\"packages/static-module-record\",\"contentType\":\"directory\"},{\"name\":\"stream-node\",\"path\":\"packages/stream-node\",\"contentType\":\"directory\"},{\"name\":\"stream-types-test\",\"path\":\"packages/stream-types-test\",\"contentType\":\"directory\"},{\"name\":\"stream\",\"path\":\"packages/stream\",\"contentType\":\"directory\"},{\"name\":\"syrup\",\"path\":\"packages/syrup\",\"contentType\":\"directory\"},{\"name\":\"test262-runner\",\"path\":\"packages/test262-runner\",\"contentType\":\"directory\"},{\"name\":\"where\",\"path\":\"packages/where\",\"contentType\":\"directory\"},{\"name\":\"zip\",\"path\":\"packages/zip\",\"contentType\":\"directory\"}],\"totalCount\":38},\"\":{\"items\":[{\"name\":\".github\",\"path\":\".github\",\"contentType\":\"directory\"},{\"name\":\"browser-test\",\"path\":\"browser-test\",\"contentType\":\"directory\"},{\"name\":\"packages\",\"path\":\"packages\",\"contentType\":\"directory\"},{\"name\":\"patches\",\"path\":\"patches\",\"contentType\":\"directory\"},{\"name\":\"scripts\",\"path\":\"scripts\",\"contentType\":\"directory\"},{\"name\":\".git-blame-ignore-revs\",\"path\":\".git-blame-ignore-revs\",\"contentType\":\"file\"},{\"name\":\".gitattributes\",\"path\":\".gitattributes\",\"contentType\":\"file\"},{\"name\":\".gitignore\",\"path\":\".gitignore\",\"contentType\":\"file\"},{\"name\":\".prettierignore\",\"path\":\".prettierignore\",\"contentType\":\"file\"},{\"name\":\".prettierrc.json\",\"path\":\".prettierrc.json\",\"contentType\":\"file\"},{\"name\":\"CONTRIBUTING.md\",\"path\":\"CONTRIBUTING.md\",\"contentType\":\"file\"},{\"name\":\"LICENSE\",\"path\":\"LICENSE\",\"contentType\":\"file\"},{\"name\":\"README.md\",\"path\":\"README.md\",\"contentType\":\"file\"},{\"name\":\"SECURITY.md\",\"path\":\"SECURITY.md\",\"contentType\":\"file\"},{\"name\":\"lerna.json\",\"path\":\"lerna.json\",\"contentType\":\"file\"},{\"name\":\"package.json\",\"path\":\"package.json\",\"contentType\":\"file\"},{\"name\":\"tsconfig-build-options.json\",\"path\":\"tsconfig-build-options.json\",\"contentType\":\"file\"},{\"name\":\"tsconfig.build.json\",\"path\":\"tsconfig.build.json\",\"contentType\":\"file\"},{\"name\":\"tsconfig.eslint-base.json\",\"path\":\"tsconfig.eslint-base.json\",\"contentType\":\"file\"},{\"name\":\"tsconfig.eslint-full.json\",\"path\":\"tsconfig.eslint-full.json\",\"contentType\":\"file\"},{\"name\":\"tsconfig.eslint-src.json\",\"path\":\"tsconfig.eslint-src.json\",\"contentType\":\"file\"},{\"name\":\"tsconfig.json\",\"path\":\"tsconfig.json\",\"contentType\":\"file\"},{\"name\":\"typedoc.base.json\",\"path\":\"typedoc.base.json\",\"contentType\":\"file\"},{\"name\":\"typedoc.json\",\"path\":\"typedoc.json\",\"contentType\":\"file\"},{\"name\":\"yarn.lock\",\"path\":\"yarn.lock\",\"contentType\":\"file\"}],\"totalCount\":25}},\"fileTreeProcessingTime\":14.062052,\"foldersToFetch\":[],\"treeExpanded\":true,\"symbolsExpanded\":false,\"csrf_tokens\":{\"/endojs/endo/branches\":{\"post\":\"U3hAgE_IUBCjY3FccZ3zyGLe4_5qQV-3odODP6U0QNavnFyiijuU1rsbgAVjqJWWG6-yn48uqJRS2Kv2BN7wOA\"},\"/endojs/endo/branches/fetch_and_merge/master\":{\"post\":\"cTatVLDh-UUCkKGkSom_HpBZlg2caGLderCx2RGSBMI3xphX2VzglYuY5cJXfB9aVfpWD4KtBJYdMOkaxSYb5A\"},\"/endojs/endo/branches/fetch_and_merge/master?discard_changes=true\":{\"post\":\"ymIBE0I6xAmOdBYEpDoBD40TmLJVpt8nIfXE0LNRy2aMkjQQK4fd2Qd8UmK5z6FLSLBYsEtjuWxGdZwTZ-XUQA\"}}},\"title\":\"endo/packages/ses at master \u00b7 endojs/endo\"}",
  "embeddings": []
}